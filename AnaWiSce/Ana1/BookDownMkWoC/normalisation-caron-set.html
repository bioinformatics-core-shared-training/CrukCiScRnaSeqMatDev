<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Normalisation - Caron set | CRUK Bioinformatics Summer School 2020 - single-cell RNA-seq analysis</title>
  <meta name="description" content="A report for all analyses (bookdown::gitbook)." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Normalisation - Caron set | CRUK Bioinformatics Summer School 2020 - single-cell RNA-seq analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A report for all analyses (bookdown::gitbook)." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Normalisation - Caron set | CRUK Bioinformatics Summer School 2020 - single-cell RNA-seq analysis" />
  
  <meta name="twitter:description" content="A report for all analyses (bookdown::gitbook)." />
  

<meta name="author" content="Stephane Ballereau, Zeynep Kalender Atak" />


<meta name="date" content="2021-04-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="NormalisationAllCells.html"/>
<link rel="next" href="normalisation-gsm3872434-set.html"/>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.18/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
.row { display: flex; }
.collapse { display: none; }
.in { display:block }
.pull-right > .dropdown-menu {
    right: 0;
    left: auto;
}
.open > .dropdown-menu {
    display: block;
}
.dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 1000;
    display: none;
    float: left;
    min-width: 160px;
    padding: 5px 0;
    margin: 2px 0 0;
    font-size: 14px;
    text-align: left;
    list-style: none;
    background-color: #fff;
    -webkit-background-clip: padding-box;
    background-clip: padding-box;
    border: 1px solid #ccc;
    border: 1px solid rgba(0,0,0,.15);
    border-radius: 4px;
    -webkit-box-shadow: 0 6px 12px rgba(0,0,0,.175);
    box-shadow: 0 6px 12px rgba(0,0,0,.175);
}
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>


<script>
document.write('<div class="btn-group pull-right" style="position: absolute; top: 20%; right: 2%; z-index: 200"><button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-_extension-text-contrast=""><span>Code</span> <span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All Code</a></li><li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li></ul></div>')
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">CRUK Functional Genomics Summer School 2020</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preamble</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-study"><i class="fa fa-check"></i><b>1.1</b> The study</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#the-plan"><i class="fa fa-check"></i><b>1.2</b> The plan</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#the-analyses"><i class="fa fa-check"></i><b>1.3</b> The analyses</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#overall-summary"><i class="fa fa-check"></i><b>1.4</b> Overall summary</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#conclusion"><i class="fa fa-check"></i><b>1.5</b> Conclusion</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#abbreviations"><i class="fa fa-check"></i><b>1.6</b> Abbreviations</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="SeqQualTop.html"><a href="SeqQualTop.html"><i class="fa fa-check"></i><b>2</b> Sequence Quality</a><ul>
<li class="chapter" data-level="2.1" data-path="SeqQualTop.html"><a href="SeqQualTop.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="SeqQualTop.html"><a href="SeqQualTop.html#caronbourque2020---fastqc"><i class="fa fa-check"></i><b>2.2</b> CaronBourque2020 - fastqc</a></li>
<li class="chapter" data-level="2.3" data-path="SeqQualTop.html"><a href="SeqQualTop.html#caronbourque2020---multiqc"><i class="fa fa-check"></i><b>2.3</b> CaronBourque2020 - MultiQC</a><ul>
<li class="chapter" data-level="2.3.1" data-path="SeqQualTop.html"><a href="SeqQualTop.html#sample-index-i1"><i class="fa fa-check"></i><b>2.3.1</b> sample index: I1</a></li>
<li class="chapter" data-level="2.3.2" data-path="SeqQualTop.html"><a href="SeqQualTop.html#cell-barcode-umi-r1"><i class="fa fa-check"></i><b>2.3.2</b> cell barcode + UMI: R1</a></li>
<li class="chapter" data-level="2.3.3" data-path="SeqQualTop.html"><a href="SeqQualTop.html#insert-r2"><i class="fa fa-check"></i><b>2.3.3</b> insert: R2</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="SeqQualTop.html"><a href="SeqQualTop.html#hca-adult-bmmc---fastqc"><i class="fa fa-check"></i><b>2.4</b> HCA adult BMMC - fastqc</a></li>
<li class="chapter" data-level="2.5" data-path="SeqQualTop.html"><a href="SeqQualTop.html#hca-adult-bmmc---multiqc"><i class="fa fa-check"></i><b>2.5</b> HCA adult BMMC - MultiQC</a><ul>
<li class="chapter" data-level="2.5.1" data-path="SeqQualTop.html"><a href="SeqQualTop.html#sample-index-i1-1"><i class="fa fa-check"></i><b>2.5.1</b> sample index: I1</a></li>
<li class="chapter" data-level="2.5.2" data-path="SeqQualTop.html"><a href="SeqQualTop.html#cell-barcode-umi-r1-1"><i class="fa fa-check"></i><b>2.5.2</b> cell barcode + UMI: R1</a></li>
<li class="chapter" data-level="2.5.3" data-path="SeqQualTop.html"><a href="SeqQualTop.html#insert-r2-1"><i class="fa fa-check"></i><b>2.5.3</b> insert: R2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="AliFeatCountTop.html"><a href="AliFeatCountTop.html"><i class="fa fa-check"></i><b>3</b> Alignment and feature counting</a><ul>
<li class="chapter" data-level="3.1" data-path="AliFeatCountTop.html"><a href="AliFeatCountTop.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="AliFeatCountTop.html"><a href="AliFeatCountTop.html#x-cellranger-pipeline-in-brief"><i class="fa fa-check"></i><b>3.2</b> 10X cellranger pipeline in brief</a></li>
<li class="chapter" data-level="3.3" data-path="AliFeatCountTop.html"><a href="AliFeatCountTop.html#sample-sheet"><i class="fa fa-check"></i><b>3.3</b> sample sheet</a></li>
<li class="chapter" data-level="3.4" data-path="AliFeatCountTop.html"><a href="AliFeatCountTop.html#x-cellranger-reports-for-caronbourque2020"><i class="fa fa-check"></i><b>3.4</b> 10X cellranger reports for CaronBourque2020</a></li>
<li class="chapter" data-level="3.5" data-path="AliFeatCountTop.html"><a href="AliFeatCountTop.html#x-cellranger-reports-for-hcas-adult-bmmcs"><i class="fa fa-check"></i><b>3.5</b> 10X cellranger reports for HCA’s adult BMMCs</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html"><i class="fa fa-check"></i><b>4</b> Quality Control</a><ul>
<li class="chapter" data-level="4.1" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#load-packages"><i class="fa fa-check"></i><b>4.2</b> Load packages</a></li>
<li class="chapter" data-level="4.3" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#sample-sheet-1"><i class="fa fa-check"></i><b>4.3</b> Sample sheet</a></li>
<li class="chapter" data-level="4.4" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#data-representation"><i class="fa fa-check"></i><b>4.4</b> Data representation</a></li>
<li class="chapter" data-level="4.5" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#example"><i class="fa fa-check"></i><b>4.5</b> Example</a></li>
<li class="chapter" data-level="4.6" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#mapping-qc"><i class="fa fa-check"></i><b>4.6</b> Mapping QC</a><ul>
<li class="chapter" data-level="4.6.1" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#gene-body-coverage"><i class="fa fa-check"></i><b>4.6.1</b> Gene body coverage</a></li>
<li class="chapter" data-level="4.6.2" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#amplification-rate"><i class="fa fa-check"></i><b>4.6.2</b> Amplification rate</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#cell-calling-for-droplet-data"><i class="fa fa-check"></i><b>4.7</b> Cell calling for droplet data</a><ul>
<li class="chapter" data-level="4.7.1" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#mixture-model"><i class="fa fa-check"></i><b>4.7.1</b> Mixture model</a></li>
<li class="chapter" data-level="4.7.2" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#barcode-rank-plot"><i class="fa fa-check"></i><b>4.7.2</b> Barcode rank plot</a></li>
<li class="chapter" data-level="4.7.3" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#inflection-point"><i class="fa fa-check"></i><b>4.7.3</b> Inflection point</a></li>
<li class="chapter" data-level="4.7.4" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#cellranger-v1-and-v2"><i class="fa fa-check"></i><b>4.7.4</b> Cellranger v1 and v2</a></li>
<li class="chapter" data-level="4.7.5" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#dropletutils-and-emptydrops"><i class="fa fa-check"></i><b>4.7.5</b> DropletUtils and EmptyDrops</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#load-filtered-matrices"><i class="fa fa-check"></i><b>4.8</b> Load filtered matrices</a></li>
<li class="chapter" data-level="4.9" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#properties-of-scrna-seq-data"><i class="fa fa-check"></i><b>4.9</b> Properties of scRNA-seq data</a></li>
<li class="chapter" data-level="4.10" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#quality-control"><i class="fa fa-check"></i><b>4.10</b> Quality control</a><ul>
<li class="chapter" data-level="4.10.1" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#qc-metric-distribution"><i class="fa fa-check"></i><b>4.10.1</b> QC metric distribution</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#identification-of-low-quality-cells-with-adaptive-thresholds"><i class="fa fa-check"></i><b>4.11</b> Identification of low-quality cells with adaptive thresholds</a><ul>
<li class="chapter" data-level="4.11.1" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#library-size"><i class="fa fa-check"></i><b>4.11.1</b> Library size</a></li>
<li class="chapter" data-level="4.11.2" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#number-of-genes"><i class="fa fa-check"></i><b>4.11.2</b> Number of genes</a></li>
<li class="chapter" data-level="4.11.3" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#mitochondrial-content"><i class="fa fa-check"></i><b>4.11.3</b> Mitochondrial content</a></li>
<li class="chapter" data-level="4.11.4" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#summary"><i class="fa fa-check"></i><b>4.11.4</b> Summary</a></li>
<li class="chapter" data-level="4.11.5" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#all-steps-at-once"><i class="fa fa-check"></i><b>4.11.5</b> All steps at once</a></li>
<li class="chapter" data-level="4.11.6" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#assumptions"><i class="fa fa-check"></i><b>4.11.6</b> Assumptions</a></li>
</ul></li>
<li class="chapter" data-level="4.12" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#experimental-factors"><i class="fa fa-check"></i><b>4.12</b> Experimental factors</a><ul>
<li class="chapter" data-level="4.12.1" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#identify-poor-quality-batches"><i class="fa fa-check"></i><b>4.12.1</b> Identify poor-quality batches</a><ul>
<li class="chapter" data-level="4.12.1.1" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#number-of-genes-detected"><i class="fa fa-check"></i><b>4.12.1.1</b> Number of genes detected</a><ul>
<li class="chapter" data-level="4.12.1.1.1" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#mitochondrial-content-1"><i class="fa fa-check"></i><b>4.12.1.1.1</b> Mitochondrial content</a></li>
</ul></li>
<li class="chapter" data-level="4.12.1.2" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#samples-to-check"><i class="fa fa-check"></i><b>4.12.1.2</b> Samples to check</a></li>
</ul></li>
<li class="chapter" data-level="4.12.2" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#qc-metrics-space"><i class="fa fa-check"></i><b>4.12.2</b> QC metrics space</a></li>
<li class="chapter" data-level="4.12.3" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#qc-pca"><i class="fa fa-check"></i><b>4.12.3</b> QC PCA</a></li>
<li class="chapter" data-level="4.12.4" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#other-diagnostic-plots"><i class="fa fa-check"></i><b>4.12.4</b> Other diagnostic plots</a></li>
<li class="chapter" data-level="4.12.5" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#filter-low-quality-cells-out"><i class="fa fa-check"></i><b>4.12.5</b> Filter low-quality cells out</a></li>
</ul></li>
<li class="chapter" data-level="4.13" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#novelty"><i class="fa fa-check"></i><b>4.13</b> Novelty</a></li>
<li class="chapter" data-level="4.14" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#qc-based-on-sparsity"><i class="fa fa-check"></i><b>4.14</b> QC based on sparsity</a><ul>
<li class="chapter" data-level="4.14.1" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#remove-genes-that-are-not-expressed-at-all"><i class="fa fa-check"></i><b>4.14.1</b> Remove genes that are not expressed at all</a></li>
<li class="chapter" data-level="4.14.2" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#sparsity-plots"><i class="fa fa-check"></i><b>4.14.2</b> Sparsity plots</a></li>
<li class="chapter" data-level="4.14.3" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#filters"><i class="fa fa-check"></i><b>4.14.3</b> Filters</a></li>
<li class="chapter" data-level="4.14.4" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#separate-caron-and-hca-batches"><i class="fa fa-check"></i><b>4.14.4</b> Separate Caron and Hca batches</a></li>
<li class="chapter" data-level="4.14.5" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#caron-only"><i class="fa fa-check"></i><b>4.14.5</b> Caron only</a></li>
<li class="chapter" data-level="4.14.6" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#hca-only"><i class="fa fa-check"></i><b>4.14.6</b> Hca only</a></li>
</ul></li>
<li class="chapter" data-level="4.15" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#subsample-hca-set"><i class="fa fa-check"></i><b>4.15</b> Subsample Hca set</a></li>
<li class="chapter" data-level="4.16" data-path="QcTopAllCells.html"><a href="QcTopAllCells.html#session-information"><i class="fa fa-check"></i><b>4.16</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="QcTop.html"><a href="QcTop.html"><i class="fa fa-check"></i><b>5</b> Quality Control</a><ul>
<li class="chapter" data-level="5.1" data-path="QcTop.html"><a href="QcTop.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="QcTop.html"><a href="QcTop.html#load-packages-1"><i class="fa fa-check"></i><b>5.2</b> Load packages</a></li>
<li class="chapter" data-level="5.3" data-path="QcTop.html"><a href="QcTop.html#sample-sheet-2"><i class="fa fa-check"></i><b>5.3</b> Sample sheet</a></li>
<li class="chapter" data-level="5.4" data-path="QcTop.html"><a href="QcTop.html#data-representation-1"><i class="fa fa-check"></i><b>5.4</b> Data representation</a></li>
<li class="chapter" data-level="5.5" data-path="QcTop.html"><a href="QcTop.html#example-1"><i class="fa fa-check"></i><b>5.5</b> Example</a></li>
<li class="chapter" data-level="5.6" data-path="QcTop.html"><a href="QcTop.html#mapping-qc-1"><i class="fa fa-check"></i><b>5.6</b> Mapping QC</a><ul>
<li class="chapter" data-level="5.6.1" data-path="QcTop.html"><a href="QcTop.html#gene-body-coverage-1"><i class="fa fa-check"></i><b>5.6.1</b> Gene body coverage</a></li>
<li class="chapter" data-level="5.6.2" data-path="QcTop.html"><a href="QcTop.html#amplification-rate-1"><i class="fa fa-check"></i><b>5.6.2</b> Amplification rate</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="QcTop.html"><a href="QcTop.html#cell-calling-for-droplet-data-1"><i class="fa fa-check"></i><b>5.7</b> Cell calling for droplet data</a><ul>
<li class="chapter" data-level="5.7.1" data-path="QcTop.html"><a href="QcTop.html#mixture-model-1"><i class="fa fa-check"></i><b>5.7.1</b> Mixture model</a></li>
<li class="chapter" data-level="5.7.2" data-path="QcTop.html"><a href="QcTop.html#barcode-rank-plot-1"><i class="fa fa-check"></i><b>5.7.2</b> Barcode rank plot</a></li>
<li class="chapter" data-level="5.7.3" data-path="QcTop.html"><a href="QcTop.html#inflection-point-1"><i class="fa fa-check"></i><b>5.7.3</b> Inflection point</a></li>
<li class="chapter" data-level="5.7.4" data-path="QcTop.html"><a href="QcTop.html#cellranger-v1-and-v2-1"><i class="fa fa-check"></i><b>5.7.4</b> Cellranger v1 and v2</a></li>
<li class="chapter" data-level="5.7.5" data-path="QcTop.html"><a href="QcTop.html#dropletutils-and-emptydrops-1"><i class="fa fa-check"></i><b>5.7.5</b> DropletUtils and EmptyDrops</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="QcTop.html"><a href="QcTop.html#load-filtered-matrices-1"><i class="fa fa-check"></i><b>5.8</b> Load filtered matrices</a></li>
<li class="chapter" data-level="5.9" data-path="QcTop.html"><a href="QcTop.html#properties-of-scrna-seq-data-1"><i class="fa fa-check"></i><b>5.9</b> Properties of scRNA-seq data</a></li>
<li class="chapter" data-level="5.10" data-path="QcTop.html"><a href="QcTop.html#quality-control-1"><i class="fa fa-check"></i><b>5.10</b> Quality control</a><ul>
<li class="chapter" data-level="5.10.1" data-path="QcTop.html"><a href="QcTop.html#qc-metric-distribution-1"><i class="fa fa-check"></i><b>5.10.1</b> QC metric distribution</a></li>
</ul></li>
<li class="chapter" data-level="5.11" data-path="QcTop.html"><a href="QcTop.html#identification-of-low-quality-cells-with-adaptive-thresholds-1"><i class="fa fa-check"></i><b>5.11</b> Identification of low-quality cells with adaptive thresholds</a><ul>
<li class="chapter" data-level="5.11.1" data-path="QcTop.html"><a href="QcTop.html#library-size-1"><i class="fa fa-check"></i><b>5.11.1</b> Library size</a></li>
<li class="chapter" data-level="5.11.2" data-path="QcTop.html"><a href="QcTop.html#number-of-genes-1"><i class="fa fa-check"></i><b>5.11.2</b> Number of genes</a></li>
<li class="chapter" data-level="5.11.3" data-path="QcTop.html"><a href="QcTop.html#mitochondrial-content-2"><i class="fa fa-check"></i><b>5.11.3</b> Mitochondrial content</a></li>
<li class="chapter" data-level="5.11.4" data-path="QcTop.html"><a href="QcTop.html#summary-1"><i class="fa fa-check"></i><b>5.11.4</b> Summary</a></li>
<li class="chapter" data-level="5.11.5" data-path="QcTop.html"><a href="QcTop.html#all-steps-at-once-1"><i class="fa fa-check"></i><b>5.11.5</b> All steps at once</a></li>
<li class="chapter" data-level="5.11.6" data-path="QcTop.html"><a href="QcTop.html#assumptions-1"><i class="fa fa-check"></i><b>5.11.6</b> Assumptions</a></li>
</ul></li>
<li class="chapter" data-level="5.12" data-path="QcTop.html"><a href="QcTop.html#experimental-factors-1"><i class="fa fa-check"></i><b>5.12</b> Experimental factors</a><ul>
<li class="chapter" data-level="5.12.1" data-path="QcTop.html"><a href="QcTop.html#identify-poor-quality-batches-1"><i class="fa fa-check"></i><b>5.12.1</b> Identify poor-quality batches</a><ul>
<li class="chapter" data-level="5.12.1.1" data-path="QcTop.html"><a href="QcTop.html#number-of-genes-detected-1"><i class="fa fa-check"></i><b>5.12.1.1</b> Number of genes detected</a><ul>
<li class="chapter" data-level="5.12.1.1.1" data-path="QcTop.html"><a href="QcTop.html#mitochondrial-content-3"><i class="fa fa-check"></i><b>5.12.1.1.1</b> Mitochondrial content</a></li>
</ul></li>
<li class="chapter" data-level="5.12.1.2" data-path="QcTop.html"><a href="QcTop.html#samples-to-check-1"><i class="fa fa-check"></i><b>5.12.1.2</b> Samples to check</a></li>
</ul></li>
<li class="chapter" data-level="5.12.2" data-path="QcTop.html"><a href="QcTop.html#qc-metrics-space-1"><i class="fa fa-check"></i><b>5.12.2</b> QC metrics space</a></li>
<li class="chapter" data-level="5.12.3" data-path="QcTop.html"><a href="QcTop.html#qc-pca-1"><i class="fa fa-check"></i><b>5.12.3</b> QC PCA</a></li>
<li class="chapter" data-level="5.12.4" data-path="QcTop.html"><a href="QcTop.html#other-diagnostic-plots-1"><i class="fa fa-check"></i><b>5.12.4</b> Other diagnostic plots</a></li>
<li class="chapter" data-level="5.12.5" data-path="QcTop.html"><a href="QcTop.html#filter-low-quality-cells-out-1"><i class="fa fa-check"></i><b>5.12.5</b> Filter low-quality cells out</a></li>
</ul></li>
<li class="chapter" data-level="5.13" data-path="QcTop.html"><a href="QcTop.html#novelty-1"><i class="fa fa-check"></i><b>5.13</b> Novelty</a></li>
<li class="chapter" data-level="5.14" data-path="QcTop.html"><a href="QcTop.html#qc-based-on-sparsity-1"><i class="fa fa-check"></i><b>5.14</b> QC based on sparsity</a><ul>
<li class="chapter" data-level="5.14.1" data-path="QcTop.html"><a href="QcTop.html#remove-genes-that-are-not-expressed-at-all-1"><i class="fa fa-check"></i><b>5.14.1</b> Remove genes that are not expressed at all</a></li>
<li class="chapter" data-level="5.14.2" data-path="QcTop.html"><a href="QcTop.html#sparsity-plots-1"><i class="fa fa-check"></i><b>5.14.2</b> Sparsity plots</a></li>
<li class="chapter" data-level="5.14.3" data-path="QcTop.html"><a href="QcTop.html#filters-1"><i class="fa fa-check"></i><b>5.14.3</b> Filters</a></li>
<li class="chapter" data-level="5.14.4" data-path="QcTop.html"><a href="QcTop.html#separate-caron-and-hca-batches-1"><i class="fa fa-check"></i><b>5.14.4</b> Separate Caron and Hca batches</a></li>
<li class="chapter" data-level="5.14.5" data-path="QcTop.html"><a href="QcTop.html#caron-only-1"><i class="fa fa-check"></i><b>5.14.5</b> Caron only</a></li>
<li class="chapter" data-level="5.14.6" data-path="QcTop.html"><a href="QcTop.html#hca-only-1"><i class="fa fa-check"></i><b>5.14.6</b> Hca only</a></li>
</ul></li>
<li class="chapter" data-level="5.15" data-path="QcTop.html"><a href="QcTop.html#session-information-1"><i class="fa fa-check"></i><b>5.15</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="NormalisationAllCells.html"><a href="NormalisationAllCells.html"><i class="fa fa-check"></i><b>6</b> Normalisation</a><ul>
<li class="chapter" data-level="6.1" data-path="NormalisationAllCells.html"><a href="NormalisationAllCells.html#caron"><i class="fa fa-check"></i><b>6.1</b> Caron</a><ul>
<li class="chapter" data-level="6.1.1" data-path="NormalisationAllCells.html"><a href="NormalisationAllCells.html#library-size-normalization"><i class="fa fa-check"></i><b>6.1.1</b> Library size normalization</a></li>
<li class="chapter" data-level="6.1.2" data-path="NormalisationAllCells.html"><a href="NormalisationAllCells.html#deconvolution"><i class="fa fa-check"></i><b>6.1.2</b> Deconvolution</a></li>
<li class="chapter" data-level="6.1.3" data-path="NormalisationAllCells.html"><a href="NormalisationAllCells.html#compute-size-factors"><i class="fa fa-check"></i><b>6.1.3</b> Compute size factors</a><ul>
<li class="chapter" data-level="6.1.3.1" data-path="NormalisationAllCells.html"><a href="NormalisationAllCells.html#apply-size-factors"><i class="fa fa-check"></i><b>6.1.3.1</b> Apply size factors</a></li>
<li class="chapter" data-level="6.1.3.2" data-path="NormalisationAllCells.html"><a href="NormalisationAllCells.html#save-object"><i class="fa fa-check"></i><b>6.1.3.2</b> Save object</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="NormalisationAllCells.html"><a href="NormalisationAllCells.html#hca"><i class="fa fa-check"></i><b>6.2</b> Hca</a><ul>
<li class="chapter" data-level="6.2.1" data-path="NormalisationAllCells.html"><a href="NormalisationAllCells.html#library-size-normalization-1"><i class="fa fa-check"></i><b>6.2.1</b> Library size normalization</a></li>
<li class="chapter" data-level="6.2.2" data-path="NormalisationAllCells.html"><a href="NormalisationAllCells.html#deconvolution-1"><i class="fa fa-check"></i><b>6.2.2</b> Deconvolution</a></li>
<li class="chapter" data-level="6.2.3" data-path="NormalisationAllCells.html"><a href="NormalisationAllCells.html#compute-size-factors-1"><i class="fa fa-check"></i><b>6.2.3</b> Compute size factors</a><ul>
<li class="chapter" data-level="6.2.3.1" data-path="NormalisationAllCells.html"><a href="NormalisationAllCells.html#apply-size-factors-1"><i class="fa fa-check"></i><b>6.2.3.1</b> Apply size factors</a></li>
<li class="chapter" data-level="6.2.3.2" data-path="NormalisationAllCells.html"><a href="NormalisationAllCells.html#save-object-1"><i class="fa fa-check"></i><b>6.2.3.2</b> Save object</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="NormalisationAllCells.html"><a href="NormalisationAllCells.html#sctransform"><i class="fa fa-check"></i><b>6.3</b> SCTransform</a><ul>
<li class="chapter" data-level="6.3.1" data-path="NormalisationAllCells.html"><a href="NormalisationAllCells.html#caron-1"><i class="fa fa-check"></i><b>6.3.1</b> Caron</a></li>
<li class="chapter" data-level="6.3.2" data-path="NormalisationAllCells.html"><a href="NormalisationAllCells.html#hca-1"><i class="fa fa-check"></i><b>6.3.2</b> Hca</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="NormalisationAllCells.html"><a href="NormalisationAllCells.html#session-information-2"><i class="fa fa-check"></i><b>6.4</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html"><i class="fa fa-check"></i><b>7</b> Normalisation - Caron set</a><ul>
<li class="chapter" data-level="7.1" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#scaling-normalization"><i class="fa fa-check"></i><b>7.1</b> Scaling normalization</a><ul>
<li class="chapter" data-level="7.1.1" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#cpm"><i class="fa fa-check"></i><b>7.1.1</b> CPM</a></li>
<li class="chapter" data-level="7.1.2" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#deseqs-size-factor"><i class="fa fa-check"></i><b>7.1.2</b> DESeq’s size factor</a></li>
<li class="chapter" data-level="7.1.3" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#weighted-trimmed-mean-of-m-values"><i class="fa fa-check"></i><b>7.1.3</b> Weighted Trimmed mean of M-values</a></li>
<li class="chapter" data-level="7.1.4" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#library-size-normalization-2"><i class="fa fa-check"></i><b>7.1.4</b> Library size normalization</a></li>
<li class="chapter" data-level="7.1.5" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#deconvolution-2"><i class="fa fa-check"></i><b>7.1.5</b> Deconvolution</a><ul>
<li class="chapter" data-level="7.1.5.1" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#cluster-cells"><i class="fa fa-check"></i><b>7.1.5.1</b> Cluster cells</a></li>
<li class="chapter" data-level="7.1.5.2" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#compute-size-factors-2"><i class="fa fa-check"></i><b>7.1.5.2</b> Compute size factors</a></li>
<li class="chapter" data-level="7.1.5.3" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#apply-size-factors-2"><i class="fa fa-check"></i><b>7.1.5.3</b> Apply size factors</a></li>
<li class="chapter" data-level="7.1.5.4" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#save-object-2"><i class="fa fa-check"></i><b>7.1.5.4</b> Save object</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#sctransform-1"><i class="fa fa-check"></i><b>7.2</b> SCTransform</a><ul>
<li class="chapter" data-level="7.2.1" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#inspect-data"><i class="fa fa-check"></i><b>7.2.1</b> Inspect data</a></li>
<li class="chapter" data-level="7.2.2" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#transformation"><i class="fa fa-check"></i><b>7.2.2</b> Transformation</a></li>
<li class="chapter" data-level="7.2.3" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#save-object-3"><i class="fa fa-check"></i><b>7.2.3</b> Save object</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#visualisation"><i class="fa fa-check"></i><b>7.3</b> Visualisation</a><ul>
<li class="chapter" data-level="7.3.1" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#log-raw-counts"><i class="fa fa-check"></i><b>7.3.1</b> log raw counts</a></li>
<li class="chapter" data-level="7.3.2" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#log-cpm"><i class="fa fa-check"></i><b>7.3.2</b> log CPM</a></li>
<li class="chapter" data-level="7.3.3" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#scran"><i class="fa fa-check"></i><b>7.3.3</b> scran</a></li>
<li class="chapter" data-level="7.3.4" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#sctransform-2"><i class="fa fa-check"></i><b>7.3.4</b> SCTransform</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#session-information-3"><i class="fa fa-check"></i><b>7.4</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html"><i class="fa fa-check"></i><b>8</b> Normalisation - GSM3872434 set</a><ul>
<li class="chapter" data-level="8.1" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html#scaling-normalization-1"><i class="fa fa-check"></i><b>8.1</b> Scaling normalization</a><ul>
<li class="chapter" data-level="8.1.1" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html#cpm-1"><i class="fa fa-check"></i><b>8.1.1</b> CPM</a></li>
<li class="chapter" data-level="8.1.2" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html#deseqs-size-factor-1"><i class="fa fa-check"></i><b>8.1.2</b> DESeq’s size factor</a></li>
<li class="chapter" data-level="8.1.3" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html#weighted-trimmed-mean-of-m-values-1"><i class="fa fa-check"></i><b>8.1.3</b> Weighted Trimmed mean of M-values</a></li>
<li class="chapter" data-level="8.1.4" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html#library-size-factor-distribution"><i class="fa fa-check"></i><b>8.1.4</b> Library size factor distribution</a></li>
<li class="chapter" data-level="8.1.5" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html#deconvolution-3"><i class="fa fa-check"></i><b>8.1.5</b> Deconvolution</a><ul>
<li class="chapter" data-level="8.1.5.1" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html#cluster-cells-1"><i class="fa fa-check"></i><b>8.1.5.1</b> Cluster cells</a></li>
<li class="chapter" data-level="8.1.5.2" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html#compute-size-factors-3"><i class="fa fa-check"></i><b>8.1.5.2</b> Compute size factors</a></li>
<li class="chapter" data-level="8.1.5.3" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html#apply-size-factors-3"><i class="fa fa-check"></i><b>8.1.5.3</b> Apply size factors</a></li>
<li class="chapter" data-level="8.1.5.4" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html#save-object-4"><i class="fa fa-check"></i><b>8.1.5.4</b> Save object</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html#sctransform-3"><i class="fa fa-check"></i><b>8.2</b> sctransform</a><ul>
<li class="chapter" data-level="8.2.1" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html#inspect-data-1"><i class="fa fa-check"></i><b>8.2.1</b> Inspect data</a></li>
<li class="chapter" data-level="8.2.2" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html#transformation-1"><i class="fa fa-check"></i><b>8.2.2</b> Transformation</a></li>
<li class="chapter" data-level="8.2.3" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html#save-sce-object"><i class="fa fa-check"></i><b>8.2.3</b> Save SCE object</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html#visualisation-1"><i class="fa fa-check"></i><b>8.3</b> Visualisation</a><ul>
<li class="chapter" data-level="8.3.1" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html#log-raw-counts-1"><i class="fa fa-check"></i><b>8.3.1</b> log raw counts</a></li>
<li class="chapter" data-level="8.3.2" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html#log-cpm-1"><i class="fa fa-check"></i><b>8.3.2</b> log CPM</a></li>
<li class="chapter" data-level="8.3.3" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html#scran-1"><i class="fa fa-check"></i><b>8.3.3</b> scran</a></li>
<li class="chapter" data-level="8.3.4" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html#sctransform-4"><i class="fa fa-check"></i><b>8.3.4</b> SCTransform</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="normalisation-gsm3872434-set.html"><a href="normalisation-gsm3872434-set.html#session-information-4"><i class="fa fa-check"></i><b>8.4</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="dimensionality-reduction-for-visualisation.html"><a href="dimensionality-reduction-for-visualisation.html"><i class="fa fa-check"></i><b>9</b> Dimensionality reduction for visualisation</a><ul>
<li class="chapter" data-level="9.1" data-path="dimensionality-reduction-for-visualisation.html"><a href="dimensionality-reduction-for-visualisation.html#principal-component-analysis"><i class="fa fa-check"></i><b>9.1</b> Principal Component Analysis</a><ul>
<li class="chapter" data-level="9.1.1" data-path="dimensionality-reduction-for-visualisation.html"><a href="dimensionality-reduction-for-visualisation.html#description"><i class="fa fa-check"></i><b>9.1.1</b> Description</a></li>
<li class="chapter" data-level="9.1.2" data-path="dimensionality-reduction-for-visualisation.html"><a href="dimensionality-reduction-for-visualisation.html#example-2"><i class="fa fa-check"></i><b>9.1.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="dimensionality-reduction-for-visualisation.html"><a href="dimensionality-reduction-for-visualisation.html#load-packages-2"><i class="fa fa-check"></i><b>9.2</b> Load packages</a></li>
<li class="chapter" data-level="9.3" data-path="dimensionality-reduction-for-visualisation.html"><a href="dimensionality-reduction-for-visualisation.html#load-data"><i class="fa fa-check"></i><b>9.3</b> Load data</a></li>
<li class="chapter" data-level="9.4" data-path="dimensionality-reduction-for-visualisation.html"><a href="dimensionality-reduction-for-visualisation.html#pca"><i class="fa fa-check"></i><b>9.4</b> PCA</a><ul>
<li class="chapter" data-level="9.4.1" data-path="dimensionality-reduction-for-visualisation.html"><a href="dimensionality-reduction-for-visualisation.html#correlation-between-pcs-and-the-total-number-of-features-detected"><i class="fa fa-check"></i><b>9.4.1</b> Correlation between PCs and the total number of features detected</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="dimensionality-reduction-for-visualisation.html"><a href="dimensionality-reduction-for-visualisation.html#t-sne-t-distributed-stochastic-neighbor-embedding"><i class="fa fa-check"></i><b>9.5</b> t-SNE: t-Distributed Stochastic Neighbor Embedding</a><ul>
<li class="chapter" data-level="9.5.1" data-path="dimensionality-reduction-for-visualisation.html"><a href="dimensionality-reduction-for-visualisation.html#perplexity"><i class="fa fa-check"></i><b>9.5.1</b> Perplexity</a></li>
<li class="chapter" data-level="9.5.2" data-path="dimensionality-reduction-for-visualisation.html"><a href="dimensionality-reduction-for-visualisation.html#stochasticity"><i class="fa fa-check"></i><b>9.5.2</b> Stochasticity</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="dimensionality-reduction-for-visualisation.html"><a href="dimensionality-reduction-for-visualisation.html#umap"><i class="fa fa-check"></i><b>9.6</b> UMAP</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="feature-selection.html"><a href="feature-selection.html"><i class="fa fa-check"></i><b>10</b> Feature selection</a><ul>
<li class="chapter" data-level="10.1" data-path="feature-selection.html"><a href="feature-selection.html#load-data-1"><i class="fa fa-check"></i><b>10.1</b> Load data</a></li>
<li class="chapter" data-level="10.2" data-path="feature-selection.html"><a href="feature-selection.html#feature-selection-with-scran"><i class="fa fa-check"></i><b>10.2</b> Feature selection with scran</a><ul>
<li class="chapter" data-level="10.2.1" data-path="feature-selection.html"><a href="feature-selection.html#modelling-and-removing-technical-noise"><i class="fa fa-check"></i><b>10.2.1</b> Modelling and removing technical noise</a></li>
<li class="chapter" data-level="10.2.2" data-path="feature-selection.html"><a href="feature-selection.html#choosing-some-hvgs"><i class="fa fa-check"></i><b>10.2.2</b> Choosing some HVGs:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html"><i class="fa fa-check"></i><b>11</b> batch correction - GSM3872442 set</a><ul>
<li class="chapter" data-level="11.1" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#prepare-data"><i class="fa fa-check"></i><b>11.1</b> Prepare data</a></li>
<li class="chapter" data-level="11.2" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#normalise-each-separately-and-re-pool"><i class="fa fa-check"></i><b>11.2</b> Normalise each separately and re-pool</a></li>
<li class="chapter" data-level="11.3" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#normalise-batches-together"><i class="fa fa-check"></i><b>11.3</b> Normalise batches together</a></li>
<li class="chapter" data-level="11.4" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#batch-correction"><i class="fa fa-check"></i><b>11.4</b> Batch correction</a><ul>
<li class="chapter" data-level="11.4.1" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#gaussian-normal-linear-models"><i class="fa fa-check"></i><b>11.4.1</b> Gaussian (normal) linear models</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#sctransform-5"><i class="fa fa-check"></i><b>11.5</b> SCTransform</a><ul>
<li class="chapter" data-level="11.5.1" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#batch-only"><i class="fa fa-check"></i><b>11.5.1</b> Batch only</a></li>
<li class="chapter" data-level="11.5.2" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#both-library-size-and-batch"><i class="fa fa-check"></i><b>11.5.2</b> Both library size and batch</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#mnncorrect"><i class="fa fa-check"></i><b>11.6</b> mnnCorrect</a><ul>
<li class="chapter" data-level="11.6.1" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#check-presence-of-batch-effect"><i class="fa fa-check"></i><b>11.6.1</b> Check presence of batch effect</a></li>
<li class="chapter" data-level="11.6.2" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#correct-batch-effect-with-mnncorrect"><i class="fa fa-check"></i><b>11.6.2</b> Correct batch effect with mnnCorrect</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#fastmnn"><i class="fa fa-check"></i><b>11.7</b> fastMNN</a></li>
<li class="chapter" data-level="11.8" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#harmony"><i class="fa fa-check"></i><b>11.8</b> Harmony</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="dimensionality-reduction-for-analysis.html"><a href="dimensionality-reduction-for-analysis.html"><i class="fa fa-check"></i><b>12</b> Dimensionality reduction for analysis</a><ul>
<li class="chapter" data-level="12.1" data-path="dimensionality-reduction-for-analysis.html"><a href="dimensionality-reduction-for-analysis.html#load-data-2"><i class="fa fa-check"></i><b>12.1</b> Load data</a></li>
<li class="chapter" data-level="12.2" data-path="dimensionality-reduction-for-analysis.html"><a href="dimensionality-reduction-for-analysis.html#denoising-expression-values-using-pca"><i class="fa fa-check"></i><b>12.2</b> Denoising expression values using PCA</a></li>
<li class="chapter" data-level="12.3" data-path="dimensionality-reduction-for-analysis.html"><a href="dimensionality-reduction-for-analysis.html#visualise-expression-patterns-of-some-hvgs"><i class="fa fa-check"></i><b>12.3</b> Visualise expression patterns of some HVGs</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="DataIntegrationPbmmc.html"><a href="DataIntegrationPbmmc.html"><i class="fa fa-check"></i><b>13</b> Data integration</a><ul>
<li class="chapter" data-level="13.1" data-path="DataIntegrationPbmmc.html"><a href="DataIntegrationPbmmc.html#abbreviations-1"><i class="fa fa-check"></i><b>13.1</b> Abbreviations</a></li>
<li class="chapter" data-level="13.2" data-path="DataIntegrationPbmmc.html"><a href="DataIntegrationPbmmc.html#motivation"><i class="fa fa-check"></i><b>13.2</b> Motivation</a></li>
<li class="chapter" data-level="13.3" data-path="DataIntegrationPbmmc.html"><a href="DataIntegrationPbmmc.html#loading-the-data"><i class="fa fa-check"></i><b>13.3</b> Loading the data</a></li>
<li class="chapter" data-level="13.4" data-path="DataIntegrationPbmmc.html"><a href="DataIntegrationPbmmc.html#diagnosing-batch-effects"><i class="fa fa-check"></i><b>13.4</b> Diagnosing batch effects</a></li>
<li class="chapter" data-level="13.5" data-path="DataIntegrationPbmmc.html"><a href="DataIntegrationPbmmc.html#linear-regression"><i class="fa fa-check"></i><b>13.5</b> Linear regression</a></li>
<li class="chapter" data-level="13.6" data-path="DataIntegrationPbmmc.html"><a href="DataIntegrationPbmmc.html#performing-mnn-correction"><i class="fa fa-check"></i><b>13.6</b> Performing MNN correction</a><ul>
<li class="chapter" data-level="13.6.1" data-path="DataIntegrationPbmmc.html"><a href="DataIntegrationPbmmc.html#algorithm-overview"><i class="fa fa-check"></i><b>13.6.1</b> Algorithm overview</a></li>
<li class="chapter" data-level="13.6.2" data-path="DataIntegrationPbmmc.html"><a href="DataIntegrationPbmmc.html#application-to-the-data"><i class="fa fa-check"></i><b>13.6.2</b> Application to the data</a></li>
<li class="chapter" data-level="13.6.3" data-path="DataIntegrationPbmmc.html"><a href="DataIntegrationPbmmc.html#correction-diagnostics"><i class="fa fa-check"></i><b>13.6.3</b> Correction diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="DataIntegrationPbmmc.html"><a href="DataIntegrationPbmmc.html#preserving-biological-heterogeneity"><i class="fa fa-check"></i><b>13.7</b> Preserving biological heterogeneity</a><ul>
<li class="chapter" data-level="13.7.1" data-path="DataIntegrationPbmmc.html"><a href="DataIntegrationPbmmc.html#comparison-to-within-batch-clusters"><i class="fa fa-check"></i><b>13.7.1</b> Comparison to within-batch clusters</a></li>
<li class="chapter" data-level="13.7.2" data-path="DataIntegrationPbmmc.html"><a href="DataIntegrationPbmmc.html#encouraging-consistency-with-marker-genes"><i class="fa fa-check"></i><b>13.7.2</b> Encouraging consistency with marker genes</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">CRUK Bioinformatics Summer School 2020 - single-cell RNA-seq analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="normalisation---caron-set" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Normalisation - Caron set</h1>
<p>Sources: chapters on Normalisation in the <a href="https://osca.bioconductor.org/normalization.html">OSCA book</a> and the ’<a href="https://scrnaseq-course.cog.sanger.ac.uk/website/index.html">Hemberg group material</a>.</p>
<p>Why normalise?</p>
<p>Systematic differences in sequencing coverage between libraries occur because of low input material, differences in cDNA capture and PCR amplification.
Normalisation removes such differences so that differences between cells are not technical but biological, allowing meaningful comparison of expression profiles between cells. Normalisation and batch correction have different aims. Normalisation addresses technical differences only, while batch correction considers both technical and biological differences.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="normalisation-caron-set.html#cb4-1"></a>qcPlotDirBit &lt;-<span class="st"> &quot;Plots/Norm&quot;</span></span>
<span id="cb4-2"><a href="normalisation-caron-set.html#cb4-2"></a>setName &lt;-<span class="st"> </span><span class="kw">tolower</span>(<span class="st">&quot;Caron&quot;</span>)</span>
<span id="cb4-3"><a href="normalisation-caron-set.html#cb4-3"></a>projDir &lt;-<span class="st"> </span>params<span class="op">$</span>projDir</span>
<span id="cb4-4"><a href="normalisation-caron-set.html#cb4-4"></a>dirRel &lt;-<span class="st"> </span>params<span class="op">$</span>dirRel</span>
<span id="cb4-5"><a href="normalisation-caron-set.html#cb4-5"></a><span class="cf">if</span>(params<span class="op">$</span>bookType <span class="op">==</span><span class="st"> &quot;mk&quot;</span>){dirRel &lt;-<span class="st"> &quot;..&quot;</span>}</span>
<span id="cb4-6"><a href="normalisation-caron-set.html#cb4-6"></a>outDirBit &lt;-<span class="st"> </span>params<span class="op">$</span>outDirBit</span>
<span id="cb4-7"><a href="normalisation-caron-set.html#cb4-7"></a>writeRds &lt;-<span class="st"> </span><span class="ot">FALSE</span></span></code></pre></div>
<!--
# dev
projDir <- "/mnt/scratcha/bioinformatics/baller01/20200511_FernandesM_ME_crukBiSs2020"
outDirBit <- "AnaWiSce/Attempt1"
-->
<p>Load object.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="normalisation-caron-set.html#cb5-1"></a>setSuf &lt;-<span class="st"> &quot;&quot;</span></span>
<span id="cb5-2"><a href="normalisation-caron-set.html#cb5-2"></a><span class="cf">if</span>(setName <span class="op">==</span><span class="st"> &quot;hca&quot;</span>) {setSuf &lt;-<span class="st"> &quot;_5kCellPerSpl&quot;</span>}</span>
<span id="cb5-3"><a href="normalisation-caron-set.html#cb5-3"></a></span>
<span id="cb5-4"><a href="normalisation-caron-set.html#cb5-4"></a><span class="co"># Read object in:</span></span>
<span id="cb5-5"><a href="normalisation-caron-set.html#cb5-5"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/%s_sce_nz_postQc%s.Rds&quot;</span>, projDir, outDirBit, setName, setSuf)</span>
<span id="cb5-6"><a href="normalisation-caron-set.html#cb5-6"></a><span class="kw">print</span>(tmpFn)</span></code></pre></div>
<pre><code>## [1] &quot;/ssd/personal/baller01/20200511_FernandesM_ME_crukBiSs2020/AnaWiSce/Ana1/Robjects/caron_sce_nz_postQc.Rds&quot;</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="normalisation-caron-set.html#cb7-1"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">file.exists</span>(tmpFn))</span>
<span id="cb7-2"><a href="normalisation-caron-set.html#cb7-2"></a>{</span>
<span id="cb7-3"><a href="normalisation-caron-set.html#cb7-3"></a>    knitr<span class="op">::</span><span class="kw">knit_exit</span>()</span>
<span id="cb7-4"><a href="normalisation-caron-set.html#cb7-4"></a>}</span>
<span id="cb7-5"><a href="normalisation-caron-set.html#cb7-5"></a>sce &lt;-<span class="st"> </span><span class="kw">readRDS</span>(tmpFn)</span>
<span id="cb7-6"><a href="normalisation-caron-set.html#cb7-6"></a>sce</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 16629 20908 
## metadata(0):
## assays(1): counts
## rownames(16629): ENSG00000237491 ENSG00000225880 ... ENSG00000275063
##   ENSG00000271254
## rowData names(11): ensembl_gene_id external_gene_name ... detected
##   gene_sparsity
## colnames: NULL
## colData names(15): Barcode Run ... outlier cell_sparsity
## reducedDimNames(0):
## altExpNames(0):</code></pre>
<p>Subsample cells down to 500 per sample</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="normalisation-caron-set.html#cb9-1"></a>setSuf &lt;-<span class="st"> &quot;_5hCellPerSpl&quot;</span></span>
<span id="cb9-2"><a href="normalisation-caron-set.html#cb9-2"></a>nbCells &lt;-<span class="st"> </span><span class="dv">500</span></span>
<span id="cb9-3"><a href="normalisation-caron-set.html#cb9-3"></a><span class="co">#setSuf &lt;- &quot;_1kCellPerSpl&quot;</span></span>
<span id="cb9-4"><a href="normalisation-caron-set.html#cb9-4"></a><span class="co">#nbCells &lt;- 1000</span></span>
<span id="cb9-5"><a href="normalisation-caron-set.html#cb9-5"></a><span class="co">#setSuf &lt;- &quot;_GSM3872434&quot;</span></span>
<span id="cb9-6"><a href="normalisation-caron-set.html#cb9-6"></a><span class="co">##nbCells &lt;- 500</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="normalisation-caron-set.html#cb10-1"></a><span class="co"># have new list of cell barcodes for each sample</span></span>
<span id="cb10-2"><a href="normalisation-caron-set.html#cb10-2"></a>sce.nz.master &lt;-<span class="st"> </span>sce</span>
<span id="cb10-3"><a href="normalisation-caron-set.html#cb10-3"></a>vec.bc &lt;-<span class="st"> </span><span class="kw">colData</span>(sce.nz.master) <span class="op">%&gt;%</span></span>
<span id="cb10-4"><a href="normalisation-caron-set.html#cb10-4"></a><span class="st">    </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb10-5"><a href="normalisation-caron-set.html#cb10-5"></a><span class="st">    </span><span class="kw">filter</span>(<span class="op">!</span>Run <span class="op">==</span><span class="st"> &quot;SRR9264351&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb10-6"><a href="normalisation-caron-set.html#cb10-6"></a><span class="st">    </span><span class="kw">group_by</span>(Sample.Name) <span class="op">%&gt;%</span></span>
<span id="cb10-7"><a href="normalisation-caron-set.html#cb10-7"></a><span class="st">    </span><span class="kw">sample_n</span>(nbCells) <span class="op">%&gt;%</span></span>
<span id="cb10-8"><a href="normalisation-caron-set.html#cb10-8"></a><span class="st">    </span><span class="kw">pull</span>(Barcode)</span>
<span id="cb10-9"><a href="normalisation-caron-set.html#cb10-9"></a></span>
<span id="cb10-10"><a href="normalisation-caron-set.html#cb10-10"></a><span class="kw">table</span>(<span class="kw">colData</span>(sce.nz.master)<span class="op">$</span>Barcode <span class="op">%in%</span><span class="st"> </span>vec.bc)</span></code></pre></div>
<pre><code>## 
## FALSE  TRUE 
## 15408  5500</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="normalisation-caron-set.html#cb12-1"></a>tmpInd &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">colData</span>(sce.nz.master)<span class="op">$</span>Barcode <span class="op">%in%</span><span class="st"> </span>vec.bc)</span>
<span id="cb12-2"><a href="normalisation-caron-set.html#cb12-2"></a></span>
<span id="cb12-3"><a href="normalisation-caron-set.html#cb12-3"></a>sce &lt;-<span class="st"> </span>sce.nz.master[,tmpInd]</span></code></pre></div>
<!--
# mind that genes were filtered using all cells, not just those sampled here.
-->
<p>We write the R object to ‘caron_sce_nz_postQc_5hCellPerSpl.Rds’.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="normalisation-caron-set.html#cb13-1"></a><span class="co"># Write object to file</span></span>
<span id="cb13-2"><a href="normalisation-caron-set.html#cb13-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/%s_sce_nz_postQc%s.Rds&quot;</span>,</span>
<span id="cb13-3"><a href="normalisation-caron-set.html#cb13-3"></a>         projDir, outDirBit, setName, setSuf)</span>
<span id="cb13-4"><a href="normalisation-caron-set.html#cb13-4"></a><span class="kw">saveRDS</span>(sce, tmpFn)</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="normalisation-caron-set.html#cb14-1"></a><span class="co"># Write object to file</span></span>
<span id="cb14-2"><a href="normalisation-caron-set.html#cb14-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/%s_sce_nz_postQc%s.Rds&quot;</span>,</span>
<span id="cb14-3"><a href="normalisation-caron-set.html#cb14-3"></a>         projDir, outDirBit, setName, setSuf)</span>
<span id="cb14-4"><a href="normalisation-caron-set.html#cb14-4"></a>sce &lt;-<span class="st"> </span><span class="kw">readRDS</span>(tmpFn)</span></code></pre></div>
<div id="scaling-normalization" class="section level2">
<h2><span class="header-section-number">7.1</span> Scaling normalization</h2>
<p>In scaling normalization, the “normalization factor” is an estimate of the library size relative to the other cells. Steps usually include: computation of a cell-specific ‘scaling’ or ‘size’ factor that represents the relative bias in that cell and division of all counts for the cell by that factor to remove that bias. Assumption: any cell specific bias will affect genes the same way.</p>
<p>Scaling methods typically generate normalised counts-per-million (CPM) or transcripts-per-million (TPM) values that address the effect of sequencing depth. These values however typically have a variance that increases with their mean (heteroscedasticity) while most statistical methods assume a stable variance, which does not vary with the mean (homoscedasticity). A widely used ‘variance stabilising transformation’ is the log transformation (often log2). This works fine for highly expressed genes (as in bulk RNA-seq) but less so for sparse scRNA-seq data.</p>
<div id="cpm" class="section level3">
<h3><span class="header-section-number">7.1.1</span> CPM</h3>
<p>Convert raw counts to counts-per-million (CPM) for each cell by dividing counts by the library size then multiplying by 1.000.000. Mind that this does not adress compositional bias caused by highly expressed genes that are also differentially expressed betwenn cells. In <code>scater</code> CPMs are computed with the following code:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="normalisation-caron-set.html#cb15-1"></a>calc_cpm &lt;-<span class="st"> </span><span class="cf">function</span> (expr_mat, <span class="dt">spikes =</span> <span class="ot">NULL</span>) </span>
<span id="cb15-2"><a href="normalisation-caron-set.html#cb15-2"></a>{</span>
<span id="cb15-3"><a href="normalisation-caron-set.html#cb15-3"></a>    norm_factor &lt;-<span class="st"> </span><span class="kw">colSums</span>(expr_mat[<span class="op">-</span>spikes, ])</span>
<span id="cb15-4"><a href="normalisation-caron-set.html#cb15-4"></a>    <span class="kw">return</span>(<span class="kw">t</span>(<span class="kw">t</span>(expr_mat)<span class="op">/</span>norm_factor)) <span class="op">*</span><span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">6</span></span>
<span id="cb15-5"><a href="normalisation-caron-set.html#cb15-5"></a>}</span></code></pre></div>
<p>We will use <code>scater</code>’s calculateCPM()</p>
</div>
<div id="deseqs-size-factor" class="section level3">
<h3><span class="header-section-number">7.1.2</span> DESeq’s size factor</h3>
<p>For each gene, compute geometric mean across cells. for each cell compute for each gene the ratio of its expression to its geometric mean, and derive the cell’s size factor as the median ratio across genes. Not suitable for sparse scRNA-seq data as the geometric is computed on non-zero values only. This method is also known as ‘Relative Log Expression’ (RLE) in <code>edgeR</code> and <code>scater</code>.</p>
<p>Example code:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="normalisation-caron-set.html#cb16-1"></a>calc_sf &lt;-<span class="st"> </span><span class="cf">function</span> (expr_mat, <span class="dt">spikes =</span> <span class="ot">NULL</span>) </span>
<span id="cb16-2"><a href="normalisation-caron-set.html#cb16-2"></a>{</span>
<span id="cb16-3"><a href="normalisation-caron-set.html#cb16-3"></a>    geomeans &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">rowMeans</span>(<span class="kw">log</span>(expr_mat[<span class="op">-</span>spikes, ])))</span>
<span id="cb16-4"><a href="normalisation-caron-set.html#cb16-4"></a>    SF &lt;-<span class="st"> </span><span class="cf">function</span>(cnts) {</span>
<span id="cb16-5"><a href="normalisation-caron-set.html#cb16-5"></a>        <span class="kw">median</span>((cnts<span class="op">/</span>geomeans)[(<span class="kw">is.finite</span>(geomeans) <span class="op">&amp;</span></span>
<span id="cb16-6"><a href="normalisation-caron-set.html#cb16-6"></a><span class="st">                </span>geomeans <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)])</span>
<span id="cb16-7"><a href="normalisation-caron-set.html#cb16-7"></a>    }</span>
<span id="cb16-8"><a href="normalisation-caron-set.html#cb16-8"></a>    norm_factor &lt;-<span class="st"> </span><span class="kw">apply</span>(expr_mat[<span class="op">-</span>spikes, ], <span class="dv">2</span>, SF)</span>
<span id="cb16-9"><a href="normalisation-caron-set.html#cb16-9"></a>    <span class="kw">return</span>(<span class="kw">t</span>(<span class="kw">t</span>(expr_mat)<span class="op">/</span>norm_factor))</span>
<span id="cb16-10"><a href="normalisation-caron-set.html#cb16-10"></a>}</span></code></pre></div>
</div>
<div id="weighted-trimmed-mean-of-m-values" class="section level3">
<h3><span class="header-section-number">7.1.3</span> Weighted Trimmed mean of M-values</h3>
<p>To compute weighted Trimmed mean of M-values (TMM), a given cell is chosen as a reference to use in computation for other cells. The M-values are gene-wise log2-fold changes between cells. Trimming entails the removal of the top and bottom 30% of values. The size factor is computed as the average for the remaining cells with a weight according to inverse variances. This method assumes that most genes are not differentially expressed, and the 40% lof genes left after trimming may include many zero counts.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="normalisation-caron-set.html#cb17-1"></a><span class="kw">sizeFactors</span>(sce) &lt;-<span class="st"> </span>edgeR<span class="op">::</span><span class="kw">calcNormFactors</span>(<span class="kw">counts</span>(sce), <span class="dt">method =</span> <span class="st">&quot;TMM&quot;</span>)</span></code></pre></div>
</div>
<div id="library-size-normalization-2" class="section level3">
<h3><span class="header-section-number">7.1.4</span> Library size normalization</h3>
<p>For each cell, the library size factor is proportional to the library size such that the average size factor across cell is one.</p>
<p>Advantage: normalised counts are on the same scale as the initial counts.</p>
<p>Compute size factors:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="normalisation-caron-set.html#cb18-1"></a>lib.sf &lt;-<span class="st"> </span><span class="kw">librarySizeFactors</span>(sce)</span>
<span id="cb18-2"><a href="normalisation-caron-set.html#cb18-2"></a><span class="kw">summary</span>(lib.sf)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.1233  0.4223  0.7386  1.0000  1.3334  7.9364</code></pre>
<p>Size factor distribution: wide range, typical of scRNA-seq data.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="normalisation-caron-set.html#cb20-1"></a><span class="kw">hist</span>(<span class="kw">log10</span>(lib.sf), <span class="dt">xlab=</span><span class="st">&quot;Log10[Size factor]&quot;</span>, <span class="dt">col=</span><span class="st">&#39;grey80&#39;</span>)</span></code></pre></div>
<p><img src="MkWoC_files/figure-html/librarySizeFactors_hist_norm_Caron_5hCellPerSpl-1.png" width="672" /></p>
<p>Assumption: absence of compositional bias; differential expression two cells is balanced: upregulation in some genes is accompanied by downregulation of other genes. Not observed.</p>
<p>Inaccurate normalisation due to unaccounted-for composition bias affects the size of the log fold change measured between clusters, but less so the clustering itself. It is thus sufficient to identify clusters and top marker genes.</p>
</div>
<div id="deconvolution-2" class="section level3">
<h3><span class="header-section-number">7.1.5</span> Deconvolution</h3>
<p>Composition bias occurs when differential expression beteween two samples or here cells is not balanced. For a fixed library size, identical in both cells, upregulation of one gene in the a cell will means fewer UMIs can be assigned to other genes, which would then appear down regulated. Even if library sizes are allowed to differ in size, with that for the cell with upregulation being higher, scaling normalisation will reduce noralised counts. Non-upregulated would therefore also appear downregulated.</p>
<p>For bulk RNA-seq, composition bias is removed by assuming that most genes are not differentially expressed between samples, so that differences in non-DE genes would amount to the bias, and used to compute size factors.</p>
<p>Given the sparsity of scRNA-seq data, the methods are not appropriate.</p>
<p>The method below increases read counts by pooling cells into groups, computing size factors within each of these groups and scaling them so they are comparable across clusters. This process is repeated many times, changing pools each time to collect several size factors for each cell, frome which is derived a single value for that cell.</p>
<!--
see DESeq2 estimateSizeFactorsFromMatrix
see edgeR calcNormFactors
-->
<p>Cluster cells then normalise.</p>
<div id="cluster-cells" class="section level4">
<h4><span class="header-section-number">7.1.5.1</span> Cluster cells</h4>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="normalisation-caron-set.html#cb21-1"></a><span class="kw">set.seed</span>(<span class="dv">100</span>) <span class="co"># clusters with PCA from irlba with approximation</span></span>
<span id="cb21-2"><a href="normalisation-caron-set.html#cb21-2"></a>clust &lt;-<span class="st"> </span><span class="kw">quickCluster</span>(sce) <span class="co"># slow with all cells.</span></span>
<span id="cb21-3"><a href="normalisation-caron-set.html#cb21-3"></a></span>
<span id="cb21-4"><a href="normalisation-caron-set.html#cb21-4"></a><span class="co"># write to file</span></span>
<span id="cb21-5"><a href="normalisation-caron-set.html#cb21-5"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/%s_sce_nz_quickClus%s.Rds&quot;</span>,</span>
<span id="cb21-6"><a href="normalisation-caron-set.html#cb21-6"></a>         projDir, outDirBit, setName, setSuf)</span>
<span id="cb21-7"><a href="normalisation-caron-set.html#cb21-7"></a><span class="kw">saveRDS</span>(clust, tmpFn)</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="normalisation-caron-set.html#cb22-1"></a><span class="co"># read from file</span></span>
<span id="cb22-2"><a href="normalisation-caron-set.html#cb22-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/%s_sce_nz_quickClus%s.Rds&quot;</span>,</span>
<span id="cb22-3"><a href="normalisation-caron-set.html#cb22-3"></a>         projDir, outDirBit, setName, setSuf)</span>
<span id="cb22-4"><a href="normalisation-caron-set.html#cb22-4"></a>clust &lt;-<span class="st"> </span><span class="kw">readRDS</span>(tmpFn)</span>
<span id="cb22-5"><a href="normalisation-caron-set.html#cb22-5"></a><span class="kw">table</span>(clust)</span></code></pre></div>
<pre><code>## clust
##   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19 
## 144 226 904 345 428 431 504 197 553 151 238 202 280 189 139 161 134 172 102</code></pre>
</div>
<div id="compute-size-factors-2" class="section level4">
<h4><span class="header-section-number">7.1.5.2</span> Compute size factors</h4>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="normalisation-caron-set.html#cb24-1"></a><span class="co">#deconv.sf &lt;- calculateSumFactors(sce, cluster=clust)</span></span>
<span id="cb24-2"><a href="normalisation-caron-set.html#cb24-2"></a>sce &lt;-<span class="st"> </span><span class="kw">computeSumFactors</span>(sce, <span class="dt">cluster=</span>clust, <span class="dt">min.mean=</span><span class="fl">0.1</span>)</span>
<span id="cb24-3"><a href="normalisation-caron-set.html#cb24-3"></a>deconv.sf &lt;-<span class="st"> </span><span class="kw">sizeFactors</span>(sce)</span>
<span id="cb24-4"><a href="normalisation-caron-set.html#cb24-4"></a></span>
<span id="cb24-5"><a href="normalisation-caron-set.html#cb24-5"></a><span class="co"># write to file</span></span>
<span id="cb24-6"><a href="normalisation-caron-set.html#cb24-6"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/%s_sce_nz_deconvSf%s.Rds&quot;</span>, projDir, outDirBit, setName, setSuf)</span>
<span id="cb24-7"><a href="normalisation-caron-set.html#cb24-7"></a><span class="kw">saveRDS</span>(deconv.sf, tmpFn)</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="normalisation-caron-set.html#cb25-1"></a><span class="co"># read from file</span></span>
<span id="cb25-2"><a href="normalisation-caron-set.html#cb25-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/%s_sce_nz_deconvSf%s.Rds&quot;</span>, projDir, outDirBit, setName, setSuf)</span>
<span id="cb25-3"><a href="normalisation-caron-set.html#cb25-3"></a>deconv.sf &lt;-<span class="st"> </span><span class="kw">readRDS</span>(tmpFn)</span>
<span id="cb25-4"><a href="normalisation-caron-set.html#cb25-4"></a></span>
<span id="cb25-5"><a href="normalisation-caron-set.html#cb25-5"></a><span class="kw">summary</span>(deconv.sf)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## 0.04128 0.38453 0.72555 1.00000 1.33783 7.70338</code></pre>
<p>Plot size factors:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="normalisation-caron-set.html#cb27-1"></a><span class="kw">plot</span>(lib.sf, deconv.sf, <span class="dt">xlab=</span><span class="st">&quot;Library size factor&quot;</span>,</span>
<span id="cb27-2"><a href="normalisation-caron-set.html#cb27-2"></a>    <span class="dt">ylab=</span><span class="st">&quot;Deconvolution size factor&quot;</span>, <span class="dt">log=</span><span class="st">&#39;xy&#39;</span>, <span class="dt">pch=</span><span class="dv">16</span>,</span>
<span id="cb27-3"><a href="normalisation-caron-set.html#cb27-3"></a>    <span class="dt">col=</span><span class="kw">as.integer</span>(<span class="kw">factor</span>(sce<span class="op">$</span>source_name)))</span>
<span id="cb27-4"><a href="normalisation-caron-set.html#cb27-4"></a><span class="kw">abline</span>(<span class="dt">a=</span><span class="dv">0</span>, <span class="dt">b=</span><span class="dv">1</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="MkWoC_files/figure-html/scatter_deconvSf_libSf_plot_norm_Caron_5hCellPerSpl-1.png" width="672" /></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="normalisation-caron-set.html#cb28-1"></a>deconvDf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(lib.sf, deconv.sf,</span>
<span id="cb28-2"><a href="normalisation-caron-set.html#cb28-2"></a>            <span class="st">&quot;source_name&quot;</span> =<span class="st"> </span>sce<span class="op">$</span>source_name,</span>
<span id="cb28-3"><a href="normalisation-caron-set.html#cb28-3"></a>            <span class="st">&quot;sum&quot;</span> =<span class="st"> </span>sce<span class="op">$</span>sum,</span>
<span id="cb28-4"><a href="normalisation-caron-set.html#cb28-4"></a>            <span class="st">&quot;mito_content&quot;</span> =<span class="st"> </span>sce<span class="op">$</span>subsets_Mito_percent,</span>
<span id="cb28-5"><a href="normalisation-caron-set.html#cb28-5"></a>            <span class="st">&quot;cell_sparsity&quot;</span> =<span class="st"> </span>sce<span class="op">$</span>cell_sparsity)</span>
<span id="cb28-6"><a href="normalisation-caron-set.html#cb28-6"></a></span>
<span id="cb28-7"><a href="normalisation-caron-set.html#cb28-7"></a><span class="co"># colour by sample type</span></span>
<span id="cb28-8"><a href="normalisation-caron-set.html#cb28-8"></a>sp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(deconvDf, <span class="kw">aes</span>(<span class="dt">x=</span>lib.sf, <span class="dt">y=</span>deconv.sf, <span class="dt">col=</span>source_name)) <span class="op">+</span></span>
<span id="cb28-9"><a href="normalisation-caron-set.html#cb28-9"></a><span class="st">  </span><span class="kw">geom_point</span>()</span>
<span id="cb28-10"><a href="normalisation-caron-set.html#cb28-10"></a>sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>source_name)</span></code></pre></div>
<p><img src="MkWoC_files/figure-html/scatter_deconvSf_libSf_colBy_plot_norm_Caron_5hCellPerSpl-1.png" width="672" /></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="normalisation-caron-set.html#cb29-1"></a><span class="co"># colour by library size</span></span>
<span id="cb29-2"><a href="normalisation-caron-set.html#cb29-2"></a>sp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(deconvDf, <span class="kw">aes</span>(<span class="dt">x=</span>lib.sf, <span class="dt">y=</span>deconv.sf, <span class="dt">col=</span>sum)) <span class="op">+</span></span>
<span id="cb29-3"><a href="normalisation-caron-set.html#cb29-3"></a><span class="st">  </span><span class="kw">geom_point</span>()</span>
<span id="cb29-4"><a href="normalisation-caron-set.html#cb29-4"></a>sp</span></code></pre></div>
<p><img src="MkWoC_files/figure-html/scatter_deconvSf_libSf_colBy_plot_norm_Caron_5hCellPerSpl-2.png" width="672" /></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="normalisation-caron-set.html#cb30-1"></a><span class="co"># colour by mito. content</span></span>
<span id="cb30-2"><a href="normalisation-caron-set.html#cb30-2"></a>sp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(deconvDf, <span class="kw">aes</span>(<span class="dt">x=</span>lib.sf, <span class="dt">y=</span>deconv.sf, <span class="dt">col=</span>mito_content)) <span class="op">+</span></span>
<span id="cb30-3"><a href="normalisation-caron-set.html#cb30-3"></a><span class="st">  </span><span class="kw">geom_point</span>()</span>
<span id="cb30-4"><a href="normalisation-caron-set.html#cb30-4"></a>sp</span></code></pre></div>
<p><img src="MkWoC_files/figure-html/scatter_deconvSf_libSf_colBy_plot_norm_Caron_5hCellPerSpl-3.png" width="672" /></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="normalisation-caron-set.html#cb31-1"></a><span class="co"># colour by cell sparsity</span></span>
<span id="cb31-2"><a href="normalisation-caron-set.html#cb31-2"></a>sp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(deconvDf, <span class="kw">aes</span>(<span class="dt">x=</span>lib.sf, <span class="dt">y=</span>deconv.sf, <span class="dt">col=</span>cell_sparsity)) <span class="op">+</span></span>
<span id="cb31-3"><a href="normalisation-caron-set.html#cb31-3"></a><span class="st">  </span><span class="kw">geom_point</span>()</span>
<span id="cb31-4"><a href="normalisation-caron-set.html#cb31-4"></a>sp</span></code></pre></div>
<p><img src="MkWoC_files/figure-html/scatter_deconvSf_libSf_colBy_plot_norm_Caron_5hCellPerSpl-4.png" width="672" /></p>
</div>
<div id="apply-size-factors-2" class="section level4">
<h4><span class="header-section-number">7.1.5.3</span> Apply size factors</h4>
<p>For each cell, raw counts for genes are divided by the size factor for that cell and log-transformed so downstream analyses focus on genes with strong relative differences. We use <code>scater::logNormCounts()</code>.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="normalisation-caron-set.html#cb32-1"></a>sce &lt;-<span class="st"> </span><span class="kw">logNormCounts</span>(sce) <span class="co"># adds logcounts</span></span>
<span id="cb32-2"><a href="normalisation-caron-set.html#cb32-2"></a><span class="kw">print</span>(<span class="kw">assayNames</span>(sce))</span></code></pre></div>
<pre><code>## [1] &quot;counts&quot;    &quot;logcounts&quot;</code></pre>
</div>
<div id="save-object-2" class="section level4">
<h4><span class="header-section-number">7.1.5.4</span> Save object</h4>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="normalisation-caron-set.html#cb34-1"></a>sceDeconv &lt;-<span class="st"> </span>sce</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="normalisation-caron-set.html#cb35-1"></a><span class="co"># write to file</span></span>
<span id="cb35-2"><a href="normalisation-caron-set.html#cb35-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/%s_sce_nz_postDeconv%s.Rds&quot;</span>, projDir, outDirBit, setName, setSuf)</span>
<span id="cb35-3"><a href="normalisation-caron-set.html#cb35-3"></a><span class="kw">saveRDS</span>(sceDeconv, tmpFn)</span></code></pre></div>
</div>
</div>
</div>
<div id="sctransform-1" class="section level2">
<h2><span class="header-section-number">7.2</span> SCTransform</h2>
<!--
https://rawgit.com/ChristophH/sctransform/master/inst/doc/variance_stabilizing_transformation.html

vars.to.regress = c("S.Score", "G2M.Score")
vars.to.regress = c("percentMito","Sex")
-->
<p>With scaling normalisation a correlation remains between the mean and variation of expression (heteroskedasticity). This affects downstream dimensionality reduction as the few main new dimensions are usually correlated with library size. SCTransform addresses the issue by regressing library size out of raw counts and providing residuals to use as normalized and variance-stabilized expression values in downstream analysis.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="normalisation-caron-set.html#cb36-1"></a>counts &lt;-<span class="st"> </span><span class="kw">counts</span>(sce)</span>
<span id="cb36-2"><a href="normalisation-caron-set.html#cb36-2"></a><span class="kw">print</span>(<span class="kw">class</span>(counts))</span></code></pre></div>
<pre><code>## [1] &quot;dgCMatrix&quot;
## attr(,&quot;package&quot;)
## [1] &quot;Matrix&quot;</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="normalisation-caron-set.html#cb38-1"></a><span class="kw">print</span>(<span class="kw">dim</span>(counts))</span></code></pre></div>
<pre><code>## [1] 16629  5500</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="normalisation-caron-set.html#cb40-1"></a><span class="kw">colnames</span>(counts) &lt;-<span class="st"> </span><span class="kw">colData</span>(sce)<span class="op">$</span>Barcode</span></code></pre></div>
<div id="inspect-data" class="section level3">
<h3><span class="header-section-number">7.2.1</span> Inspect data</h3>
<p>We will now calculate some properties and visually inspect the data. Our main interest is in the general trends not in individual outliers. Neither genes nor cells that stand out are important at this step, but we focus on the global trends.</p>
<p>Derive gene and cell attributes from the UMI matrix.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="normalisation-caron-set.html#cb41-1"></a>gene_attr &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">mean =</span> <span class="kw">rowMeans</span>(counts), </span>
<span id="cb41-2"><a href="normalisation-caron-set.html#cb41-2"></a>                        <span class="dt">detection_rate =</span> <span class="kw">rowMeans</span>(counts <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>),</span>
<span id="cb41-3"><a href="normalisation-caron-set.html#cb41-3"></a>                        <span class="dt">var =</span> <span class="kw">apply</span>(counts, <span class="dv">1</span>, var))</span>
<span id="cb41-4"><a href="normalisation-caron-set.html#cb41-4"></a>gene_attr<span class="op">$</span>log_mean &lt;-<span class="st"> </span><span class="kw">log10</span>(gene_attr<span class="op">$</span>mean)</span>
<span id="cb41-5"><a href="normalisation-caron-set.html#cb41-5"></a>gene_attr<span class="op">$</span>log_var &lt;-<span class="st"> </span><span class="kw">log10</span>(gene_attr<span class="op">$</span>var)</span>
<span id="cb41-6"><a href="normalisation-caron-set.html#cb41-6"></a><span class="kw">rownames</span>(gene_attr) &lt;-<span class="st"> </span><span class="kw">rownames</span>(counts)</span>
<span id="cb41-7"><a href="normalisation-caron-set.html#cb41-7"></a>cell_attr &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">n_umi =</span> <span class="kw">colSums</span>(counts),</span>
<span id="cb41-8"><a href="normalisation-caron-set.html#cb41-8"></a>                        <span class="dt">n_gene =</span> <span class="kw">colSums</span>(counts <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>))</span>
<span id="cb41-9"><a href="normalisation-caron-set.html#cb41-9"></a><span class="kw">rownames</span>(cell_attr) &lt;-<span class="st"> </span><span class="kw">colnames</span>(counts)</span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="normalisation-caron-set.html#cb42-1"></a><span class="kw">dim</span>(gene_attr)</span></code></pre></div>
<pre><code>## [1] 16629     5</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="normalisation-caron-set.html#cb44-1"></a><span class="kw">head</span>(gene_attr)</span></code></pre></div>
<pre><code>##                        mean detection_rate         var   log_mean    log_var
## ENSG00000237491 0.018181818    0.018181818 0.017854486 -1.7403627 -1.7482526
## ENSG00000225880 0.013818182    0.013636364 0.013993420 -1.8595491 -1.8540761
## ENSG00000230368 0.018909091    0.018727273 0.018918613 -1.7233294 -1.7231107
## ENSG00000230699 0.002363636    0.002363636 0.002358478 -2.6264193 -2.6273681
## ENSG00000188976 0.188363636    0.164000000 0.208920762 -0.7250029 -0.6800184
## ENSG00000187961 0.004909091    0.004545455 0.005613285 -2.3089989 -2.2507829</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="normalisation-caron-set.html#cb46-1"></a><span class="kw">dim</span>(cell_attr)</span></code></pre></div>
<pre><code>## [1] 5500    2</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="normalisation-caron-set.html#cb48-1"></a><span class="kw">head</span>(cell_attr)</span></code></pre></div>
<pre><code>##                    n_umi n_gene
## GTCCTCAGTCCAAGTT-1   573    331
## ACACCCTAGCTCCCAG-1  4370   1513
## ACTTTCACACCACCAG-1  3110   1107
## ACGCCAGAGGCCCTCA-1  5094   1815
## ATCCACCTCATCGATG-1  8990   2732
## CCTATTACAAGCGATG-1  6614   2313</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="normalisation-caron-set.html#cb50-1"></a><span class="kw">ggplot</span>(gene_attr, <span class="kw">aes</span>(log_mean, log_var)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb50-2"><a href="normalisation-caron-set.html#cb50-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.3</span>, <span class="dt">shape=</span><span class="dv">16</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb50-3"><a href="normalisation-caron-set.html#cb50-3"></a><span class="st">  </span><span class="kw">geom_density_2d</span>(<span class="dt">size =</span> <span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb50-4"><a href="normalisation-caron-set.html#cb50-4"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">color=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="MkWoC_files/figure-html/attr_plot_sct_Caron_5hCellPerSpl-1.png" width="672" /></p>
<p>Mean-variance relationship</p>
<p>For the genes, we can see that up to a mean UMI count of ca. 0.1 the variance follows the line through the origin with slop one, i.e. variance and mean are roughly equal as expected under a Poisson model. However, genes with a higher average UMI count show overdispersion compared to Poisson.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="normalisation-caron-set.html#cb51-1"></a><span class="co"># add the expected detection rate under Poisson model</span></span>
<span id="cb51-2"><a href="normalisation-caron-set.html#cb51-2"></a>x =<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">-3</span>, <span class="dt">to =</span> <span class="dv">2</span>, <span class="dt">length.out =</span> <span class="dv">1000</span>)</span>
<span id="cb51-3"><a href="normalisation-caron-set.html#cb51-3"></a>poisson_model &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">log_mean =</span> x, <span class="dt">detection_rate =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">dpois</span>(<span class="dv">0</span>, <span class="dt">lambda =</span> <span class="dv">10</span><span class="op">^</span>x))</span>
<span id="cb51-4"><a href="normalisation-caron-set.html#cb51-4"></a><span class="kw">ggplot</span>(gene_attr, <span class="kw">aes</span>(log_mean, detection_rate)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb51-5"><a href="normalisation-caron-set.html#cb51-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.3</span>, <span class="dt">shape=</span><span class="dv">16</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb51-6"><a href="normalisation-caron-set.html#cb51-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data=</span>poisson_model, <span class="dt">color=</span><span class="st">&#39;red&#39;</span>) <span class="op">+</span></span>
<span id="cb51-7"><a href="normalisation-caron-set.html#cb51-7"></a><span class="st">  </span><span class="kw">theme_gray</span>(<span class="dt">base_size =</span> <span class="dv">8</span>)</span></code></pre></div>
<p><img src="MkWoC_files/figure-html/scatter_detecRate_logMean_sct_Caron_5hCellPerSpl-1.png" width="672" /></p>
<p>Mean-detection-rate relationship</p>
<p>In line with the previous plot, we see a lower than expected detection rate in the medium expression range. However, for the highly expressed genes, the rate is at or very close to 1.0 suggesting that there is no zero-inflation in the counts for those genes and that zero-inflation is a result of overdispersion, rather than an independent systematic bias.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="normalisation-caron-set.html#cb52-1"></a><span class="kw">ggplot</span>(cell_attr, <span class="kw">aes</span>(n_umi, n_gene)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb52-2"><a href="normalisation-caron-set.html#cb52-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.3</span>, <span class="dt">shape=</span><span class="dv">16</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb52-3"><a href="normalisation-caron-set.html#cb52-3"></a><span class="st">  </span><span class="kw">geom_density_2d</span>(<span class="dt">size =</span> <span class="fl">0.3</span>)</span></code></pre></div>
<p><img src="MkWoC_files/figure-html/scatter_nGene_nUmi_sct_Caron_5hCellPerSpl-1.png" width="672" /></p>
</div>
<div id="transformation" class="section level3">
<h3><span class="header-section-number">7.2.2</span> Transformation</h3>
<p>Based on the observations above, which are not unique to this particular data set, we propose to model the expression of each gene as a negative binomial random variable with a mean that depends on other variables. Here the other variables can be used to model the differences in sequencing depth between cells and are used as independent variables in a regression model. In order to avoid overfitting, we will first fit model parameters per gene, and then use the relationship between gene mean and parameter values to fit parameters, thereby combining information across genes. Given the fitted model parameters, we transform each observed UMI count into a Pearson residual which can be interpreted as the number of standard deviations an observed count was away from the expected mean. If the model accurately describes the mean-variance relationship and the dependency of mean and latent factors, then the result should have mean zero and a stable variance across the range of expression.
Estimate model parameters and transform data</p>
<p>The vst function estimates model parameters and performs the variance stabilizing transformation. Here we use the log10 of the total UMI counts of a cell as variable for sequencing depth for each cell. After data transformation we plot the model parameters as a function of gene mean (geometric mean).</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="normalisation-caron-set.html#cb53-1"></a><span class="kw">print</span>(<span class="kw">dim</span>(counts))</span></code></pre></div>
<pre><code>## [1] 16629  5500</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="normalisation-caron-set.html#cb55-1"></a><span class="co"># We use the Future API for parallel processing; set parameters here</span></span>
<span id="cb55-2"><a href="normalisation-caron-set.html#cb55-2"></a>future<span class="op">::</span><span class="kw">plan</span>(<span class="dt">strategy =</span> <span class="st">&#39;multicore&#39;</span>, <span class="dt">workers =</span> <span class="dv">4</span>)</span>
<span id="cb55-3"><a href="normalisation-caron-set.html#cb55-3"></a><span class="kw">options</span>(<span class="dt">future.globals.maxSize =</span> <span class="dv">10</span> <span class="op">*</span><span class="st"> </span><span class="dv">1024</span> <span class="op">^</span><span class="st"> </span><span class="dv">3</span>)</span>
<span id="cb55-4"><a href="normalisation-caron-set.html#cb55-4"></a></span>
<span id="cb55-5"><a href="normalisation-caron-set.html#cb55-5"></a><span class="kw">set.seed</span>(<span class="dv">44</span>)</span>
<span id="cb55-6"><a href="normalisation-caron-set.html#cb55-6"></a>vst_out &lt;-<span class="st"> </span>sctransform<span class="op">::</span><span class="kw">vst</span>(counts,</span>
<span id="cb55-7"><a href="normalisation-caron-set.html#cb55-7"></a>                <span class="dt">latent_var =</span> <span class="kw">c</span>(<span class="st">&#39;log_umi&#39;</span>),</span>
<span id="cb55-8"><a href="normalisation-caron-set.html#cb55-8"></a>                <span class="dt">return_gene_attr =</span> <span class="ot">TRUE</span>,</span>
<span id="cb55-9"><a href="normalisation-caron-set.html#cb55-9"></a>                <span class="dt">return_cell_attr =</span> <span class="ot">TRUE</span>,</span>
<span id="cb55-10"><a href="normalisation-caron-set.html#cb55-10"></a>                <span class="dt">show_progress =</span> <span class="ot">FALSE</span>)</span>
<span id="cb55-11"><a href="normalisation-caron-set.html#cb55-11"></a>sctransform<span class="op">::</span><span class="kw">plot_model_pars</span>(vst_out)</span></code></pre></div>
<p><img src="MkWoC_files/figure-html/comp_sct_Caron_5hCellPerSpl-1.png" width="672" /></p>
<p>Inspect model</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="normalisation-caron-set.html#cb56-1"></a><span class="kw">print</span>(vst_out<span class="op">$</span>model_str)</span></code></pre></div>
<pre><code>## [1] &quot;y ~ log_umi&quot;</code></pre>
<p>We will look at several genes in more detail.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="normalisation-caron-set.html#cb58-1"></a><span class="kw">rowData</span>(sce) <span class="op">%&gt;%</span></span>
<span id="cb58-2"><a href="normalisation-caron-set.html#cb58-2"></a><span class="st">    </span>as.data.frame <span class="op">%&gt;%</span></span>
<span id="cb58-3"><a href="normalisation-caron-set.html#cb58-3"></a><span class="st">    </span><span class="kw">filter</span>(Symbol <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;MALAT1&#39;</span>, <span class="st">&#39;RPL10&#39;</span>, <span class="st">&#39;FTL&#39;</span>))</span></code></pre></div>
<pre><code>##                 ensembl_gene_id external_gene_name chromosome_name
## ENSG00000147403 ENSG00000147403              RPL10               X
## ENSG00000251562 ENSG00000251562             MALAT1              11
## ENSG00000087086 ENSG00000087086                FTL              19
##                 start_position end_position strand Symbol            Type
## ENSG00000147403      154389955    154409168      1  RPL10 Gene Expression
## ENSG00000251562       65497688     65506516      1 MALAT1 Gene Expression
## ENSG00000087086       48965309     48966879      1    FTL Gene Expression
##                      mean detected gene_sparsity
## ENSG00000147403  44.29776 98.41586    0.01085709
## ENSG00000251562 168.70211 98.86173    0.00607423
## ENSG00000087086  11.38505 92.88974    0.09063516</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="normalisation-caron-set.html#cb60-1"></a>sctransform<span class="op">::</span><span class="kw">plot_model</span>(vst_out,</span>
<span id="cb60-2"><a href="normalisation-caron-set.html#cb60-2"></a>            counts,</span>
<span id="cb60-3"><a href="normalisation-caron-set.html#cb60-3"></a>            <span class="kw">c</span>(<span class="st">&#39;ENSG00000251562&#39;</span>, <span class="st">&#39;ENSG00000147403&#39;</span>, <span class="st">&#39;ENSG00000087086&#39;</span>),</span>
<span id="cb60-4"><a href="normalisation-caron-set.html#cb60-4"></a>            <span class="dt">plot_residual =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="MkWoC_files/figure-html/plot_model_1_sct_Caron_5hCellPerSpl-1.png" width="672" /></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="normalisation-caron-set.html#cb61-1"></a>sctransform<span class="op">::</span><span class="kw">plot_model</span>(vst_out,</span>
<span id="cb61-2"><a href="normalisation-caron-set.html#cb61-2"></a>            counts,</span>
<span id="cb61-3"><a href="normalisation-caron-set.html#cb61-3"></a>            <span class="kw">c</span>(<span class="st">&#39;ENSG00000087086&#39;</span>),</span>
<span id="cb61-4"><a href="normalisation-caron-set.html#cb61-4"></a>            <span class="dt">plot_residual =</span> <span class="ot">TRUE</span>,</span>
<span id="cb61-5"><a href="normalisation-caron-set.html#cb61-5"></a>            <span class="dt">show_nr =</span> <span class="ot">TRUE</span>,</span>
<span id="cb61-6"><a href="normalisation-caron-set.html#cb61-6"></a>            <span class="dt">arrange_vertical =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="MkWoC_files/figure-html/plot_model_2_sct_Caron_5hCellPerSpl-1.png" width="672" /></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="normalisation-caron-set.html#cb62-1"></a><span class="kw">ggplot</span>(vst_out<span class="op">$</span>gene_attr, <span class="kw">aes</span>(residual_mean)) <span class="op">+</span></span>
<span id="cb62-2"><a href="normalisation-caron-set.html#cb62-2"></a><span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth=</span><span class="fl">0.01</span>)</span></code></pre></div>
<p><img src="MkWoC_files/figure-html/plot_model_4_sct_Caron_5hCellPerSpl-1.png" width="672" /></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="normalisation-caron-set.html#cb63-1"></a><span class="kw">ggplot</span>(vst_out<span class="op">$</span>gene_attr, <span class="kw">aes</span>(residual_variance)) <span class="op">+</span></span>
<span id="cb63-2"><a href="normalisation-caron-set.html#cb63-2"></a><span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth=</span><span class="fl">0.1</span>) <span class="op">+</span></span>
<span id="cb63-3"><a href="normalisation-caron-set.html#cb63-3"></a><span class="st">    </span><span class="kw">geom_vline</span>(<span class="dt">xintercept=</span><span class="dv">1</span>, <span class="dt">color=</span><span class="st">&#39;red&#39;</span>) <span class="op">+</span></span>
<span id="cb63-4"><a href="normalisation-caron-set.html#cb63-4"></a><span class="st">    </span><span class="kw">xlim</span>(<span class="dv">0</span>, <span class="dv">10</span>)</span></code></pre></div>
<p><img src="MkWoC_files/figure-html/plot_model_4_sct_Caron_5hCellPerSpl-2.png" width="672" /></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="normalisation-caron-set.html#cb64-1"></a><span class="kw">ggplot</span>(vst_out<span class="op">$</span>gene_attr, <span class="kw">aes</span>(<span class="dt">x=</span>residual_mean, <span class="dt">y=</span>residual_variance)) <span class="op">+</span></span>
<span id="cb64-2"><a href="normalisation-caron-set.html#cb64-2"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.3</span>, <span class="dt">shape=</span><span class="dv">16</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb64-3"><a href="normalisation-caron-set.html#cb64-3"></a><span class="st">    </span><span class="kw">xlim</span>(<span class="dv">0</span>, <span class="fl">2.5</span>) <span class="op">+</span></span>
<span id="cb64-4"><a href="normalisation-caron-set.html#cb64-4"></a><span class="st">    </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">10</span>) <span class="op">+</span></span>
<span id="cb64-5"><a href="normalisation-caron-set.html#cb64-5"></a><span class="st">    </span><span class="kw">geom_density_2d</span>()</span></code></pre></div>
<p><img src="MkWoC_files/figure-html/plot_model_4_sct_Caron_5hCellPerSpl-3.png" width="672" /></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="normalisation-caron-set.html#cb65-1"></a><span class="kw">ggplot</span>(vst_out<span class="op">$</span>gene_attr,</span>
<span id="cb65-2"><a href="normalisation-caron-set.html#cb65-2"></a>       <span class="kw">aes</span>(<span class="kw">log10</span>(gmean), residual_variance)) <span class="op">+</span></span>
<span id="cb65-3"><a href="normalisation-caron-set.html#cb65-3"></a><span class="st">       </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.3</span>, <span class="dt">shape=</span><span class="dv">16</span>) <span class="op">+</span></span>
<span id="cb65-4"><a href="normalisation-caron-set.html#cb65-4"></a><span class="st">       </span><span class="kw">geom_density_2d</span>(<span class="dt">size =</span> <span class="fl">0.3</span>)</span></code></pre></div>
<p><img src="MkWoC_files/figure-html/plot_model_5_sct_Caron_5hCellPerSpl-1.png" width="672" /></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="normalisation-caron-set.html#cb66-1"></a>dd &lt;-<span class="st"> </span>vst_out<span class="op">$</span>gene_attr <span class="op">%&gt;%</span></span>
<span id="cb66-2"><a href="normalisation-caron-set.html#cb66-2"></a><span class="st">    </span><span class="kw">arrange</span>(<span class="op">-</span>residual_variance) <span class="op">%&gt;%</span></span>
<span id="cb66-3"><a href="normalisation-caron-set.html#cb66-3"></a><span class="st">    </span><span class="kw">slice_head</span>(<span class="dt">n =</span> <span class="dv">22</span>) <span class="op">%&gt;%</span></span>
<span id="cb66-4"><a href="normalisation-caron-set.html#cb66-4"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.numeric), round, <span class="dv">2</span>))</span>
<span id="cb66-5"><a href="normalisation-caron-set.html#cb66-5"></a>dd <span class="op">%&gt;%</span><span class="st"> </span>tibble<span class="op">::</span><span class="kw">rownames_to_column</span>(<span class="st">&quot;ensembl_gene_id&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb66-6"><a href="normalisation-caron-set.html#cb66-6"></a><span class="st">    </span><span class="kw">left_join</span>(<span class="kw">as.data.frame</span>(<span class="kw">rowData</span>(sce))[,<span class="kw">c</span>(<span class="st">&quot;ensembl_gene_id&quot;</span>, <span class="st">&quot;Symbol&quot;</span>)],</span>
<span id="cb66-7"><a href="normalisation-caron-set.html#cb66-7"></a>          <span class="st">&quot;ensembl_gene_id&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb66-8"><a href="normalisation-caron-set.html#cb66-8"></a><span class="st">    </span>DT<span class="op">::</span><span class="kw">datatable</span>(<span class="dt">rownames =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div id="htmlwidget-2ce557cc59d30cb7332f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2ce557cc59d30cb7332f">{"x":{"filter":"none","data":[["ENSG00000244734","ENSG00000206172","ENSG00000188536","ENSG00000223609","ENSG00000090382","ENSG00000143546","ENSG00000163220","ENSG00000206177","ENSG00000169877","ENSG00000133742","ENSG00000257764","ENSG00000115523","ENSG00000163221","ENSG00000196565","ENSG00000211677","ENSG00000211592","ENSG00000197061","ENSG00000271503","ENSG00000165949","ENSG00000170180","ENSG00000005381","ENSG00000211679"],[0.63,0.44,0.49,0.23,0.09,0.11,0.12,0.15,0.16,0.15,0.06,0.03,0.03,0.08,0.13,0.29,0.42,0.06,0.09,0.08,0.02,0.14],[3.59,1.56,1.99,0.53,0.19,0.2,0.2,0.35,0.37,0.29,0.09,0.05,0.06,0.11,0.16,0.4,0.84,0.08,0.18,0.16,0.03,0.17],[611883.73,42286.22,82996.6,1144.4,157.86,338.4,264.49,268.16,248.39,239.25,38.54,5.62,8.65,1831.63,22779.32,37992,302.99,3.81,27.17,23.87,3.77,6836.5],[5.36,4.88,4.95,2.84,1.83,1.54,1.48,1.89,1.74,1.25,0.69,0.6,0.59,0.49,0.7,0.91,1.06,0.66,0.76,0.69,0.39,0.63],[362.86,348.49,346.51,181.78,137,119.97,112.46,112.24,87.48,71.74,53.3,49.77,43.29,42.85,39.97,38.48,36.8,35.89,35.29,32.28,31.64,29.17],["HBB","HBA1","HBA2","HBD","LYZ","S100A8","S100A9","HBM","AHSP","CA1","AC020656.1","GNLY","S100A12","HBG2","IGLC2","IGKC","HIST1H4C","CCL5","IFI27","GYPA","MPO","IGLC3"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>ensembl_gene_id<\/th>\n      <th>detection_rate<\/th>\n      <th>gmean<\/th>\n      <th>variance<\/th>\n      <th>residual_mean<\/th>\n      <th>residual_variance<\/th>\n      <th>Symbol<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="normalisation-caron-set.html#cb67-1"></a><span class="co"># write to file</span></span>
<span id="cb67-2"><a href="normalisation-caron-set.html#cb67-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/%s_sce_nz_vst_out%s.Rds&quot;</span>,</span>
<span id="cb67-3"><a href="normalisation-caron-set.html#cb67-3"></a>         projDir, outDirBit, setName, setSuf)</span>
<span id="cb67-4"><a href="normalisation-caron-set.html#cb67-4"></a><span class="kw">saveRDS</span>(vst_out, tmpFn)</span></code></pre></div>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="normalisation-caron-set.html#cb68-1"></a><span class="kw">print</span>(<span class="kw">dim</span>(vst_out<span class="op">$</span>y))</span></code></pre></div>
<pre><code>## [1] 16353  5500</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="normalisation-caron-set.html#cb70-1"></a>vst_out<span class="op">$</span>y[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>##                 GTCCTCAGTCCAAGTT-1 ACACCCTAGCTCCCAG-1 ACTTTCACACCACCAG-1
## ENSG00000237491        -0.05609117         6.74247881        -0.11724281
## ENSG00000225880        -0.05010427        -0.11721874        -0.10206077
## ENSG00000230368        -0.05696297        -0.13783109        -0.11937957
## ENSG00000230699        -0.02265068        -0.04848545        -0.04274449
## ENSG00000188976        -0.17050940        -0.42416056        -0.36719193
## ENSG00000187961        -0.03121753        -0.06988428        -0.06123475
## ENSG00000272512        -0.02108042        -0.04455552        -0.03935650
## ENSG00000188290        -0.14604143        -0.36522703        -0.31538220
## ENSG00000187608        -0.27407056        -0.64324432        -0.56711490
## ENSG00000188157        -0.03246537        -0.07295948        -0.06389654
##                 ACGCCAGAGGCCCTCA-1 ATCCACCTCATCGATG-1
## ENSG00000237491        -0.14418312        -0.18129692
## ENSG00000225880        -0.12466224        -0.15567896
## ENSG00000230368         6.12170744        -0.18486895
## ENSG00000230699        -0.05130377        -0.06312019
## ENSG00000188976        -0.45181507        -0.56374272
## ENSG00000187961        -0.07412736        -0.09183209
## ENSG00000272512        -0.04710584        -0.05779140
## ENSG00000188290        -0.38960850        -0.48980229
## ENSG00000187608        -0.67855403        -0.81010185
## ENSG00000188157        -0.07740485        -0.09594379</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="normalisation-caron-set.html#cb72-1"></a>sce</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 16629 5500 
## metadata(0):
## assays(2): counts logcounts
## rownames(16629): ENSG00000237491 ENSG00000225880 ... ENSG00000275063
##   ENSG00000271254
## rowData names(11): ensembl_gene_id external_gene_name ... detected
##   gene_sparsity
## colnames: NULL
## colData names(16): Barcode Run ... cell_sparsity sizeFactor
## reducedDimNames(0):
## altExpNames(0):</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="normalisation-caron-set.html#cb74-1"></a><span class="kw">print</span>(<span class="kw">assayNames</span>(sce))</span></code></pre></div>
<pre><code>## [1] &quot;counts&quot;    &quot;logcounts&quot;</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="normalisation-caron-set.html#cb76-1"></a><span class="co"># assay(sce, &quot;sctrans_norm&quot;) &lt;- vst_out$y</span></span></code></pre></div>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="normalisation-caron-set.html#cb77-1"></a><span class="co"># genes that are expressed in fewer than 5 cells are not used and not returned</span></span>
<span id="cb77-2"><a href="normalisation-caron-set.html#cb77-2"></a><span class="co"># so to add vst_out$y as an assay we need to ditch the missing genes completely.</span></span>
<span id="cb77-3"><a href="normalisation-caron-set.html#cb77-3"></a><span class="co"># https://github.com/ChristophH/sctransform/issues/27</span></span>
<span id="cb77-4"><a href="normalisation-caron-set.html#cb77-4"></a></span>
<span id="cb77-5"><a href="normalisation-caron-set.html#cb77-5"></a><span class="co">#rownames(vst_out$y)</span></span>
<span id="cb77-6"><a href="normalisation-caron-set.html#cb77-6"></a></span>
<span id="cb77-7"><a href="normalisation-caron-set.html#cb77-7"></a>sceOrig &lt;-<span class="st"> </span>sce</span>
<span id="cb77-8"><a href="normalisation-caron-set.html#cb77-8"></a>sceOrig</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 16629 5500 
## metadata(0):
## assays(2): counts logcounts
## rownames(16629): ENSG00000237491 ENSG00000225880 ... ENSG00000275063
##   ENSG00000271254
## rowData names(11): ensembl_gene_id external_gene_name ... detected
##   gene_sparsity
## colnames: NULL
## colData names(16): Barcode Run ... cell_sparsity sizeFactor
## reducedDimNames(0):
## altExpNames(0):</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="normalisation-caron-set.html#cb79-1"></a>tmpInd &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">rownames</span>(sce) <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(vst_out<span class="op">$</span>y))</span>
<span id="cb79-2"><a href="normalisation-caron-set.html#cb79-2"></a>cols.meta &lt;-<span class="st"> </span><span class="kw">colData</span>(sceOrig)</span>
<span id="cb79-3"><a href="normalisation-caron-set.html#cb79-3"></a>rows.meta &lt;-<span class="st"> </span><span class="kw">rowData</span>(sceOrig)</span>
<span id="cb79-4"><a href="normalisation-caron-set.html#cb79-4"></a></span>
<span id="cb79-5"><a href="normalisation-caron-set.html#cb79-5"></a>new.counts &lt;-<span class="st"> </span><span class="kw">counts</span>(sceOrig)[tmpInd, ]</span>
<span id="cb79-6"><a href="normalisation-caron-set.html#cb79-6"></a>sce &lt;-<span class="st"> </span><span class="kw">SingleCellExperiment</span>(<span class="kw">list</span>(<span class="dt">counts=</span>new.counts))</span>
<span id="cb79-7"><a href="normalisation-caron-set.html#cb79-7"></a></span>
<span id="cb79-8"><a href="normalisation-caron-set.html#cb79-8"></a><span class="co"># reset the column data on the new object</span></span>
<span id="cb79-9"><a href="normalisation-caron-set.html#cb79-9"></a><span class="kw">colData</span>(sce) &lt;-<span class="st"> </span>cols.meta</span>
<span id="cb79-10"><a href="normalisation-caron-set.html#cb79-10"></a><span class="kw">rowData</span>(sce) &lt;-<span class="st"> </span>rows.meta[tmpInd, ]</span>
<span id="cb79-11"><a href="normalisation-caron-set.html#cb79-11"></a></span>
<span id="cb79-12"><a href="normalisation-caron-set.html#cb79-12"></a><span class="cf">if</span>(<span class="ot">FALSE</span>) <span class="co"># dev</span></span>
<span id="cb79-13"><a href="normalisation-caron-set.html#cb79-13"></a>{</span>
<span id="cb79-14"><a href="normalisation-caron-set.html#cb79-14"></a><span class="co"># logcounts_raw</span></span>
<span id="cb79-15"><a href="normalisation-caron-set.html#cb79-15"></a>assayX &lt;-<span class="st"> &quot;logcounts_raw&quot;</span></span>
<span id="cb79-16"><a href="normalisation-caron-set.html#cb79-16"></a>tmpAssay &lt;-<span class="st"> </span><span class="kw">assay</span>(sceOrig, assayX)</span>
<span id="cb79-17"><a href="normalisation-caron-set.html#cb79-17"></a><span class="kw">assay</span>(sce, assayX) &lt;-<span class="st"> </span>tmpAssay[tmpInd, ]</span>
<span id="cb79-18"><a href="normalisation-caron-set.html#cb79-18"></a></span>
<span id="cb79-19"><a href="normalisation-caron-set.html#cb79-19"></a><span class="co"># logCpm</span></span>
<span id="cb79-20"><a href="normalisation-caron-set.html#cb79-20"></a><span class="co"># logcounts</span></span>
<span id="cb79-21"><a href="normalisation-caron-set.html#cb79-21"></a><span class="cf">for</span> (assayX <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&quot;logCpm&quot;</span>, <span class="st">&quot;logcounts&quot;</span>))</span>
<span id="cb79-22"><a href="normalisation-caron-set.html#cb79-22"></a>{</span>
<span id="cb79-23"><a href="normalisation-caron-set.html#cb79-23"></a>    tmpAssay &lt;-<span class="st"> </span><span class="kw">assay</span>(sceOrig, assayX)</span>
<span id="cb79-24"><a href="normalisation-caron-set.html#cb79-24"></a>    <span class="kw">assay</span>(sce, assayX) &lt;-<span class="st"> </span>tmpAssay[tmpInd, ]</span>
<span id="cb79-25"><a href="normalisation-caron-set.html#cb79-25"></a>}</span>
<span id="cb79-26"><a href="normalisation-caron-set.html#cb79-26"></a><span class="kw">rm</span>(assayX, tmpAssay)</span>
<span id="cb79-27"><a href="normalisation-caron-set.html#cb79-27"></a>}</span>
<span id="cb79-28"><a href="normalisation-caron-set.html#cb79-28"></a></span>
<span id="cb79-29"><a href="normalisation-caron-set.html#cb79-29"></a><span class="kw">assayNames</span>(sce)</span></code></pre></div>
<pre><code>## [1] &quot;counts&quot;</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="normalisation-caron-set.html#cb81-1"></a>sce</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 16353 5500 
## metadata(0):
## assays(1): counts
## rownames(16353): ENSG00000237491 ENSG00000225880 ... ENSG00000275063
##   ENSG00000271254
## rowData names(11): ensembl_gene_id external_gene_name ... detected
##   gene_sparsity
## colnames: NULL
## colData names(16): Barcode Run ... cell_sparsity sizeFactor
## reducedDimNames(0):
## altExpNames(0):</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="normalisation-caron-set.html#cb83-1"></a>vstMat &lt;-<span class="st"> </span><span class="kw">as</span>(vst_out<span class="op">$</span>y[<span class="kw">rownames</span>(sce),], <span class="st">&quot;dgCMatrix&quot;</span>)</span>
<span id="cb83-2"><a href="normalisation-caron-set.html#cb83-2"></a><span class="kw">all</span>(<span class="kw">colnames</span>(vstMat) <span class="op">==</span><span class="st"> </span>sce<span class="op">$</span>Barcode)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="normalisation-caron-set.html#cb85-1"></a><span class="kw">colnames</span>(vstMat) &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb85-2"><a href="normalisation-caron-set.html#cb85-2"></a><span class="kw">assay</span>(sce, <span class="st">&quot;sctrans_norm&quot;</span>) &lt;-<span class="st"> </span>vstMat <span class="co"># as(vst_out$y[rownames(sce),], &quot;dgCMatrix&quot;)</span></span>
<span id="cb85-3"><a href="normalisation-caron-set.html#cb85-3"></a><span class="kw">assayNames</span>(sce)</span></code></pre></div>
<pre><code>## [1] &quot;counts&quot;       &quot;sctrans_norm&quot;</code></pre>
</div>
<div id="save-object-3" class="section level3">
<h3><span class="header-section-number">7.2.3</span> Save object</h3>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="normalisation-caron-set.html#cb87-1"></a><span class="co"># write to file</span></span>
<span id="cb87-2"><a href="normalisation-caron-set.html#cb87-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/%s_sce_nz_postSct%s.Rds&quot;</span>,</span>
<span id="cb87-3"><a href="normalisation-caron-set.html#cb87-3"></a>         projDir, outDirBit, setName, setSuf)</span>
<span id="cb87-4"><a href="normalisation-caron-set.html#cb87-4"></a><span class="kw">saveRDS</span>(sce, tmpFn)</span></code></pre></div>
</div>
</div>
<div id="visualisation" class="section level2">
<h2><span class="header-section-number">7.3</span> Visualisation</h2>
<div id="log-raw-counts" class="section level3">
<h3><span class="header-section-number">7.3.1</span> log raw counts</h3>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="normalisation-caron-set.html#cb88-1"></a>typeNorm &lt;-<span class="st"> &quot;logRaw&quot;</span></span>
<span id="cb88-2"><a href="normalisation-caron-set.html#cb88-2"></a></span>
<span id="cb88-3"><a href="normalisation-caron-set.html#cb88-3"></a><span class="co">#setSuf &lt;- &quot;_5kCellPerSpl&quot;</span></span>
<span id="cb88-4"><a href="normalisation-caron-set.html#cb88-4"></a><span class="kw">options</span>(<span class="dt">BiocSingularParam.default=</span><span class="kw">IrlbaParam</span>())</span>
<span id="cb88-5"><a href="normalisation-caron-set.html#cb88-5"></a></span>
<span id="cb88-6"><a href="normalisation-caron-set.html#cb88-6"></a><span class="kw">assay</span>(sce, <span class="st">&quot;logcounts_raw&quot;</span>) &lt;-<span class="st"> </span><span class="kw">log2</span>(<span class="kw">counts</span>(sce) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb88-7"><a href="normalisation-caron-set.html#cb88-7"></a></span>
<span id="cb88-8"><a href="normalisation-caron-set.html#cb88-8"></a>tmp &lt;-<span class="st"> </span><span class="kw">runPCA</span>(</span>
<span id="cb88-9"><a href="normalisation-caron-set.html#cb88-9"></a>  sce[,],</span>
<span id="cb88-10"><a href="normalisation-caron-set.html#cb88-10"></a>  <span class="dt">exprs_values =</span> <span class="st">&quot;logcounts_raw&quot;</span></span>
<span id="cb88-11"><a href="normalisation-caron-set.html#cb88-11"></a>)</span></code></pre></div>
<p>PCA plot for the ‘logRaw’ counts in the caron set.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="normalisation-caron-set.html#cb89-1"></a>p &lt;-<span class="st"> </span><span class="kw">plotPCA</span>(</span>
<span id="cb89-2"><a href="normalisation-caron-set.html#cb89-2"></a>    tmp,</span>
<span id="cb89-3"><a href="normalisation-caron-set.html#cb89-3"></a>    <span class="dt">colour_by =</span> <span class="st">&quot;Sample.Name&quot;</span>,</span>
<span id="cb89-4"><a href="normalisation-caron-set.html#cb89-4"></a>    <span class="dt">size_by =</span> <span class="st">&quot;sum&quot;</span>,</span>
<span id="cb89-5"><a href="normalisation-caron-set.html#cb89-5"></a>    <span class="dt">shape_by =</span> <span class="st">&quot;source_name&quot;</span></span>
<span id="cb89-6"><a href="normalisation-caron-set.html#cb89-6"></a>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="kw">sprintf</span>(<span class="st">&quot;PCA plot: %s&quot;</span>, typeNorm))</span>
<span id="cb89-7"><a href="normalisation-caron-set.html#cb89-7"></a></span>
<span id="cb89-8"><a href="normalisation-caron-set.html#cb89-8"></a><span class="co"># write plot to file:</span></span>
<span id="cb89-9"><a href="normalisation-caron-set.html#cb89-9"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s/%s_sce_nz_postQc%s_%sPca.png&quot;</span>,</span>
<span id="cb89-10"><a href="normalisation-caron-set.html#cb89-10"></a>         projDir, outDirBit, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb89-11"><a href="normalisation-caron-set.html#cb89-11"></a><span class="kw">ggsave</span>(<span class="dt">filename=</span>tmpFn, <span class="dt">plot=</span>p)</span></code></pre></div>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="normalisation-caron-set.html#cb90-1"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s_sce_nz_postQc%s_%sPca.png&quot;</span>,</span>
<span id="cb90-2"><a href="normalisation-caron-set.html#cb90-2"></a>         dirRel, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb90-3"><a href="normalisation-caron-set.html#cb90-3"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(tmpFn, <span class="dt">auto_pdf =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="../Plots/Norm/caron_sce_nz_postQc_5hCellPerSpl_logRawPca.png" width="1050" /></p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="normalisation-caron-set.html#cb91-1"></a><span class="kw">rm</span>(tmpFn)</span></code></pre></div>
<p>Cell-wise RLE for the ‘logRaw’ counts in the caron set. Each cell is represented by a box plot showing the inter-quartile range in grey, wiskers colour-coded by Sample.Name and the median as a black circle.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="normalisation-caron-set.html#cb92-1"></a>p &lt;-<span class="st"> </span><span class="kw">plotRLE</span>(</span>
<span id="cb92-2"><a href="normalisation-caron-set.html#cb92-2"></a>    <span class="co">#tmp[,1:10],</span></span>
<span id="cb92-3"><a href="normalisation-caron-set.html#cb92-3"></a>    tmp,</span>
<span id="cb92-4"><a href="normalisation-caron-set.html#cb92-4"></a>    <span class="dt">exprs_values =</span> <span class="st">&quot;logcounts_raw&quot;</span>,</span>
<span id="cb92-5"><a href="normalisation-caron-set.html#cb92-5"></a>    <span class="dt">colour_by =</span> <span class="st">&quot;Sample.Name&quot;</span></span>
<span id="cb92-6"><a href="normalisation-caron-set.html#cb92-6"></a>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="kw">sprintf</span>(<span class="st">&quot;RLE plot: %s&quot;</span>, typeNorm))</span>
<span id="cb92-7"><a href="normalisation-caron-set.html#cb92-7"></a></span>
<span id="cb92-8"><a href="normalisation-caron-set.html#cb92-8"></a><span class="co"># write plot to file:</span></span>
<span id="cb92-9"><a href="normalisation-caron-set.html#cb92-9"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s/%s_sce_nz_postQc%s_%sRle.png&quot;</span>,</span>
<span id="cb92-10"><a href="normalisation-caron-set.html#cb92-10"></a>         projDir, outDirBit, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb92-11"><a href="normalisation-caron-set.html#cb92-11"></a><span class="kw">ggsave</span>(<span class="dt">filename=</span>tmpFn, <span class="dt">plot=</span>p)</span></code></pre></div>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="normalisation-caron-set.html#cb93-1"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s_sce_nz_postQc%s_%sRle.png&quot;</span>,</span>
<span id="cb93-2"><a href="normalisation-caron-set.html#cb93-2"></a>         dirRel, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb93-3"><a href="normalisation-caron-set.html#cb93-3"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(tmpFn, <span class="dt">auto_pdf =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="../Plots/Norm/caron_sce_nz_postQc_5hCellPerSpl_logRawRle.png" width="1050" /></p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="normalisation-caron-set.html#cb94-1"></a><span class="kw">rm</span>(tmpFn)</span></code></pre></div>
</div>
<div id="log-cpm" class="section level3">
<h3><span class="header-section-number">7.3.2</span> log CPM</h3>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="normalisation-caron-set.html#cb95-1"></a>typeNorm &lt;-<span class="st"> &quot;logCpm&quot;</span></span>
<span id="cb95-2"><a href="normalisation-caron-set.html#cb95-2"></a></span>
<span id="cb95-3"><a href="normalisation-caron-set.html#cb95-3"></a><span class="kw">assay</span>(sce, <span class="st">&quot;logCpm&quot;</span>) &lt;-<span class="st"> </span><span class="kw">log2</span>(<span class="kw">calculateCPM</span>(sce, <span class="dt">size_factors =</span> <span class="ot">NULL</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb95-4"><a href="normalisation-caron-set.html#cb95-4"></a></span>
<span id="cb95-5"><a href="normalisation-caron-set.html#cb95-5"></a>logCpmPca &lt;-<span class="st"> </span><span class="kw">runPCA</span>(</span>
<span id="cb95-6"><a href="normalisation-caron-set.html#cb95-6"></a>  sce[,],</span>
<span id="cb95-7"><a href="normalisation-caron-set.html#cb95-7"></a>  <span class="dt">exprs_values =</span> <span class="st">&quot;logCpm&quot;</span></span>
<span id="cb95-8"><a href="normalisation-caron-set.html#cb95-8"></a>)</span></code></pre></div>
<p>PCA plot for the ‘logCpm’ counts in the caron set.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="normalisation-caron-set.html#cb96-1"></a>p &lt;-<span class="st"> </span><span class="kw">plotPCA</span>(</span>
<span id="cb96-2"><a href="normalisation-caron-set.html#cb96-2"></a>    logCpmPca,</span>
<span id="cb96-3"><a href="normalisation-caron-set.html#cb96-3"></a>    <span class="dt">colour_by =</span> <span class="st">&quot;Sample.Name&quot;</span>,</span>
<span id="cb96-4"><a href="normalisation-caron-set.html#cb96-4"></a>    <span class="dt">size_by =</span> <span class="st">&quot;sum&quot;</span>,</span>
<span id="cb96-5"><a href="normalisation-caron-set.html#cb96-5"></a>    <span class="dt">shape_by =</span> <span class="st">&quot;source_name&quot;</span></span>
<span id="cb96-6"><a href="normalisation-caron-set.html#cb96-6"></a>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="kw">sprintf</span>(<span class="st">&quot;PCA plot: %s&quot;</span>, typeNorm))</span>
<span id="cb96-7"><a href="normalisation-caron-set.html#cb96-7"></a></span>
<span id="cb96-8"><a href="normalisation-caron-set.html#cb96-8"></a><span class="co"># write plot to file:</span></span>
<span id="cb96-9"><a href="normalisation-caron-set.html#cb96-9"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s/%s_sce_nz_postQc%s_%sPca.png&quot;</span>,</span>
<span id="cb96-10"><a href="normalisation-caron-set.html#cb96-10"></a>         projDir, outDirBit, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb96-11"><a href="normalisation-caron-set.html#cb96-11"></a><span class="kw">ggsave</span>(<span class="dt">filename=</span>tmpFn, <span class="dt">plot=</span>p)</span></code></pre></div>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="normalisation-caron-set.html#cb97-1"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s_sce_nz_postQc%s_%sPca.png&quot;</span>,</span>
<span id="cb97-2"><a href="normalisation-caron-set.html#cb97-2"></a>         dirRel, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb97-3"><a href="normalisation-caron-set.html#cb97-3"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(tmpFn, <span class="dt">auto_pdf =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="../Plots/Norm/caron_sce_nz_postQc_5hCellPerSpl_logCpmPca.png" width="1050" /></p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="normalisation-caron-set.html#cb98-1"></a><span class="kw">rm</span>(tmpFn)</span></code></pre></div>
<p>Cell-wise RLE for the ‘logCpm’ counts in the caron set.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="normalisation-caron-set.html#cb99-1"></a>p &lt;-<span class="st"> </span><span class="kw">plotRLE</span>(</span>
<span id="cb99-2"><a href="normalisation-caron-set.html#cb99-2"></a>    sce,</span>
<span id="cb99-3"><a href="normalisation-caron-set.html#cb99-3"></a>    <span class="dt">exprs_values =</span> <span class="st">&quot;logCpm&quot;</span>,</span>
<span id="cb99-4"><a href="normalisation-caron-set.html#cb99-4"></a>    <span class="dt">colour_by =</span> <span class="st">&quot;Sample.Name&quot;</span></span>
<span id="cb99-5"><a href="normalisation-caron-set.html#cb99-5"></a>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="kw">sprintf</span>(<span class="st">&quot;RLE plot: %s&quot;</span>, typeNorm))</span>
<span id="cb99-6"><a href="normalisation-caron-set.html#cb99-6"></a></span>
<span id="cb99-7"><a href="normalisation-caron-set.html#cb99-7"></a><span class="co"># write plot to file:</span></span>
<span id="cb99-8"><a href="normalisation-caron-set.html#cb99-8"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s/%s_sce_nz_postQc%s_%sRle.png&quot;</span>,</span>
<span id="cb99-9"><a href="normalisation-caron-set.html#cb99-9"></a>         projDir, outDirBit, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb99-10"><a href="normalisation-caron-set.html#cb99-10"></a><span class="kw">ggsave</span>(<span class="dt">filename=</span>tmpFn, <span class="dt">plot=</span>p)</span></code></pre></div>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="normalisation-caron-set.html#cb100-1"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s_sce_nz_postQc%s_%sRle.png&quot;</span>,</span>
<span id="cb100-2"><a href="normalisation-caron-set.html#cb100-2"></a>         dirRel, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb100-3"><a href="normalisation-caron-set.html#cb100-3"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(tmpFn, <span class="dt">auto_pdf =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="../Plots/Norm/caron_sce_nz_postQc_5hCellPerSpl_logCpmRle.png" width="1050" /></p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="normalisation-caron-set.html#cb101-1"></a><span class="kw">rm</span>(tmpFn)</span></code></pre></div>
</div>
<div id="scran" class="section level3">
<h3><span class="header-section-number">7.3.3</span> scran</h3>
<p>Normalised counts are stored in ‘logcounts’ assay</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="normalisation-caron-set.html#cb102-1"></a>typeNorm &lt;-<span class="st"> &quot;scran&quot;</span></span>
<span id="cb102-2"><a href="normalisation-caron-set.html#cb102-2"></a></span>
<span id="cb102-3"><a href="normalisation-caron-set.html#cb102-3"></a><span class="co"># assay(sce, &quot;logcounts&quot;)</span></span>
<span id="cb102-4"><a href="normalisation-caron-set.html#cb102-4"></a></span>
<span id="cb102-5"><a href="normalisation-caron-set.html#cb102-5"></a>scranPca &lt;-<span class="st"> </span><span class="kw">runPCA</span>(</span>
<span id="cb102-6"><a href="normalisation-caron-set.html#cb102-6"></a>  sceDeconv[,],</span>
<span id="cb102-7"><a href="normalisation-caron-set.html#cb102-7"></a>  <span class="dt">exprs_values =</span> <span class="st">&quot;logcounts&quot;</span></span>
<span id="cb102-8"><a href="normalisation-caron-set.html#cb102-8"></a>)</span></code></pre></div>
<p>PCA plot for the ‘scran’ counts in the caron set.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="normalisation-caron-set.html#cb103-1"></a>p &lt;-<span class="st"> </span><span class="kw">plotPCA</span>(</span>
<span id="cb103-2"><a href="normalisation-caron-set.html#cb103-2"></a>    scranPca,</span>
<span id="cb103-3"><a href="normalisation-caron-set.html#cb103-3"></a>    <span class="dt">colour_by =</span> <span class="st">&quot;Sample.Name&quot;</span>,</span>
<span id="cb103-4"><a href="normalisation-caron-set.html#cb103-4"></a>    <span class="dt">size_by =</span> <span class="st">&quot;sum&quot;</span>,</span>
<span id="cb103-5"><a href="normalisation-caron-set.html#cb103-5"></a>    <span class="dt">shape_by =</span> <span class="st">&quot;source_name&quot;</span></span>
<span id="cb103-6"><a href="normalisation-caron-set.html#cb103-6"></a>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="kw">sprintf</span>(<span class="st">&quot;PCA plot: %s&quot;</span>, typeNorm))</span>
<span id="cb103-7"><a href="normalisation-caron-set.html#cb103-7"></a></span>
<span id="cb103-8"><a href="normalisation-caron-set.html#cb103-8"></a><span class="co"># write plot to file:</span></span>
<span id="cb103-9"><a href="normalisation-caron-set.html#cb103-9"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s/%s_sce_nz_postQc%s_%sPca.png&quot;</span>,</span>
<span id="cb103-10"><a href="normalisation-caron-set.html#cb103-10"></a>         projDir, outDirBit, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb103-11"><a href="normalisation-caron-set.html#cb103-11"></a><span class="kw">ggsave</span>(<span class="dt">filename=</span>tmpFn, <span class="dt">plot=</span>p)</span></code></pre></div>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="normalisation-caron-set.html#cb104-1"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s_sce_nz_postQc%s_%sPca.png&quot;</span>,</span>
<span id="cb104-2"><a href="normalisation-caron-set.html#cb104-2"></a>         dirRel, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb104-3"><a href="normalisation-caron-set.html#cb104-3"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(tmpFn, <span class="dt">auto_pdf =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="../Plots/Norm/caron_sce_nz_postQc_5hCellPerSpl_scranPca.png" width="1050" /></p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="normalisation-caron-set.html#cb105-1"></a><span class="kw">rm</span>(tmpFn)</span></code></pre></div>
<p>TSNE plot for the ‘scran’ counts in the caron set.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="normalisation-caron-set.html#cb106-1"></a>typeNorm &lt;-<span class="st"> &quot;scran&quot;</span></span>
<span id="cb106-2"><a href="normalisation-caron-set.html#cb106-2"></a></span>
<span id="cb106-3"><a href="normalisation-caron-set.html#cb106-3"></a><span class="kw">reducedDim</span>(sceDeconv, <span class="st">&quot;TSNE_scran&quot;</span>) &lt;-<span class="st"> </span><span class="kw">reducedDim</span>(</span>
<span id="cb106-4"><a href="normalisation-caron-set.html#cb106-4"></a>  <span class="kw">runTSNE</span>(sceDeconv, <span class="dt">exprs_values =</span> <span class="st">&quot;logcounts&quot;</span>),</span>
<span id="cb106-5"><a href="normalisation-caron-set.html#cb106-5"></a>  <span class="st">&quot;TSNE&quot;</span></span>
<span id="cb106-6"><a href="normalisation-caron-set.html#cb106-6"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="normalisation-caron-set.html#cb107-1"></a>p &lt;-<span class="st"> </span><span class="kw">plotReducedDim</span>(</span>
<span id="cb107-2"><a href="normalisation-caron-set.html#cb107-2"></a>  sceDeconv,</span>
<span id="cb107-3"><a href="normalisation-caron-set.html#cb107-3"></a>  <span class="dt">dimred =</span> <span class="st">&quot;TSNE_scran&quot;</span>,</span>
<span id="cb107-4"><a href="normalisation-caron-set.html#cb107-4"></a>  <span class="dt">colour_by =</span> <span class="st">&quot;Sample.Name&quot;</span>,</span>
<span id="cb107-5"><a href="normalisation-caron-set.html#cb107-5"></a>  <span class="dt">size_by =</span> <span class="st">&quot;sum&quot;</span>,</span>
<span id="cb107-6"><a href="normalisation-caron-set.html#cb107-6"></a>  <span class="dt">shape_by =</span> <span class="st">&quot;source_name&quot;</span></span>
<span id="cb107-7"><a href="normalisation-caron-set.html#cb107-7"></a>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="kw">sprintf</span>(<span class="st">&quot;TSNE plot: %s&quot;</span>, typeNorm))</span>
<span id="cb107-8"><a href="normalisation-caron-set.html#cb107-8"></a></span>
<span id="cb107-9"><a href="normalisation-caron-set.html#cb107-9"></a><span class="co"># write plot to file:</span></span>
<span id="cb107-10"><a href="normalisation-caron-set.html#cb107-10"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s/%s_sce_nz_postQc%s_%sTsne.png&quot;</span>,</span>
<span id="cb107-11"><a href="normalisation-caron-set.html#cb107-11"></a>         projDir, outDirBit, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb107-12"><a href="normalisation-caron-set.html#cb107-12"></a><span class="kw">ggsave</span>(<span class="dt">filename=</span>tmpFn, <span class="dt">plot=</span>p)</span></code></pre></div>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="normalisation-caron-set.html#cb108-1"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s_sce_nz_postQc%s_%sTsne.png&quot;</span>,</span>
<span id="cb108-2"><a href="normalisation-caron-set.html#cb108-2"></a>         dirRel, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb108-3"><a href="normalisation-caron-set.html#cb108-3"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(tmpFn, <span class="dt">auto_pdf =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="../Plots/Norm/caron_sce_nz_postQc_5hCellPerSpl_scranTsne.png" width="1050" /></p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="normalisation-caron-set.html#cb109-1"></a><span class="kw">rm</span>(tmpFn)</span></code></pre></div>
<p>UMAP plot for the ‘scran’ counts in the caron set.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="normalisation-caron-set.html#cb110-1"></a>typeNorm &lt;-<span class="st"> &quot;scran&quot;</span></span>
<span id="cb110-2"><a href="normalisation-caron-set.html#cb110-2"></a></span>
<span id="cb110-3"><a href="normalisation-caron-set.html#cb110-3"></a><span class="kw">reducedDim</span>(sceDeconv, <span class="st">&quot;UMAP_scran&quot;</span>) &lt;-<span class="st"> </span><span class="kw">reducedDim</span>(</span>
<span id="cb110-4"><a href="normalisation-caron-set.html#cb110-4"></a>  <span class="kw">runUMAP</span>(sceDeconv, <span class="dt">exprs_values =</span> <span class="st">&quot;logcounts&quot;</span>),</span>
<span id="cb110-5"><a href="normalisation-caron-set.html#cb110-5"></a>  <span class="st">&quot;UMAP&quot;</span></span>
<span id="cb110-6"><a href="normalisation-caron-set.html#cb110-6"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="normalisation-caron-set.html#cb111-1"></a>p &lt;-<span class="st"> </span><span class="kw">plotReducedDim</span>(</span>
<span id="cb111-2"><a href="normalisation-caron-set.html#cb111-2"></a>  sceDeconv,</span>
<span id="cb111-3"><a href="normalisation-caron-set.html#cb111-3"></a>  <span class="dt">dimred =</span> <span class="st">&quot;UMAP_scran&quot;</span>,</span>
<span id="cb111-4"><a href="normalisation-caron-set.html#cb111-4"></a>  <span class="dt">colour_by =</span> <span class="st">&quot;Sample.Name&quot;</span>,</span>
<span id="cb111-5"><a href="normalisation-caron-set.html#cb111-5"></a>  <span class="dt">size_by =</span> <span class="st">&quot;sum&quot;</span>,</span>
<span id="cb111-6"><a href="normalisation-caron-set.html#cb111-6"></a>  <span class="dt">shape_by =</span> <span class="st">&quot;source_name&quot;</span></span>
<span id="cb111-7"><a href="normalisation-caron-set.html#cb111-7"></a>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="kw">sprintf</span>(<span class="st">&quot;UMAP plot: %s&quot;</span>, typeNorm))</span>
<span id="cb111-8"><a href="normalisation-caron-set.html#cb111-8"></a></span>
<span id="cb111-9"><a href="normalisation-caron-set.html#cb111-9"></a><span class="co"># write plot to file:</span></span>
<span id="cb111-10"><a href="normalisation-caron-set.html#cb111-10"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s/%s_sce_nz_postQc%s_%sUmap.png&quot;</span>,</span>
<span id="cb111-11"><a href="normalisation-caron-set.html#cb111-11"></a>         projDir, outDirBit, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb111-12"><a href="normalisation-caron-set.html#cb111-12"></a><span class="kw">ggsave</span>(<span class="dt">filename=</span>tmpFn, <span class="dt">plot=</span>p)</span></code></pre></div>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="normalisation-caron-set.html#cb112-1"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s_sce_nz_postQc%s_%sUmap.png&quot;</span>,</span>
<span id="cb112-2"><a href="normalisation-caron-set.html#cb112-2"></a>         dirRel, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb112-3"><a href="normalisation-caron-set.html#cb112-3"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(tmpFn, <span class="dt">auto_pdf =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="../Plots/Norm/caron_sce_nz_postQc_5hCellPerSpl_scranUmap.png" width="1050" /></p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="normalisation-caron-set.html#cb113-1"></a><span class="kw">rm</span>(tmpFn)</span></code></pre></div>
<p>Cell-wise RLE for the ‘scran’ counts in the caron set.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="normalisation-caron-set.html#cb114-1"></a>p &lt;-<span class="st"> </span><span class="kw">plotRLE</span>(</span>
<span id="cb114-2"><a href="normalisation-caron-set.html#cb114-2"></a>    scranPca,</span>
<span id="cb114-3"><a href="normalisation-caron-set.html#cb114-3"></a>    <span class="dt">exprs_values =</span> <span class="st">&quot;logcounts&quot;</span>,</span>
<span id="cb114-4"><a href="normalisation-caron-set.html#cb114-4"></a>    <span class="dt">colour_by =</span> <span class="st">&quot;Sample.Name&quot;</span></span>
<span id="cb114-5"><a href="normalisation-caron-set.html#cb114-5"></a>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="kw">sprintf</span>(<span class="st">&quot;RLE plot: %s&quot;</span>, typeNorm))</span>
<span id="cb114-6"><a href="normalisation-caron-set.html#cb114-6"></a></span>
<span id="cb114-7"><a href="normalisation-caron-set.html#cb114-7"></a><span class="co"># write plot to file:</span></span>
<span id="cb114-8"><a href="normalisation-caron-set.html#cb114-8"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s/%s_sce_nz_postQc%s_%sRle.png&quot;</span>,</span>
<span id="cb114-9"><a href="normalisation-caron-set.html#cb114-9"></a>         projDir, outDirBit, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb114-10"><a href="normalisation-caron-set.html#cb114-10"></a><span class="kw">ggsave</span>(<span class="dt">filename=</span>tmpFn, <span class="dt">plot=</span>p)</span></code></pre></div>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="normalisation-caron-set.html#cb115-1"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s_sce_nz_postQc%s_%sRle.png&quot;</span>,</span>
<span id="cb115-2"><a href="normalisation-caron-set.html#cb115-2"></a>         dirRel, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb115-3"><a href="normalisation-caron-set.html#cb115-3"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(tmpFn, <span class="dt">auto_pdf =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="../Plots/Norm/caron_sce_nz_postQc_5hCellPerSpl_scranRle.png" width="1050" /></p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="normalisation-caron-set.html#cb116-1"></a><span class="kw">rm</span>(tmpFn)</span></code></pre></div>
</div>
<div id="sctransform-2" class="section level3">
<h3><span class="header-section-number">7.3.4</span> SCTransform</h3>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="normalisation-caron-set.html#cb117-1"></a>typeNorm &lt;-<span class="st"> &quot;sctrans&quot;</span></span>
<span id="cb117-2"><a href="normalisation-caron-set.html#cb117-2"></a></span>
<span id="cb117-3"><a href="normalisation-caron-set.html#cb117-3"></a><span class="kw">reducedDim</span>(sce, <span class="st">&quot;PCA_sctrans_norm&quot;</span>) &lt;-<span class="st"> </span><span class="kw">reducedDim</span>(</span>
<span id="cb117-4"><a href="normalisation-caron-set.html#cb117-4"></a>  <span class="kw">runPCA</span>(sce, <span class="dt">exprs_values =</span> <span class="st">&quot;sctrans_norm&quot;</span>),</span>
<span id="cb117-5"><a href="normalisation-caron-set.html#cb117-5"></a>  <span class="st">&quot;PCA&quot;</span></span>
<span id="cb117-6"><a href="normalisation-caron-set.html#cb117-6"></a>)</span></code></pre></div>
<p>PCA plot for the ‘sctrans’ counts in the caron set.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="normalisation-caron-set.html#cb118-1"></a>p &lt;-<span class="st"> </span><span class="kw">plotReducedDim</span>(</span>
<span id="cb118-2"><a href="normalisation-caron-set.html#cb118-2"></a>  sce,</span>
<span id="cb118-3"><a href="normalisation-caron-set.html#cb118-3"></a>  <span class="dt">dimred =</span> <span class="st">&quot;PCA_sctrans_norm&quot;</span>,</span>
<span id="cb118-4"><a href="normalisation-caron-set.html#cb118-4"></a>  <span class="dt">colour_by =</span> <span class="st">&quot;Sample.Name&quot;</span>,</span>
<span id="cb118-5"><a href="normalisation-caron-set.html#cb118-5"></a>  <span class="dt">size_by =</span> <span class="st">&quot;sum&quot;</span>,</span>
<span id="cb118-6"><a href="normalisation-caron-set.html#cb118-6"></a>  <span class="dt">shape_by =</span> <span class="st">&quot;source_name&quot;</span></span>
<span id="cb118-7"><a href="normalisation-caron-set.html#cb118-7"></a>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="kw">sprintf</span>(<span class="st">&quot;PCA plot: %s&quot;</span>, typeNorm))</span>
<span id="cb118-8"><a href="normalisation-caron-set.html#cb118-8"></a></span>
<span id="cb118-9"><a href="normalisation-caron-set.html#cb118-9"></a><span class="co"># write plot to file:</span></span>
<span id="cb118-10"><a href="normalisation-caron-set.html#cb118-10"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s/%s_sce_nz_postQc%s_%sPca.png&quot;</span>,</span>
<span id="cb118-11"><a href="normalisation-caron-set.html#cb118-11"></a>         projDir, outDirBit, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb118-12"><a href="normalisation-caron-set.html#cb118-12"></a><span class="kw">ggsave</span>(<span class="dt">filename=</span>tmpFn, <span class="dt">plot=</span>p)</span></code></pre></div>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="normalisation-caron-set.html#cb119-1"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s_sce_nz_postQc%s_%sPca.png&quot;</span>,</span>
<span id="cb119-2"><a href="normalisation-caron-set.html#cb119-2"></a>         dirRel, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb119-3"><a href="normalisation-caron-set.html#cb119-3"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(tmpFn, <span class="dt">auto_pdf =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="../Plots/Norm/caron_sce_nz_postQc_5hCellPerSpl_sctransPca.png" width="1050" /></p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="normalisation-caron-set.html#cb120-1"></a><span class="kw">rm</span>(tmpFn)</span></code></pre></div>
<p>TSNE plot for the ‘sctrans’ counts in the caron set.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="normalisation-caron-set.html#cb121-1"></a>typeNorm &lt;-<span class="st"> &quot;sctrans&quot;</span></span>
<span id="cb121-2"><a href="normalisation-caron-set.html#cb121-2"></a></span>
<span id="cb121-3"><a href="normalisation-caron-set.html#cb121-3"></a><span class="kw">reducedDim</span>(sce, <span class="st">&quot;TSNE_sctrans_norm&quot;</span>) &lt;-<span class="st"> </span><span class="kw">reducedDim</span>(</span>
<span id="cb121-4"><a href="normalisation-caron-set.html#cb121-4"></a>  <span class="kw">runTSNE</span>(sce, <span class="dt">exprs_values =</span> <span class="st">&quot;sctrans_norm&quot;</span>),</span>
<span id="cb121-5"><a href="normalisation-caron-set.html#cb121-5"></a>  <span class="st">&quot;TSNE&quot;</span></span>
<span id="cb121-6"><a href="normalisation-caron-set.html#cb121-6"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="normalisation-caron-set.html#cb122-1"></a>p &lt;-<span class="st"> </span><span class="kw">plotReducedDim</span>(</span>
<span id="cb122-2"><a href="normalisation-caron-set.html#cb122-2"></a>  sce,</span>
<span id="cb122-3"><a href="normalisation-caron-set.html#cb122-3"></a>  <span class="dt">dimred =</span> <span class="st">&quot;TSNE_sctrans_norm&quot;</span>,</span>
<span id="cb122-4"><a href="normalisation-caron-set.html#cb122-4"></a>  <span class="dt">colour_by =</span> <span class="st">&quot;Sample.Name&quot;</span>,</span>
<span id="cb122-5"><a href="normalisation-caron-set.html#cb122-5"></a>  <span class="dt">size_by =</span> <span class="st">&quot;sum&quot;</span>,</span>
<span id="cb122-6"><a href="normalisation-caron-set.html#cb122-6"></a>  <span class="dt">shape_by =</span> <span class="st">&quot;source_name&quot;</span></span>
<span id="cb122-7"><a href="normalisation-caron-set.html#cb122-7"></a>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="kw">sprintf</span>(<span class="st">&quot;TSNE plot: %s&quot;</span>, typeNorm))</span>
<span id="cb122-8"><a href="normalisation-caron-set.html#cb122-8"></a></span>
<span id="cb122-9"><a href="normalisation-caron-set.html#cb122-9"></a><span class="co"># write plot to file:</span></span>
<span id="cb122-10"><a href="normalisation-caron-set.html#cb122-10"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s/%s_sce_nz_postQc%s_%sTsne.png&quot;</span>,</span>
<span id="cb122-11"><a href="normalisation-caron-set.html#cb122-11"></a>         projDir, outDirBit, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb122-12"><a href="normalisation-caron-set.html#cb122-12"></a><span class="kw">ggsave</span>(<span class="dt">filename=</span>tmpFn, <span class="dt">plot=</span>p)</span></code></pre></div>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="normalisation-caron-set.html#cb123-1"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s_sce_nz_postQc%s_%sTsne.png&quot;</span>,</span>
<span id="cb123-2"><a href="normalisation-caron-set.html#cb123-2"></a>         dirRel, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb123-3"><a href="normalisation-caron-set.html#cb123-3"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(tmpFn, <span class="dt">auto_pdf =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="../Plots/Norm/caron_sce_nz_postQc_5hCellPerSpl_sctransTsne.png" width="1050" /></p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="normalisation-caron-set.html#cb124-1"></a><span class="kw">rm</span>(tmpFn)</span></code></pre></div>
<p>UMAP plot for the ‘sctrans’ counts in the caron set.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="normalisation-caron-set.html#cb125-1"></a>typeNorm &lt;-<span class="st"> &quot;sctrans&quot;</span></span>
<span id="cb125-2"><a href="normalisation-caron-set.html#cb125-2"></a></span>
<span id="cb125-3"><a href="normalisation-caron-set.html#cb125-3"></a><span class="kw">reducedDim</span>(sce, <span class="st">&quot;UMAP_sctrans_norm&quot;</span>) &lt;-<span class="st"> </span><span class="kw">reducedDim</span>(</span>
<span id="cb125-4"><a href="normalisation-caron-set.html#cb125-4"></a>  <span class="kw">runUMAP</span>(sce, <span class="dt">exprs_values =</span> <span class="st">&quot;sctrans_norm&quot;</span>),</span>
<span id="cb125-5"><a href="normalisation-caron-set.html#cb125-5"></a>  <span class="st">&quot;UMAP&quot;</span></span>
<span id="cb125-6"><a href="normalisation-caron-set.html#cb125-6"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="normalisation-caron-set.html#cb126-1"></a>p &lt;-<span class="st"> </span><span class="kw">plotReducedDim</span>(</span>
<span id="cb126-2"><a href="normalisation-caron-set.html#cb126-2"></a>  sce,</span>
<span id="cb126-3"><a href="normalisation-caron-set.html#cb126-3"></a>  <span class="dt">dimred =</span> <span class="st">&quot;UMAP_sctrans_norm&quot;</span>,</span>
<span id="cb126-4"><a href="normalisation-caron-set.html#cb126-4"></a>  <span class="dt">colour_by =</span> <span class="st">&quot;Sample.Name&quot;</span>,</span>
<span id="cb126-5"><a href="normalisation-caron-set.html#cb126-5"></a>  <span class="dt">size_by =</span> <span class="st">&quot;sum&quot;</span>,</span>
<span id="cb126-6"><a href="normalisation-caron-set.html#cb126-6"></a>  <span class="dt">shape_by =</span> <span class="st">&quot;source_name&quot;</span></span>
<span id="cb126-7"><a href="normalisation-caron-set.html#cb126-7"></a>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="kw">sprintf</span>(<span class="st">&quot;UMAP plot: %s&quot;</span>, typeNorm))</span>
<span id="cb126-8"><a href="normalisation-caron-set.html#cb126-8"></a></span>
<span id="cb126-9"><a href="normalisation-caron-set.html#cb126-9"></a><span class="co"># write plot to file:</span></span>
<span id="cb126-10"><a href="normalisation-caron-set.html#cb126-10"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s/%s_sce_nz_postQc%s_%sUmap.png&quot;</span>,</span>
<span id="cb126-11"><a href="normalisation-caron-set.html#cb126-11"></a>         projDir, outDirBit, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb126-12"><a href="normalisation-caron-set.html#cb126-12"></a><span class="kw">ggsave</span>(<span class="dt">filename=</span>tmpFn, <span class="dt">plot=</span>p)</span></code></pre></div>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="normalisation-caron-set.html#cb127-1"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s_sce_nz_postQc%s_%sUmap.png&quot;</span>,</span>
<span id="cb127-2"><a href="normalisation-caron-set.html#cb127-2"></a>         dirRel, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb127-3"><a href="normalisation-caron-set.html#cb127-3"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(tmpFn, <span class="dt">auto_pdf =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="../Plots/Norm/caron_sce_nz_postQc_5hCellPerSpl_sctransUmap.png" width="1050" /></p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="normalisation-caron-set.html#cb128-1"></a><span class="kw">rm</span>(tmpFn)</span></code></pre></div>
<p>Cell-wise RLE for the ‘sctrans’ counts in the caron set.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="normalisation-caron-set.html#cb129-1"></a>p &lt;-<span class="st"> </span><span class="kw">plotRLE</span>(</span>
<span id="cb129-2"><a href="normalisation-caron-set.html#cb129-2"></a>    sce,</span>
<span id="cb129-3"><a href="normalisation-caron-set.html#cb129-3"></a>    <span class="dt">exprs_values =</span> <span class="st">&quot;sctrans_norm&quot;</span>,</span>
<span id="cb129-4"><a href="normalisation-caron-set.html#cb129-4"></a>    <span class="dt">colour_by =</span> <span class="st">&quot;Sample.Name&quot;</span></span>
<span id="cb129-5"><a href="normalisation-caron-set.html#cb129-5"></a>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="kw">sprintf</span>(<span class="st">&quot;RLE plot: %s&quot;</span>, typeNorm))</span>
<span id="cb129-6"><a href="normalisation-caron-set.html#cb129-6"></a></span>
<span id="cb129-7"><a href="normalisation-caron-set.html#cb129-7"></a><span class="co"># write plot to file:</span></span>
<span id="cb129-8"><a href="normalisation-caron-set.html#cb129-8"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s/%s_sce_nz_postQc%s_%sRle.png&quot;</span>,</span>
<span id="cb129-9"><a href="normalisation-caron-set.html#cb129-9"></a>         projDir, outDirBit, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb129-10"><a href="normalisation-caron-set.html#cb129-10"></a><span class="kw">ggsave</span>(<span class="dt">filename=</span>tmpFn, <span class="dt">plot=</span>p)</span></code></pre></div>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="normalisation-caron-set.html#cb130-1"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s_sce_nz_postQc%s_%sRle.png&quot;</span>,</span>
<span id="cb130-2"><a href="normalisation-caron-set.html#cb130-2"></a>         dirRel, qcPlotDirBit, setName, setSuf, typeNorm)</span>
<span id="cb130-3"><a href="normalisation-caron-set.html#cb130-3"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(tmpFn, <span class="dt">auto_pdf =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="../Plots/Norm/caron_sce_nz_postQc_5hCellPerSpl_sctransRle.png" width="1050" /></p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="normalisation-caron-set.html#cb131-1"></a><span class="kw">rm</span>(tmpFn)</span></code></pre></div>
</div>
</div>
<div id="session-information-3" class="section level2">
<h2><span class="header-section-number">7.4</span> Session information</h2>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="normalisation-caron-set.html#cb132-1"></a><span class="kw">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.0.3 (2020-10-10)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: CentOS Linux 8 (Core)
## 
## Matrix products: default
## BLAS:   /opt/R/R-4.0.3/lib64/R/lib/libRblas.so
## LAPACK: /opt/R/R-4.0.3/lib64/R/lib/libRlapack.so
## 
## locale:
##  [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8    
##  [5] LC_MONETARY=en_GB.UTF-8    LC_MESSAGES=en_GB.UTF-8   
##  [7] LC_PAPER=en_GB.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] parallel  stats4    stats     graphics  grDevices utils     datasets 
## [8] methods   base     
## 
## other attached packages:
##  [1] BiocSingular_1.6.0          dplyr_1.0.5                
##  [3] scran_1.18.7                scater_1.18.6              
##  [5] ggplot2_3.3.3               SingleCellExperiment_1.12.0
##  [7] SummarizedExperiment_1.20.0 Biobase_2.50.0             
##  [9] GenomicRanges_1.42.0        GenomeInfoDb_1.26.7        
## [11] IRanges_2.24.1              S4Vectors_0.28.1           
## [13] BiocGenerics_0.36.1         MatrixGenerics_1.2.1       
## [15] matrixStats_0.58.0          knitr_1.32                 
## 
## loaded via a namespace (and not attached):
##  [1] bitops_1.0-6              RcppAnnoy_0.0.18         
##  [3] sctransform_0.3.2.9005    tools_4.0.3              
##  [5] bslib_0.2.4               DT_0.18                  
##  [7] utf8_1.2.1                R6_2.5.0                 
##  [9] irlba_2.3.3               vipor_0.4.5              
## [11] uwot_0.1.10               DBI_1.1.1                
## [13] colorspace_2.0-0          withr_2.4.2              
## [15] tidyselect_1.1.0          gridExtra_2.3            
## [17] compiler_4.0.3            BiocNeighbors_1.8.2      
## [19] isoband_0.2.4             DelayedArray_0.16.3      
## [21] labeling_0.4.2            bookdown_0.21            
## [23] sass_0.3.1                scales_1.1.1             
## [25] stringr_1.4.0             digest_0.6.27            
## [27] rmarkdown_2.7             XVector_0.30.0           
## [29] pkgconfig_2.0.3           htmltools_0.5.1.1        
## [31] parallelly_1.24.0         sparseMatrixStats_1.2.1  
## [33] limma_3.46.0              highr_0.8                
## [35] htmlwidgets_1.5.3         rlang_0.4.10             
## [37] rstudioapi_0.13           DelayedMatrixStats_1.12.3
## [39] jquerylib_0.1.3           generics_0.1.0           
## [41] farver_2.1.0              jsonlite_1.7.2           
## [43] crosstalk_1.1.1           BiocParallel_1.24.1      
## [45] RCurl_1.98-1.3            magrittr_2.0.1           
## [47] GenomeInfoDbData_1.2.4    scuttle_1.0.4            
## [49] Matrix_1.2-18             Rcpp_1.0.6               
## [51] ggbeeswarm_0.6.0          munsell_0.5.0            
## [53] fansi_0.4.2               viridis_0.5.1            
## [55] lifecycle_1.0.0           stringi_1.5.3            
## [57] yaml_2.2.1                edgeR_3.32.1             
## [59] MASS_7.3-53               zlibbioc_1.36.0          
## [61] Rtsne_0.15                plyr_1.8.6               
## [63] grid_4.0.3                listenv_0.8.0            
## [65] dqrng_0.2.1               crayon_1.4.1             
## [67] lattice_0.20-41           cowplot_1.1.1            
## [69] beachmat_2.6.4            locfit_1.5-9.4           
## [71] pillar_1.6.0              igraph_1.2.6             
## [73] future.apply_1.7.0        reshape2_1.4.4           
## [75] codetools_0.2-16          glue_1.4.2               
## [77] evaluate_0.14             png_0.1-7                
## [79] vctrs_0.3.7               gtable_0.3.0             
## [81] purrr_0.3.4               future_1.21.0            
## [83] assertthat_0.2.1          xfun_0.22                
## [85] rsvd_1.0.3                RSpectra_0.16-0          
## [87] viridisLite_0.3.0         tibble_3.1.1             
## [89] beeswarm_0.2.3            globals_0.14.0           
## [91] bluster_1.0.0             statmod_1.4.35           
## [93] ellipsis_0.3.1</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="NormalisationAllCells.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="normalisation-gsm3872434-set.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/normalisation_5hcps.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["MkWoC.pdf", "MkWoC.epub"],
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"code_folding": "hide"
});
});
</script>

</body>

</html>
