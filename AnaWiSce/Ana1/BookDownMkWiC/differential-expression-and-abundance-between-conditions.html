<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 23 Differential expression and abundance between conditions | CRUK Bioinformatics Summer School 2020 - single-cell RNA-seq analysis</title>
  <meta name="description" content="A report for all analyses (bookdown::gitbook)." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 23 Differential expression and abundance between conditions | CRUK Bioinformatics Summer School 2020 - single-cell RNA-seq analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A report for all analyses (bookdown::gitbook)." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 23 Differential expression and abundance between conditions | CRUK Bioinformatics Summer School 2020 - single-cell RNA-seq analysis" />
  
  <meta name="twitter:description" content="A report for all analyses (bookdown::gitbook)." />
  

<meta name="author" content="Stephane Ballereau, Zeynep Kalender Atak" />


<meta name="date" content="2021-04-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="cellCyclePhasesTop.html"/>

<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.18/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
.row { display: flex; }
.collapse { display: none; }
.in { display:block }
.pull-right > .dropdown-menu {
    right: 0;
    left: auto;
}
.open > .dropdown-menu {
    display: block;
}
.dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 1000;
    display: none;
    float: left;
    min-width: 160px;
    padding: 5px 0;
    margin: 2px 0 0;
    font-size: 14px;
    text-align: left;
    list-style: none;
    background-color: #fff;
    -webkit-background-clip: padding-box;
    background-clip: padding-box;
    border: 1px solid #ccc;
    border: 1px solid rgba(0,0,0,.15);
    border-radius: 4px;
    -webkit-box-shadow: 0 6px 12px rgba(0,0,0,.175);
    box-shadow: 0 6px 12px rgba(0,0,0,.175);
}
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>


<script>
document.write('<div class="btn-group pull-right" style="position: absolute; top: 20%; right: 2%; z-index: 200"><button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-_extension-text-contrast=""><span>Code</span> <span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All Code</a></li><li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li></ul></div>')
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">CRUK Functional Genomics Summer School 2020</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preamble</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-study"><i class="fa fa-check"></i><b>1.1</b> The study</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#the-plan"><i class="fa fa-check"></i><b>1.2</b> The plan</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#the-analyses"><i class="fa fa-check"></i><b>1.3</b> The analyses</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#overall-summary"><i class="fa fa-check"></i><b>1.4</b> Overall summary</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#conclusion"><i class="fa fa-check"></i><b>1.5</b> Conclusion</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#abbreviations"><i class="fa fa-check"></i><b>1.6</b> Abbreviations</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="SeqQualTop.html"><a href="SeqQualTop.html"><i class="fa fa-check"></i><b>2</b> Sequence Quality</a><ul>
<li class="chapter" data-level="2.1" data-path="SeqQualTop.html"><a href="SeqQualTop.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="SeqQualTop.html"><a href="SeqQualTop.html#caronbourque2020---fastqc"><i class="fa fa-check"></i><b>2.2</b> CaronBourque2020 - fastqc</a></li>
<li class="chapter" data-level="2.3" data-path="SeqQualTop.html"><a href="SeqQualTop.html#caronbourque2020---multiqc"><i class="fa fa-check"></i><b>2.3</b> CaronBourque2020 - MultiQC</a><ul>
<li class="chapter" data-level="2.3.1" data-path="SeqQualTop.html"><a href="SeqQualTop.html#sample-index-i1"><i class="fa fa-check"></i><b>2.3.1</b> sample index: I1</a></li>
<li class="chapter" data-level="2.3.2" data-path="SeqQualTop.html"><a href="SeqQualTop.html#cell-barcode-umi-r1"><i class="fa fa-check"></i><b>2.3.2</b> cell barcode + UMI: R1</a></li>
<li class="chapter" data-level="2.3.3" data-path="SeqQualTop.html"><a href="SeqQualTop.html#insert-r2"><i class="fa fa-check"></i><b>2.3.3</b> insert: R2</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="SeqQualTop.html"><a href="SeqQualTop.html#hca-adult-bmmc---fastqc"><i class="fa fa-check"></i><b>2.4</b> HCA adult BMMC - fastqc</a></li>
<li class="chapter" data-level="2.5" data-path="SeqQualTop.html"><a href="SeqQualTop.html#hca-adult-bmmc---multiqc"><i class="fa fa-check"></i><b>2.5</b> HCA adult BMMC - MultiQC</a><ul>
<li class="chapter" data-level="2.5.1" data-path="SeqQualTop.html"><a href="SeqQualTop.html#sample-index-i1-1"><i class="fa fa-check"></i><b>2.5.1</b> sample index: I1</a></li>
<li class="chapter" data-level="2.5.2" data-path="SeqQualTop.html"><a href="SeqQualTop.html#cell-barcode-umi-r1-1"><i class="fa fa-check"></i><b>2.5.2</b> cell barcode + UMI: R1</a></li>
<li class="chapter" data-level="2.5.3" data-path="SeqQualTop.html"><a href="SeqQualTop.html#insert-r2-1"><i class="fa fa-check"></i><b>2.5.3</b> insert: R2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="AliFeatCountTop.html"><a href="AliFeatCountTop.html"><i class="fa fa-check"></i><b>3</b> Alignment and feature counting</a><ul>
<li class="chapter" data-level="3.1" data-path="AliFeatCountTop.html"><a href="AliFeatCountTop.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="AliFeatCountTop.html"><a href="AliFeatCountTop.html#x-cellranger-pipeline-in-brief"><i class="fa fa-check"></i><b>3.2</b> 10X cellranger pipeline in brief</a></li>
<li class="chapter" data-level="3.3" data-path="AliFeatCountTop.html"><a href="AliFeatCountTop.html#sample-sheet"><i class="fa fa-check"></i><b>3.3</b> sample sheet</a></li>
<li class="chapter" data-level="3.4" data-path="AliFeatCountTop.html"><a href="AliFeatCountTop.html#x-cellranger-reports-for-caronbourque2020"><i class="fa fa-check"></i><b>3.4</b> 10X cellranger reports for CaronBourque2020</a></li>
<li class="chapter" data-level="3.5" data-path="AliFeatCountTop.html"><a href="AliFeatCountTop.html#x-cellranger-reports-for-hcas-adult-bmmcs"><i class="fa fa-check"></i><b>3.5</b> 10X cellranger reports for HCA’s adult BMMCs</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html"><i class="fa fa-check"></i><b>4</b> Quality Control</a><ul>
<li class="chapter" data-level="4.1" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#load-packages"><i class="fa fa-check"></i><b>4.2</b> Load packages</a></li>
<li class="chapter" data-level="4.3" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#sample-sheet-1"><i class="fa fa-check"></i><b>4.3</b> Sample sheet</a></li>
<li class="chapter" data-level="4.4" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#data-representation"><i class="fa fa-check"></i><b>4.4</b> Data representation</a></li>
<li class="chapter" data-level="4.5" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#example"><i class="fa fa-check"></i><b>4.5</b> Example</a></li>
<li class="chapter" data-level="4.6" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#mapping-qc"><i class="fa fa-check"></i><b>4.6</b> Mapping QC</a><ul>
<li class="chapter" data-level="4.6.1" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#gene-body-coverage"><i class="fa fa-check"></i><b>4.6.1</b> Gene body coverage</a></li>
<li class="chapter" data-level="4.6.2" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#amplification-rate"><i class="fa fa-check"></i><b>4.6.2</b> Amplification rate</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#cell-calling-for-droplet-data"><i class="fa fa-check"></i><b>4.7</b> Cell calling for droplet data</a><ul>
<li class="chapter" data-level="4.7.1" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#mixture-model"><i class="fa fa-check"></i><b>4.7.1</b> Mixture model</a></li>
<li class="chapter" data-level="4.7.2" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#barcode-rank-plot"><i class="fa fa-check"></i><b>4.7.2</b> Barcode rank plot</a></li>
<li class="chapter" data-level="4.7.3" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#inflection-point"><i class="fa fa-check"></i><b>4.7.3</b> Inflection point</a></li>
<li class="chapter" data-level="4.7.4" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#cellranger-v1-and-v2"><i class="fa fa-check"></i><b>4.7.4</b> Cellranger v1 and v2</a></li>
<li class="chapter" data-level="4.7.5" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#dropletutils-and-emptydrops"><i class="fa fa-check"></i><b>4.7.5</b> DropletUtils and EmptyDrops</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#load-filtered-matrices"><i class="fa fa-check"></i><b>4.8</b> Load filtered matrices</a></li>
<li class="chapter" data-level="4.9" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#properties-of-scrna-seq-data"><i class="fa fa-check"></i><b>4.9</b> Properties of scRNA-seq data</a></li>
<li class="chapter" data-level="4.10" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#quality-control"><i class="fa fa-check"></i><b>4.10</b> Quality control</a><ul>
<li class="chapter" data-level="4.10.1" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#qc-metric-distribution"><i class="fa fa-check"></i><b>4.10.1</b> QC metric distribution</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#identification-of-low-quality-cells-with-adaptive-thresholds"><i class="fa fa-check"></i><b>4.11</b> Identification of low-quality cells with adaptive thresholds</a><ul>
<li class="chapter" data-level="4.11.1" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#library-size"><i class="fa fa-check"></i><b>4.11.1</b> Library size</a></li>
<li class="chapter" data-level="4.11.2" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#number-of-genes"><i class="fa fa-check"></i><b>4.11.2</b> Number of genes</a></li>
<li class="chapter" data-level="4.11.3" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#mitochondrial-content"><i class="fa fa-check"></i><b>4.11.3</b> Mitochondrial content</a></li>
<li class="chapter" data-level="4.11.4" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#summary"><i class="fa fa-check"></i><b>4.11.4</b> Summary</a></li>
<li class="chapter" data-level="4.11.5" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#all-steps-at-once"><i class="fa fa-check"></i><b>4.11.5</b> All steps at once</a></li>
<li class="chapter" data-level="4.11.6" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#assumptions"><i class="fa fa-check"></i><b>4.11.6</b> Assumptions</a></li>
</ul></li>
<li class="chapter" data-level="4.12" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#experimental-factors"><i class="fa fa-check"></i><b>4.12</b> Experimental factors</a><ul>
<li class="chapter" data-level="4.12.1" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#identify-poor-quality-batches"><i class="fa fa-check"></i><b>4.12.1</b> Identify poor-quality batches</a><ul>
<li class="chapter" data-level="4.12.1.1" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#number-of-genes-detected"><i class="fa fa-check"></i><b>4.12.1.1</b> Number of genes detected</a><ul>
<li class="chapter" data-level="4.12.1.1.1" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#mitochondrial-content-1"><i class="fa fa-check"></i><b>4.12.1.1.1</b> Mitochondrial content</a></li>
</ul></li>
<li class="chapter" data-level="4.12.1.2" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#samples-to-check"><i class="fa fa-check"></i><b>4.12.1.2</b> Samples to check</a></li>
</ul></li>
<li class="chapter" data-level="4.12.2" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#qc-metrics-space"><i class="fa fa-check"></i><b>4.12.2</b> QC metrics space</a></li>
<li class="chapter" data-level="4.12.3" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#qc-pca"><i class="fa fa-check"></i><b>4.12.3</b> QC PCA</a></li>
<li class="chapter" data-level="4.12.4" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#other-diagnostic-plots"><i class="fa fa-check"></i><b>4.12.4</b> Other diagnostic plots</a></li>
<li class="chapter" data-level="4.12.5" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#filter-low-quality-cells-out"><i class="fa fa-check"></i><b>4.12.5</b> Filter low-quality cells out</a></li>
</ul></li>
<li class="chapter" data-level="4.13" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#novelty"><i class="fa fa-check"></i><b>4.13</b> Novelty</a></li>
<li class="chapter" data-level="4.14" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#qc-based-on-sparsity"><i class="fa fa-check"></i><b>4.14</b> QC based on sparsity</a><ul>
<li class="chapter" data-level="4.14.1" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#remove-genes-that-are-not-expressed-at-all"><i class="fa fa-check"></i><b>4.14.1</b> Remove genes that are not expressed at all</a></li>
<li class="chapter" data-level="4.14.2" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#sparsity-plots"><i class="fa fa-check"></i><b>4.14.2</b> Sparsity plots</a></li>
<li class="chapter" data-level="4.14.3" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#filters"><i class="fa fa-check"></i><b>4.14.3</b> Filters</a></li>
<li class="chapter" data-level="4.14.4" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#separate-caron-and-hca-batches"><i class="fa fa-check"></i><b>4.14.4</b> Separate Caron and Hca batches</a></li>
<li class="chapter" data-level="4.14.5" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#caron-only"><i class="fa fa-check"></i><b>4.14.5</b> Caron only</a></li>
<li class="chapter" data-level="4.14.6" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#hca-only"><i class="fa fa-check"></i><b>4.14.6</b> Hca only</a></li>
</ul></li>
<li class="chapter" data-level="4.15" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#subsample-hca-set"><i class="fa fa-check"></i><b>4.15</b> Subsample Hca set</a></li>
<li class="chapter" data-level="4.16" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#session-information"><i class="fa fa-check"></i><b>4.16</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="PreProcTop.html"><a href="PreProcTop.html"><i class="fa fa-check"></i><b>5</b> Quality Control</a><ul>
<li class="chapter" data-level="5.1" data-path="PreProcTop.html"><a href="PreProcTop.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="PreProcTop.html"><a href="PreProcTop.html#load-packages-1"><i class="fa fa-check"></i><b>5.2</b> Load packages</a></li>
<li class="chapter" data-level="5.3" data-path="PreProcTop.html"><a href="PreProcTop.html#sample-sheet-2"><i class="fa fa-check"></i><b>5.3</b> Sample sheet</a></li>
<li class="chapter" data-level="5.4" data-path="PreProcTop.html"><a href="PreProcTop.html#data-representation-1"><i class="fa fa-check"></i><b>5.4</b> Data representation</a></li>
<li class="chapter" data-level="5.5" data-path="PreProcTop.html"><a href="PreProcTop.html#example-1"><i class="fa fa-check"></i><b>5.5</b> Example</a></li>
<li class="chapter" data-level="5.6" data-path="PreProcTop.html"><a href="PreProcTop.html#mapping-qc-1"><i class="fa fa-check"></i><b>5.6</b> Mapping QC</a><ul>
<li class="chapter" data-level="5.6.1" data-path="PreProcTop.html"><a href="PreProcTop.html#gene-body-coverage-1"><i class="fa fa-check"></i><b>5.6.1</b> Gene body coverage</a></li>
<li class="chapter" data-level="5.6.2" data-path="PreProcTop.html"><a href="PreProcTop.html#amplification-rate-1"><i class="fa fa-check"></i><b>5.6.2</b> Amplification rate</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="PreProcTop.html"><a href="PreProcTop.html#cell-calling-for-droplet-data-1"><i class="fa fa-check"></i><b>5.7</b> Cell calling for droplet data</a><ul>
<li class="chapter" data-level="5.7.1" data-path="PreProcTop.html"><a href="PreProcTop.html#mixture-model-1"><i class="fa fa-check"></i><b>5.7.1</b> Mixture model</a></li>
<li class="chapter" data-level="5.7.2" data-path="PreProcTop.html"><a href="PreProcTop.html#barcode-rank-plot-1"><i class="fa fa-check"></i><b>5.7.2</b> Barcode rank plot</a></li>
<li class="chapter" data-level="5.7.3" data-path="PreProcTop.html"><a href="PreProcTop.html#inflection-point-1"><i class="fa fa-check"></i><b>5.7.3</b> Inflection point</a></li>
<li class="chapter" data-level="5.7.4" data-path="PreProcTop.html"><a href="PreProcTop.html#cellranger-v1-and-v2-1"><i class="fa fa-check"></i><b>5.7.4</b> Cellranger v1 and v2</a></li>
<li class="chapter" data-level="5.7.5" data-path="PreProcTop.html"><a href="PreProcTop.html#dropletutils-and-emptydrops-1"><i class="fa fa-check"></i><b>5.7.5</b> DropletUtils and EmptyDrops</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="PreProcTop.html"><a href="PreProcTop.html#load-filtered-matrices-1"><i class="fa fa-check"></i><b>5.8</b> Load filtered matrices</a></li>
<li class="chapter" data-level="5.9" data-path="PreProcTop.html"><a href="PreProcTop.html#properties-of-scrna-seq-data-1"><i class="fa fa-check"></i><b>5.9</b> Properties of scRNA-seq data</a></li>
<li class="chapter" data-level="5.10" data-path="PreProcTop.html"><a href="PreProcTop.html#quality-control-1"><i class="fa fa-check"></i><b>5.10</b> Quality control</a><ul>
<li class="chapter" data-level="5.10.1" data-path="PreProcTop.html"><a href="PreProcTop.html#qc-metric-distribution-1"><i class="fa fa-check"></i><b>5.10.1</b> QC metric distribution</a></li>
</ul></li>
<li class="chapter" data-level="5.11" data-path="PreProcTop.html"><a href="PreProcTop.html#identification-of-low-quality-cells-with-adaptive-thresholds-1"><i class="fa fa-check"></i><b>5.11</b> Identification of low-quality cells with adaptive thresholds</a><ul>
<li class="chapter" data-level="5.11.1" data-path="PreProcTop.html"><a href="PreProcTop.html#library-size-1"><i class="fa fa-check"></i><b>5.11.1</b> Library size</a></li>
<li class="chapter" data-level="5.11.2" data-path="PreProcTop.html"><a href="PreProcTop.html#number-of-genes-1"><i class="fa fa-check"></i><b>5.11.2</b> Number of genes</a></li>
<li class="chapter" data-level="5.11.3" data-path="PreProcTop.html"><a href="PreProcTop.html#mitochondrial-content-2"><i class="fa fa-check"></i><b>5.11.3</b> Mitochondrial content</a></li>
<li class="chapter" data-level="5.11.4" data-path="PreProcTop.html"><a href="PreProcTop.html#summary-1"><i class="fa fa-check"></i><b>5.11.4</b> Summary</a></li>
<li class="chapter" data-level="5.11.5" data-path="PreProcTop.html"><a href="PreProcTop.html#all-steps-at-once-1"><i class="fa fa-check"></i><b>5.11.5</b> All steps at once</a></li>
<li class="chapter" data-level="5.11.6" data-path="PreProcTop.html"><a href="PreProcTop.html#assumptions-1"><i class="fa fa-check"></i><b>5.11.6</b> Assumptions</a></li>
</ul></li>
<li class="chapter" data-level="5.12" data-path="PreProcTop.html"><a href="PreProcTop.html#experimental-factors-1"><i class="fa fa-check"></i><b>5.12</b> Experimental factors</a><ul>
<li class="chapter" data-level="5.12.1" data-path="PreProcTop.html"><a href="PreProcTop.html#identify-poor-quality-batches-1"><i class="fa fa-check"></i><b>5.12.1</b> Identify poor-quality batches</a><ul>
<li class="chapter" data-level="5.12.1.1" data-path="PreProcTop.html"><a href="PreProcTop.html#number-of-genes-detected-1"><i class="fa fa-check"></i><b>5.12.1.1</b> Number of genes detected</a><ul>
<li class="chapter" data-level="5.12.1.1.1" data-path="PreProcTop.html"><a href="PreProcTop.html#mitochondrial-content-3"><i class="fa fa-check"></i><b>5.12.1.1.1</b> Mitochondrial content</a></li>
</ul></li>
<li class="chapter" data-level="5.12.1.2" data-path="PreProcTop.html"><a href="PreProcTop.html#samples-to-check-1"><i class="fa fa-check"></i><b>5.12.1.2</b> Samples to check</a></li>
</ul></li>
<li class="chapter" data-level="5.12.2" data-path="PreProcTop.html"><a href="PreProcTop.html#qc-metrics-space-1"><i class="fa fa-check"></i><b>5.12.2</b> QC metrics space</a></li>
<li class="chapter" data-level="5.12.3" data-path="PreProcTop.html"><a href="PreProcTop.html#qc-pca-1"><i class="fa fa-check"></i><b>5.12.3</b> QC PCA</a></li>
<li class="chapter" data-level="5.12.4" data-path="PreProcTop.html"><a href="PreProcTop.html#other-diagnostic-plots-1"><i class="fa fa-check"></i><b>5.12.4</b> Other diagnostic plots</a></li>
<li class="chapter" data-level="5.12.5" data-path="PreProcTop.html"><a href="PreProcTop.html#filter-low-quality-cells-out-1"><i class="fa fa-check"></i><b>5.12.5</b> Filter low-quality cells out</a></li>
</ul></li>
<li class="chapter" data-level="5.13" data-path="PreProcTop.html"><a href="PreProcTop.html#novelty-1"><i class="fa fa-check"></i><b>5.13</b> Novelty</a></li>
<li class="chapter" data-level="5.14" data-path="PreProcTop.html"><a href="PreProcTop.html#qc-based-on-sparsity-1"><i class="fa fa-check"></i><b>5.14</b> QC based on sparsity</a><ul>
<li class="chapter" data-level="5.14.1" data-path="PreProcTop.html"><a href="PreProcTop.html#remove-genes-that-are-not-expressed-at-all-1"><i class="fa fa-check"></i><b>5.14.1</b> Remove genes that are not expressed at all</a></li>
<li class="chapter" data-level="5.14.2" data-path="PreProcTop.html"><a href="PreProcTop.html#sparsity-plots-1"><i class="fa fa-check"></i><b>5.14.2</b> Sparsity plots</a></li>
<li class="chapter" data-level="5.14.3" data-path="PreProcTop.html"><a href="PreProcTop.html#filters-1"><i class="fa fa-check"></i><b>5.14.3</b> Filters</a></li>
<li class="chapter" data-level="5.14.4" data-path="PreProcTop.html"><a href="PreProcTop.html#separate-caron-and-hca-batches-1"><i class="fa fa-check"></i><b>5.14.4</b> Separate Caron and Hca batches</a></li>
<li class="chapter" data-level="5.14.5" data-path="PreProcTop.html"><a href="PreProcTop.html#caron-only-1"><i class="fa fa-check"></i><b>5.14.5</b> Caron only</a></li>
<li class="chapter" data-level="5.14.6" data-path="PreProcTop.html"><a href="PreProcTop.html#hca-only-1"><i class="fa fa-check"></i><b>5.14.6</b> Hca only</a></li>
</ul></li>
<li class="chapter" data-level="5.15" data-path="PreProcTop.html"><a href="PreProcTop.html#session-information-1"><i class="fa fa-check"></i><b>5.15</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html"><i class="fa fa-check"></i><b>6</b> Normalisation</a><ul>
<li class="chapter" data-level="6.1" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#caron"><i class="fa fa-check"></i><b>6.1</b> Caron</a><ul>
<li class="chapter" data-level="6.1.1" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#library-size-normalization"><i class="fa fa-check"></i><b>6.1.1</b> Library size normalization</a></li>
<li class="chapter" data-level="6.1.2" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#deconvolution"><i class="fa fa-check"></i><b>6.1.2</b> Deconvolution</a></li>
<li class="chapter" data-level="6.1.3" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#compute-size-factors"><i class="fa fa-check"></i><b>6.1.3</b> Compute size factors</a><ul>
<li class="chapter" data-level="6.1.3.1" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#apply-size-factors"><i class="fa fa-check"></i><b>6.1.3.1</b> Apply size factors</a></li>
<li class="chapter" data-level="6.1.3.2" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#save-object"><i class="fa fa-check"></i><b>6.1.3.2</b> Save object</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#hca"><i class="fa fa-check"></i><b>6.2</b> Hca</a><ul>
<li class="chapter" data-level="6.2.1" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#library-size-normalization-1"><i class="fa fa-check"></i><b>6.2.1</b> Library size normalization</a></li>
<li class="chapter" data-level="6.2.2" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#deconvolution-1"><i class="fa fa-check"></i><b>6.2.2</b> Deconvolution</a></li>
<li class="chapter" data-level="6.2.3" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#compute-size-factors-1"><i class="fa fa-check"></i><b>6.2.3</b> Compute size factors</a><ul>
<li class="chapter" data-level="6.2.3.1" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#apply-size-factors-1"><i class="fa fa-check"></i><b>6.2.3.1</b> Apply size factors</a></li>
<li class="chapter" data-level="6.2.3.2" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#save-object-1"><i class="fa fa-check"></i><b>6.2.3.2</b> Save object</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#sctransform"><i class="fa fa-check"></i><b>6.3</b> SCTransform</a><ul>
<li class="chapter" data-level="6.3.1" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#caron-1"><i class="fa fa-check"></i><b>6.3.1</b> Caron</a></li>
<li class="chapter" data-level="6.3.2" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#hca-1"><i class="fa fa-check"></i><b>6.3.2</b> Hca</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#session-information-2"><i class="fa fa-check"></i><b>6.4</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html"><i class="fa fa-check"></i><b>7</b> Normalisation - Caron set</a><ul>
<li class="chapter" data-level="7.1" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#scaling-normalization"><i class="fa fa-check"></i><b>7.1</b> Scaling normalization</a><ul>
<li class="chapter" data-level="7.1.1" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#cpm"><i class="fa fa-check"></i><b>7.1.1</b> CPM</a></li>
<li class="chapter" data-level="7.1.2" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#deseqs-size-factor"><i class="fa fa-check"></i><b>7.1.2</b> DESeq’s size factor</a></li>
<li class="chapter" data-level="7.1.3" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#weighted-trimmed-mean-of-m-values"><i class="fa fa-check"></i><b>7.1.3</b> Weighted Trimmed mean of M-values</a></li>
<li class="chapter" data-level="7.1.4" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#library-size-normalization-2"><i class="fa fa-check"></i><b>7.1.4</b> Library size normalization</a></li>
<li class="chapter" data-level="7.1.5" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#deconvolution-2"><i class="fa fa-check"></i><b>7.1.5</b> Deconvolution</a><ul>
<li class="chapter" data-level="7.1.5.1" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#cluster-cells"><i class="fa fa-check"></i><b>7.1.5.1</b> Cluster cells</a></li>
<li class="chapter" data-level="7.1.5.2" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#compute-size-factors-2"><i class="fa fa-check"></i><b>7.1.5.2</b> Compute size factors</a></li>
<li class="chapter" data-level="7.1.5.3" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#apply-size-factors-2"><i class="fa fa-check"></i><b>7.1.5.3</b> Apply size factors</a></li>
<li class="chapter" data-level="7.1.5.4" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#save-object-2"><i class="fa fa-check"></i><b>7.1.5.4</b> Save object</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#sctransform-1"><i class="fa fa-check"></i><b>7.2</b> SCTransform</a><ul>
<li class="chapter" data-level="7.2.1" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#inspect-data"><i class="fa fa-check"></i><b>7.2.1</b> Inspect data</a></li>
<li class="chapter" data-level="7.2.2" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#transformation"><i class="fa fa-check"></i><b>7.2.2</b> Transformation</a></li>
<li class="chapter" data-level="7.2.3" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#save-sce-object"><i class="fa fa-check"></i><b>7.2.3</b> Save SCE object</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#visualisation"><i class="fa fa-check"></i><b>7.3</b> Visualisation</a><ul>
<li class="chapter" data-level="7.3.1" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#log-raw-counts"><i class="fa fa-check"></i><b>7.3.1</b> log raw counts</a></li>
<li class="chapter" data-level="7.3.2" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#log-cpm"><i class="fa fa-check"></i><b>7.3.2</b> log CPM</a></li>
<li class="chapter" data-level="7.3.3" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#scran"><i class="fa fa-check"></i><b>7.3.3</b> scran</a></li>
<li class="chapter" data-level="7.3.4" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#sctransform-2"><i class="fa fa-check"></i><b>7.3.4</b> SCTransform</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#session-information-3"><i class="fa fa-check"></i><b>7.4</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html"><i class="fa fa-check"></i><b>8</b> Normalisation - GSM3872434 set</a><ul>
<li class="chapter" data-level="8.1" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#scaling-normalization-1"><i class="fa fa-check"></i><b>8.1</b> Scaling normalization</a><ul>
<li class="chapter" data-level="8.1.1" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#cpm-1"><i class="fa fa-check"></i><b>8.1.1</b> CPM</a></li>
<li class="chapter" data-level="8.1.2" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#deseqs-size-factor-1"><i class="fa fa-check"></i><b>8.1.2</b> DESeq’s size factor</a></li>
<li class="chapter" data-level="8.1.3" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#weighted-trimmed-mean-of-m-values-1"><i class="fa fa-check"></i><b>8.1.3</b> Weighted Trimmed mean of M-values</a></li>
<li class="chapter" data-level="8.1.4" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#library-size-factor-distribution"><i class="fa fa-check"></i><b>8.1.4</b> Library size factor distribution</a></li>
<li class="chapter" data-level="8.1.5" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#deconvolution-3"><i class="fa fa-check"></i><b>8.1.5</b> Deconvolution</a><ul>
<li class="chapter" data-level="8.1.5.1" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#cluster-cells-1"><i class="fa fa-check"></i><b>8.1.5.1</b> Cluster cells</a></li>
<li class="chapter" data-level="8.1.5.2" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#compute-size-factors-3"><i class="fa fa-check"></i><b>8.1.5.2</b> Compute size factors</a></li>
<li class="chapter" data-level="8.1.5.3" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#apply-size-factors-3"><i class="fa fa-check"></i><b>8.1.5.3</b> Apply size factors</a></li>
<li class="chapter" data-level="8.1.5.4" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#save-object-3"><i class="fa fa-check"></i><b>8.1.5.4</b> Save object</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#sctransform-3"><i class="fa fa-check"></i><b>8.2</b> SCTransform</a><ul>
<li class="chapter" data-level="8.2.1" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#inspect-data-1"><i class="fa fa-check"></i><b>8.2.1</b> Inspect data</a></li>
<li class="chapter" data-level="8.2.2" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#transformation-1"><i class="fa fa-check"></i><b>8.2.2</b> Transformation</a></li>
<li class="chapter" data-level="8.2.3" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#save-sce-object-1"><i class="fa fa-check"></i><b>8.2.3</b> Save SCE object</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#visualisation-1"><i class="fa fa-check"></i><b>8.3</b> Visualisation</a><ul>
<li class="chapter" data-level="8.3.1" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#log-raw-counts-1"><i class="fa fa-check"></i><b>8.3.1</b> log raw counts</a></li>
<li class="chapter" data-level="8.3.2" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#log-cpm-1"><i class="fa fa-check"></i><b>8.3.2</b> log CPM</a></li>
<li class="chapter" data-level="8.3.3" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#scran-1"><i class="fa fa-check"></i><b>8.3.3</b> scran</a></li>
<li class="chapter" data-level="8.3.4" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#sctransform-4"><i class="fa fa-check"></i><b>8.3.4</b> SCTransform</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#session-information-4"><i class="fa fa-check"></i><b>8.4</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html"><i class="fa fa-check"></i><b>9</b> Dimensionality reduction for visualisation</a><ul>
<li class="chapter" data-level="9.1" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#principal-component-analysis"><i class="fa fa-check"></i><b>9.1</b> Principal Component Analysis</a><ul>
<li class="chapter" data-level="9.1.1" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#description"><i class="fa fa-check"></i><b>9.1.1</b> Description</a></li>
<li class="chapter" data-level="9.1.2" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#example-2"><i class="fa fa-check"></i><b>9.1.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#load-packages-2"><i class="fa fa-check"></i><b>9.2</b> Load packages</a></li>
<li class="chapter" data-level="9.3" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#load-data"><i class="fa fa-check"></i><b>9.3</b> Load data</a></li>
<li class="chapter" data-level="9.4" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#pca"><i class="fa fa-check"></i><b>9.4</b> PCA</a><ul>
<li class="chapter" data-level="9.4.1" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#correlation-between-pcs-and-the-total-number-of-features-detected"><i class="fa fa-check"></i><b>9.4.1</b> Correlation between PCs and the total number of features detected</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#t-sne-t-distributed-stochastic-neighbor-embedding"><i class="fa fa-check"></i><b>9.5</b> t-SNE: t-Distributed Stochastic Neighbor Embedding</a><ul>
<li class="chapter" data-level="9.5.1" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#perplexity"><i class="fa fa-check"></i><b>9.5.1</b> Perplexity</a></li>
<li class="chapter" data-level="9.5.2" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#stochasticity"><i class="fa fa-check"></i><b>9.5.2</b> Stochasticity</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#umap"><i class="fa fa-check"></i><b>9.6</b> UMAP</a></li>
<li class="chapter" data-level="9.7" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#session-information-5"><i class="fa fa-check"></i><b>9.7</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="identifying-confounding-factors-caron-set.html"><a href="identifying-confounding-factors-caron-set.html"><i class="fa fa-check"></i><b>10</b> Identifying confounding factors - Caron set</a><ul>
<li class="chapter" data-level="10.1" data-path="identifying-confounding-factors-caron-set.html"><a href="identifying-confounding-factors-caron-set.html#load-object"><i class="fa fa-check"></i><b>10.1</b> Load object</a></li>
<li class="chapter" data-level="10.2" data-path="identifying-confounding-factors-caron-set.html"><a href="identifying-confounding-factors-caron-set.html#pca-1"><i class="fa fa-check"></i><b>10.2</b> PCA</a></li>
<li class="chapter" data-level="10.3" data-path="identifying-confounding-factors-caron-set.html"><a href="identifying-confounding-factors-caron-set.html#normalised-counts"><i class="fa fa-check"></i><b>10.3</b> Normalised counts</a></li>
<li class="chapter" data-level="10.4" data-path="identifying-confounding-factors-caron-set.html"><a href="identifying-confounding-factors-caron-set.html#session-information-6"><i class="fa fa-check"></i><b>10.4</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="featSelecTop.html"><a href="featSelecTop.html"><i class="fa fa-check"></i><b>11</b> Feature selection</a><ul>
<li class="chapter" data-level="11.1" data-path="featSelecTop.html"><a href="featSelecTop.html#load-data-1"><i class="fa fa-check"></i><b>11.1</b> Load data</a></li>
<li class="chapter" data-level="11.2" data-path="featSelecTop.html"><a href="featSelecTop.html#feature-selection-with-scran"><i class="fa fa-check"></i><b>11.2</b> Feature selection with scran</a><ul>
<li class="chapter" data-level="11.2.1" data-path="featSelecTop.html"><a href="featSelecTop.html#modelling-and-removing-technical-noise"><i class="fa fa-check"></i><b>11.2.1</b> Modelling and removing technical noise</a></li>
<li class="chapter" data-level="11.2.2" data-path="featSelecTop.html"><a href="featSelecTop.html#choosing-some-hvgs"><i class="fa fa-check"></i><b>11.2.2</b> Choosing some HVGs</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="featSelecTop.html"><a href="featSelecTop.html#session-information-7"><i class="fa fa-check"></i><b>11.3</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html"><i class="fa fa-check"></i><b>12</b> batch correction - GSM3872442 set</a><ul>
<li class="chapter" data-level="12.1" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#prepare-data"><i class="fa fa-check"></i><b>12.1</b> Prepare data</a></li>
<li class="chapter" data-level="12.2" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#normalise-each-separately-and-re-pool"><i class="fa fa-check"></i><b>12.2</b> Normalise each separately and re-pool</a></li>
<li class="chapter" data-level="12.3" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#normalise-batches-together"><i class="fa fa-check"></i><b>12.3</b> Normalise batches together</a></li>
<li class="chapter" data-level="12.4" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#batch-correction"><i class="fa fa-check"></i><b>12.4</b> Batch correction</a><ul>
<li class="chapter" data-level="12.4.1" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#gaussian-normal-linear-models"><i class="fa fa-check"></i><b>12.4.1</b> Gaussian (normal) linear models</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#sctransform-5"><i class="fa fa-check"></i><b>12.5</b> SCTransform</a><ul>
<li class="chapter" data-level="12.5.1" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#batch-only"><i class="fa fa-check"></i><b>12.5.1</b> Batch only</a></li>
<li class="chapter" data-level="12.5.2" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#both-library-size-and-batch"><i class="fa fa-check"></i><b>12.5.2</b> Both library size and batch</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#mnncorrect"><i class="fa fa-check"></i><b>12.6</b> mnnCorrect</a><ul>
<li class="chapter" data-level="12.6.1" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#check-presence-of-batch-effect"><i class="fa fa-check"></i><b>12.6.1</b> Check presence of batch effect</a></li>
<li class="chapter" data-level="12.6.2" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#correct-batch-effect-with-mnncorrect"><i class="fa fa-check"></i><b>12.6.2</b> Correct batch effect with mnnCorrect</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#fastmnn"><i class="fa fa-check"></i><b>12.7</b> fastMNN</a></li>
<li class="chapter" data-level="12.8" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#harmony"><i class="fa fa-check"></i><b>12.8</b> Harmony</a></li>
<li class="chapter" data-level="12.9" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#session-information-8"><i class="fa fa-check"></i><b>12.9</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="dimensionality-reduction-for-analysis.html"><a href="dimensionality-reduction-for-analysis.html"><i class="fa fa-check"></i><b>13</b> Dimensionality reduction for analysis</a><ul>
<li class="chapter" data-level="13.1" data-path="dimensionality-reduction-for-analysis.html"><a href="dimensionality-reduction-for-analysis.html#load-data-2"><i class="fa fa-check"></i><b>13.1</b> Load data</a></li>
<li class="chapter" data-level="13.2" data-path="dimensionality-reduction-for-analysis.html"><a href="dimensionality-reduction-for-analysis.html#denoising-expression-values-using-pca"><i class="fa fa-check"></i><b>13.2</b> Denoising expression values using PCA</a></li>
<li class="chapter" data-level="13.3" data-path="dimensionality-reduction-for-analysis.html"><a href="dimensionality-reduction-for-analysis.html#visualise-expression-patterns-of-some-hvgs"><i class="fa fa-check"></i><b>13.3</b> Visualise expression patterns of some HVGs</a></li>
<li class="chapter" data-level="13.4" data-path="dimensionality-reduction-for-analysis.html"><a href="dimensionality-reduction-for-analysis.html#session-information-9"><i class="fa fa-check"></i><b>13.4</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html"><i class="fa fa-check"></i><b>14</b> Data integration</a><ul>
<li class="chapter" data-level="14.1" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#abbreviations-1"><i class="fa fa-check"></i><b>14.1</b> Abbreviations</a></li>
<li class="chapter" data-level="14.2" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#motivation"><i class="fa fa-check"></i><b>14.2</b> Motivation</a></li>
<li class="chapter" data-level="14.3" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#loading-the-data"><i class="fa fa-check"></i><b>14.3</b> Loading the data</a></li>
<li class="chapter" data-level="14.4" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#diagnosing-batch-effects"><i class="fa fa-check"></i><b>14.4</b> Diagnosing batch effects</a></li>
<li class="chapter" data-level="14.5" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#linear-regression"><i class="fa fa-check"></i><b>14.5</b> Linear regression</a></li>
<li class="chapter" data-level="14.6" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#performing-mnn-correction"><i class="fa fa-check"></i><b>14.6</b> Performing MNN correction</a><ul>
<li class="chapter" data-level="14.6.1" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#algorithm-overview"><i class="fa fa-check"></i><b>14.6.1</b> Algorithm overview</a></li>
<li class="chapter" data-level="14.6.2" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#application-to-the-data"><i class="fa fa-check"></i><b>14.6.2</b> Application to the data</a></li>
<li class="chapter" data-level="14.6.3" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#correction-diagnostics"><i class="fa fa-check"></i><b>14.6.3</b> Correction diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#preserving-biological-heterogeneity"><i class="fa fa-check"></i><b>14.7</b> Preserving biological heterogeneity</a><ul>
<li class="chapter" data-level="14.7.1" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#comparison-to-within-batch-clusters"><i class="fa fa-check"></i><b>14.7.1</b> Comparison to within-batch clusters</a></li>
<li class="chapter" data-level="14.7.2" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#encouraging-consistency-with-marker-genes"><i class="fa fa-check"></i><b>14.7.2</b> Encouraging consistency with marker genes</a></li>
</ul></li>
<li class="chapter" data-level="14.8" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#session-information-10"><i class="fa fa-check"></i><b>14.8</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html"><i class="fa fa-check"></i><b>15</b> Data integration</a><ul>
<li class="chapter" data-level="15.1" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#abbreviations-2"><i class="fa fa-check"></i><b>15.1</b> Abbreviations</a></li>
<li class="chapter" data-level="15.2" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#motivation-1"><i class="fa fa-check"></i><b>15.2</b> Motivation</a></li>
<li class="chapter" data-level="15.3" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#load-data-3"><i class="fa fa-check"></i><b>15.3</b> Load data</a></li>
<li class="chapter" data-level="15.4" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#loading-the-data-1"><i class="fa fa-check"></i><b>15.4</b> Loading the data</a></li>
<li class="chapter" data-level="15.5" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#diagnosing-batch-effects-1"><i class="fa fa-check"></i><b>15.5</b> Diagnosing batch effects</a></li>
<li class="chapter" data-level="15.6" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#linear-regression-1"><i class="fa fa-check"></i><b>15.6</b> Linear regression</a></li>
<li class="chapter" data-level="15.7" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#performing-mnn-correction-1"><i class="fa fa-check"></i><b>15.7</b> Performing MNN correction</a><ul>
<li class="chapter" data-level="15.7.1" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#algorithm-overview-1"><i class="fa fa-check"></i><b>15.7.1</b> Algorithm overview</a></li>
<li class="chapter" data-level="15.7.2" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#application-to-the-data-1"><i class="fa fa-check"></i><b>15.7.2</b> Application to the data</a></li>
</ul></li>
<li class="chapter" data-level="15.8" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#correction-diagnostics-1"><i class="fa fa-check"></i><b>15.8</b> Correction diagnostics</a><ul>
<li class="chapter" data-level="15.8.1" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#mixing-between-batches"><i class="fa fa-check"></i><b>15.8.1</b> Mixing between batches</a></li>
<li class="chapter" data-level="15.8.2" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#preserving-biological-heterogeneity-1"><i class="fa fa-check"></i><b>15.8.2</b> Preserving biological heterogeneity</a><ul>
<li class="chapter" data-level="15.8.2.1" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#comparison-between-within-batch-clusters-and-across-batch-clusters-obtained-after-mnn-correction"><i class="fa fa-check"></i><b>15.8.2.1</b> Comparison between within-batch clusters and across-batch clusters obtained after MNN correction</a></li>
<li class="chapter" data-level="15.8.2.2" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#coassignment-probabilities"><i class="fa fa-check"></i><b>15.8.2.2</b> Coassignment probabilities</a></li>
<li class="chapter" data-level="15.8.2.3" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#rand-index"><i class="fa fa-check"></i><b>15.8.2.3</b> Rand index</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15.9" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#encouraging-consistency-with-marker-genes-1"><i class="fa fa-check"></i><b>15.9</b> Encouraging consistency with marker genes</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html"><i class="fa fa-check"></i><b>16</b> Data integration</a><ul>
<li class="chapter" data-level="16.1" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#abbreviations-3"><i class="fa fa-check"></i><b>16.1</b> Abbreviations</a></li>
<li class="chapter" data-level="16.2" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#motivation-2"><i class="fa fa-check"></i><b>16.2</b> Motivation</a></li>
<li class="chapter" data-level="16.3" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#load-data-4"><i class="fa fa-check"></i><b>16.3</b> Load data</a></li>
<li class="chapter" data-level="16.4" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#loading-the-data-2"><i class="fa fa-check"></i><b>16.4</b> Loading the data</a></li>
<li class="chapter" data-level="16.5" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#diagnosing-batch-effects-2"><i class="fa fa-check"></i><b>16.5</b> Diagnosing batch effects</a></li>
<li class="chapter" data-level="16.6" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#linear-regression-2"><i class="fa fa-check"></i><b>16.6</b> Linear regression</a></li>
<li class="chapter" data-level="16.7" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#performing-mnn-correction-2"><i class="fa fa-check"></i><b>16.7</b> Performing MNN correction</a><ul>
<li class="chapter" data-level="16.7.1" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#algorithm-overview-2"><i class="fa fa-check"></i><b>16.7.1</b> Algorithm overview</a></li>
<li class="chapter" data-level="16.7.2" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#application-to-the-data-2"><i class="fa fa-check"></i><b>16.7.2</b> Application to the data</a></li>
</ul></li>
<li class="chapter" data-level="16.8" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#correction-diagnostics-2"><i class="fa fa-check"></i><b>16.8</b> Correction diagnostics</a><ul>
<li class="chapter" data-level="16.8.1" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#mixing-between-batches-1"><i class="fa fa-check"></i><b>16.8.1</b> Mixing between batches</a></li>
<li class="chapter" data-level="16.8.2" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#preserving-biological-heterogeneity-2"><i class="fa fa-check"></i><b>16.8.2</b> Preserving biological heterogeneity</a><ul>
<li class="chapter" data-level="16.8.2.1" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#comparison-between-within-batch-clusters-and-across-batch-clusters-obtained-after-mnn-correction-1"><i class="fa fa-check"></i><b>16.8.2.1</b> Comparison between within-batch clusters and across-batch clusters obtained after MNN correction</a></li>
<li class="chapter" data-level="16.8.2.2" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#coassignment-probabilities-1"><i class="fa fa-check"></i><b>16.8.2.2</b> Coassignment probabilities</a></li>
<li class="chapter" data-level="16.8.2.3" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#rand-index-1"><i class="fa fa-check"></i><b>16.8.2.3</b> Rand index</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16.9" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#encouraging-consistency-with-marker-genes-2"><i class="fa fa-check"></i><b>16.9</b> Encouraging consistency with marker genes</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="data-integration.html"><a href="data-integration.html"><i class="fa fa-check"></i><b>17</b> Data integration</a><ul>
<li class="chapter" data-level="17.1" data-path="data-integration.html"><a href="data-integration.html#abbreviations-4"><i class="fa fa-check"></i><b>17.1</b> Abbreviations</a></li>
<li class="chapter" data-level="17.2" data-path="data-integration.html"><a href="data-integration.html#motivation-3"><i class="fa fa-check"></i><b>17.2</b> Motivation</a></li>
<li class="chapter" data-level="17.3" data-path="data-integration.html"><a href="data-integration.html#load-data-5"><i class="fa fa-check"></i><b>17.3</b> Load data</a></li>
<li class="chapter" data-level="17.4" data-path="data-integration.html"><a href="data-integration.html#loading-the-data-3"><i class="fa fa-check"></i><b>17.4</b> Loading the data</a></li>
<li class="chapter" data-level="17.5" data-path="data-integration.html"><a href="data-integration.html#diagnosing-batch-effects-3"><i class="fa fa-check"></i><b>17.5</b> Diagnosing batch effects</a></li>
<li class="chapter" data-level="17.6" data-path="data-integration.html"><a href="data-integration.html#linear-regression-3"><i class="fa fa-check"></i><b>17.6</b> Linear regression</a></li>
<li class="chapter" data-level="17.7" data-path="data-integration.html"><a href="data-integration.html#performing-mnn-correction-3"><i class="fa fa-check"></i><b>17.7</b> Performing MNN correction</a><ul>
<li class="chapter" data-level="17.7.1" data-path="data-integration.html"><a href="data-integration.html#algorithm-overview-3"><i class="fa fa-check"></i><b>17.7.1</b> Algorithm overview</a></li>
<li class="chapter" data-level="17.7.2" data-path="data-integration.html"><a href="data-integration.html#application-to-the-data-3"><i class="fa fa-check"></i><b>17.7.2</b> Application to the data</a></li>
</ul></li>
<li class="chapter" data-level="17.8" data-path="data-integration.html"><a href="data-integration.html#correction-diagnostics-3"><i class="fa fa-check"></i><b>17.8</b> Correction diagnostics</a><ul>
<li class="chapter" data-level="17.8.1" data-path="data-integration.html"><a href="data-integration.html#mixing-between-batches-2"><i class="fa fa-check"></i><b>17.8.1</b> Mixing between batches</a></li>
<li class="chapter" data-level="17.8.2" data-path="data-integration.html"><a href="data-integration.html#preserving-biological-heterogeneity-3"><i class="fa fa-check"></i><b>17.8.2</b> Preserving biological heterogeneity</a><ul>
<li class="chapter" data-level="17.8.2.1" data-path="data-integration.html"><a href="data-integration.html#comparison-between-within-batch-clusters-and-across-batch-clusters-obtained-after-mnn-correction-2"><i class="fa fa-check"></i><b>17.8.2.1</b> Comparison between within-batch clusters and across-batch clusters obtained after MNN correction</a></li>
<li class="chapter" data-level="17.8.2.2" data-path="data-integration.html"><a href="data-integration.html#coassignment-probabilities-2"><i class="fa fa-check"></i><b>17.8.2.2</b> Coassignment probabilities</a></li>
<li class="chapter" data-level="17.8.2.3" data-path="data-integration.html"><a href="data-integration.html#rand-index-2"><i class="fa fa-check"></i><b>17.8.2.3</b> Rand index</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17.9" data-path="data-integration.html"><a href="data-integration.html#encouraging-consistency-with-marker-genes-3"><i class="fa fa-check"></i><b>17.9</b> Encouraging consistency with marker genes</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><i class="fa fa-check"></i><b>18</b> Data integration</a><ul>
<li class="chapter" data-level="18.1" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#abbreviations-5"><i class="fa fa-check"></i><b>18.1</b> Abbreviations</a></li>
<li class="chapter" data-level="18.2" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#motivation-4"><i class="fa fa-check"></i><b>18.2</b> Motivation</a></li>
<li class="chapter" data-level="18.3" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#load-data-6"><i class="fa fa-check"></i><b>18.3</b> Load data</a></li>
<li class="chapter" data-level="18.4" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#loading-the-data-4"><i class="fa fa-check"></i><b>18.4</b> Loading the data</a></li>
<li class="chapter" data-level="18.5" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#diagnosing-batch-effects-4"><i class="fa fa-check"></i><b>18.5</b> Diagnosing batch effects</a></li>
<li class="chapter" data-level="18.6" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#linear-regression-4"><i class="fa fa-check"></i><b>18.6</b> Linear regression</a></li>
<li class="chapter" data-level="18.7" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#performing-mnn-correction-4"><i class="fa fa-check"></i><b>18.7</b> Performing MNN correction</a><ul>
<li class="chapter" data-level="18.7.1" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#algorithm-overview-4"><i class="fa fa-check"></i><b>18.7.1</b> Algorithm overview</a></li>
<li class="chapter" data-level="18.7.2" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#application-to-the-data-4"><i class="fa fa-check"></i><b>18.7.2</b> Application to the data</a></li>
</ul></li>
<li class="chapter" data-level="18.8" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#correction-diagnostics-4"><i class="fa fa-check"></i><b>18.8</b> Correction diagnostics</a><ul>
<li class="chapter" data-level="18.8.1" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#mixing-between-batches-3"><i class="fa fa-check"></i><b>18.8.1</b> Mixing between batches</a></li>
<li class="chapter" data-level="18.8.2" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#preserving-biological-heterogeneity-4"><i class="fa fa-check"></i><b>18.8.2</b> Preserving biological heterogeneity</a><ul>
<li class="chapter" data-level="18.8.2.1" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#comparison-between-within-batch-clusters-and-across-batch-clusters-obtained-after-mnn-correction-3"><i class="fa fa-check"></i><b>18.8.2.1</b> Comparison between within-batch clusters and across-batch clusters obtained after MNN correction</a></li>
<li class="chapter" data-level="18.8.2.2" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#coassignment-probabilities-3"><i class="fa fa-check"></i><b>18.8.2.2</b> Coassignment probabilities</a></li>
<li class="chapter" data-level="18.8.2.3" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#rand-index-3"><i class="fa fa-check"></i><b>18.8.2.3</b> Rand index</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18.9" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#encouraging-consistency-with-marker-genes-4"><i class="fa fa-check"></i><b>18.9</b> Encouraging consistency with marker genes</a></li>
<li class="chapter" data-level="18.10" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#identify-clusters-with-pbmmc-cells"><i class="fa fa-check"></i><b>18.10</b> Identify clusters with PBMMC cells</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="large-cluster-with-moderate-pbmmc-proportion.html"><a href="large-cluster-with-moderate-pbmmc-proportion.html"><i class="fa fa-check"></i><b>19</b> large cluster with moderate PBMMC proportion:</a></li>
<li class="chapter" data-level="20" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><i class="fa fa-check"></i><b>20</b> Clustering with ‘’PBMMC,ETV6-RUNX1’’ and ’_5hCellPerSpl’ {#clustering’PBMMC_ETV6-RUNX1__5hCellPerSpl’Top}</a><ul>
<li class="chapter" data-level="20.1" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#load-data-7"><i class="fa fa-check"></i><b>20.1</b> Load data</a></li>
<li class="chapter" data-level="20.2" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#clustering-cells-into-putative-subpopulations"><i class="fa fa-check"></i><b>20.2</b> Clustering cells into putative subpopulations</a><ul>
<li class="chapter" data-level="20.2.1" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#defining-cell-clusters-from-expression-data"><i class="fa fa-check"></i><b>20.2.1</b> Defining cell clusters from expression data</a><ul>
<li class="chapter" data-level="20.2.1.1" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#hierarchical-clustering"><i class="fa fa-check"></i><b>20.2.1.1</b> Hierarchical clustering</a><ul>
<li class="chapter" data-level="20.2.1.1.1" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#clustering"><i class="fa fa-check"></i><b>20.2.1.1.1</b> Clustering</a></li>
<li class="chapter" data-level="20.2.1.1.2" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#separatedness"><i class="fa fa-check"></i><b>20.2.1.1.2</b> Separatedness</a></li>
</ul></li>
<li class="chapter" data-level="20.2.1.2" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#k-means"><i class="fa fa-check"></i><b>20.2.1.2</b> k-means</a><ul>
<li class="chapter" data-level="20.2.1.2.1" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#description-1"><i class="fa fa-check"></i><b>20.2.1.2.1</b> Description</a></li>
<li class="chapter" data-level="20.2.1.2.2" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#example-3"><i class="fa fa-check"></i><b>20.2.1.2.2</b> Example</a></li>
<li class="chapter" data-level="20.2.1.2.3" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#within-cluster-sum-of-squares"><i class="fa fa-check"></i><b>20.2.1.2.3</b> Within-cluster sum-of-squares</a></li>
<li class="chapter" data-level="20.2.1.2.4" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#silhouette"><i class="fa fa-check"></i><b>20.2.1.2.4</b> Silhouette</a></li>
<li class="chapter" data-level="20.2.1.2.5" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#gap-statistic"><i class="fa fa-check"></i><b>20.2.1.2.5</b> Gap statistic</a></li>
<li class="chapter" data-level="20.2.1.2.6" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#multi-metric"><i class="fa fa-check"></i><b>20.2.1.2.6</b> Multi-metric</a></li>
</ul></li>
<li class="chapter" data-level="20.2.1.3" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#graph-based-clustering"><i class="fa fa-check"></i><b>20.2.1.3</b> Graph-based clustering</a><ul>
<li class="chapter" data-level="20.2.1.3.1" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#modularity"><i class="fa fa-check"></i><b>20.2.1.3.1</b> Modularity</a></li>
<li class="chapter" data-level="20.2.1.3.2" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#community-detection-via-short-random-walks-walktrap"><i class="fa fa-check"></i><b>20.2.1.3.2</b> Community detection via short random walks: ‘walktrap’</a></li>
<li class="chapter" data-level="20.2.1.3.3" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#community-detection-with-the-louvain-method"><i class="fa fa-check"></i><b>20.2.1.3.3</b> Community detection with the ‘Louvain’ method</a></li>
<li class="chapter" data-level="20.2.1.3.4" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#community-detection-with-the-leiden-method"><i class="fa fa-check"></i><b>20.2.1.3.4</b> Community detection with the ‘Leiden’ method</a></li>
<li class="chapter" data-level="20.2.1.3.5" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#choose-the-number-of-clusters"><i class="fa fa-check"></i><b>20.2.1.3.5</b> Choose the number of clusters</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#comparing-two-sets-of-clusters"><i class="fa fa-check"></i><b>20.3</b> Comparing two sets of clusters</a></li>
<li class="chapter" data-level="20.4" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#expression-of-known-marker-genes"><i class="fa fa-check"></i><b>20.4</b> Expression of known marker genes</a></li>
<li class="chapter" data-level="20.5" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#save-data"><i class="fa fa-check"></i><b>20.5</b> Save data</a></li>
<li class="chapter" data-level="20.6" data-path="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html"><a href="clustering-with-pbmmcetv6-runx1-and-5hcellperspl-clusteringpbmmc-etv6-runx1-5hcellperspltop.html#session-information-11"><i class="fa fa-check"></i><b>20.6</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html"><i class="fa fa-check"></i><b>21</b> Cluster marker genes</a><ul>
<li class="chapter" data-level="21.1" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#learning-objectives"><i class="fa fa-check"></i><b>21.1</b> Learning objectives</a></li>
<li class="chapter" data-level="21.2" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#load-data-8"><i class="fa fa-check"></i><b>21.2</b> Load data</a></li>
<li class="chapter" data-level="21.3" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#detecting-genes-differentially-expressed-between-clusters"><i class="fa fa-check"></i><b>21.3</b> Detecting genes differentially expressed between clusters</a><ul>
<li class="chapter" data-level="21.3.1" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#differential-expression-analysis"><i class="fa fa-check"></i><b>21.3.1</b> Differential expression analysis</a></li>
<li class="chapter" data-level="21.3.2" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#heatmap"><i class="fa fa-check"></i><b>21.3.2</b> Heatmap</a></li>
</ul></li>
<li class="chapter" data-level="21.4" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#using-the-log-fold-change"><i class="fa fa-check"></i><b>21.4</b> Using the log-fold change</a></li>
<li class="chapter" data-level="21.5" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#finding-cluster-specific-markers"><i class="fa fa-check"></i><b>21.5</b> Finding cluster-specific markers</a></li>
<li class="chapter" data-level="21.6" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#using-the-wilcoxon-rank-sum-test"><i class="fa fa-check"></i><b>21.6</b> Using the Wilcoxon rank sum test</a></li>
<li class="chapter" data-level="21.7" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#using-a-binomial-test"><i class="fa fa-check"></i><b>21.7</b> Using a binomial test</a></li>
<li class="chapter" data-level="21.8" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#combining-multiple-marker-statistics"><i class="fa fa-check"></i><b>21.8</b> Combining multiple marker statistics</a></li>
<li class="chapter" data-level="21.9" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#invalidity-of-p-values"><i class="fa fa-check"></i><b>21.9</b> Invalidity of p-values</a><ul>
<li class="chapter" data-level="21.9.1" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#from-data-snooping"><i class="fa fa-check"></i><b>21.9.1</b> 11.5.1 From data snooping</a></li>
<li class="chapter" data-level="21.9.2" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#nature-of-replication"><i class="fa fa-check"></i><b>21.9.2</b> Nature of replication</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="cellCyclePhasesTop.html"><a href="cellCyclePhasesTop.html"><i class="fa fa-check"></i><b>22</b> Cell cycle assignment</a><ul>
<li class="chapter" data-level="22.1" data-path="cellCyclePhasesTop.html"><a href="cellCyclePhasesTop.html#load-data-9"><i class="fa fa-check"></i><b>22.1</b> Load data</a></li>
<li class="chapter" data-level="22.2" data-path="cellCyclePhasesTop.html"><a href="cellCyclePhasesTop.html#motivation-5"><i class="fa fa-check"></i><b>22.2</b> Motivation</a></li>
<li class="chapter" data-level="22.3" data-path="cellCyclePhasesTop.html"><a href="cellCyclePhasesTop.html#using-the-cyclins"><i class="fa fa-check"></i><b>22.3</b> Using the cyclins</a></li>
<li class="chapter" data-level="22.4" data-path="cellCyclePhasesTop.html"><a href="cellCyclePhasesTop.html#using-the-cyclone-classifier"><i class="fa fa-check"></i><b>22.4</b> Using the cyclone() classifier</a></li>
<li class="chapter" data-level="22.5" data-path="cellCyclePhasesTop.html"><a href="cellCyclePhasesTop.html#regressing-out-cell-cycle-phase"><i class="fa fa-check"></i><b>22.5</b> Regressing out cell cycle phase</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="differential-expression-and-abundance-between-conditions.html"><a href="differential-expression-and-abundance-between-conditions.html"><i class="fa fa-check"></i><b>23</b> Differential expression and abundance between conditions</a><ul>
<li class="chapter" data-level="23.1" data-path="differential-expression-and-abundance-between-conditions.html"><a href="differential-expression-and-abundance-between-conditions.html#motivation-6"><i class="fa fa-check"></i><b>23.1</b> Motivation</a></li>
<li class="chapter" data-level="23.2" data-path="differential-expression-and-abundance-between-conditions.html"><a href="differential-expression-and-abundance-between-conditions.html#setting-up-the-data"><i class="fa fa-check"></i><b>23.2</b> Setting up the data</a></li>
<li class="chapter" data-level="23.3" data-path="differential-expression-and-abundance-between-conditions.html"><a href="differential-expression-and-abundance-between-conditions.html#differential-expression-between-conditions"><i class="fa fa-check"></i><b>23.3</b> Differential expression between conditions</a><ul>
<li class="chapter" data-level="23.3.1" data-path="differential-expression-and-abundance-between-conditions.html"><a href="differential-expression-and-abundance-between-conditions.html#creating-pseudo-bulk-samples"><i class="fa fa-check"></i><b>23.3.1</b> Creating pseudo-bulk samples</a></li>
<li class="chapter" data-level="23.3.2" data-path="differential-expression-and-abundance-between-conditions.html"><a href="differential-expression-and-abundance-between-conditions.html#performing-the-de-analysis"><i class="fa fa-check"></i><b>23.3.2</b> Performing the DE analysis</a><ul>
<li class="chapter" data-level="23.3.2.1" data-path="differential-expression-and-abundance-between-conditions.html"><a href="differential-expression-and-abundance-between-conditions.html#introduction-4"><i class="fa fa-check"></i><b>23.3.2.1</b> Introduction</a></li>
<li class="chapter" data-level="23.3.2.2" data-path="differential-expression-and-abundance-between-conditions.html"><a href="differential-expression-and-abundance-between-conditions.html#pre-processing"><i class="fa fa-check"></i><b>23.3.2.2</b> Pre-processing</a></li>
<li class="chapter" data-level="23.3.2.3" data-path="differential-expression-and-abundance-between-conditions.html"><a href="differential-expression-and-abundance-between-conditions.html#statistical-modelling"><i class="fa fa-check"></i><b>23.3.2.3</b> Statistical modelling</a></li>
<li class="chapter" data-level="23.3.2.4" data-path="differential-expression-and-abundance-between-conditions.html"><a href="differential-expression-and-abundance-between-conditions.html#differential-expression-for-each-cluster"><i class="fa fa-check"></i><b>23.3.2.4</b> Differential expression for each cluster</a><ul>
<li class="chapter" data-level="23.3.2.4.1" data-path="differential-expression-and-abundance-between-conditions.html"><a href="differential-expression-and-abundance-between-conditions.html#number-of-degs-by-cluster-and-direction"><i class="fa fa-check"></i><b>23.3.2.4.1</b> Number of DEGs by cluster and direction</a></li>
<li class="chapter" data-level="23.3.2.4.2" data-path="differential-expression-and-abundance-between-conditions.html"><a href="differential-expression-and-abundance-between-conditions.html#list-of-degs"><i class="fa fa-check"></i><b>23.3.2.4.2</b> List of DEGs</a></li>
<li class="chapter" data-level="23.3.2.4.3" data-path="differential-expression-and-abundance-between-conditions.html"><a href="differential-expression-and-abundance-between-conditions.html#number-of-clusters-skipped"><i class="fa fa-check"></i><b>23.3.2.4.3</b> Number of clusters skipped</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="23.3.3" data-path="differential-expression-and-abundance-between-conditions.html"><a href="differential-expression-and-abundance-between-conditions.html#putting-it-all-together"><i class="fa fa-check"></i><b>23.3.3</b> Putting it all together</a></li>
</ul></li>
<li class="chapter" data-level="23.4" data-path="differential-expression-and-abundance-between-conditions.html"><a href="differential-expression-and-abundance-between-conditions.html#differential-abundance-between-conditions"><i class="fa fa-check"></i><b>23.4</b> Differential abundance between conditions</a><ul>
<li class="chapter" data-level="23.4.1" data-path="differential-expression-and-abundance-between-conditions.html"><a href="differential-expression-and-abundance-between-conditions.html#overview"><i class="fa fa-check"></i><b>23.4.1</b> Overview</a></li>
<li class="chapter" data-level="23.4.2" data-path="differential-expression-and-abundance-between-conditions.html"><a href="differential-expression-and-abundance-between-conditions.html#handling-composition-effects"><i class="fa fa-check"></i><b>23.4.2</b> Handling composition effects</a><ul>
<li class="chapter" data-level="23.4.2.1" data-path="differential-expression-and-abundance-between-conditions.html"><a href="differential-expression-and-abundance-between-conditions.html#background"><i class="fa fa-check"></i><b>23.4.2.1</b> Background</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="23.5" data-path="differential-expression-and-abundance-between-conditions.html"><a href="differential-expression-and-abundance-between-conditions.html#session-information-12"><i class="fa fa-check"></i><b>23.5</b> Session information</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">CRUK Bioinformatics Summer School 2020 - single-cell RNA-seq analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="differential-expression-and-abundance-between-conditions" class="section level1">
<h1><span class="header-section-number">Chapter 23</span> Differential expression and abundance between conditions</h1>
<p>Source: <a href="https://osca.bioconductor.org/multi-sample-comparisons.html">Multi-sample comparisons</a> of the OSCA book.</p>
<div id="motivation-6" class="section level2">
<h2><span class="header-section-number">23.1</span> Motivation</h2>
<p>A powerful use of scRNA-seq technology lies in the design of replicated multi-condition experiments to detect changes in composition or expression between conditions. For example, a researcher could use this strategy to detect changes in cell type abundance after drug treatment (Richard et al. 2018) or genetic modifications (Scialdone et al. 2016). This provides more biological insight than conventional scRNA-seq experiments involving only one biological condition, especially if we can relate population changes to specific experimental perturbations.</p>
<p>Differential analyses of multi-condition scRNA-seq experiments can be broadly split into two categories - differential expression (DE) and differential abundance (DA) analyses. The former tests for changes in expression between conditions for cells of the same type that are present in both conditions, while the latter tests for changes in the composition of cell types (or states, etc.) between conditions.</p>
</div>
<div id="setting-up-the-data" class="section level2">
<h2><span class="header-section-number">23.2</span> Setting up the data</h2>
<p>We will use the data set comprising the 11 samples (500 or 1000 cells per sample) analysed with fastMNN and the nested list of samples.</p>
<p>The differential analyses in this chapter will be predicated on many of the pre-processing steps covered previously. For brevity, we will not explicitly repeat them here, only noting that we have already merged cells from all samples into the same coordinate system and clustered the merged dataset to obtain a common partitioning across all samples.</p>
<p>Load the SCE object:</p>
<div class="sourceCode" id="cb1727"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1727-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1727-1"></a><span class="co">#setName &lt;- &quot;caron&quot;</span></span>
<span id="cb1727-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1727-2"></a><span class="co"># Read object in:</span></span>
<span id="cb1727-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1727-3"></a><span class="co">##setSuf &lt;- &quot;_1kCellPerSpl&quot;</span></span>
<span id="cb1727-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1727-4"></a><span class="co">##tmpFn &lt;- sprintf(&quot;%s/%s/Robjects/%s_sce_nz_postDeconv%s_clustered.Rds&quot;, projDir, outDirBit, setName, setSuf)</span></span>
<span id="cb1727-5"><a href="differential-expression-and-abundance-between-conditions.html#cb1727-5"></a></span>
<span id="cb1727-6"><a href="differential-expression-and-abundance-between-conditions.html#cb1727-6"></a><span class="co">#setSuf &lt;- &quot;_1kCps&quot;</span></span>
<span id="cb1727-7"><a href="differential-expression-and-abundance-between-conditions.html#cb1727-7"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/%s_sce_nz_postDeconv%s_Fmwbl.Rds&quot;</span>, projDir, outDirBit, setName, setSuf)</span>
<span id="cb1727-8"><a href="differential-expression-and-abundance-between-conditions.html#cb1727-8"></a></span>
<span id="cb1727-9"><a href="differential-expression-and-abundance-between-conditions.html#cb1727-9"></a><span class="kw">print</span>(tmpFn)</span></code></pre></div>
<pre><code>## [1] &quot;/ssd/personal/baller01/20200511_FernandesM_ME_crukBiSs2020/AnaWiSce/Ana1/Robjects/caron_sce_nz_postDeconv_5hCps_Fmwbl.Rds&quot;</code></pre>
<div class="sourceCode" id="cb1729"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1729-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1729-1"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">file.exists</span>(tmpFn))</span>
<span id="cb1729-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1729-2"></a>{</span>
<span id="cb1729-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1729-3"></a>    knitr<span class="op">::</span><span class="kw">knit_exit</span>()</span>
<span id="cb1729-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1729-4"></a>}</span>
<span id="cb1729-5"><a href="differential-expression-and-abundance-between-conditions.html#cb1729-5"></a>sce &lt;-<span class="st"> </span><span class="kw">readRDS</span>(tmpFn)</span>
<span id="cb1729-6"><a href="differential-expression-and-abundance-between-conditions.html#cb1729-6"></a>sce</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 9799 5500 
## metadata(2): merge.info pca.info
## assays(1): reconstructed
## rownames(9799): ENSG00000000457 ENSG00000000938 ... ENSG00000285476
##   ENSG00000285486
## rowData names(1): rotation
## colnames: NULL
## colData names(21): Barcode Run ... type clusters.mnn
## reducedDimNames(2): corrected TSNE
## altExpNames(0):</code></pre>
<p>A brief inspection of the results shows clusters contain varying contributions from batches:</p>
<div class="sourceCode" id="cb1731"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1731-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1731-1"></a><span class="kw">library</span>(scater)</span>
<span id="cb1731-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1731-2"></a><span class="kw">colLabels</span>(sce) &lt;-<span class="st"> </span>sce<span class="op">$</span>clusters.mnn</span>
<span id="cb1731-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1731-3"></a>tab &lt;-<span class="st"> </span><span class="kw">table</span>(<span class="kw">colLabels</span>(sce), sce<span class="op">$</span>type)</span>
<span id="cb1731-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1731-4"></a>tab</span></code></pre></div>
<pre><code>##      
##       ETV6-RUNX1 HHD PBMMC PRE-T
##   c1         186 119    89   151
##   c10          3   2     8     5
##   c11          6   9    18   253
##   c12          1   0    39     0
##   c13         41   0    33     0
##   c14         71  25   140    17
##   c15         33   4    17     4
##   c16         50   0    69     3
##   c17          9   6    24    17
##   c18          8   0    21     5
##   c2         360 211   102    13
##   c3           0   2   121    22
##   c4         192  39   431   255
##   c5          98  35    55    34
##   c6         846 484   195    45
##   c7          15   1    37     5
##   c8          49  47     7   141
##   c9          32  16    94    30</code></pre>
<div class="sourceCode" id="cb1733"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1733-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1733-1"></a>pheatmap<span class="op">::</span><span class="kw">pheatmap</span>(tab,</span>
<span id="cb1733-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1733-2"></a>           <span class="dt">border_color      =</span> <span class="ot">NA</span>,</span>
<span id="cb1733-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1733-3"></a>           <span class="dt">drop_levels       =</span> <span class="ot">TRUE</span>,</span>
<span id="cb1733-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1733-4"></a>           <span class="dt">cluster_rows      =</span> <span class="ot">FALSE</span>,</span>
<span id="cb1733-5"><a href="differential-expression-and-abundance-between-conditions.html#cb1733-5"></a>           <span class="dt">cluster_cols      =</span> <span class="ot">FALSE</span></span>
<span id="cb1733-6"><a href="differential-expression-and-abundance-between-conditions.html#cb1733-6"></a>           )</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-571-1.png" width="672" /></p>
<div class="sourceCode" id="cb1734"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1734-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1734-1"></a>tab &lt;-<span class="st"> </span><span class="kw">table</span>(<span class="kw">colLabels</span>(sce), sce<span class="op">$</span>Sample.Name2)</span>
<span id="cb1734-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1734-2"></a>pheatmap<span class="op">::</span><span class="kw">pheatmap</span>(tab,</span>
<span id="cb1734-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1734-3"></a>           <span class="dt">border_color      =</span> <span class="ot">NA</span>,</span>
<span id="cb1734-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1734-4"></a>           <span class="dt">drop_levels       =</span> <span class="ot">TRUE</span>,</span>
<span id="cb1734-5"><a href="differential-expression-and-abundance-between-conditions.html#cb1734-5"></a>           <span class="dt">cluster_rows      =</span> <span class="ot">FALSE</span>,</span>
<span id="cb1734-6"><a href="differential-expression-and-abundance-between-conditions.html#cb1734-6"></a>           <span class="dt">cluster_cols      =</span> <span class="ot">FALSE</span></span>
<span id="cb1734-7"><a href="differential-expression-and-abundance-between-conditions.html#cb1734-7"></a>           )</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-572-1.png" width="672" /></p>
<p>On the t-SNE plots below, cells colored by type or sample (‘batch of origin’). Cluster numbers are superimposed based on the median coordinate of cells assigned to that cluster.</p>
<div class="sourceCode" id="cb1735"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1735-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1735-1"></a>p1 &lt;-<span class="st"> </span><span class="kw">plotTSNE</span>(sce, <span class="dt">colour_by=</span><span class="st">&quot;type&quot;</span>, <span class="dt">text_by=</span><span class="st">&quot;label&quot;</span>)</span>
<span id="cb1735-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1735-2"></a>p2 &lt;-<span class="st"> </span><span class="kw">plotTSNE</span>(sce, <span class="dt">colour_by=</span><span class="st">&quot;Sample.Name2&quot;</span>)</span>
<span id="cb1735-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1735-3"></a>gridExtra<span class="op">::</span><span class="kw">grid.arrange</span>(p1, p2<span class="op">+</span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="kw">colData</span>(sce)<span class="op">$</span>type), <span class="dt">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-573-1.png" width="806.4" /></p>
<div class="sourceCode" id="cb1736"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1736-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1736-1"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/%s_sce_nz_postDeconv%s_Fmwbl2.Rds&quot;</span>, projDir, outDirBit, setName, setSuf)</span>
<span id="cb1736-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1736-2"></a>tmpList &lt;-<span class="st"> </span><span class="kw">readRDS</span>(tmpFn)</span>
<span id="cb1736-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1736-3"></a></span>
<span id="cb1736-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1736-4"></a>chosen.hvgs &lt;-<span class="st"> </span>tmpList<span class="op">$</span>chosen.hvgs</span>
<span id="cb1736-5"><a href="differential-expression-and-abundance-between-conditions.html#cb1736-5"></a>rescaled.mbn &lt;-<span class="st"> </span>tmpList<span class="op">$</span>rescaled.mbn</span>
<span id="cb1736-6"><a href="differential-expression-and-abundance-between-conditions.html#cb1736-6"></a>uncorrected &lt;-<span class="st"> </span>tmpList<span class="op">$</span>uncorrected</span>
<span id="cb1736-7"><a href="differential-expression-and-abundance-between-conditions.html#cb1736-7"></a>colToKeep &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Run&quot;</span>, <span class="st">&quot;Sample.Name&quot;</span>, <span class="st">&quot;source_name&quot;</span>, <span class="st">&quot;block&quot;</span>, <span class="st">&quot;setName&quot;</span>, <span class="st">&quot;Sample.Name2&quot;</span>) </span>
<span id="cb1736-8"><a href="differential-expression-and-abundance-between-conditions.html#cb1736-8"></a><span class="kw">colData</span>(uncorrected) &lt;-<span class="st"> </span><span class="kw">colData</span>(uncorrected)[,colToKeep]</span>
<span id="cb1736-9"><a href="differential-expression-and-abundance-between-conditions.html#cb1736-9"></a><span class="kw">colData</span>(uncorrected)[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]</span></code></pre></div>
<pre><code>## DataFrame with 3 rows and 6 columns
##           Run Sample.Name source_name      block     setName Sample.Name2
##   &lt;character&gt; &lt;character&gt;    &lt;factor&gt;   &lt;factor&gt; &lt;character&gt;  &lt;character&gt;
## 1  SRR9264343  GSM3872434  ETV6-RUNX1 ETV6-RUNX1       Caron ETV6-RUNX1_1
## 2  SRR9264343  GSM3872434  ETV6-RUNX1 ETV6-RUNX1       Caron ETV6-RUNX1_1
## 3  SRR9264343  GSM3872434  ETV6-RUNX1 ETV6-RUNX1       Caron ETV6-RUNX1_1</code></pre>
<div class="sourceCode" id="cb1738"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1738-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1738-1"></a><span class="co">#--- merging ---#</span></span>
<span id="cb1738-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1738-2"></a><span class="kw">library</span>(batchelor)</span>
<span id="cb1738-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1738-3"></a><span class="kw">set.seed</span>(<span class="dv">01001001</span>)</span>
<span id="cb1738-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1738-4"></a>merged &lt;-<span class="st"> </span><span class="kw">correctExperiments</span>(uncorrected, </span>
<span id="cb1738-5"><a href="differential-expression-and-abundance-between-conditions.html#cb1738-5"></a>    <span class="dt">batch=</span>uncorrected<span class="op">$</span>Sample.Name2, </span>
<span id="cb1738-6"><a href="differential-expression-and-abundance-between-conditions.html#cb1738-6"></a>    <span class="dt">subset.row=</span>chosen.hvgs,</span>
<span id="cb1738-7"><a href="differential-expression-and-abundance-between-conditions.html#cb1738-7"></a>    <span class="dt">PARAM=</span><span class="kw">FastMnnParam</span>(</span>
<span id="cb1738-8"><a href="differential-expression-and-abundance-between-conditions.html#cb1738-8"></a>        <span class="dt">merge.order=</span><span class="kw">list</span>( <span class="kw">list</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="kw">list</span>(<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>), <span class="kw">list</span>(<span class="dv">5</span>,<span class="dv">6</span>), <span class="kw">list</span>(<span class="dv">7</span>,<span class="dv">8</span>) )</span>
<span id="cb1738-9"><a href="differential-expression-and-abundance-between-conditions.html#cb1738-9"></a>    )</span>
<span id="cb1738-10"><a href="differential-expression-and-abundance-between-conditions.html#cb1738-10"></a>)</span>
<span id="cb1738-11"><a href="differential-expression-and-abundance-between-conditions.html#cb1738-11"></a></span>
<span id="cb1738-12"><a href="differential-expression-and-abundance-between-conditions.html#cb1738-12"></a>merged</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 9799 5500 
## metadata(2): merge.info pca.info
## assays(3): reconstructed counts logcounts
## rownames(9799): ENSG00000000457 ENSG00000000938 ... ENSG00000285476
##   ENSG00000285486
## rowData names(12): rotation ensembl_gene_id ... detected gene_sparsity
## colnames: NULL
## colData names(7): batch Run ... setName Sample.Name2
## reducedDimNames(4): corrected PCA TSNE UMAP
## altExpNames(0):</code></pre>
<div class="sourceCode" id="cb1740"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1740-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1740-1"></a><span class="co">#--- clustering ---#</span></span>
<span id="cb1740-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1740-2"></a>g &lt;-<span class="st"> </span><span class="kw">buildSNNGraph</span>(merged, <span class="dt">use.dimred=</span><span class="st">&quot;corrected&quot;</span>)</span>
<span id="cb1740-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1740-3"></a>clusters &lt;-<span class="st"> </span>igraph<span class="op">::</span><span class="kw">cluster_louvain</span>(g)</span>
<span id="cb1740-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1740-4"></a>merged<span class="op">$</span>clusters.mnn &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">paste0</span>(<span class="st">&quot;c&quot;</span>, clusters<span class="op">$</span>membership))</span>
<span id="cb1740-5"><a href="differential-expression-and-abundance-between-conditions.html#cb1740-5"></a><span class="co">#colLabels(merged) &lt;- merged$clusters.mnn</span></span>
<span id="cb1740-6"><a href="differential-expression-and-abundance-between-conditions.html#cb1740-6"></a></span>
<span id="cb1740-7"><a href="differential-expression-and-abundance-between-conditions.html#cb1740-7"></a><span class="co">#--- dimensionality-reduction ---#</span></span>
<span id="cb1740-8"><a href="differential-expression-and-abundance-between-conditions.html#cb1740-8"></a>merged &lt;-<span class="st"> </span><span class="kw">runTSNE</span>(merged, <span class="dt">dimred=</span><span class="st">&quot;corrected&quot;</span>, <span class="dt">external_neighbors=</span><span class="ot">TRUE</span>)</span>
<span id="cb1740-9"><a href="differential-expression-and-abundance-between-conditions.html#cb1740-9"></a>merged &lt;-<span class="st"> </span><span class="kw">runUMAP</span>(merged, <span class="dt">dimred=</span><span class="st">&quot;corrected&quot;</span>, <span class="dt">external_neighbors=</span><span class="ot">TRUE</span>)</span>
<span id="cb1740-10"><a href="differential-expression-and-abundance-between-conditions.html#cb1740-10"></a></span>
<span id="cb1740-11"><a href="differential-expression-and-abundance-between-conditions.html#cb1740-11"></a><span class="kw">library</span>(scater)</span>
<span id="cb1740-12"><a href="differential-expression-and-abundance-between-conditions.html#cb1740-12"></a>tab &lt;-<span class="st"> </span><span class="kw">table</span>(merged<span class="op">$</span>clusters.mnn, merged<span class="op">$</span>block)</span>
<span id="cb1740-13"><a href="differential-expression-and-abundance-between-conditions.html#cb1740-13"></a>pheatmap<span class="op">::</span><span class="kw">pheatmap</span>(tab,</span>
<span id="cb1740-14"><a href="differential-expression-and-abundance-between-conditions.html#cb1740-14"></a>           <span class="dt">border_color      =</span> <span class="ot">NA</span>,</span>
<span id="cb1740-15"><a href="differential-expression-and-abundance-between-conditions.html#cb1740-15"></a>           <span class="dt">drop_levels       =</span> <span class="ot">TRUE</span>,</span>
<span id="cb1740-16"><a href="differential-expression-and-abundance-between-conditions.html#cb1740-16"></a>           <span class="dt">cluster_rows      =</span> <span class="ot">FALSE</span>,</span>
<span id="cb1740-17"><a href="differential-expression-and-abundance-between-conditions.html#cb1740-17"></a>           <span class="dt">cluster_cols      =</span> <span class="ot">FALSE</span></span>
<span id="cb1740-18"><a href="differential-expression-and-abundance-between-conditions.html#cb1740-18"></a>           )</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-574-1.png" width="672" /></p>
<div class="sourceCode" id="cb1741"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1741-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1741-1"></a>tab &lt;-<span class="st"> </span><span class="kw">table</span>(merged<span class="op">$</span>clusters.mnn, merged<span class="op">$</span>Sample.Name2)</span>
<span id="cb1741-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1741-2"></a>pheatmap<span class="op">::</span><span class="kw">pheatmap</span>(tab,</span>
<span id="cb1741-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1741-3"></a>           <span class="dt">border_color      =</span> <span class="ot">NA</span>,</span>
<span id="cb1741-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1741-4"></a>           <span class="dt">drop_levels       =</span> <span class="ot">TRUE</span>,</span>
<span id="cb1741-5"><a href="differential-expression-and-abundance-between-conditions.html#cb1741-5"></a>           <span class="dt">cluster_rows      =</span> <span class="ot">FALSE</span>,</span>
<span id="cb1741-6"><a href="differential-expression-and-abundance-between-conditions.html#cb1741-6"></a>           <span class="dt">cluster_cols      =</span> <span class="ot">FALSE</span></span>
<span id="cb1741-7"><a href="differential-expression-and-abundance-between-conditions.html#cb1741-7"></a>           )</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-574-2.png" width="672" /></p>
<div class="sourceCode" id="cb1742"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1742-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1742-1"></a><span class="co">#plotTSNE(merged, colour_by=&quot;block&quot;, text_by=&quot;clusters.mnn&quot;)</span></span>
<span id="cb1742-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1742-2"></a><span class="co">#plotTSNE(merged, colour_by=&quot;Sample.Name2&quot;)</span></span></code></pre></div>
<div class="sourceCode" id="cb1743"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1743-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1743-1"></a>p1 &lt;-<span class="st"> </span><span class="kw">plotTSNE</span>(merged, <span class="dt">colour_by=</span><span class="st">&quot;block&quot;</span>, <span class="dt">text_by=</span><span class="st">&quot;clusters.mnn&quot;</span>)</span>
<span id="cb1743-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1743-2"></a>p2 &lt;-<span class="st"> </span><span class="kw">plotTSNE</span>(merged, <span class="dt">colour_by=</span><span class="st">&quot;Sample.Name2&quot;</span>)</span>
<span id="cb1743-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1743-3"></a>gridExtra<span class="op">::</span><span class="kw">grid.arrange</span>(p1, p2<span class="op">+</span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="kw">colData</span>(sce)<span class="op">$</span>type), <span class="dt">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-575-1.png" width="806.4" /></p>
</div>
<div id="differential-expression-between-conditions" class="section level2">
<h2><span class="header-section-number">23.3</span> Differential expression between conditions</h2>
<div id="creating-pseudo-bulk-samples" class="section level3">
<h3><span class="header-section-number">23.3.1</span> Creating pseudo-bulk samples</h3>
<p>The most obvious differential analysis is to look for changes in expression between conditions. We perform the DE analysis separately for each label. The actual DE testing is performed on “pseudo-bulk” expression profiles (Tung et al. 2017), generated by summing counts together for all cells with the same combination of label and sample. This leverages the resolution offered by single-cell technologies to define the labels, and combines it with the statistical rigor of existing methods for DE analyses involving a small number of samples.</p>
<div class="sourceCode" id="cb1744"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1744-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1744-1"></a><span class="co"># Using &#39;label&#39; and &#39;sample&#39; as our two factors; each column of the output</span></span>
<span id="cb1744-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1744-2"></a><span class="co"># corresponds to one unique combination of these two factors.</span></span>
<span id="cb1744-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1744-3"></a>summed &lt;-<span class="st"> </span><span class="kw">aggregateAcrossCells</span>(merged, </span>
<span id="cb1744-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1744-4"></a>                    <span class="dt">id =</span> <span class="kw">DataFrame</span>(</span>
<span id="cb1744-5"><a href="differential-expression-and-abundance-between-conditions.html#cb1744-5"></a>                        <span class="dt">label=</span>merged<span class="op">$</span>clusters.mnn,</span>
<span id="cb1744-6"><a href="differential-expression-and-abundance-between-conditions.html#cb1744-6"></a>                        <span class="dt">sample=</span>merged<span class="op">$</span>Sample.Name2</span>
<span id="cb1744-7"><a href="differential-expression-and-abundance-between-conditions.html#cb1744-7"></a>                    )</span>
<span id="cb1744-8"><a href="differential-expression-and-abundance-between-conditions.html#cb1744-8"></a>)</span>
<span id="cb1744-9"><a href="differential-expression-and-abundance-between-conditions.html#cb1744-9"></a>summed</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 9799 112 
## metadata(2): merge.info pca.info
## assays(1): counts
## rownames(9799): ENSG00000000457 ENSG00000000938 ... ENSG00000285476
##   ENSG00000285486
## rowData names(12): rotation ensembl_gene_id ... detected gene_sparsity
## colnames: NULL
## colData names(11): batch Run ... sample ncells
## reducedDimNames(4): corrected PCA TSNE UMAP
## altExpNames(0):</code></pre>
<div class="sourceCode" id="cb1746"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1746-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1746-1"></a><span class="kw">colData</span>(summed) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## DataFrame with 3 rows and 11 columns
##          batch         Run Sample.Name source_name      block     setName
##    &lt;character&gt; &lt;character&gt; &lt;character&gt;    &lt;factor&gt;   &lt;factor&gt; &lt;character&gt;
## 1 ETV6-RUNX1_1  SRR9264343  GSM3872434  ETV6-RUNX1 ETV6-RUNX1       Caron
## 2 ETV6-RUNX1_2  SRR9264344  GSM3872435  ETV6-RUNX1 ETV6-RUNX1       Caron
## 3 ETV6-RUNX1_3  SRR9264345  GSM3872436  ETV6-RUNX1 ETV6-RUNX1       Caron
##   Sample.Name2 clusters.mnn    label       sample    ncells
##    &lt;character&gt;     &lt;factor&gt; &lt;factor&gt;  &lt;character&gt; &lt;integer&gt;
## 1 ETV6-RUNX1_1           c1       c1 ETV6-RUNX1_1        25
## 2 ETV6-RUNX1_2           c1       c1 ETV6-RUNX1_2        43
## 3 ETV6-RUNX1_3           c1       c1 ETV6-RUNX1_3        22</code></pre>
<p>At this point, it is worth reflecting on the motivations behind the use of pseudo-bulking:</p>
<p>Larger counts are more amenable to standard DE analysis pipelines designed for bulk RNA-seq data. Normalization is more straightforward and certain statistical approximations are more accurate e.g., the saddlepoint approximation for quasi-likelihood methods or normality for linear models.
Collapsing cells into samples reflects the fact that our biological replication occurs at the sample level (Lun and Marioni 2017). Each sample is represented no more than once for each condition, avoiding problems from unmodelled correlations between samples. Supplying the per-cell counts directly to a DE analysis pipeline would imply that each cell is an independent biological replicate, which is not true from an experimental perspective. (A mixed effects model can handle this variance structure but involves extra statistical and computational complexity for little benefit, see Crowell et al. (2019).)
Variance between cells within each sample is masked, provided it does not affect variance across (replicate) samples. This avoids penalizing DEGs that are not uniformly up- or down-regulated for all cells in all samples of one condition. Masking is generally desirable as DEGs - unlike marker genes - do not need to have low within-sample variance to be interesting, e.g., if the treatment effect is consistent across replicate populations but heterogeneous on a per-cell basis. (Of course, high per-cell variability will still result in weaker DE if it affects the variability across populations, while homogeneous per-cell responses will result in stronger DE due to a larger population-level log-fold change. These effects are also largely desirable.)</p>
</div>
<div id="performing-the-de-analysis" class="section level3">
<h3><span class="header-section-number">23.3.2</span> Performing the DE analysis</h3>
<div id="introduction-4" class="section level4">
<h4><span class="header-section-number">23.3.2.1</span> Introduction</h4>
<p>The DE analysis will be performed using quasi-likelihood (QL) methods from the edgeR package (Robinson, McCarthy, and Smyth 2010; Chen, Lun, and Smyth 2016). This uses a negative binomial generalized linear model (NB GLM) to handle overdispersed count data in experiments with limited replication. In our case, we have biological variation with three paired replicates per condition, so edgeR (or its contemporaries) is a natural choice for the analysis.</p>
<p>We do not use all labels for GLM fitting as the strong DE between labels makes it difficult to compute a sensible average abundance to model the mean-dispersion trend. Moreover, label-specific batch effects would not be easily handled with a single additive term in the design matrix for the batch. Instead, we arbitrarily pick one of the labels to use for this demonstration.</p>
<div class="sourceCode" id="cb1748"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1748-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1748-1"></a>labelToGet &lt;-<span class="st"> &quot;c1&quot;</span></span>
<span id="cb1748-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1748-2"></a>current &lt;-<span class="st"> </span>summed[,summed<span class="op">$</span>label<span class="op">==</span>labelToGet]</span>
<span id="cb1748-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1748-3"></a></span>
<span id="cb1748-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1748-4"></a><span class="co"># Creating up a DGEList object for use in edgeR:</span></span>
<span id="cb1748-5"><a href="differential-expression-and-abundance-between-conditions.html#cb1748-5"></a><span class="kw">suppressMessages</span>(<span class="kw">library</span>(edgeR))</span>
<span id="cb1748-6"><a href="differential-expression-and-abundance-between-conditions.html#cb1748-6"></a>y &lt;-<span class="st"> </span><span class="kw">DGEList</span>(<span class="kw">counts</span>(current), <span class="dt">samples=</span><span class="kw">colData</span>(current))</span>
<span id="cb1748-7"><a href="differential-expression-and-abundance-between-conditions.html#cb1748-7"></a>y</span></code></pre></div>
<pre><code>## An object of class &quot;DGEList&quot;
## $counts
##                 Sample1 Sample2 Sample3 Sample4 Sample5 Sample6 Sample7 Sample8
## ENSG00000000457       0       0       0       0       1       0       0       0
## ENSG00000000938       0       0       0       0       0       0       0       0
## ENSG00000001084       0       0       0       0       0       0       0       1
## ENSG00000001461       4       1       0       0       6       2       0       2
## ENSG00000001561       0       1       1       0       0       0       0       0
##                 Sample9 Sample10 Sample11
## ENSG00000000457       0        3        0
## ENSG00000000938       3        0        2
## ENSG00000001084       1        1        0
## ENSG00000001461       0        0        1
## ENSG00000001561       0        0        0
## 9794 more rows ...
## 
## $samples
##         group lib.size norm.factors        batch        Run Sample.Name
## Sample1     1    13148            1 ETV6-RUNX1_1 SRR9264343  GSM3872434
## Sample2     1    24066            1 ETV6-RUNX1_2 SRR9264344  GSM3872435
## Sample3     1    12680            1 ETV6-RUNX1_3 SRR9264345  GSM3872436
## Sample4     1     6784            1 ETV6-RUNX1_4 SRR9264346  GSM3872437
## Sample5     1    49440            1        HHD_1 SRR9264347  GSM3872438
##         source_name      block setName Sample.Name2 clusters.mnn label
## Sample1  ETV6-RUNX1 ETV6-RUNX1   Caron ETV6-RUNX1_1           c1    c1
## Sample2  ETV6-RUNX1 ETV6-RUNX1   Caron ETV6-RUNX1_2           c1    c1
## Sample3  ETV6-RUNX1 ETV6-RUNX1   Caron ETV6-RUNX1_3           c1    c1
## Sample4  ETV6-RUNX1 ETV6-RUNX1   Caron ETV6-RUNX1_4           c1    c1
## Sample5         HHD        HHD   Caron        HHD_1           c1    c1
##               sample ncells
## Sample1 ETV6-RUNX1_1     25
## Sample2 ETV6-RUNX1_2     43
## Sample3 ETV6-RUNX1_3     22
## Sample4 ETV6-RUNX1_4     10
## Sample5        HHD_1     68
## 6 more rows ...</code></pre>
</div>
<div id="pre-processing" class="section level4">
<h4><span class="header-section-number">23.3.2.2</span> Pre-processing</h4>
<p>A typical step in bulk RNA-seq data analyses is to remove samples with very low library sizes due to failed library preparation or sequencing. The very low counts in these samples can be troublesome in downstream steps such as normalization (Chapter 7) or for some statistical approximations used in the DE analysis. In our situation, this is equivalent to removing label-sample combinations that have very few or lowly-sequenced cells. The exact definition of “very low” will vary, but in this case, we remove combinations containing fewer than 20 cells (Crowell et al. 2019). Alternatively, we could apply the outlier-based strategy described in Chapter 6, but this makes the strong assumption that all label-sample combinations have similar numbers of cells that are sequenced to similar depth.</p>
<!--
with 500 cells per samples, some clusters are discarded, which may not be with more cells
-->
<div class="sourceCode" id="cb1750"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1750-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1750-1"></a>discarded &lt;-<span class="st"> </span>current<span class="op">$</span>ncells <span class="op">&lt;</span><span class="st"> </span><span class="dv">20</span></span>
<span id="cb1750-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1750-2"></a>y &lt;-<span class="st"> </span>y[,<span class="op">!</span>discarded]</span>
<span id="cb1750-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1750-3"></a><span class="kw">summary</span>(discarded)</span></code></pre></div>
<pre><code>##    Mode   FALSE    TRUE 
## logical       7       4</code></pre>
<p>Another typical step in bulk RNA-seq analyses is to remove genes that are lowly expressed. This reduces computational work, improves the accuracy of mean-variance trend modelling and decreases the severity of the multiple testing correction. Genes are discarded if they are not expressed above a log-CPM threshold in a minimum number of samples (determined from the size of the smallest treatment group in the experimental design).</p>
<div class="sourceCode" id="cb1752"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1752-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1752-1"></a>keep &lt;-<span class="st"> </span><span class="kw">filterByExpr</span>(y, <span class="dt">group=</span>current<span class="op">$</span>source_name)</span>
<span id="cb1752-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1752-2"></a>y &lt;-<span class="st"> </span>y[keep,]</span>
<span id="cb1752-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1752-3"></a><span class="kw">summary</span>(keep)</span></code></pre></div>
<pre><code>##    Mode   FALSE    TRUE 
## logical    9493     306</code></pre>
<p>Finally, we correct for composition biases by computing normalization factors with the trimmed mean of M-values method (Robinson and Oshlack 2010). We do not need the bespoke single-cell methods described in Chapter 7, as the counts for our pseudo-bulk samples are large enough to apply bulk normalization methods. (Readers should be aware that edgeR normalization factors are closely related but not the same as the size factors described elsewhere in this book.)</p>
<div class="sourceCode" id="cb1754"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1754-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1754-1"></a>y &lt;-<span class="st"> </span><span class="kw">calcNormFactors</span>(y)</span>
<span id="cb1754-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1754-2"></a>y<span class="op">$</span>samples</span></code></pre></div>
<pre><code>##          group lib.size norm.factors        batch        Run Sample.Name
## Sample1      1    13148    0.9721325 ETV6-RUNX1_1 SRR9264343  GSM3872434
## Sample2      1    24066    1.0444534 ETV6-RUNX1_2 SRR9264344  GSM3872435
## Sample3      1    12680    1.0531536 ETV6-RUNX1_3 SRR9264345  GSM3872436
## Sample5      1    49440    1.0410712        HHD_1 SRR9264347  GSM3872438
## Sample6      1    16648    1.0390018        HHD_2 SRR9264348  GSM3872439
## Sample10     1    46484    0.8553093      PRE-T_1 SRR9264349  GSM3872440
## Sample11     1    12372    1.0108201      PRE-T_2 SRR9264350  GSM3872441
##          source_name      block setName Sample.Name2 clusters.mnn label
## Sample1   ETV6-RUNX1 ETV6-RUNX1   Caron ETV6-RUNX1_1           c1    c1
## Sample2   ETV6-RUNX1 ETV6-RUNX1   Caron ETV6-RUNX1_2           c1    c1
## Sample3   ETV6-RUNX1 ETV6-RUNX1   Caron ETV6-RUNX1_3           c1    c1
## Sample5          HHD        HHD   Caron        HHD_1           c1    c1
## Sample6          HHD        HHD   Caron        HHD_2           c1    c1
## Sample10       PRE-T      PRE-T   Caron      PRE-T_1           c1    c1
## Sample11       PRE-T      PRE-T   Caron      PRE-T_2           c1    c1
##                sample ncells
## Sample1  ETV6-RUNX1_1     25
## Sample2  ETV6-RUNX1_2     43
## Sample3  ETV6-RUNX1_3     22
## Sample5         HHD_1     68
## Sample6         HHD_2     22
## Sample10      PRE-T_1     95
## Sample11      PRE-T_2     26</code></pre>
</div>
<div id="statistical-modelling" class="section level4">
<h4><span class="header-section-number">23.3.2.3</span> Statistical modelling</h4>
<p>Our aim is to test whether the log-fold change between sample groups is significantly different from zero.</p>
<div class="sourceCode" id="cb1756"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1756-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1756-1"></a>design &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="op">~</span><span class="kw">factor</span>(source_name), y<span class="op">$</span>samples)</span>
<span id="cb1756-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1756-2"></a>design</span></code></pre></div>
<pre><code>##          (Intercept) factor(source_name)HHD factor(source_name)PRE-T
## Sample1            1                      0                        0
## Sample2            1                      0                        0
## Sample3            1                      0                        0
## Sample5            1                      1                        0
## Sample6            1                      1                        0
## Sample10           1                      0                        1
## Sample11           1                      0                        1
## attr(,&quot;assign&quot;)
## [1] 0 1 1
## attr(,&quot;contrasts&quot;)
## attr(,&quot;contrasts&quot;)$`factor(source_name)`
## [1] &quot;contr.treatment&quot;</code></pre>
<p>We estimate the negative binomial (NB) dispersions with estimateDisp(). The role of the NB dispersion is to model the mean-variance trend, which is not easily accommodated by QL dispersions alone due to the quadratic nature of the NB mean-variance trend.</p>
<div class="sourceCode" id="cb1758"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1758-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1758-1"></a>y &lt;-<span class="st"> </span><span class="kw">estimateDisp</span>(y, design)</span>
<span id="cb1758-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1758-2"></a><span class="kw">summary</span>(y<span class="op">$</span>trended.dispersion)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.2246  0.2573  0.2601  0.2630  0.2754  0.3087</code></pre>
<p>Biological coefficient of variation (BCV) for each gene as a function of the average abundance. The BCV is computed as the square root of the NB dispersion after empirical Bayes shrinkage towards the trend. Trended and common BCV estimates are shown in blue and red, respectively.</p>
<div class="sourceCode" id="cb1760"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1760-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1760-1"></a><span class="kw">plotBCV</span>(y)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-583-1.png" width="672" /></p>
<p>We also estimate the quasi-likelihood dispersions with glmQLFit() (Chen, Lun, and Smyth 2016). This fits a GLM to the counts for each gene and estimates the QL dispersion from the GLM deviance. We set robust=TRUE to avoid distortions from highly variable clusters (Phipson et al. 2016). The QL dispersion models the uncertainty and variability of the per-gene variance - which is not well handled by the NB dispersions, so the two dispersion types complement each other in the final analysis.</p>
<div class="sourceCode" id="cb1761"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1761-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1761-1"></a>fit &lt;-<span class="st"> </span><span class="kw">glmQLFit</span>(y, design, <span class="dt">robust=</span><span class="ot">TRUE</span>)</span>
<span id="cb1761-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1761-2"></a><span class="kw">summary</span>(fit<span class="op">$</span>var.prior)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.3773  0.6253  0.8626  0.7968  0.9437  1.4173</code></pre>
<div class="sourceCode" id="cb1763"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1763-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1763-1"></a><span class="kw">summary</span>(fit<span class="op">$</span>df.prior)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.6626  6.5189  6.5189  6.4172  6.5189  6.5189</code></pre>
<p>QL dispersion estimates for each gene as a function of abundance. Raw estimates (black) are shrunk towards the trend (blue) to yield squeezed estimates (red).</p>
<div class="sourceCode" id="cb1765"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1765-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1765-1"></a><span class="kw">plotQLDisp</span>(fit)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-586-1.png" width="672" /></p>
<p>We test for differences in expression due to sample group using glmQLFTest(). DEGs are defined as those with non-zero log-fold changes at a false discovery rate of 5%. If very few genes are significantly DE that sample group has little effect on the transcriptome.</p>
<div class="sourceCode" id="cb1766"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1766-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1766-1"></a>res &lt;-<span class="st"> </span><span class="kw">glmQLFTest</span>(fit, <span class="dt">coef=</span><span class="kw">ncol</span>(design))</span>
<span id="cb1766-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1766-2"></a><span class="kw">summary</span>(<span class="kw">decideTests</span>(res))</span></code></pre></div>
<pre><code>##        factor(source_name)PRE-T
## Down                         49
## NotSig                      239
## Up                           18</code></pre>
<div class="sourceCode" id="cb1768"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1768-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1768-1"></a>topTab &lt;-<span class="st"> </span><span class="kw">topTags</span>(res)<span class="op">$</span>table</span>
<span id="cb1768-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1768-2"></a>tmpAnnot &lt;-<span class="st"> </span><span class="kw">rowData</span>(current)[,<span class="kw">c</span>(<span class="st">&quot;ensembl_gene_id&quot;</span>,<span class="st">&quot;Symbol&quot;</span>)] <span class="op">%&gt;%</span><span class="st"> </span>data.frame</span>
<span id="cb1768-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1768-3"></a>topTab <span class="op">%&gt;%</span><span class="st"> </span>tibble<span class="op">::</span><span class="kw">rownames_to_column</span>(<span class="st">&quot;ensembl_gene_id&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1768-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1768-4"></a><span class="st">    </span><span class="kw">left_join</span>(tmpAnnot, <span class="dt">by=</span><span class="st">&quot;ensembl_gene_id&quot;</span>)</span></code></pre></div>
<pre><code>##    ensembl_gene_id      logFC   logCPM         F       PValue          FDR
## 1  ENSG00000204287 -10.920567 12.53527 111.58190 1.441355e-06 0.0002141228
## 2  ENSG00000223865  -9.058273 10.77238 102.75490 2.072052e-06 0.0002141228
## 3  ENSG00000105369  -8.975967 10.82307 102.45020 2.099243e-06 0.0002141228
## 4  ENSG00000019582  -9.127507 13.11212  81.27775 2.846380e-06 0.0002177481
## 5  ENSG00000231389  -8.816250 10.54287  84.91085 4.756560e-06 0.0002911015
## 6  ENSG00000196126  -6.882113 11.12680  61.81748 1.011198e-05 0.0005157111
## 7  ENSG00000100721  -8.933679 11.05938  65.55031 1.434612e-05 0.0006271304
## 8  ENSG00000128218  -8.449292 10.17020  58.90560 2.242855e-05 0.0008578920
## 9  ENSG00000081189  -8.652306 10.40569  52.30029 3.661793e-05 0.0012101843
## 10 ENSG00000162511  -3.488401 11.32993  45.51624 3.954851e-05 0.0012101843
##      Symbol
## 1   HLA-DRA
## 2  HLA-DPB1
## 3     CD79A
## 4      CD74
## 5  HLA-DPA1
## 6  HLA-DRB1
## 7     TCL1A
## 8    VPREB3
## 9     MEF2C
## 10   LAPTM5</code></pre>
</div>
<div id="differential-expression-for-each-cluster" class="section level4">
<h4><span class="header-section-number">23.3.2.4</span> Differential expression for each cluster</h4>
<p>The steps illustrated above with cluster c1 are now repeated for each cluster:</p>
<ul>
<li>Subset pseudo-bulk counts for that cluster</li>
<li>Create edgeR object with these pseudo-bulk counts</li>
<li>Pre-process
<ul>
<li>Remove samples with very small library size</li>
<li>Remove genes with low UMI counts</li>
<li>Correct for compositional bias</li>
</ul></li>
<li>Perform differential expression analysis
<ul>
<li>Estimate negative binomial dispersion</li>
<li>Estimate quasi-likelihood dispersion</li>
<li>Test for differential expression</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb1770"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1770-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-1"></a>de.results &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb1770-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-2"></a><span class="cf">for</span> (labelToGet <span class="cf">in</span> <span class="kw">levels</span>(summed<span class="op">$</span>label)) {</span>
<span id="cb1770-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-3"></a></span>
<span id="cb1770-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-4"></a>    current &lt;-<span class="st"> </span>summed[,summed<span class="op">$</span>label<span class="op">==</span>labelToGet]</span>
<span id="cb1770-5"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-5"></a></span>
<span id="cb1770-6"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-6"></a>    y &lt;-<span class="st"> </span><span class="kw">DGEList</span>(<span class="kw">counts</span>(current), <span class="dt">samples=</span><span class="kw">colData</span>(current))</span>
<span id="cb1770-7"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-7"></a></span>
<span id="cb1770-8"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-8"></a>    discarded &lt;-<span class="st"> </span><span class="kw">isOutlier</span>(<span class="kw">colSums</span>(<span class="kw">counts</span>(current)), <span class="dt">log=</span><span class="ot">TRUE</span>, <span class="dt">type=</span><span class="st">&quot;lower&quot;</span>)</span>
<span id="cb1770-9"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-9"></a>    y &lt;-<span class="st"> </span>y[,<span class="op">!</span>discarded]</span>
<span id="cb1770-10"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-10"></a>    y &lt;-<span class="st"> </span>y[<span class="kw">filterByExpr</span>(y, <span class="dt">group=</span>current<span class="op">$</span>source_name),]</span>
<span id="cb1770-11"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-11"></a>    y &lt;-<span class="st"> </span><span class="kw">calcNormFactors</span>(y)</span>
<span id="cb1770-12"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-12"></a></span>
<span id="cb1770-13"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-13"></a>    design &lt;-<span class="st"> </span><span class="kw">try</span>(</span>
<span id="cb1770-14"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-14"></a>        <span class="kw">model.matrix</span>(<span class="op">~</span><span class="kw">factor</span>(source_name), y<span class="op">$</span>samples),</span>
<span id="cb1770-15"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-15"></a>        <span class="dt">silent=</span><span class="ot">TRUE</span></span>
<span id="cb1770-16"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-16"></a>    )</span>
<span id="cb1770-17"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-17"></a>    <span class="cf">if</span> (<span class="kw">is</span>(design, <span class="st">&quot;try-error&quot;</span>) <span class="op">||</span><span class="st"> </span></span>
<span id="cb1770-18"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-18"></a><span class="st">        </span><span class="kw">qr</span>(design)<span class="op">$</span>rank<span class="op">==</span><span class="kw">nrow</span>(design) <span class="op">||</span></span>
<span id="cb1770-19"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-19"></a><span class="st">        </span><span class="kw">qr</span>(design)<span class="op">$</span>rank <span class="op">&lt;</span><span class="st"> </span><span class="kw">ncol</span>(design)) </span>
<span id="cb1770-20"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-20"></a>    {</span>
<span id="cb1770-21"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-21"></a>        <span class="co"># Skipping labels without contrasts or without </span></span>
<span id="cb1770-22"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-22"></a>        <span class="co"># enough residual d.f. to estimate the dispersion.</span></span>
<span id="cb1770-23"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-23"></a>        <span class="cf">next</span></span>
<span id="cb1770-24"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-24"></a>    }</span>
<span id="cb1770-25"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-25"></a></span>
<span id="cb1770-26"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-26"></a>    y &lt;-<span class="st"> </span><span class="kw">estimateDisp</span>(y, design)</span>
<span id="cb1770-27"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-27"></a>    fit &lt;-<span class="st"> </span><span class="kw">glmQLFit</span>(y, design)</span>
<span id="cb1770-28"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-28"></a>    res &lt;-<span class="st"> </span><span class="kw">glmQLFTest</span>(fit, <span class="dt">coef=</span><span class="kw">ncol</span>(design))</span>
<span id="cb1770-29"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-29"></a>    de.results[[labelToGet]] &lt;-<span class="st"> </span>res</span>
<span id="cb1770-30"><a href="differential-expression-and-abundance-between-conditions.html#cb1770-30"></a>}</span></code></pre></div>
<div id="number-of-degs-by-cluster-and-direction" class="section level5">
<h5><span class="header-section-number">23.3.2.4.1</span> Number of DEGs by cluster and direction</h5>
<p>We examine the numbers of DEGs at a FDR of 5% for each label (i.e. cluster). In general, there seems to be very little differential expression between the on and off conditions.</p>
<div class="sourceCode" id="cb1771"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1771-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1771-1"></a>summaries &lt;-<span class="st"> </span><span class="kw">lapply</span>(de.results, <span class="dt">FUN=</span><span class="cf">function</span>(x) <span class="kw">summary</span>(<span class="kw">decideTests</span>(x))[,<span class="dv">1</span>])</span>
<span id="cb1771-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1771-2"></a>sum.tab &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, summaries)</span>
<span id="cb1771-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1771-3"></a><span class="co">#sum.tab</span></span>
<span id="cb1771-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1771-4"></a>sum.tab[<span class="kw">order</span>(<span class="kw">rownames</span>(sum.tab)),] <span class="op">%&gt;%</span></span>
<span id="cb1771-5"><a href="differential-expression-and-abundance-between-conditions.html#cb1771-5"></a><span class="st">    </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb1771-6"><a href="differential-expression-and-abundance-between-conditions.html#cb1771-6"></a><span class="st">    </span>tibble<span class="op">::</span><span class="kw">rownames_to_column</span>(<span class="st">&quot;Cluster&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1771-7"><a href="differential-expression-and-abundance-between-conditions.html#cb1771-7"></a><span class="st">    </span><span class="kw">datatable</span>(<span class="dt">rownames =</span> <span class="ot">FALSE</span>, <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">pageLength =</span> <span class="dv">20</span>, <span class="dt">scrollX =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<div id="htmlwidget-b4f45dd6136c26de5738" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b4f45dd6136c26de5738">{"x":{"filter":"none","data":[["c1","c10","c11","c2","c3","c4","c5","c6","c7","c8","c9"],[38,9,1,0,363,64,207,107,0,202,16],[252,287,1338,153,2088,1355,2004,3250,242,1001,489],[15,12,2,0,235,88,43,3,1,131,7]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Cluster<\/th>\n      <th>Down<\/th>\n      <th>NotSig<\/th>\n      <th>Up<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="list-of-degs" class="section level5">
<h5><span class="header-section-number">23.3.2.4.2</span> List of DEGs</h5>
<p>We now list DEGs and the number of clusters they were detected in:</p>
<div class="sourceCode" id="cb1772"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1772-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1772-1"></a>degs &lt;-<span class="st"> </span><span class="kw">lapply</span>(de.results, <span class="dt">FUN=</span><span class="cf">function</span>(x) <span class="kw">rownames</span>(<span class="kw">topTags</span>(x, <span class="dt">p.value=</span><span class="fl">0.05</span>)))</span>
<span id="cb1772-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1772-2"></a>common.degs &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">table</span>(<span class="kw">unlist</span>(degs)), <span class="dt">decreasing=</span><span class="ot">TRUE</span>)</span>
<span id="cb1772-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1772-3"></a><span class="co">#head(common.degs, 20)</span></span>
<span id="cb1772-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1772-4"></a>common.degs <span class="op">%&gt;%</span></span>
<span id="cb1772-5"><a href="differential-expression-and-abundance-between-conditions.html#cb1772-5"></a><span class="st">    </span>as.data.frame <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1772-6"><a href="differential-expression-and-abundance-between-conditions.html#cb1772-6"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">ensembl_gene_id =</span> Var1, <span class="dt">NbClu =</span> Freq) <span class="op">%&gt;%</span></span>
<span id="cb1772-7"><a href="differential-expression-and-abundance-between-conditions.html#cb1772-7"></a><span class="st">    </span><span class="kw">left_join</span>(</span>
<span id="cb1772-8"><a href="differential-expression-and-abundance-between-conditions.html#cb1772-8"></a>    <span class="kw">data.frame</span>(<span class="kw">rowData</span>(summed)[,<span class="kw">c</span>(<span class="st">&quot;ensembl_gene_id&quot;</span>, <span class="st">&quot;Symbol&quot;</span>)]),</span>
<span id="cb1772-9"><a href="differential-expression-and-abundance-between-conditions.html#cb1772-9"></a>    <span class="dt">by=</span><span class="st">&quot;ensembl_gene_id&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1772-10"><a href="differential-expression-and-abundance-between-conditions.html#cb1772-10"></a><span class="st">    </span><span class="co">#rename(Gene = ensembl_gene_id) %&gt;%</span></span>
<span id="cb1772-11"><a href="differential-expression-and-abundance-between-conditions.html#cb1772-11"></a><span class="st">    </span><span class="kw">relocate</span>(<span class="kw">c</span>(<span class="st">&quot;Symbol&quot;</span>,<span class="st">&quot;NbClu&quot;</span>,<span class="st">&quot;ensembl_gene_id&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1772-12"><a href="differential-expression-and-abundance-between-conditions.html#cb1772-12"></a><span class="st">    </span><span class="kw">datatable</span>(<span class="dt">rownames =</span> <span class="ot">FALSE</span>, <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">pageLength =</span> <span class="dv">20</span>, <span class="dt">scrollX =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<div id="htmlwidget-b64f577eace7aae6190e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b64f577eace7aae6190e">{"x":{"filter":"none","data":[["FXYD2","CD74","CHI3L2","TCL1A","CD3D","HLA-DRA","MEF2C","SOCS2","TERF2","CD3G","CD7","HLA-DRB1","HLA-DMA","HLA-DPB1","RPS4Y2","TCF7","CD79A","CTGF","IFIT3","SOX4","VPREB3","TMCC2","LDHA","RCBTB2","HMGA1","S100A8","HHEX","LAPTM5","S100A9","MYO7B","MZB1","MAL","MARCKSL1","SLC35E3","GNG7","CD19","ISG15","HIST1H1C","H1F0","S100A4","HBG2","LYPD2","ARMH1","CD3E","HLA-A","TRBC1","TRBC2","HBG1","MIR181A1HG","HLA-DPA1","HLA-B","HLA-DMB","AC084033.3","CASC15","CD24","UHRF1","CCL3"],[5,4,4,4,4,3,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],["ENSG00000137731","ENSG00000019582","ENSG00000064886","ENSG00000100721","ENSG00000167286","ENSG00000204287","ENSG00000081189","ENSG00000120833","ENSG00000132604","ENSG00000160654","ENSG00000173762","ENSG00000196126","ENSG00000204257","ENSG00000223865","ENSG00000280969","ENSG00000081059","ENSG00000105369","ENSG00000118523","ENSG00000119917","ENSG00000124766","ENSG00000128218","ENSG00000133069","ENSG00000134333","ENSG00000136161","ENSG00000137309","ENSG00000143546","ENSG00000152804","ENSG00000162511","ENSG00000163220","ENSG00000169994","ENSG00000170476","ENSG00000172005","ENSG00000175130","ENSG00000175782","ENSG00000176533","ENSG00000177455","ENSG00000187608","ENSG00000187837","ENSG00000189060","ENSG00000196154","ENSG00000196565","ENSG00000197353","ENSG00000198520","ENSG00000198851","ENSG00000206503","ENSG00000211751","ENSG00000211772","ENSG00000213934","ENSG00000229989","ENSG00000231389","ENSG00000234745","ENSG00000242574","ENSG00000257698","ENSG00000272168","ENSG00000272398","ENSG00000276043","ENSG00000277632"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Symbol<\/th>\n      <th>NbClu<\/th>\n      <th>ensembl_gene_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="number-of-clusters-skipped" class="section level5">
<h5><span class="header-section-number">23.3.2.4.3</span> Number of clusters skipped</h5>
<p>“We also list the labels that were skipped due to the absence of replicates or contrasts. If it is necessary to extract statistics in the absence of replicates, several strategies can be applied such as reducing the complexity of the model or using a predefined value for the NB dispersion. We refer readers to the edgeR user’s guide for more details.”</p>
<div class="sourceCode" id="cb1773"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1773-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1773-1"></a>skippedClusters &lt;-<span class="st"> </span><span class="kw">setdiff</span>(<span class="kw">unique</span>(summed<span class="op">$</span>label), <span class="kw">names</span>(summaries))</span></code></pre></div>
<p>The number of clusters skipped is 0.</p>
<div class="sourceCode" id="cb1774"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1774-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1774-1"></a><span class="cf">if</span>(<span class="kw">length</span>(skippedClusters)<span class="op">&gt;</span><span class="dv">0</span>)</span>
<span id="cb1774-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1774-2"></a>{</span>
<span id="cb1774-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1774-3"></a>  skippedClusters</span>
<span id="cb1774-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1774-4"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb1775"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1775-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-1"></a>grmToShowList &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dt">length =</span> <span class="kw">nlevels</span>(merged<span class="op">$</span>clusters.mnn))</span>
<span id="cb1775-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-2"></a><span class="kw">names</span>(grmToShowList) &lt;-<span class="st"> </span><span class="kw">levels</span>(merged<span class="op">$</span>clusters.mnn)</span>
<span id="cb1775-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-3"></a>genesToExclude &lt;-<span class="st"> </span><span class="kw">c</span>()</span>
<span id="cb1775-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-4"></a>nbGeneToShow &lt;-<span class="st"> </span><span class="dv">20</span></span>
<span id="cb1775-5"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-5"></a></span>
<span id="cb1775-6"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-6"></a><span class="co">#degs &lt;- lapply(de.results, FUN=function(x) (topTags(x, p.value=0.05)))</span></span>
<span id="cb1775-7"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-7"></a>degs &lt;-<span class="st"> </span><span class="kw">lapply</span>(de.results, <span class="dt">FUN=</span><span class="cf">function</span>(x) (<span class="kw">as.data.frame</span>(<span class="kw">topTags</span>(x, <span class="dt">n=</span>nbGeneToShow))))</span>
<span id="cb1775-8"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-8"></a></span>
<span id="cb1775-9"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-9"></a><span class="cf">for</span>( namex <span class="cf">in</span> <span class="kw">levels</span>(merged<span class="op">$</span>clusters.mnn) )</span>
<span id="cb1775-10"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-10"></a>{</span>
<span id="cb1775-11"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-11"></a>    nbGeneToUse &lt;-<span class="st"> </span><span class="kw">min</span>(<span class="kw">c</span>(<span class="kw">nrow</span>(degs[[namex]]), nbGeneToShow))</span>
<span id="cb1775-12"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-12"></a></span>
<span id="cb1775-13"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-13"></a>    <span class="co"># format</span></span>
<span id="cb1775-14"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-14"></a></span>
<span id="cb1775-15"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-15"></a>    <span class="co"># format p value:</span></span>
<span id="cb1775-16"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-16"></a>    tmpCol &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;PValue|FDR&quot;</span>, <span class="kw">colnames</span>(degs[[namex]]), <span class="dt">value=</span><span class="ot">TRUE</span>)</span>
<span id="cb1775-17"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-17"></a>    degs[[namex]][,tmpCol] &lt;-<span class="st"> </span><span class="kw">apply</span>(degs[[namex]][,tmpCol],</span>
<span id="cb1775-18"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-18"></a>                         <span class="dv">2</span>,</span>
<span id="cb1775-19"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-19"></a>                         <span class="cf">function</span>(x){<span class="kw">format</span>(x, <span class="dt">scientific =</span> <span class="ot">TRUE</span>, <span class="dt">digits =</span> <span class="dv">1</span>)})</span>
<span id="cb1775-20"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-20"></a>    <span class="co"># format logFC:</span></span>
<span id="cb1775-21"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-21"></a>    tmpCol &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;logFC&quot;</span>, <span class="st">&quot;logCPM&quot;</span>, <span class="st">&quot;F&quot;</span>)</span>
<span id="cb1775-22"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-22"></a>    degs[[namex]][,tmpCol] &lt;-<span class="st"> </span><span class="kw">apply</span>(degs[[namex]][,tmpCol], <span class="dv">2</span>,  <span class="cf">function</span>(x){<span class="kw">round</span>(x, <span class="dv">2</span>)})</span>
<span id="cb1775-23"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-23"></a>    <span class="kw">rm</span>(tmpCol)</span>
<span id="cb1775-24"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-24"></a></span>
<span id="cb1775-25"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-25"></a>    <span class="co"># subset data</span></span>
<span id="cb1775-26"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-26"></a>    grmToShow &lt;-<span class="st"> </span>degs[[namex]] <span class="op">%&gt;%</span></span>
<span id="cb1775-27"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-27"></a><span class="st">        </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb1775-28"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-28"></a><span class="st">        </span>tibble<span class="op">::</span><span class="kw">rownames_to_column</span>(<span class="st">&quot;gene&quot;</span>) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb1775-29"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-29"></a><span class="st">        </span><span class="kw">arrange</span>(FDR, <span class="kw">desc</span>(<span class="kw">abs</span>(logFC))) <span class="op">%&gt;%</span></span>
<span id="cb1775-30"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-30"></a><span class="st">        </span><span class="kw">filter</span>(<span class="op">!</span><span class="st"> </span>gene <span class="op">%in%</span><span class="st"> </span>genesToExclude) <span class="op">%&gt;%</span></span>
<span id="cb1775-31"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-31"></a><span class="st">        </span><span class="kw">group_modify</span>(<span class="op">~</span><span class="st"> </span><span class="kw">head</span>(.x, nbGeneToUse)) </span>
<span id="cb1775-32"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-32"></a>    <span class="co"># keep data</span></span>
<span id="cb1775-33"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-33"></a>    grmToShow<span class="op">$</span>cluster &lt;-<span class="st"> </span>namex</span>
<span id="cb1775-34"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-34"></a>    grmToShowList[[namex]] &lt;-<span class="st"> </span>grmToShow</span>
<span id="cb1775-35"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-35"></a>    <span class="co"># tidy</span></span>
<span id="cb1775-36"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-36"></a>    <span class="kw">rm</span>(nbGeneToUse)</span>
<span id="cb1775-37"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-37"></a>}</span>
<span id="cb1775-38"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-38"></a>grmToShowDf &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&quot;rbind&quot;</span>, grmToShowList)</span>
<span id="cb1775-39"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-39"></a>tmpCol &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;cluster&quot;</span>, <span class="st">&quot;gene&quot;</span>)</span>
<span id="cb1775-40"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-40"></a>grmToShowDf <span class="op">%&gt;%</span></span>
<span id="cb1775-41"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-41"></a><span class="st">    </span><span class="kw">select</span>(tmpCol, <span class="kw">setdiff</span>(<span class="kw">colnames</span>(grmToShowDf), tmpCol)) <span class="op">%&gt;%</span></span>
<span id="cb1775-42"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-42"></a><span class="st">    </span><span class="kw">filter</span>(gene <span class="op">%in%</span><span class="st"> </span><span class="kw">names</span>(common.degs) <span class="op">&amp;</span><span class="st"> </span><span class="kw">as.numeric</span>(FDR) <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>) <span class="op">%&gt;%</span></span>
<span id="cb1775-43"><a href="differential-expression-and-abundance-between-conditions.html#cb1775-43"></a><span class="st">    </span><span class="kw">datatable</span>(<span class="dt">rownames =</span> <span class="ot">FALSE</span>, <span class="dt">filter=</span><span class="st">&quot;top&quot;</span>, <span class="dt">options=</span><span class="kw">list</span>(<span class="dt">scrollX =</span> <span class="ot">TRUE</span>, <span class="dt">pageLength =</span> <span class="dv">15</span>))</span></code></pre></div>
<div id="htmlwidget-4ccd7d9b72449fc7b4fe" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4ccd7d9b72449fc7b4fe">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"-12.82\" data-max=\"13.59\" data-scale=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"5.38\" data-max=\"14.15\" data-scale=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"12.56\" data-max=\"243.99\" data-scale=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["c1","c1","c1","c1","c1","c1","c1","c1","c1","c1","c1","c1","c1","c1","c1","c1","c10","c10","c10","c10","c10","c10","c10","c10","c10","c10","c10","c10","c10","c11","c11","c3","c3","c3","c3","c3","c3","c3","c3","c3","c3","c3","c3","c3","c3","c3","c4","c4","c4","c4","c4","c4","c4","c4","c4","c4","c5","c5","c5","c5","c5","c5","c5","c5","c5","c5","c5","c5","c5","c5","c5","c6","c6","c6","c6","c6","c6","c6","c6","c6","c6","c6","c6","c7","c8","c8","c8","c8","c8","c8","c8","c8","c8","c8","c8","c8","c8","c8","c9","c9","c9","c9","c9","c9","c9","c9","c9","c9","c9"],["ENSG00000272398","ENSG00000081189","ENSG00000204257","ENSG00000105369","ENSG00000223865","ENSG00000231389","ENSG00000128218","ENSG00000196126","ENSG00000100721","ENSG00000137731","ENSG00000211772","ENSG00000204287","ENSG00000019582","ENSG00000162511","ENSG00000167286","ENSG00000177455","ENSG00000064886","ENSG00000196126","ENSG00000204287","ENSG00000234745","ENSG00000137731","ENSG00000167286","ENSG00000223865","ENSG00000019582","ENSG00000081189","ENSG00000124766","ENSG00000211772","ENSG00000206503","ENSG00000211751","ENSG00000197353","ENSG00000143546","ENSG00000242574","ENSG00000100721","ENSG00000167286","ENSG00000064886","ENSG00000137731","ENSG00000173762","ENSG00000081059","ENSG00000128218","ENSG00000081189","ENSG00000231389","ENSG00000176533","ENSG00000172005","ENSG00000204257","ENSG00000152804","ENSG00000272398","ENSG00000136161","ENSG00000257698","ENSG00000064886","ENSG00000169994","ENSG00000272168","ENSG00000229989","ENSG00000019582","ENSG00000124766","ENSG00000170476","ENSG00000137731","ENSG00000280969","ENSG00000160654","ENSG00000172005","ENSG00000211751","ENSG00000128218","ENSG00000167286","ENSG00000162511","ENSG00000081059","ENSG00000169994","ENSG00000105369","ENSG00000064886","ENSG00000120833","ENSG00000137731","ENSG00000132604","ENSG00000100721","ENSG00000204287","ENSG00000132604","ENSG00000280969","ENSG00000276043","ENSG00000118523","ENSG00000198520","ENSG00000175130","ENSG00000189060","ENSG00000134333","ENSG00000175782","ENSG00000137309","ENSG00000231389","ENSG00000277632","ENSG00000172005","ENSG00000160654","ENSG00000173762","ENSG00000137731","ENSG00000167286","ENSG00000242574","ENSG00000177455","ENSG00000120833","ENSG00000272398","ENSG00000198851","ENSG00000204257","ENSG00000064886","ENSG00000128218","ENSG00000105369","ENSG00000100721","ENSG00000213934","ENSG00000211772","ENSG00000196565","ENSG00000204287","ENSG00000133069","ENSG00000187837","ENSG00000196154","ENSG00000119917","ENSG00000187608","ENSG00000019582"],[-5.29,-7.98,-7.39,-8.6,-8.44,-8.23,-8.15,-6.78,-8.27,8.23,5.5,-10.28,-8.96,-3.24,8.36,-6.97,10.82,-6.87,-6.51,-3.48,10.16,10.1,-5.82,-5.52,-5.39,4.42,3.61,-2.1,10.06,-8.39,13.59,-9.74,-12.82,10.38,9.9,9.37,6.85,5.42,-12,-11.01,-10.14,-9.83,8.5,-8.31,-7.78,-10.5,6.22,5.05,4.93,8.8,5.64,5.12,-4,3.93,3.81,8.53,-10.59,6.56,6.43,6.41,-6.39,4.72,-4.2,3.48,5.06,-4.79,8.56,-10.91,9.76,-10.94,-7.42,-2.32,-6.23,-4.69,-6.05,-9.6,-5.38,-4.35,-10.46,-8.99,-4.81,-4.04,-2.75,5.41,11.14,10.17,10.15,10.01,9.63,-9.11,-8.8,-8.7,-8.07,7.99,-6.88,12.28,-10.88,-9.17,-8.21,-12.62,4.37,-5.74,-9.27,-6.87,-6.05,4.42,-8.59,-6.32,-4.86],[10.59,10.28,9.92,10.96,10.82,10.66,10.91,11.23,11.02,9.32,9.45,12.59,13.21,11.28,9.6,9.49,10.01,9.64,10.22,11.91,9.43,9.42,9.19,11.73,9.06,9.98,9.89,11.28,9.37,8.96,14.15,7.92,11.52,9.25,9.55,9.3,6.9,7.81,10.4,9.29,10.33,7.92,7.86,9.12,7.67,10.56,8.98,8.06,9.46,7.29,7.23,7.38,9.33,9.82,7.93,8.98,9.93,6.13,5.9,8.37,11.08,7.36,11.8,7.37,7.31,11.2,8.27,10.09,7.13,10.05,12.21,13.27,10.57,10.83,10.36,9.4,9.94,10.68,10.13,9.16,9.69,9.41,11.36,10.78,8.8,7.98,8.01,9.49,9.35,8.27,7.78,9.22,9.12,7.9,9.06,9.83,9.68,10.33,6.64,10.74,5.38,12.71,7.49,8.5,8.76,9.08,6.76,7.86,8.19],[27.29,42.97,44.35,75.03,75.44,67.97,68.17,67.9,61.79,49.37,35.63,103.08,97.21,33.41,35.32,32.17,39.63,32.08,32.26,36.53,35.46,32.39,22.81,22.4,21.8,21.11,24.38,24.59,18.69,17.45,28.57,114.2,219.36,170.45,243.99,167.06,158.23,150.51,143.76,161.75,127.52,146.16,144.79,137.53,131.44,111.64,50.89,53.22,48.05,56.51,42.09,37.85,37.43,37.74,35.26,89.81,40.79,40.54,38.64,44.05,36.84,37.82,38.03,37.15,32.7,31.55,86.64,53.08,83.79,46.57,44.74,24.69,44.31,42.86,40.08,38.22,33.84,33.26,29.93,31.37,28.22,27.92,25.91,61.22,106.43,90.17,96.93,109.06,107.91,88.93,82.16,75.51,69.57,74.7,68.47,127.63,65.67,64.25,14.94,24.59,12.56,22.35,19.6,18.73,18.8,19.93,16.99,17.04,15.57],["7e-05","8e-06","6e-06","2e-07","2e-07","5e-07","4e-07","3e-07","8e-07","2e-05","2e-05","3e-08","2e-08","2e-05","4e-05","4e-05","2e-04","2e-04","2e-04","1e-04","7e-04","4e-04","7e-04","7e-04","8e-04","9e-04","5e-04","5e-04","2e-03","6e-05","5e-07","8e-08","1e-09","3e-09","8e-10","3e-09","5e-09","7e-09","2e-08","1e-08","2e-08","2e-08","2e-08","1e-08","2e-08","4e-08","4e-07","3e-07","6e-07","9e-07","2e-06","3e-06","4e-06","4e-06","6e-06","5e-09","4e-06","5e-06","7e-06","3e-06","6e-06","5e-06","5e-06","5e-06","1e-05","2e-05","1e-08","6e-07","5e-08","1e-06","1e-06","6e-05","1e-06","1e-06","2e-06","5e-06","7e-06","8e-06","2e-05","2e-05","2e-05","3e-05","4e-05","7e-07","2e-07","3e-07","2e-07","4e-08","5e-08","9e-08","1e-07","2e-07","3e-07","2e-07","3e-07","4e-07","6e-07","5e-07","2e-04","3e-06","6e-04","7e-06","2e-05","3e-05","3e-05","2e-05","7e-05","7e-05","1e-04"],["1e-03","2e-04","2e-04","2e-05","2e-05","2e-05","2e-05","2e-05","3e-05","4e-04","4e-04","4e-06","4e-06","5e-04","8e-04","8e-04","1e-02","1e-02","1e-02","1e-02","2e-02","2e-02","2e-02","2e-02","2e-02","2e-02","2e-02","2e-02","4e-02","4e-02","6e-04","1e-05","2e-06","2e-06","2e-06","2e-06","3e-06","3e-06","4e-06","4e-06","4e-06","4e-06","4e-06","4e-06","4e-06","7e-06","2e-04","2e-04","2e-04","3e-04","5e-04","6e-04","6e-04","6e-04","8e-04","8e-06","1e-03","1e-03","1e-03","1e-03","1e-03","1e-03","1e-03","1e-03","2e-03","2e-03","3e-05","4e-04","5e-05","7e-04","7e-04","1e-02","2e-03","2e-03","3e-03","4e-03","5e-03","5e-03","8e-03","8e-03","8e-03","8e-03","9e-03","2e-04","3e-05","3e-05","3e-05","3e-05","3e-05","3e-05","3e-05","3e-05","3e-05","3e-05","3e-05","4e-05","4e-05","4e-05","1e-02","1e-03","2e-02","2e-03","3e-03","3e-03","3e-03","3e-03","5e-03","5e-03","8e-03"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>cluster<\/th>\n      <th>gene<\/th>\n      <th>logFC<\/th>\n      <th>logCPM<\/th>\n      <th>F<\/th>\n      <th>PValue<\/th>\n      <th>FDR<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"pageLength":15,"columnDefs":[{"className":"dt-right","targets":[2,3,4]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[10,15,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb1776"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1776-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1776-1"></a>tmpBool &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(grmToShowDf<span class="op">$</span>FDR) <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span> </span>
<span id="cb1776-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1776-2"></a>markers.to.plot &lt;-<span class="st"> </span><span class="kw">unique</span>(grmToShowDf[tmpBool, <span class="st">&quot;gene&quot;</span>])</span>
<span id="cb1776-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1776-3"></a>markers.to.plot &lt;-<span class="st"> </span>markers.to.plot[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</span></code></pre></div>
</div>
</div>
</div>
<div id="putting-it-all-together" class="section level3">
<h3><span class="header-section-number">23.3.3</span> Putting it all together</h3>
<p>Now that we have laid out the theory underlying the DE analysis, we repeat this process for each of the labels. This is conveniently done using the pseudoBulkDGE() function from scran, which will loop over all labels and apply the exact analysis described above to each label. To prepare for this, we filter out all sample-label combinations with insufficient cells.</p>
<div class="sourceCode" id="cb1777"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1777-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1777-1"></a>summed.filt &lt;-<span class="st"> </span>summed[,summed<span class="op">$</span>ncells <span class="op">&gt;=</span><span class="st"> </span><span class="dv">20</span>]</span></code></pre></div>
<p>We construct a common design matrix that will be used in the analysis for each label. Recall that this matrix should have one row per unique sample (and named as such), reflecting the fact that we are modelling counts on the sample level instead of the cell level.</p>
<div class="sourceCode" id="cb1778"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1778-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1778-1"></a><span class="co"># Pulling out a sample-level &#39;targets&#39; data.frame:</span></span>
<span id="cb1778-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1778-2"></a>targets &lt;-<span class="st"> </span><span class="kw">colData</span>(merged)[<span class="op">!</span><span class="kw">duplicated</span>(merged<span class="op">$</span>Sample.Name2),]</span>
<span id="cb1778-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1778-3"></a></span>
<span id="cb1778-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1778-4"></a><span class="co"># Constructing the design matrix:</span></span>
<span id="cb1778-5"><a href="differential-expression-and-abundance-between-conditions.html#cb1778-5"></a>design &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="op">~</span><span class="kw">factor</span>(source_name), <span class="dt">data=</span>targets)</span>
<span id="cb1778-6"><a href="differential-expression-and-abundance-between-conditions.html#cb1778-6"></a><span class="kw">rownames</span>(design) &lt;-<span class="st"> </span>targets<span class="op">$</span>Sample.Name2</span></code></pre></div>
<p>We then apply the pseudoBulkDGE() function to obtain a list of DE genes for each label. This function puts some additional effort into automatically dealing with labels that are not represented in all sample groups, for which a DE analysis between conditions is meaningless; or are not represented in a sufficient number of replicate samples to enable modelling of biological variability.</p>
<div class="sourceCode" id="cb1779"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1779-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1779-1"></a><span class="kw">library</span>(scran)</span>
<span id="cb1779-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1779-2"></a>de.results &lt;-<span class="st"> </span><span class="kw">pseudoBulkDGE</span>(summed.filt, </span>
<span id="cb1779-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1779-3"></a>    <span class="dt">sample=</span>summed.filt<span class="op">$</span>Sample.Name2,</span>
<span id="cb1779-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1779-4"></a>    <span class="dt">label=</span>summed.filt<span class="op">$</span>label,</span>
<span id="cb1779-5"><a href="differential-expression-and-abundance-between-conditions.html#cb1779-5"></a>    <span class="dt">design=</span>design,</span>
<span id="cb1779-6"><a href="differential-expression-and-abundance-between-conditions.html#cb1779-6"></a>    <span class="dt">coef=</span><span class="kw">ncol</span>(design),</span>
<span id="cb1779-7"><a href="differential-expression-and-abundance-between-conditions.html#cb1779-7"></a></span>
<span id="cb1779-8"><a href="differential-expression-and-abundance-between-conditions.html#cb1779-8"></a>    <span class="co"># &#39;condition&#39; sets the group size for filterByExpr(),</span></span>
<span id="cb1779-9"><a href="differential-expression-and-abundance-between-conditions.html#cb1779-9"></a>    <span class="co"># to perfectly mimic our previous manual analysis.</span></span>
<span id="cb1779-10"><a href="differential-expression-and-abundance-between-conditions.html#cb1779-10"></a>    <span class="dt">condition=</span>targets<span class="op">$</span>source_name </span>
<span id="cb1779-11"><a href="differential-expression-and-abundance-between-conditions.html#cb1779-11"></a>)</span></code></pre></div>
<p>We examine the numbers of DEGs at a FDR of 5% for each label using the decideTestsPerLabel() function. Note that genes listed as NA were either filtered out as low-abundance genes for a given label’s analysis, or the comparison of interest was not possible for a particular label, e.g., due to lack of residual degrees of freedom or an absence of samples from both conditions.</p>
<div class="sourceCode" id="cb1780"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1780-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1780-1"></a>is.de &lt;-<span class="st"> </span><span class="kw">decideTestsPerLabel</span>(de.results, <span class="dt">threshold=</span><span class="fl">0.05</span>)</span>
<span id="cb1780-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1780-2"></a><span class="kw">summarizeTestsPerLabel</span>(is.de)</span></code></pre></div>
<pre><code>##     -1    0   1   NA
## c3 393 2805 257 6344
## c4  38 2374 100 7287
## c5 107 3080  58 6554
## c8 281 3865 129 5524</code></pre>
<p>For each gene, we compute the percentage of cell types in which that gene is upregulated or downregulated. (Here, we consider a gene to be non-DE if it is not retained after filtering.).</p>
<div class="sourceCode" id="cb1782"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1782-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1782-1"></a><span class="co"># Upregulated across most cell types.</span></span>
<span id="cb1782-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1782-2"></a>up.de &lt;-<span class="st"> </span>is.de <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(is.de)</span>
<span id="cb1782-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1782-3"></a><span class="kw">head</span>(<span class="kw">sort</span>(<span class="kw">rowMeans</span>(up.de), <span class="dt">decreasing=</span><span class="ot">TRUE</span>), <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## ENSG00000064886 ENSG00000066294 ENSG00000128918 ENSG00000137731 ENSG00000169994 
##            1.00            1.00            1.00            1.00            1.00 
## ENSG00000172005 ENSG00000229140 ENSG00000236283 ENSG00000005844 ENSG00000077782 
##            1.00            1.00            1.00            0.75            0.75</code></pre>
<div class="sourceCode" id="cb1784"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1784-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1784-1"></a><span class="co"># Downregulated across cell types.</span></span>
<span id="cb1784-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1784-2"></a>down.de &lt;-<span class="st"> </span>is.de <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(is.de)</span>
<span id="cb1784-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1784-3"></a><span class="kw">head</span>(<span class="kw">sort</span>(<span class="kw">rowMeans</span>(down.de), <span class="dt">decreasing=</span><span class="ot">TRUE</span>), <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## ENSG00000100721 ENSG00000196126 ENSG00000234745 ENSG00000007312 ENSG00000007944 
##            1.00            1.00            1.00            0.75            0.75 
## ENSG00000010671 ENSG00000012124 ENSG00000012779 ENSG00000015413 ENSG00000019582 
##            0.75            0.75            0.75            0.75            0.75</code></pre>
<p>We further identify label-specific DE genes that are significant in our label of interest yet not DE in any other label. As hypothesis tests are not typically geared towards identifying genes that are not DE, we use an ad hoc approach where we consider a gene to be consistent with the null hypothesis for a label if it fails to be detected even at a generous FDR threshold of 50%.</p>
<div class="sourceCode" id="cb1786"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1786-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1786-1"></a>remotely.de &lt;-<span class="st"> </span><span class="kw">decideTestsPerLabel</span>(de.results, <span class="dt">threshold=</span><span class="fl">0.5</span>)</span>
<span id="cb1786-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1786-2"></a>not.de &lt;-<span class="st"> </span>remotely.de<span class="op">==</span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(remotely.de)</span>
<span id="cb1786-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1786-3"></a></span>
<span id="cb1786-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1786-4"></a><span class="co"># first cluster in is.de</span></span>
<span id="cb1786-5"><a href="differential-expression-and-abundance-between-conditions.html#cb1786-5"></a>cx &lt;-<span class="st"> </span><span class="kw">colnames</span>(is.de)[<span class="dv">1</span>]</span>
<span id="cb1786-6"><a href="differential-expression-and-abundance-between-conditions.html#cb1786-6"></a>other.labels &lt;-<span class="st"> </span><span class="kw">setdiff</span>(<span class="kw">colnames</span>(not.de), cx)</span>
<span id="cb1786-7"><a href="differential-expression-and-abundance-between-conditions.html#cb1786-7"></a>unique.degs &lt;-<span class="st"> </span>is.de[,cx]<span class="op">!=</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">rowMeans</span>(not.de[,other.labels])<span class="op">==</span><span class="dv">1</span></span>
<span id="cb1786-8"><a href="differential-expression-and-abundance-between-conditions.html#cb1786-8"></a>unique.degs &lt;-<span class="st"> </span><span class="kw">names</span>(<span class="kw">which</span>(unique.degs))</span>
<span id="cb1786-9"><a href="differential-expression-and-abundance-between-conditions.html#cb1786-9"></a><span class="kw">head</span>(unique.degs)</span></code></pre></div>
<pre><code>## [1] &quot;ENSG00000035720&quot; &quot;ENSG00000107551&quot; &quot;ENSG00000112306&quot; &quot;ENSG00000114374&quot;
## [5] &quot;ENSG00000114942&quot; &quot;ENSG00000122786&quot;</code></pre>
<div class="sourceCode" id="cb1788"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1788-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1788-1"></a><span class="co"># 2nd cluster in is.de</span></span>
<span id="cb1788-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1788-2"></a>cx &lt;-<span class="st"> </span><span class="kw">colnames</span>(is.de)[<span class="dv">2</span>]</span>
<span id="cb1788-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1788-3"></a>other.labels &lt;-<span class="st"> </span><span class="kw">setdiff</span>(<span class="kw">colnames</span>(not.de), cx)</span>
<span id="cb1788-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1788-4"></a>unique.degs &lt;-<span class="st"> </span>is.de[,cx]<span class="op">!=</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">rowMeans</span>(not.de[,other.labels])<span class="op">==</span><span class="dv">1</span></span>
<span id="cb1788-5"><a href="differential-expression-and-abundance-between-conditions.html#cb1788-5"></a>unique.degs &lt;-<span class="st"> </span><span class="kw">names</span>(<span class="kw">which</span>(unique.degs))</span></code></pre></div>
<div class="sourceCode" id="cb1789"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1789-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1789-1"></a><span class="co"># Choosing the top-ranked gene for inspection:</span></span>
<span id="cb1789-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1789-2"></a>de.inspec &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb1789-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1789-3"></a>de.inspec[[cx]] &lt;-<span class="st"> </span>de.results[[cx]] </span>
<span id="cb1789-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1789-4"></a>de.inspec[[cx]] &lt;-<span class="st"> </span>de.inspec[[cx]][<span class="kw">order</span>(de.inspec[[cx]]<span class="op">$</span>PValue),]</span>
<span id="cb1789-5"><a href="differential-expression-and-abundance-between-conditions.html#cb1789-5"></a>de.inspec[[cx]] &lt;-<span class="st"> </span>de.inspec[[cx]][<span class="kw">rownames</span>(de.inspec[[cx]]) <span class="op">%in%</span><span class="st"> </span>unique.degs,]</span>
<span id="cb1789-6"><a href="differential-expression-and-abundance-between-conditions.html#cb1789-6"></a></span>
<span id="cb1789-7"><a href="differential-expression-and-abundance-between-conditions.html#cb1789-7"></a><span class="kw">sizeFactors</span>(summed.filt) &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb1789-8"><a href="differential-expression-and-abundance-between-conditions.html#cb1789-8"></a><span class="kw">plotExpression</span>(<span class="kw">logNormCounts</span>(summed.filt), </span>
<span id="cb1789-9"><a href="differential-expression-and-abundance-between-conditions.html#cb1789-9"></a>    <span class="dt">features=</span><span class="kw">rownames</span>(de.inspec[[cx]])[<span class="dv">1</span>],</span>
<span id="cb1789-10"><a href="differential-expression-and-abundance-between-conditions.html#cb1789-10"></a>    <span class="dt">x=</span><span class="st">&quot;source_name&quot;</span>, <span class="dt">colour_by=</span><span class="st">&quot;source_name&quot;</span>, </span>
<span id="cb1789-11"><a href="differential-expression-and-abundance-between-conditions.html#cb1789-11"></a>    <span class="dt">other_fields=</span><span class="st">&quot;label&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1789-12"><a href="differential-expression-and-abundance-between-conditions.html#cb1789-12"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span>label)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-602-1.png" width="672" /></p>
<p>We also list the labels that were skipped due to the absence of replicates or contrasts. If it is necessary to extract statistics in the absence of replicates, several strategies can be applied such as reducing the complexity of the model or using a predefined value for the NB dispersion. We refer readers to the edgeR user’s guide for more details.</p>
<div class="sourceCode" id="cb1790"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1790-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1790-1"></a><span class="kw">print</span>(<span class="kw">metadata</span>(de.results)<span class="op">$</span>failed)</span></code></pre></div>
<pre><code>## [1] &quot;c1&quot;  &quot;c10&quot; &quot;c11&quot; &quot;c2&quot;  &quot;c6&quot;  &quot;c7&quot;  &quot;c9&quot;</code></pre>
</div>
</div>
<div id="differential-abundance-between-conditions" class="section level2">
<h2><span class="header-section-number">23.4</span> Differential abundance between conditions</h2>
<div id="overview" class="section level3">
<h3><span class="header-section-number">23.4.1</span> Overview</h3>
<p>n a DA analysis, we test for significant changes in per-label cell abundance across conditions. This will reveal which cell types are depleted or enriched upon treatment, which is arguably just as interesting as changes in expression within each cell type. The DA analysis has a long history in flow cytometry (Finak et al. 2014; Lun, Richard, and Marioni 2017) where it is routinely used to examine the effects of different conditions on the composition of complex cell populations. By performing it here, we effectively treat scRNA-seq as a “super-FACS” technology for defining relevant subpopulations using the entire transcriptome.</p>
<p>We prepare for the DA analysis by quantifying the number of cells assigned to each label (or cluster).</p>
<div class="sourceCode" id="cb1792"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1792-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1792-1"></a>abundances &lt;-<span class="st"> </span><span class="kw">table</span>(merged<span class="op">$</span>clusters.mnn, merged<span class="op">$</span>Sample.Name2) </span>
<span id="cb1792-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1792-2"></a>abundances &lt;-<span class="st"> </span><span class="kw">unclass</span>(abundances) </span>
<span id="cb1792-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1792-3"></a><span class="kw">head</span>(abundances)</span></code></pre></div>
<pre><code>##      
##       ETV6-RUNX1_1 ETV6-RUNX1_2 ETV6-RUNX1_3 ETV6-RUNX1_4 HHD_1 HHD_2 PBMMC_1
##   c1            25           43           22           10    68    22       9
##   c10            0            2            1            2     0     2      11
##   c11            0            0            2            7     7     0      42
##   c2             1            9           51           10    24     1      15
##   c3           136           70           30          133    81   101      89
##   c4             0           16          149           20    28    11     193
##      
##       PBMMC_2 PBMMC_3 PRE-T_1 PRE-T_2
##   c1        7       9      95      26
##   c10       4      12      69      58
##   c11      44      95       2      37
##   c2       54      69       4      14
##   c3       18      49     138      26
##   c4      108     124      59     227</code></pre>
<p>Performing the DA analysis</p>
<p>Our DA analysis will again be performed with the edgeR package. This allows us to take advantage of the NB GLM methods to model overdispersed count data in the presence of limited replication - except that the counts are not of reads per gene, but of cells per label (Lun, Richard, and Marioni 2017). The aim is to share information across labels to improve our estimates of the biological variability in cell abundance between replicates.</p>
<div class="sourceCode" id="cb1794"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1794-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1794-1"></a><span class="co"># Attaching some column metadata.</span></span>
<span id="cb1794-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1794-2"></a>extra.info &lt;-<span class="st"> </span><span class="kw">colData</span>(merged)[<span class="kw">match</span>(<span class="kw">colnames</span>(abundances), merged<span class="op">$</span>Sample.Name2),]</span>
<span id="cb1794-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1794-3"></a>y.ab &lt;-<span class="st"> </span><span class="kw">DGEList</span>(abundances, <span class="dt">samples=</span>extra.info)</span>
<span id="cb1794-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1794-4"></a>y.ab</span></code></pre></div>
<pre><code>## An object of class &quot;DGEList&quot;
## $counts
##      
##       ETV6-RUNX1_1 ETV6-RUNX1_2 ETV6-RUNX1_3 ETV6-RUNX1_4 HHD_1 HHD_2 PBMMC_1
##   c1            25           43           22           10    68    22       9
##   c10            0            2            1            2     0     2      11
##   c11            0            0            2            7     7     0      42
##   c2             1            9           51           10    24     1      15
##   c3           136           70           30          133    81   101      89
##      
##       PBMMC_2 PBMMC_3 PRE-T_1 PRE-T_2
##   c1        7       9      95      26
##   c10       4      12      69      58
##   c11      44      95       2      37
##   c2       54      69       4      14
##   c3       18      49     138      26
## 6 more rows ...
## 
## $samples
##              group lib.size norm.factors        batch        Run Sample.Name
## ETV6-RUNX1_1     1      500            1 ETV6-RUNX1_1 SRR9264343  GSM3872434
## ETV6-RUNX1_2     1      500            1 ETV6-RUNX1_2 SRR9264344  GSM3872435
## ETV6-RUNX1_3     1      500            1 ETV6-RUNX1_3 SRR9264345  GSM3872436
## ETV6-RUNX1_4     1      500            1 ETV6-RUNX1_4 SRR9264346  GSM3872437
## HHD_1            1      500            1        HHD_1 SRR9264347  GSM3872438
##              source_name      block setName Sample.Name2 clusters.mnn
## ETV6-RUNX1_1  ETV6-RUNX1 ETV6-RUNX1   Caron ETV6-RUNX1_1           c1
## ETV6-RUNX1_2  ETV6-RUNX1 ETV6-RUNX1   Caron ETV6-RUNX1_2           c5
## ETV6-RUNX1_3  ETV6-RUNX1 ETV6-RUNX1   Caron ETV6-RUNX1_3           c9
## ETV6-RUNX1_4  ETV6-RUNX1 ETV6-RUNX1   Caron ETV6-RUNX1_4           c6
## HHD_1                HHD        HHD   Caron        HHD_1           c4
## 6 more rows ...</code></pre>
<p>We filter out low-abundance labels as previously described. This avoids cluttering the result table with very rare subpopulations that contain only a handful of cells. For a DA analysis of cluster abundances, filtering is generally not required as most clusters will not be of low-abundance (otherwise there would not have been enough evidence to define the cluster in the first place).</p>
<div class="sourceCode" id="cb1796"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1796-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1796-1"></a>keep &lt;-<span class="st"> </span><span class="kw">filterByExpr</span>(y.ab, <span class="dt">group=</span>y.ab<span class="op">$</span>samples<span class="op">$</span>source_name)</span>
<span id="cb1796-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1796-2"></a>y.ab &lt;-<span class="st"> </span>y.ab[keep,]</span>
<span id="cb1796-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1796-3"></a><span class="kw">summary</span>(keep)</span></code></pre></div>
<pre><code>##    Mode    TRUE 
## logical      11</code></pre>
<p>Unlike DE analyses, we do not perform an additional normalization step with calcNormFactors(). This means that we are only normalizing based on the “library size”, i.e., the total number of cells in each sample. Any changes we detect between conditions will subsequently represent differences in the proportion of cells in each cluster. The motivation behind this decision is discussed in more detail in Section 14.4.3.</p>
<p>Here, the log-fold change in our model refers to the change in cell abundance between sample groups, rather than the change in gene expression.</p>
<div class="sourceCode" id="cb1798"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1798-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1798-1"></a>design &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="op">~</span><span class="kw">factor</span>(source_name), y.ab<span class="op">$</span>samples)</span></code></pre></div>
<p>We use the estimateDisp() function to estimate the NB dipersion for each cluster. We turn off the trend as we do not have enough points for its stable estimation.</p>
<div class="sourceCode" id="cb1799"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1799-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1799-1"></a>y.ab &lt;-<span class="st"> </span><span class="kw">estimateDisp</span>(y.ab, design, <span class="dt">trend=</span><span class="st">&quot;none&quot;</span>)</span>
<span id="cb1799-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1799-2"></a><span class="kw">summary</span>(y.ab<span class="op">$</span>common.dispersion)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.8607  0.8607  0.8607  0.8607  0.8607  0.8607</code></pre>
<div class="sourceCode" id="cb1801"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1801-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1801-1"></a><span class="kw">plotBCV</span>(y.ab, <span class="dt">cex=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-609-1.png" width="672" /></p>
<p>We repeat this process with the QL dispersion, again disabling the trend.</p>
<div class="sourceCode" id="cb1802"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1802-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1802-1"></a>fit.ab &lt;-<span class="st"> </span><span class="kw">glmQLFit</span>(y.ab, design, <span class="dt">robust=</span><span class="ot">TRUE</span>, <span class="dt">abundance.trend=</span><span class="ot">FALSE</span>)</span>
<span id="cb1802-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1802-2"></a><span class="kw">summary</span>(fit.ab<span class="op">$</span>var.prior)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   1.017   1.017   1.017   1.017   1.017   1.017</code></pre>
<div class="sourceCode" id="cb1804"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1804-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1804-1"></a><span class="kw">summary</span>(fit.ab<span class="op">$</span>df.prior)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   9.057   9.057   9.447   9.757  10.520  10.520</code></pre>
<div class="sourceCode" id="cb1806"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1806-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1806-1"></a><span class="kw">plotQLDisp</span>(fit.ab, <span class="dt">cex=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-612-1.png" width="672" /></p>
<p>We test for differences in abundance between sample groups using glmQLFTest().</p>
<div class="sourceCode" id="cb1807"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1807-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1807-1"></a>res &lt;-<span class="st"> </span><span class="kw">glmQLFTest</span>(fit.ab, <span class="dt">coef=</span><span class="kw">ncol</span>(design))</span>
<span id="cb1807-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1807-2"></a><span class="kw">summary</span>(<span class="kw">decideTests</span>(res))</span></code></pre></div>
<pre><code>##        factor(source_name)PRE-T
## Down                          1
## NotSig                        9
## Up                            1</code></pre>
<div class="sourceCode" id="cb1809"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1809-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1809-1"></a><span class="kw">topTags</span>(res)</span></code></pre></div>
<pre><code>## Coefficient:  factor(source_name)PRE-T 
##          logFC   logCPM          F       PValue         FDR
## c10  5.5320902 15.01056 21.4641343 0.0002208281 0.001301813
## c6  -7.4312887 16.71644 21.1682244 0.0002366933 0.001301813
## c5  -2.9327527 17.53240  5.6760487 0.0287621595 0.105461252
## c11  3.0466932 15.50608  4.3788481 0.0526233185 0.144714126
## c1   1.2707892 15.97867  1.6398697 0.2170377903 0.416607012
## c4   1.6258565 17.39723  1.4394563 0.2476317870 0.416607012
## c9  -2.1057947 16.17081  1.3333095 0.2651135528 0.416607012
## c8   1.1165756 16.61380  0.9275065 0.3494588184 0.480505875
## c2  -0.9700468 15.59289  0.4627632 0.5060265444 0.618476888
## c7   0.6620035 15.18136  0.2765670 0.6061480796 0.666762888</code></pre>
</div>
<div id="handling-composition-effects" class="section level3">
<h3><span class="header-section-number">23.4.2</span> Handling composition effects</h3>
<div id="background" class="section level4">
<h4><span class="header-section-number">23.4.2.1</span> Background</h4>
<p>As mentioned above, we do not use calcNormFactors() in our default DA analysis. This normalization step assumes that most of the input features are not different between conditions. While this assumption is reasonable for most types of gene expression data, it is generally too strong for cell type abundance - most experiments consist of only a few cell types that may all change in abundance upon perturbation. Thus, our default approach is to only normalize based on the total number of cells in each sample, which means that we are effectively testing for differential proportions between conditions.</p>
<p>Unfortunately, the use of the total number of cells leaves us susceptible to composition effects. For example, a large increase in abundance for one cell subpopulation will introduce decreases in proportion for all other subpopulations - which is technically correct, but may be misleading if one concludes that those other subpopulations are decreasing in abundance of their own volition. If composition biases are proving problematic for interpretation of DA results, we have several avenues for removing them or mitigating their impact by leveraging a priori biological knowledge.
14.4.3.2 Assuming most labels do not change</p>
<p>If it is possible to assume that most labels (i.e., cell types) do not change in abundance, we can use calcNormFactors() to compute normalization factors.</p>
<div class="sourceCode" id="cb1811"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1811-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1811-1"></a>y.ab2 &lt;-<span class="st"> </span><span class="kw">calcNormFactors</span>(y.ab)</span>
<span id="cb1811-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1811-2"></a>y.ab2<span class="op">$</span>samples<span class="op">$</span>norm.factors</span></code></pre></div>
<pre><code>##  [1] 1.4988629 1.9675297 1.0150084 0.7200483 1.1741816 1.3145814 0.7318001
##  [8] 0.5014104 0.8850156 0.7307249 1.2666952</code></pre>
<p>We then proceed with the remainder of the edgeR analysis, shown below in condensed format. A shift of positive log-fold changes towards zero is consistent with the removal of composition biases.</p>
<div class="sourceCode" id="cb1813"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1813-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1813-1"></a>y.ab2 &lt;-<span class="st"> </span><span class="kw">estimateDisp</span>(y.ab2, design, <span class="dt">trend=</span><span class="st">&quot;none&quot;</span>)</span>
<span id="cb1813-2"><a href="differential-expression-and-abundance-between-conditions.html#cb1813-2"></a>fit.ab2 &lt;-<span class="st"> </span><span class="kw">glmQLFit</span>(y.ab2, design, <span class="dt">robust=</span><span class="ot">TRUE</span>, <span class="dt">abundance.trend=</span><span class="ot">FALSE</span>)</span>
<span id="cb1813-3"><a href="differential-expression-and-abundance-between-conditions.html#cb1813-3"></a>res2 &lt;-<span class="st"> </span><span class="kw">glmQLFTest</span>(fit.ab2, <span class="dt">coef=</span><span class="kw">ncol</span>(design))</span>
<span id="cb1813-4"><a href="differential-expression-and-abundance-between-conditions.html#cb1813-4"></a><span class="kw">topTags</span>(res2, <span class="dt">n=</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## Coefficient:  factor(source_name)PRE-T 
##          logFC   logCPM          F       PValue         FDR
## c10  5.8771119 15.15479 21.8465926 0.0002785924 0.003064516
## c6  -7.1144672 16.55018 18.5422306 0.0005872280 0.003229754
## c1   2.0088491 15.97032  4.0442760 0.0621268373 0.224609010
## c5  -2.1993001 17.33747  3.4690534 0.0816760038 0.224609010
## c11  2.5949527 15.81442  2.6836275 0.1231798117 0.259982496
## c8   1.7694835 16.55085  2.3972634 0.1418086342 0.259982496
## c9  -2.6900290 16.79873  1.6090440 0.2248756583 0.353376035
## c4   1.5119768 17.61485  1.0910675 0.3135611308 0.431146555
## c2  -1.0324517 15.86419  0.4555800 0.5104570236 0.623891918
## c7   0.5401679 15.45712  0.1586805 0.6962547642 0.765880241</code></pre>
</div>
</div>
</div>
<div id="session-information-12" class="section level2">
<h2><span class="header-section-number">23.5</span> Session information</h2>
<div class="sourceCode" id="cb1815"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1815-1"><a href="differential-expression-and-abundance-between-conditions.html#cb1815-1"></a><span class="kw">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.0.3 (2020-10-10)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: CentOS Linux 8
## 
## Matrix products: default
## BLAS:   /opt/R/R-4.0.3/lib64/R/lib/libRblas.so
## LAPACK: /opt/R/R-4.0.3/lib64/R/lib/libRlapack.so
## 
## locale:
##  [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8    
##  [5] LC_MONETARY=en_GB.UTF-8    LC_MESSAGES=en_GB.UTF-8   
##  [7] LC_PAPER=en_GB.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] parallel  stats4    stats     graphics  grDevices utils     datasets 
## [8] methods   base     
## 
## other attached packages:
##  [1] edgeR_3.32.1                DelayedArray_0.16.3        
##  [3] RColorBrewer_1.1-2          reticulate_1.18            
##  [5] purrr_0.3.4                 tidyr_1.1.3                
##  [7] tibble_3.1.1                broom_0.7.6                
##  [9] leiden_0.3.7                cluster_2.1.0              
## [11] dynamicTreeCut_1.63-1       bluster_1.0.0              
## [13] fossil_0.4.0                shapefiles_0.7             
## [15] foreign_0.8-80              maps_3.3.0                 
## [17] sp_1.4-5                    clustree_0.4.3             
## [19] ggraph_2.0.5                pheatmap_1.0.12            
## [21] harmony_1.0                 Rcpp_1.0.6                 
## [23] batchelor_1.6.3             SeuratObject_4.0.0         
## [25] Seurat_4.0.1                limma_3.46.0               
## [27] ggfortify_0.4.11            BiocSingular_1.6.0         
## [29] scuttle_1.0.4               robustbase_0.93-7          
## [31] mixtools_1.2.0              dplyr_1.0.5                
## [33] DT_0.18                     irlba_2.3.3                
## [35] biomaRt_2.46.3              Matrix_1.2-18              
## [37] igraph_1.2.6                DropletUtils_1.10.3        
## [39] scater_1.18.6               ggplot2_3.3.3              
## [41] scran_1.18.7                SingleCellExperiment_1.12.0
## [43] SummarizedExperiment_1.20.0 Biobase_2.50.0             
## [45] GenomicRanges_1.42.0        GenomeInfoDb_1.26.7        
## [47] IRanges_2.24.1              S4Vectors_0.28.1           
## [49] BiocGenerics_0.36.1         MatrixGenerics_1.2.1       
## [51] matrixStats_0.58.0          knitr_1.32                 
## 
## loaded via a namespace (and not attached):
##   [1] rappdirs_0.3.1            scattermore_0.7          
##   [3] R.methodsS3_1.8.1         bit64_4.0.5              
##   [5] R.utils_2.10.1            data.table_1.14.0        
##   [7] rpart_4.1-15              RCurl_1.98-1.3           
##   [9] generics_0.1.0            cowplot_1.1.1            
##  [11] RSQLite_2.2.6             RANN_2.6.1               
##  [13] future_1.21.0             bit_4.0.4                
##  [15] spatstat.data_2.1-0       xml2_1.3.2               
##  [17] httpuv_1.5.5              assertthat_0.2.1         
##  [19] viridis_0.5.1             xfun_0.22                
##  [21] hms_1.0.0                 jquerylib_0.1.3          
##  [23] evaluate_0.14             promises_1.1.1           
##  [25] DEoptimR_1.0-8            fansi_0.4.2              
##  [27] progress_1.2.2            dbplyr_2.0.0             
##  [29] DBI_1.1.1                 htmlwidgets_1.5.3        
##  [31] spatstat.geom_2.1-0       ellipsis_0.3.1           
##  [33] crosstalk_1.1.1           RSpectra_0.16-0          
##  [35] backports_1.2.1           bookdown_0.21            
##  [37] deldir_0.2-10             sparseMatrixStats_1.2.1  
##  [39] vctrs_0.3.7               ROCR_1.0-11              
##  [41] abind_1.4-5               cachem_1.0.4             
##  [43] withr_2.4.2               ggforce_0.3.3            
##  [45] sctransform_0.3.2.9005    prettyunits_1.1.1        
##  [47] mclust_5.4.7              goftest_1.2-2            
##  [49] segmented_1.3-3           lazyeval_0.2.2           
##  [51] crayon_1.4.1              labeling_0.4.2           
##  [53] pkgconfig_2.0.3           tweenr_1.0.2             
##  [55] nlme_3.1-149              vipor_0.4.5              
##  [57] rlang_0.4.10              globals_0.14.0           
##  [59] lifecycle_1.0.0           miniUI_0.1.1.1           
##  [61] BiocFileCache_1.14.0      rsvd_1.0.3               
##  [63] polyclip_1.10-0           lmtest_0.9-38            
##  [65] Rhdf5lib_1.12.1           zoo_1.8-9                
##  [67] beeswarm_0.2.3            ggridges_0.5.3           
##  [69] png_0.1-7                 viridisLite_0.3.0        
##  [71] bitops_1.0-6              R.oo_1.24.0              
##  [73] KernSmooth_2.23-17        rhdf5filters_1.2.0       
##  [75] blob_1.2.1                DelayedMatrixStats_1.12.3
##  [77] stringr_1.4.0             parallelly_1.24.0        
##  [79] readr_1.4.0               beachmat_2.6.4           
##  [81] scales_1.1.1              memoise_2.0.0            
##  [83] magrittr_2.0.1            plyr_1.8.6               
##  [85] ica_1.0-2                 zlibbioc_1.36.0          
##  [87] compiler_4.0.3            dqrng_0.2.1              
##  [89] fitdistrplus_1.1-3        cli_2.4.0                
##  [91] XVector_0.30.0            listenv_0.8.0            
##  [93] ps_1.6.0                  patchwork_1.1.1          
##  [95] pbapply_1.4-3             MASS_7.3-53              
##  [97] mgcv_1.8-33               tidyselect_1.1.0         
##  [99] stringi_1.5.3             highr_0.8                
## [101] yaml_2.2.1                askpass_1.1              
## [103] locfit_1.5-9.4            ggrepel_0.9.1            
## [105] grid_4.0.3                sass_0.3.1               
## [107] tools_4.0.3               future.apply_1.7.0       
## [109] rstudioapi_0.13           gridExtra_2.3            
## [111] farver_2.1.0              Rtsne_0.15               
## [113] digest_0.6.27             FNN_1.1.3                
## [115] shiny_1.5.0               later_1.1.0.1            
## [117] RcppAnnoy_0.0.18          httr_1.4.2               
## [119] AnnotationDbi_1.52.0      kernlab_0.9-29           
## [121] colorspace_2.0-0          XML_3.99-0.5             
## [123] tensor_1.5                splines_4.0.3            
## [125] uwot_0.1.10               statmod_1.4.35           
## [127] spatstat.utils_2.1-0      graphlayouts_0.7.1       
## [129] plotly_4.9.3              xtable_1.8-4             
## [131] jsonlite_1.7.2            tidygraph_1.2.0          
## [133] R6_2.5.0                  pillar_1.6.0             
## [135] htmltools_0.5.1.1         mime_0.10                
## [137] glue_1.4.2                fastmap_1.1.0            
## [139] BiocParallel_1.24.1       BiocNeighbors_1.8.2      
## [141] codetools_0.2-16          utf8_1.2.1               
## [143] lattice_0.20-41           bslib_0.2.4              
## [145] spatstat.sparse_2.0-0     ResidualMatrix_1.0.0     
## [147] curl_4.3                  ggbeeswarm_0.6.0         
## [149] openssl_1.4.3             survival_3.2-7           
## [151] rmarkdown_2.7             munsell_0.5.0            
## [153] rhdf5_2.34.0              GenomeInfoDbData_1.2.4   
## [155] HDF5Array_1.18.1          reshape2_1.4.4           
## [157] gtable_0.3.0              spatstat.core_2.1-2</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="cellCyclePhasesTop.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/multiSplComp.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["MkWiC.pdf", "MkWiC.epub"],
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"code_folding": "hide"
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
