<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Quality Control | CRUK Bioinformatics Summer School 2020 - single-cell RNA-seq analysis</title>
  <meta name="description" content="A report for all analyses (bookdown::gitbook)." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Quality Control | CRUK Bioinformatics Summer School 2020 - single-cell RNA-seq analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A report for all analyses (bookdown::gitbook)." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Quality Control | CRUK Bioinformatics Summer School 2020 - single-cell RNA-seq analysis" />
  
  <meta name="twitter:description" content="A report for all analyses (bookdown::gitbook)." />
  

<meta name="author" content="Stephane Ballereau, Zeynep Kalender Atak" />


<meta name="date" content="2021-04-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="PreProcAllCellsTop.html"/>
<link rel="next" href="NormalisationAllCellsTop.html"/>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.18/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
.row { display: flex; }
.collapse { display: none; }
.in { display:block }
.pull-right > .dropdown-menu {
    right: 0;
    left: auto;
}
.open > .dropdown-menu {
    display: block;
}
.dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 1000;
    display: none;
    float: left;
    min-width: 160px;
    padding: 5px 0;
    margin: 2px 0 0;
    font-size: 14px;
    text-align: left;
    list-style: none;
    background-color: #fff;
    -webkit-background-clip: padding-box;
    background-clip: padding-box;
    border: 1px solid #ccc;
    border: 1px solid rgba(0,0,0,.15);
    border-radius: 4px;
    -webkit-box-shadow: 0 6px 12px rgba(0,0,0,.175);
    box-shadow: 0 6px 12px rgba(0,0,0,.175);
}
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>


<script>
document.write('<div class="btn-group pull-right" style="position: absolute; top: 20%; right: 2%; z-index: 200"><button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-_extension-text-contrast=""><span>Code</span> <span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All Code</a></li><li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li></ul></div>')
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">CRUK Functional Genomics Summer School 2020</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preamble</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-study"><i class="fa fa-check"></i><b>1.1</b> The study</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#the-plan"><i class="fa fa-check"></i><b>1.2</b> The plan</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#the-analyses"><i class="fa fa-check"></i><b>1.3</b> The analyses</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#overall-summary"><i class="fa fa-check"></i><b>1.4</b> Overall summary</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#conclusion"><i class="fa fa-check"></i><b>1.5</b> Conclusion</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#abbreviations"><i class="fa fa-check"></i><b>1.6</b> Abbreviations</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="SeqQualTop.html"><a href="SeqQualTop.html"><i class="fa fa-check"></i><b>2</b> Sequence Quality</a><ul>
<li class="chapter" data-level="2.1" data-path="SeqQualTop.html"><a href="SeqQualTop.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="SeqQualTop.html"><a href="SeqQualTop.html#caronbourque2020---fastqc"><i class="fa fa-check"></i><b>2.2</b> CaronBourque2020 - fastqc</a></li>
<li class="chapter" data-level="2.3" data-path="SeqQualTop.html"><a href="SeqQualTop.html#caronbourque2020---multiqc"><i class="fa fa-check"></i><b>2.3</b> CaronBourque2020 - MultiQC</a><ul>
<li class="chapter" data-level="2.3.1" data-path="SeqQualTop.html"><a href="SeqQualTop.html#sample-index-i1"><i class="fa fa-check"></i><b>2.3.1</b> sample index: I1</a></li>
<li class="chapter" data-level="2.3.2" data-path="SeqQualTop.html"><a href="SeqQualTop.html#cell-barcode-umi-r1"><i class="fa fa-check"></i><b>2.3.2</b> cell barcode + UMI: R1</a></li>
<li class="chapter" data-level="2.3.3" data-path="SeqQualTop.html"><a href="SeqQualTop.html#insert-r2"><i class="fa fa-check"></i><b>2.3.3</b> insert: R2</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="SeqQualTop.html"><a href="SeqQualTop.html#hca-adult-bmmc---fastqc"><i class="fa fa-check"></i><b>2.4</b> HCA adult BMMC - fastqc</a></li>
<li class="chapter" data-level="2.5" data-path="SeqQualTop.html"><a href="SeqQualTop.html#hca-adult-bmmc---multiqc"><i class="fa fa-check"></i><b>2.5</b> HCA adult BMMC - MultiQC</a><ul>
<li class="chapter" data-level="2.5.1" data-path="SeqQualTop.html"><a href="SeqQualTop.html#sample-index-i1-1"><i class="fa fa-check"></i><b>2.5.1</b> sample index: I1</a></li>
<li class="chapter" data-level="2.5.2" data-path="SeqQualTop.html"><a href="SeqQualTop.html#cell-barcode-umi-r1-1"><i class="fa fa-check"></i><b>2.5.2</b> cell barcode + UMI: R1</a></li>
<li class="chapter" data-level="2.5.3" data-path="SeqQualTop.html"><a href="SeqQualTop.html#insert-r2-1"><i class="fa fa-check"></i><b>2.5.3</b> insert: R2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="AliFeatCountTop.html"><a href="AliFeatCountTop.html"><i class="fa fa-check"></i><b>3</b> Alignment and feature counting</a><ul>
<li class="chapter" data-level="3.1" data-path="AliFeatCountTop.html"><a href="AliFeatCountTop.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="AliFeatCountTop.html"><a href="AliFeatCountTop.html#x-cellranger-pipeline-in-brief"><i class="fa fa-check"></i><b>3.2</b> 10X cellranger pipeline in brief</a></li>
<li class="chapter" data-level="3.3" data-path="AliFeatCountTop.html"><a href="AliFeatCountTop.html#sample-sheet"><i class="fa fa-check"></i><b>3.3</b> sample sheet</a></li>
<li class="chapter" data-level="3.4" data-path="AliFeatCountTop.html"><a href="AliFeatCountTop.html#x-cellranger-reports-for-caronbourque2020"><i class="fa fa-check"></i><b>3.4</b> 10X cellranger reports for CaronBourque2020</a></li>
<li class="chapter" data-level="3.5" data-path="AliFeatCountTop.html"><a href="AliFeatCountTop.html#x-cellranger-reports-for-hcas-adult-bmmcs"><i class="fa fa-check"></i><b>3.5</b> 10X cellranger reports for HCA’s adult BMMCs</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html"><i class="fa fa-check"></i><b>4</b> Quality Control</a><ul>
<li class="chapter" data-level="4.1" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#load-packages"><i class="fa fa-check"></i><b>4.2</b> Load packages</a></li>
<li class="chapter" data-level="4.3" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#sample-sheet-1"><i class="fa fa-check"></i><b>4.3</b> Sample sheet</a></li>
<li class="chapter" data-level="4.4" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#data-representation"><i class="fa fa-check"></i><b>4.4</b> Data representation</a></li>
<li class="chapter" data-level="4.5" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#example"><i class="fa fa-check"></i><b>4.5</b> Example</a></li>
<li class="chapter" data-level="4.6" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#mapping-qc"><i class="fa fa-check"></i><b>4.6</b> Mapping QC</a><ul>
<li class="chapter" data-level="4.6.1" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#gene-body-coverage"><i class="fa fa-check"></i><b>4.6.1</b> Gene body coverage</a></li>
<li class="chapter" data-level="4.6.2" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#amplification-rate"><i class="fa fa-check"></i><b>4.6.2</b> Amplification rate</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#cell-calling-for-droplet-data"><i class="fa fa-check"></i><b>4.7</b> Cell calling for droplet data</a><ul>
<li class="chapter" data-level="4.7.1" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#mixture-model"><i class="fa fa-check"></i><b>4.7.1</b> Mixture model</a></li>
<li class="chapter" data-level="4.7.2" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#barcode-rank-plot"><i class="fa fa-check"></i><b>4.7.2</b> Barcode rank plot</a></li>
<li class="chapter" data-level="4.7.3" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#inflection-point"><i class="fa fa-check"></i><b>4.7.3</b> Inflection point</a></li>
<li class="chapter" data-level="4.7.4" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#cellranger-v1-and-v2"><i class="fa fa-check"></i><b>4.7.4</b> Cellranger v1 and v2</a></li>
<li class="chapter" data-level="4.7.5" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#dropletutils-and-emptydrops"><i class="fa fa-check"></i><b>4.7.5</b> DropletUtils and EmptyDrops</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#load-filtered-matrices"><i class="fa fa-check"></i><b>4.8</b> Load filtered matrices</a></li>
<li class="chapter" data-level="4.9" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#properties-of-scrna-seq-data"><i class="fa fa-check"></i><b>4.9</b> Properties of scRNA-seq data</a></li>
<li class="chapter" data-level="4.10" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#quality-control"><i class="fa fa-check"></i><b>4.10</b> Quality control</a><ul>
<li class="chapter" data-level="4.10.1" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#qc-metric-distribution"><i class="fa fa-check"></i><b>4.10.1</b> QC metric distribution</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#identification-of-low-quality-cells-with-adaptive-thresholds"><i class="fa fa-check"></i><b>4.11</b> Identification of low-quality cells with adaptive thresholds</a><ul>
<li class="chapter" data-level="4.11.1" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#library-size"><i class="fa fa-check"></i><b>4.11.1</b> Library size</a></li>
<li class="chapter" data-level="4.11.2" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#number-of-genes"><i class="fa fa-check"></i><b>4.11.2</b> Number of genes</a></li>
<li class="chapter" data-level="4.11.3" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#mitochondrial-content"><i class="fa fa-check"></i><b>4.11.3</b> Mitochondrial content</a></li>
<li class="chapter" data-level="4.11.4" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#summary"><i class="fa fa-check"></i><b>4.11.4</b> Summary</a></li>
<li class="chapter" data-level="4.11.5" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#all-steps-at-once"><i class="fa fa-check"></i><b>4.11.5</b> All steps at once</a></li>
<li class="chapter" data-level="4.11.6" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#assumptions"><i class="fa fa-check"></i><b>4.11.6</b> Assumptions</a></li>
</ul></li>
<li class="chapter" data-level="4.12" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#experimental-factors"><i class="fa fa-check"></i><b>4.12</b> Experimental factors</a><ul>
<li class="chapter" data-level="4.12.1" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#identify-poor-quality-batches"><i class="fa fa-check"></i><b>4.12.1</b> Identify poor-quality batches</a><ul>
<li class="chapter" data-level="4.12.1.1" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#number-of-genes-detected"><i class="fa fa-check"></i><b>4.12.1.1</b> Number of genes detected</a><ul>
<li class="chapter" data-level="4.12.1.1.1" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#mitochondrial-content-1"><i class="fa fa-check"></i><b>4.12.1.1.1</b> Mitochondrial content</a></li>
</ul></li>
<li class="chapter" data-level="4.12.1.2" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#samples-to-check"><i class="fa fa-check"></i><b>4.12.1.2</b> Samples to check</a></li>
</ul></li>
<li class="chapter" data-level="4.12.2" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#qc-metrics-space"><i class="fa fa-check"></i><b>4.12.2</b> QC metrics space</a></li>
<li class="chapter" data-level="4.12.3" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#qc-pca"><i class="fa fa-check"></i><b>4.12.3</b> QC PCA</a></li>
<li class="chapter" data-level="4.12.4" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#other-diagnostic-plots"><i class="fa fa-check"></i><b>4.12.4</b> Other diagnostic plots</a></li>
<li class="chapter" data-level="4.12.5" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#filter-low-quality-cells-out"><i class="fa fa-check"></i><b>4.12.5</b> Filter low-quality cells out</a></li>
</ul></li>
<li class="chapter" data-level="4.13" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#novelty"><i class="fa fa-check"></i><b>4.13</b> Novelty</a></li>
<li class="chapter" data-level="4.14" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#qc-based-on-sparsity"><i class="fa fa-check"></i><b>4.14</b> QC based on sparsity</a><ul>
<li class="chapter" data-level="4.14.1" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#remove-genes-that-are-not-expressed-at-all"><i class="fa fa-check"></i><b>4.14.1</b> Remove genes that are not expressed at all</a></li>
<li class="chapter" data-level="4.14.2" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#sparsity-plots"><i class="fa fa-check"></i><b>4.14.2</b> Sparsity plots</a></li>
<li class="chapter" data-level="4.14.3" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#filters"><i class="fa fa-check"></i><b>4.14.3</b> Filters</a></li>
<li class="chapter" data-level="4.14.4" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#separate-caron-and-hca-batches"><i class="fa fa-check"></i><b>4.14.4</b> Separate Caron and Hca batches</a></li>
<li class="chapter" data-level="4.14.5" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#caron-only"><i class="fa fa-check"></i><b>4.14.5</b> Caron only</a></li>
<li class="chapter" data-level="4.14.6" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#hca-only"><i class="fa fa-check"></i><b>4.14.6</b> Hca only</a></li>
</ul></li>
<li class="chapter" data-level="4.15" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#subsample-hca-set"><i class="fa fa-check"></i><b>4.15</b> Subsample Hca set</a></li>
<li class="chapter" data-level="4.16" data-path="PreProcAllCellsTop.html"><a href="PreProcAllCellsTop.html#session-information"><i class="fa fa-check"></i><b>4.16</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="PreProcTop.html"><a href="PreProcTop.html"><i class="fa fa-check"></i><b>5</b> Quality Control</a><ul>
<li class="chapter" data-level="5.1" data-path="PreProcTop.html"><a href="PreProcTop.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="PreProcTop.html"><a href="PreProcTop.html#load-packages-1"><i class="fa fa-check"></i><b>5.2</b> Load packages</a></li>
<li class="chapter" data-level="5.3" data-path="PreProcTop.html"><a href="PreProcTop.html#sample-sheet-2"><i class="fa fa-check"></i><b>5.3</b> Sample sheet</a></li>
<li class="chapter" data-level="5.4" data-path="PreProcTop.html"><a href="PreProcTop.html#data-representation-1"><i class="fa fa-check"></i><b>5.4</b> Data representation</a></li>
<li class="chapter" data-level="5.5" data-path="PreProcTop.html"><a href="PreProcTop.html#example-1"><i class="fa fa-check"></i><b>5.5</b> Example</a></li>
<li class="chapter" data-level="5.6" data-path="PreProcTop.html"><a href="PreProcTop.html#mapping-qc-1"><i class="fa fa-check"></i><b>5.6</b> Mapping QC</a><ul>
<li class="chapter" data-level="5.6.1" data-path="PreProcTop.html"><a href="PreProcTop.html#gene-body-coverage-1"><i class="fa fa-check"></i><b>5.6.1</b> Gene body coverage</a></li>
<li class="chapter" data-level="5.6.2" data-path="PreProcTop.html"><a href="PreProcTop.html#amplification-rate-1"><i class="fa fa-check"></i><b>5.6.2</b> Amplification rate</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="PreProcTop.html"><a href="PreProcTop.html#cell-calling-for-droplet-data-1"><i class="fa fa-check"></i><b>5.7</b> Cell calling for droplet data</a><ul>
<li class="chapter" data-level="5.7.1" data-path="PreProcTop.html"><a href="PreProcTop.html#mixture-model-1"><i class="fa fa-check"></i><b>5.7.1</b> Mixture model</a></li>
<li class="chapter" data-level="5.7.2" data-path="PreProcTop.html"><a href="PreProcTop.html#barcode-rank-plot-1"><i class="fa fa-check"></i><b>5.7.2</b> Barcode rank plot</a></li>
<li class="chapter" data-level="5.7.3" data-path="PreProcTop.html"><a href="PreProcTop.html#inflection-point-1"><i class="fa fa-check"></i><b>5.7.3</b> Inflection point</a></li>
<li class="chapter" data-level="5.7.4" data-path="PreProcTop.html"><a href="PreProcTop.html#cellranger-v1-and-v2-1"><i class="fa fa-check"></i><b>5.7.4</b> Cellranger v1 and v2</a></li>
<li class="chapter" data-level="5.7.5" data-path="PreProcTop.html"><a href="PreProcTop.html#dropletutils-and-emptydrops-1"><i class="fa fa-check"></i><b>5.7.5</b> DropletUtils and EmptyDrops</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="PreProcTop.html"><a href="PreProcTop.html#load-filtered-matrices-1"><i class="fa fa-check"></i><b>5.8</b> Load filtered matrices</a></li>
<li class="chapter" data-level="5.9" data-path="PreProcTop.html"><a href="PreProcTop.html#properties-of-scrna-seq-data-1"><i class="fa fa-check"></i><b>5.9</b> Properties of scRNA-seq data</a></li>
<li class="chapter" data-level="5.10" data-path="PreProcTop.html"><a href="PreProcTop.html#quality-control-1"><i class="fa fa-check"></i><b>5.10</b> Quality control</a><ul>
<li class="chapter" data-level="5.10.1" data-path="PreProcTop.html"><a href="PreProcTop.html#qc-metric-distribution-1"><i class="fa fa-check"></i><b>5.10.1</b> QC metric distribution</a></li>
</ul></li>
<li class="chapter" data-level="5.11" data-path="PreProcTop.html"><a href="PreProcTop.html#identification-of-low-quality-cells-with-adaptive-thresholds-1"><i class="fa fa-check"></i><b>5.11</b> Identification of low-quality cells with adaptive thresholds</a><ul>
<li class="chapter" data-level="5.11.1" data-path="PreProcTop.html"><a href="PreProcTop.html#library-size-1"><i class="fa fa-check"></i><b>5.11.1</b> Library size</a></li>
<li class="chapter" data-level="5.11.2" data-path="PreProcTop.html"><a href="PreProcTop.html#number-of-genes-1"><i class="fa fa-check"></i><b>5.11.2</b> Number of genes</a></li>
<li class="chapter" data-level="5.11.3" data-path="PreProcTop.html"><a href="PreProcTop.html#mitochondrial-content-2"><i class="fa fa-check"></i><b>5.11.3</b> Mitochondrial content</a></li>
<li class="chapter" data-level="5.11.4" data-path="PreProcTop.html"><a href="PreProcTop.html#summary-1"><i class="fa fa-check"></i><b>5.11.4</b> Summary</a></li>
<li class="chapter" data-level="5.11.5" data-path="PreProcTop.html"><a href="PreProcTop.html#all-steps-at-once-1"><i class="fa fa-check"></i><b>5.11.5</b> All steps at once</a></li>
<li class="chapter" data-level="5.11.6" data-path="PreProcTop.html"><a href="PreProcTop.html#assumptions-1"><i class="fa fa-check"></i><b>5.11.6</b> Assumptions</a></li>
</ul></li>
<li class="chapter" data-level="5.12" data-path="PreProcTop.html"><a href="PreProcTop.html#experimental-factors-1"><i class="fa fa-check"></i><b>5.12</b> Experimental factors</a><ul>
<li class="chapter" data-level="5.12.1" data-path="PreProcTop.html"><a href="PreProcTop.html#identify-poor-quality-batches-1"><i class="fa fa-check"></i><b>5.12.1</b> Identify poor-quality batches</a><ul>
<li class="chapter" data-level="5.12.1.1" data-path="PreProcTop.html"><a href="PreProcTop.html#number-of-genes-detected-1"><i class="fa fa-check"></i><b>5.12.1.1</b> Number of genes detected</a><ul>
<li class="chapter" data-level="5.12.1.1.1" data-path="PreProcTop.html"><a href="PreProcTop.html#mitochondrial-content-3"><i class="fa fa-check"></i><b>5.12.1.1.1</b> Mitochondrial content</a></li>
</ul></li>
<li class="chapter" data-level="5.12.1.2" data-path="PreProcTop.html"><a href="PreProcTop.html#samples-to-check-1"><i class="fa fa-check"></i><b>5.12.1.2</b> Samples to check</a></li>
</ul></li>
<li class="chapter" data-level="5.12.2" data-path="PreProcTop.html"><a href="PreProcTop.html#qc-metrics-space-1"><i class="fa fa-check"></i><b>5.12.2</b> QC metrics space</a></li>
<li class="chapter" data-level="5.12.3" data-path="PreProcTop.html"><a href="PreProcTop.html#qc-pca-1"><i class="fa fa-check"></i><b>5.12.3</b> QC PCA</a></li>
<li class="chapter" data-level="5.12.4" data-path="PreProcTop.html"><a href="PreProcTop.html#other-diagnostic-plots-1"><i class="fa fa-check"></i><b>5.12.4</b> Other diagnostic plots</a></li>
<li class="chapter" data-level="5.12.5" data-path="PreProcTop.html"><a href="PreProcTop.html#filter-low-quality-cells-out-1"><i class="fa fa-check"></i><b>5.12.5</b> Filter low-quality cells out</a></li>
</ul></li>
<li class="chapter" data-level="5.13" data-path="PreProcTop.html"><a href="PreProcTop.html#novelty-1"><i class="fa fa-check"></i><b>5.13</b> Novelty</a></li>
<li class="chapter" data-level="5.14" data-path="PreProcTop.html"><a href="PreProcTop.html#qc-based-on-sparsity-1"><i class="fa fa-check"></i><b>5.14</b> QC based on sparsity</a><ul>
<li class="chapter" data-level="5.14.1" data-path="PreProcTop.html"><a href="PreProcTop.html#remove-genes-that-are-not-expressed-at-all-1"><i class="fa fa-check"></i><b>5.14.1</b> Remove genes that are not expressed at all</a></li>
<li class="chapter" data-level="5.14.2" data-path="PreProcTop.html"><a href="PreProcTop.html#sparsity-plots-1"><i class="fa fa-check"></i><b>5.14.2</b> Sparsity plots</a></li>
<li class="chapter" data-level="5.14.3" data-path="PreProcTop.html"><a href="PreProcTop.html#filters-1"><i class="fa fa-check"></i><b>5.14.3</b> Filters</a></li>
<li class="chapter" data-level="5.14.4" data-path="PreProcTop.html"><a href="PreProcTop.html#separate-caron-and-hca-batches-1"><i class="fa fa-check"></i><b>5.14.4</b> Separate Caron and Hca batches</a></li>
<li class="chapter" data-level="5.14.5" data-path="PreProcTop.html"><a href="PreProcTop.html#caron-only-1"><i class="fa fa-check"></i><b>5.14.5</b> Caron only</a></li>
<li class="chapter" data-level="5.14.6" data-path="PreProcTop.html"><a href="PreProcTop.html#hca-only-1"><i class="fa fa-check"></i><b>5.14.6</b> Hca only</a></li>
</ul></li>
<li class="chapter" data-level="5.15" data-path="PreProcTop.html"><a href="PreProcTop.html#session-information-1"><i class="fa fa-check"></i><b>5.15</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html"><i class="fa fa-check"></i><b>6</b> Normalisation</a><ul>
<li class="chapter" data-level="6.1" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#caron"><i class="fa fa-check"></i><b>6.1</b> Caron</a><ul>
<li class="chapter" data-level="6.1.1" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#library-size-normalization"><i class="fa fa-check"></i><b>6.1.1</b> Library size normalization</a></li>
<li class="chapter" data-level="6.1.2" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#deconvolution"><i class="fa fa-check"></i><b>6.1.2</b> Deconvolution</a></li>
<li class="chapter" data-level="6.1.3" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#compute-size-factors"><i class="fa fa-check"></i><b>6.1.3</b> Compute size factors</a><ul>
<li class="chapter" data-level="6.1.3.1" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#apply-size-factors"><i class="fa fa-check"></i><b>6.1.3.1</b> Apply size factors</a></li>
<li class="chapter" data-level="6.1.3.2" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#save-object"><i class="fa fa-check"></i><b>6.1.3.2</b> Save object</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#hca"><i class="fa fa-check"></i><b>6.2</b> Hca</a><ul>
<li class="chapter" data-level="6.2.1" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#library-size-normalization-1"><i class="fa fa-check"></i><b>6.2.1</b> Library size normalization</a></li>
<li class="chapter" data-level="6.2.2" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#deconvolution-1"><i class="fa fa-check"></i><b>6.2.2</b> Deconvolution</a></li>
<li class="chapter" data-level="6.2.3" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#compute-size-factors-1"><i class="fa fa-check"></i><b>6.2.3</b> Compute size factors</a><ul>
<li class="chapter" data-level="6.2.3.1" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#apply-size-factors-1"><i class="fa fa-check"></i><b>6.2.3.1</b> Apply size factors</a></li>
<li class="chapter" data-level="6.2.3.2" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#save-object-1"><i class="fa fa-check"></i><b>6.2.3.2</b> Save object</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#sctransform"><i class="fa fa-check"></i><b>6.3</b> SCTransform</a><ul>
<li class="chapter" data-level="6.3.1" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#caron-1"><i class="fa fa-check"></i><b>6.3.1</b> Caron</a></li>
<li class="chapter" data-level="6.3.2" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#hca-1"><i class="fa fa-check"></i><b>6.3.2</b> Hca</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="NormalisationAllCellsTop.html"><a href="NormalisationAllCellsTop.html#session-information-2"><i class="fa fa-check"></i><b>6.4</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html"><i class="fa fa-check"></i><b>7</b> Normalisation - Caron set</a><ul>
<li class="chapter" data-level="7.1" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#scaling-normalization"><i class="fa fa-check"></i><b>7.1</b> Scaling normalization</a><ul>
<li class="chapter" data-level="7.1.1" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#cpm"><i class="fa fa-check"></i><b>7.1.1</b> CPM</a></li>
<li class="chapter" data-level="7.1.2" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#deseqs-size-factor"><i class="fa fa-check"></i><b>7.1.2</b> DESeq’s size factor</a></li>
<li class="chapter" data-level="7.1.3" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#weighted-trimmed-mean-of-m-values"><i class="fa fa-check"></i><b>7.1.3</b> Weighted Trimmed mean of M-values</a></li>
<li class="chapter" data-level="7.1.4" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#library-size-normalization-2"><i class="fa fa-check"></i><b>7.1.4</b> Library size normalization</a></li>
<li class="chapter" data-level="7.1.5" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#deconvolution-2"><i class="fa fa-check"></i><b>7.1.5</b> Deconvolution</a><ul>
<li class="chapter" data-level="7.1.5.1" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#cluster-cells"><i class="fa fa-check"></i><b>7.1.5.1</b> Cluster cells</a></li>
<li class="chapter" data-level="7.1.5.2" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#compute-size-factors-2"><i class="fa fa-check"></i><b>7.1.5.2</b> Compute size factors</a></li>
<li class="chapter" data-level="7.1.5.3" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#apply-size-factors-2"><i class="fa fa-check"></i><b>7.1.5.3</b> Apply size factors</a></li>
<li class="chapter" data-level="7.1.5.4" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#save-object-2"><i class="fa fa-check"></i><b>7.1.5.4</b> Save object</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#sctransform-1"><i class="fa fa-check"></i><b>7.2</b> SCTransform</a><ul>
<li class="chapter" data-level="7.2.1" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#inspect-data"><i class="fa fa-check"></i><b>7.2.1</b> Inspect data</a></li>
<li class="chapter" data-level="7.2.2" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#transformation"><i class="fa fa-check"></i><b>7.2.2</b> Transformation</a></li>
<li class="chapter" data-level="7.2.3" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#save-sce-object"><i class="fa fa-check"></i><b>7.2.3</b> Save SCE object</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#visualisation"><i class="fa fa-check"></i><b>7.3</b> Visualisation</a><ul>
<li class="chapter" data-level="7.3.1" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#log-raw-counts"><i class="fa fa-check"></i><b>7.3.1</b> log raw counts</a></li>
<li class="chapter" data-level="7.3.2" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#log-cpm"><i class="fa fa-check"></i><b>7.3.2</b> log CPM</a></li>
<li class="chapter" data-level="7.3.3" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#scran"><i class="fa fa-check"></i><b>7.3.3</b> scran</a></li>
<li class="chapter" data-level="7.3.4" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#sctransform-2"><i class="fa fa-check"></i><b>7.3.4</b> SCTransform</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="normalisation-caron-set.html"><a href="normalisation-caron-set.html#session-information-3"><i class="fa fa-check"></i><b>7.4</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html"><i class="fa fa-check"></i><b>8</b> Normalisation - GSM3872434 set</a><ul>
<li class="chapter" data-level="8.1" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#scaling-normalization-1"><i class="fa fa-check"></i><b>8.1</b> Scaling normalization</a><ul>
<li class="chapter" data-level="8.1.1" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#cpm-1"><i class="fa fa-check"></i><b>8.1.1</b> CPM</a></li>
<li class="chapter" data-level="8.1.2" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#deseqs-size-factor-1"><i class="fa fa-check"></i><b>8.1.2</b> DESeq’s size factor</a></li>
<li class="chapter" data-level="8.1.3" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#weighted-trimmed-mean-of-m-values-1"><i class="fa fa-check"></i><b>8.1.3</b> Weighted Trimmed mean of M-values</a></li>
<li class="chapter" data-level="8.1.4" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#library-size-factor-distribution"><i class="fa fa-check"></i><b>8.1.4</b> Library size factor distribution</a></li>
<li class="chapter" data-level="8.1.5" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#deconvolution-3"><i class="fa fa-check"></i><b>8.1.5</b> Deconvolution</a><ul>
<li class="chapter" data-level="8.1.5.1" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#cluster-cells-1"><i class="fa fa-check"></i><b>8.1.5.1</b> Cluster cells</a></li>
<li class="chapter" data-level="8.1.5.2" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#compute-size-factors-3"><i class="fa fa-check"></i><b>8.1.5.2</b> Compute size factors</a></li>
<li class="chapter" data-level="8.1.5.3" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#apply-size-factors-3"><i class="fa fa-check"></i><b>8.1.5.3</b> Apply size factors</a></li>
<li class="chapter" data-level="8.1.5.4" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#save-object-3"><i class="fa fa-check"></i><b>8.1.5.4</b> Save object</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#sctransform-3"><i class="fa fa-check"></i><b>8.2</b> SCTransform</a><ul>
<li class="chapter" data-level="8.2.1" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#inspect-data-1"><i class="fa fa-check"></i><b>8.2.1</b> Inspect data</a></li>
<li class="chapter" data-level="8.2.2" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#transformation-1"><i class="fa fa-check"></i><b>8.2.2</b> Transformation</a></li>
<li class="chapter" data-level="8.2.3" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#save-sce-object-1"><i class="fa fa-check"></i><b>8.2.3</b> Save SCE object</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#visualisation-1"><i class="fa fa-check"></i><b>8.3</b> Visualisation</a><ul>
<li class="chapter" data-level="8.3.1" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#log-raw-counts-1"><i class="fa fa-check"></i><b>8.3.1</b> log raw counts</a></li>
<li class="chapter" data-level="8.3.2" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#log-cpm-1"><i class="fa fa-check"></i><b>8.3.2</b> log CPM</a></li>
<li class="chapter" data-level="8.3.3" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#scran-1"><i class="fa fa-check"></i><b>8.3.3</b> scran</a></li>
<li class="chapter" data-level="8.3.4" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#sctransform-4"><i class="fa fa-check"></i><b>8.3.4</b> SCTransform</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="NormalisationGSM3872434Top.html"><a href="NormalisationGSM3872434Top.html#session-information-4"><i class="fa fa-check"></i><b>8.4</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html"><i class="fa fa-check"></i><b>9</b> Dimensionality reduction for visualisation</a><ul>
<li class="chapter" data-level="9.1" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#principal-component-analysis"><i class="fa fa-check"></i><b>9.1</b> Principal Component Analysis</a><ul>
<li class="chapter" data-level="9.1.1" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#description"><i class="fa fa-check"></i><b>9.1.1</b> Description</a></li>
<li class="chapter" data-level="9.1.2" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#example-2"><i class="fa fa-check"></i><b>9.1.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#load-packages-2"><i class="fa fa-check"></i><b>9.2</b> Load packages</a></li>
<li class="chapter" data-level="9.3" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#load-data"><i class="fa fa-check"></i><b>9.3</b> Load data</a></li>
<li class="chapter" data-level="9.4" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#pca"><i class="fa fa-check"></i><b>9.4</b> PCA</a><ul>
<li class="chapter" data-level="9.4.1" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#correlation-between-pcs-and-the-total-number-of-features-detected"><i class="fa fa-check"></i><b>9.4.1</b> Correlation between PCs and the total number of features detected</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#t-sne-t-distributed-stochastic-neighbor-embedding"><i class="fa fa-check"></i><b>9.5</b> t-SNE: t-Distributed Stochastic Neighbor Embedding</a><ul>
<li class="chapter" data-level="9.5.1" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#perplexity"><i class="fa fa-check"></i><b>9.5.1</b> Perplexity</a></li>
<li class="chapter" data-level="9.5.2" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#stochasticity"><i class="fa fa-check"></i><b>9.5.2</b> Stochasticity</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#umap"><i class="fa fa-check"></i><b>9.6</b> UMAP</a></li>
<li class="chapter" data-level="9.7" data-path="dimRedForVizTop.html"><a href="dimRedForVizTop.html#session-information-5"><i class="fa fa-check"></i><b>9.7</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="identifying-confounding-factors-caron-set.html"><a href="identifying-confounding-factors-caron-set.html"><i class="fa fa-check"></i><b>10</b> Identifying confounding factors - Caron set</a><ul>
<li class="chapter" data-level="10.1" data-path="identifying-confounding-factors-caron-set.html"><a href="identifying-confounding-factors-caron-set.html#load-object"><i class="fa fa-check"></i><b>10.1</b> Load object</a></li>
<li class="chapter" data-level="10.2" data-path="identifying-confounding-factors-caron-set.html"><a href="identifying-confounding-factors-caron-set.html#pca-1"><i class="fa fa-check"></i><b>10.2</b> PCA</a></li>
<li class="chapter" data-level="10.3" data-path="identifying-confounding-factors-caron-set.html"><a href="identifying-confounding-factors-caron-set.html#normalised-counts"><i class="fa fa-check"></i><b>10.3</b> Normalised counts</a></li>
<li class="chapter" data-level="10.4" data-path="identifying-confounding-factors-caron-set.html"><a href="identifying-confounding-factors-caron-set.html#session-information-6"><i class="fa fa-check"></i><b>10.4</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="featSelecTop.html"><a href="featSelecTop.html"><i class="fa fa-check"></i><b>11</b> Feature selection</a><ul>
<li class="chapter" data-level="11.1" data-path="featSelecTop.html"><a href="featSelecTop.html#load-data-1"><i class="fa fa-check"></i><b>11.1</b> Load data</a></li>
<li class="chapter" data-level="11.2" data-path="featSelecTop.html"><a href="featSelecTop.html#feature-selection-with-scran"><i class="fa fa-check"></i><b>11.2</b> Feature selection with scran</a><ul>
<li class="chapter" data-level="11.2.1" data-path="featSelecTop.html"><a href="featSelecTop.html#modelling-and-removing-technical-noise"><i class="fa fa-check"></i><b>11.2.1</b> Modelling and removing technical noise</a></li>
<li class="chapter" data-level="11.2.2" data-path="featSelecTop.html"><a href="featSelecTop.html#choosing-some-hvgs"><i class="fa fa-check"></i><b>11.2.2</b> Choosing some HVGs</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="featSelecTop.html"><a href="featSelecTop.html#session-information-7"><i class="fa fa-check"></i><b>11.3</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html"><i class="fa fa-check"></i><b>12</b> batch correction - GSM3872442 set</a><ul>
<li class="chapter" data-level="12.1" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#prepare-data"><i class="fa fa-check"></i><b>12.1</b> Prepare data</a></li>
<li class="chapter" data-level="12.2" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#normalise-each-separately-and-re-pool"><i class="fa fa-check"></i><b>12.2</b> Normalise each separately and re-pool</a></li>
<li class="chapter" data-level="12.3" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#normalise-batches-together"><i class="fa fa-check"></i><b>12.3</b> Normalise batches together</a></li>
<li class="chapter" data-level="12.4" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#batch-correction"><i class="fa fa-check"></i><b>12.4</b> Batch correction</a><ul>
<li class="chapter" data-level="12.4.1" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#gaussian-normal-linear-models"><i class="fa fa-check"></i><b>12.4.1</b> Gaussian (normal) linear models</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#sctransform-5"><i class="fa fa-check"></i><b>12.5</b> SCTransform</a><ul>
<li class="chapter" data-level="12.5.1" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#batch-only"><i class="fa fa-check"></i><b>12.5.1</b> Batch only</a></li>
<li class="chapter" data-level="12.5.2" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#both-library-size-and-batch"><i class="fa fa-check"></i><b>12.5.2</b> Both library size and batch</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#mnncorrect"><i class="fa fa-check"></i><b>12.6</b> mnnCorrect</a><ul>
<li class="chapter" data-level="12.6.1" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#check-presence-of-batch-effect"><i class="fa fa-check"></i><b>12.6.1</b> Check presence of batch effect</a></li>
<li class="chapter" data-level="12.6.2" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#correct-batch-effect-with-mnncorrect"><i class="fa fa-check"></i><b>12.6.2</b> Correct batch effect with mnnCorrect</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#fastmnn"><i class="fa fa-check"></i><b>12.7</b> fastMNN</a></li>
<li class="chapter" data-level="12.8" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#harmony"><i class="fa fa-check"></i><b>12.8</b> Harmony</a></li>
<li class="chapter" data-level="12.9" data-path="batch-correction-gsm3872442-set.html"><a href="batch-correction-gsm3872442-set.html#session-information-8"><i class="fa fa-check"></i><b>12.9</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="dimensionality-reduction-for-analysis.html"><a href="dimensionality-reduction-for-analysis.html"><i class="fa fa-check"></i><b>13</b> Dimensionality reduction for analysis</a><ul>
<li class="chapter" data-level="13.1" data-path="dimensionality-reduction-for-analysis.html"><a href="dimensionality-reduction-for-analysis.html#load-data-2"><i class="fa fa-check"></i><b>13.1</b> Load data</a></li>
<li class="chapter" data-level="13.2" data-path="dimensionality-reduction-for-analysis.html"><a href="dimensionality-reduction-for-analysis.html#denoising-expression-values-using-pca"><i class="fa fa-check"></i><b>13.2</b> Denoising expression values using PCA</a></li>
<li class="chapter" data-level="13.3" data-path="dimensionality-reduction-for-analysis.html"><a href="dimensionality-reduction-for-analysis.html#visualise-expression-patterns-of-some-hvgs"><i class="fa fa-check"></i><b>13.3</b> Visualise expression patterns of some HVGs</a></li>
<li class="chapter" data-level="13.4" data-path="dimensionality-reduction-for-analysis.html"><a href="dimensionality-reduction-for-analysis.html#session-information-9"><i class="fa fa-check"></i><b>13.4</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html"><i class="fa fa-check"></i><b>14</b> Data integration</a><ul>
<li class="chapter" data-level="14.1" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#abbreviations-1"><i class="fa fa-check"></i><b>14.1</b> Abbreviations</a></li>
<li class="chapter" data-level="14.2" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#motivation"><i class="fa fa-check"></i><b>14.2</b> Motivation</a></li>
<li class="chapter" data-level="14.3" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#loading-the-data"><i class="fa fa-check"></i><b>14.3</b> Loading the data</a></li>
<li class="chapter" data-level="14.4" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#diagnosing-batch-effects"><i class="fa fa-check"></i><b>14.4</b> Diagnosing batch effects</a></li>
<li class="chapter" data-level="14.5" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#linear-regression"><i class="fa fa-check"></i><b>14.5</b> Linear regression</a></li>
<li class="chapter" data-level="14.6" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#performing-mnn-correction"><i class="fa fa-check"></i><b>14.6</b> Performing MNN correction</a><ul>
<li class="chapter" data-level="14.6.1" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#algorithm-overview"><i class="fa fa-check"></i><b>14.6.1</b> Algorithm overview</a></li>
<li class="chapter" data-level="14.6.2" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#application-to-the-data"><i class="fa fa-check"></i><b>14.6.2</b> Application to the data</a></li>
<li class="chapter" data-level="14.6.3" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#correction-diagnostics"><i class="fa fa-check"></i><b>14.6.3</b> Correction diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#preserving-biological-heterogeneity"><i class="fa fa-check"></i><b>14.7</b> Preserving biological heterogeneity</a><ul>
<li class="chapter" data-level="14.7.1" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#comparison-to-within-batch-clusters"><i class="fa fa-check"></i><b>14.7.1</b> Comparison to within-batch clusters</a></li>
<li class="chapter" data-level="14.7.2" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#encouraging-consistency-with-marker-genes"><i class="fa fa-check"></i><b>14.7.2</b> Encouraging consistency with marker genes</a></li>
</ul></li>
<li class="chapter" data-level="14.8" data-path="DataIntegrationPbmmcTop.html"><a href="DataIntegrationPbmmcTop.html#session-information-10"><i class="fa fa-check"></i><b>14.8</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html"><i class="fa fa-check"></i><b>15</b> Data integration</a><ul>
<li class="chapter" data-level="15.1" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#abbreviations-2"><i class="fa fa-check"></i><b>15.1</b> Abbreviations</a></li>
<li class="chapter" data-level="15.2" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#motivation-1"><i class="fa fa-check"></i><b>15.2</b> Motivation</a></li>
<li class="chapter" data-level="15.3" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#load-data-3"><i class="fa fa-check"></i><b>15.3</b> Load data</a></li>
<li class="chapter" data-level="15.4" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#loading-the-data-1"><i class="fa fa-check"></i><b>15.4</b> Loading the data</a></li>
<li class="chapter" data-level="15.5" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#diagnosing-batch-effects-1"><i class="fa fa-check"></i><b>15.5</b> Diagnosing batch effects</a></li>
<li class="chapter" data-level="15.6" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#linear-regression-1"><i class="fa fa-check"></i><b>15.6</b> Linear regression</a></li>
<li class="chapter" data-level="15.7" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#performing-mnn-correction-1"><i class="fa fa-check"></i><b>15.7</b> Performing MNN correction</a><ul>
<li class="chapter" data-level="15.7.1" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#algorithm-overview-1"><i class="fa fa-check"></i><b>15.7.1</b> Algorithm overview</a></li>
<li class="chapter" data-level="15.7.2" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#application-to-the-data-1"><i class="fa fa-check"></i><b>15.7.2</b> Application to the data</a></li>
</ul></li>
<li class="chapter" data-level="15.8" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#correction-diagnostics-1"><i class="fa fa-check"></i><b>15.8</b> Correction diagnostics</a><ul>
<li class="chapter" data-level="15.8.1" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#mixing-between-batches"><i class="fa fa-check"></i><b>15.8.1</b> Mixing between batches</a></li>
<li class="chapter" data-level="15.8.2" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#preserving-biological-heterogeneity-1"><i class="fa fa-check"></i><b>15.8.2</b> Preserving biological heterogeneity</a><ul>
<li class="chapter" data-level="15.8.2.1" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#comparison-between-within-batch-clusters-and-across-batch-clusters-obtained-after-mnn-correction"><i class="fa fa-check"></i><b>15.8.2.1</b> Comparison between within-batch clusters and across-batch clusters obtained after MNN correction</a></li>
<li class="chapter" data-level="15.8.2.2" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#coassignment-probabilities"><i class="fa fa-check"></i><b>15.8.2.2</b> Coassignment probabilities</a></li>
<li class="chapter" data-level="15.8.2.3" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#rand-index"><i class="fa fa-check"></i><b>15.8.2.3</b> Rand index</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15.9" data-path="dataSetIntegration-ETV6-RUNX1Top.html"><a href="dataSetIntegration-ETV6-RUNX1Top.html#encouraging-consistency-with-marker-genes-1"><i class="fa fa-check"></i><b>15.9</b> Encouraging consistency with marker genes</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html"><i class="fa fa-check"></i><b>16</b> Data integration</a><ul>
<li class="chapter" data-level="16.1" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#abbreviations-3"><i class="fa fa-check"></i><b>16.1</b> Abbreviations</a></li>
<li class="chapter" data-level="16.2" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#motivation-2"><i class="fa fa-check"></i><b>16.2</b> Motivation</a></li>
<li class="chapter" data-level="16.3" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#load-data-4"><i class="fa fa-check"></i><b>16.3</b> Load data</a></li>
<li class="chapter" data-level="16.4" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#loading-the-data-2"><i class="fa fa-check"></i><b>16.4</b> Loading the data</a></li>
<li class="chapter" data-level="16.5" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#diagnosing-batch-effects-2"><i class="fa fa-check"></i><b>16.5</b> Diagnosing batch effects</a></li>
<li class="chapter" data-level="16.6" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#linear-regression-2"><i class="fa fa-check"></i><b>16.6</b> Linear regression</a></li>
<li class="chapter" data-level="16.7" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#performing-mnn-correction-2"><i class="fa fa-check"></i><b>16.7</b> Performing MNN correction</a><ul>
<li class="chapter" data-level="16.7.1" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#algorithm-overview-2"><i class="fa fa-check"></i><b>16.7.1</b> Algorithm overview</a></li>
<li class="chapter" data-level="16.7.2" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#application-to-the-data-2"><i class="fa fa-check"></i><b>16.7.2</b> Application to the data</a></li>
</ul></li>
<li class="chapter" data-level="16.8" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#correction-diagnostics-2"><i class="fa fa-check"></i><b>16.8</b> Correction diagnostics</a><ul>
<li class="chapter" data-level="16.8.1" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#mixing-between-batches-1"><i class="fa fa-check"></i><b>16.8.1</b> Mixing between batches</a></li>
<li class="chapter" data-level="16.8.2" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#preserving-biological-heterogeneity-2"><i class="fa fa-check"></i><b>16.8.2</b> Preserving biological heterogeneity</a><ul>
<li class="chapter" data-level="16.8.2.1" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#comparison-between-within-batch-clusters-and-across-batch-clusters-obtained-after-mnn-correction-1"><i class="fa fa-check"></i><b>16.8.2.1</b> Comparison between within-batch clusters and across-batch clusters obtained after MNN correction</a></li>
<li class="chapter" data-level="16.8.2.2" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#coassignment-probabilities-1"><i class="fa fa-check"></i><b>16.8.2.2</b> Coassignment probabilities</a></li>
<li class="chapter" data-level="16.8.2.3" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#rand-index-1"><i class="fa fa-check"></i><b>16.8.2.3</b> Rand index</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16.9" data-path="dataSetIntegration-HHDTop.html"><a href="dataSetIntegration-HHDTop.html#encouraging-consistency-with-marker-genes-2"><i class="fa fa-check"></i><b>16.9</b> Encouraging consistency with marker genes</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="data-integration.html"><a href="data-integration.html"><i class="fa fa-check"></i><b>17</b> Data integration</a><ul>
<li class="chapter" data-level="17.1" data-path="data-integration.html"><a href="data-integration.html#abbreviations-4"><i class="fa fa-check"></i><b>17.1</b> Abbreviations</a></li>
<li class="chapter" data-level="17.2" data-path="data-integration.html"><a href="data-integration.html#motivation-3"><i class="fa fa-check"></i><b>17.2</b> Motivation</a></li>
<li class="chapter" data-level="17.3" data-path="data-integration.html"><a href="data-integration.html#load-data-5"><i class="fa fa-check"></i><b>17.3</b> Load data</a></li>
<li class="chapter" data-level="17.4" data-path="data-integration.html"><a href="data-integration.html#loading-the-data-3"><i class="fa fa-check"></i><b>17.4</b> Loading the data</a></li>
<li class="chapter" data-level="17.5" data-path="data-integration.html"><a href="data-integration.html#diagnosing-batch-effects-3"><i class="fa fa-check"></i><b>17.5</b> Diagnosing batch effects</a></li>
<li class="chapter" data-level="17.6" data-path="data-integration.html"><a href="data-integration.html#linear-regression-3"><i class="fa fa-check"></i><b>17.6</b> Linear regression</a></li>
<li class="chapter" data-level="17.7" data-path="data-integration.html"><a href="data-integration.html#performing-mnn-correction-3"><i class="fa fa-check"></i><b>17.7</b> Performing MNN correction</a><ul>
<li class="chapter" data-level="17.7.1" data-path="data-integration.html"><a href="data-integration.html#algorithm-overview-3"><i class="fa fa-check"></i><b>17.7.1</b> Algorithm overview</a></li>
<li class="chapter" data-level="17.7.2" data-path="data-integration.html"><a href="data-integration.html#application-to-the-data-3"><i class="fa fa-check"></i><b>17.7.2</b> Application to the data</a></li>
</ul></li>
<li class="chapter" data-level="17.8" data-path="data-integration.html"><a href="data-integration.html#correction-diagnostics-3"><i class="fa fa-check"></i><b>17.8</b> Correction diagnostics</a><ul>
<li class="chapter" data-level="17.8.1" data-path="data-integration.html"><a href="data-integration.html#mixing-between-batches-2"><i class="fa fa-check"></i><b>17.8.1</b> Mixing between batches</a></li>
<li class="chapter" data-level="17.8.2" data-path="data-integration.html"><a href="data-integration.html#preserving-biological-heterogeneity-3"><i class="fa fa-check"></i><b>17.8.2</b> Preserving biological heterogeneity</a><ul>
<li class="chapter" data-level="17.8.2.1" data-path="data-integration.html"><a href="data-integration.html#comparison-between-within-batch-clusters-and-across-batch-clusters-obtained-after-mnn-correction-2"><i class="fa fa-check"></i><b>17.8.2.1</b> Comparison between within-batch clusters and across-batch clusters obtained after MNN correction</a></li>
<li class="chapter" data-level="17.8.2.2" data-path="data-integration.html"><a href="data-integration.html#coassignment-probabilities-2"><i class="fa fa-check"></i><b>17.8.2.2</b> Coassignment probabilities</a></li>
<li class="chapter" data-level="17.8.2.3" data-path="data-integration.html"><a href="data-integration.html#rand-index-2"><i class="fa fa-check"></i><b>17.8.2.3</b> Rand index</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17.9" data-path="data-integration.html"><a href="data-integration.html#encouraging-consistency-with-marker-genes-3"><i class="fa fa-check"></i><b>17.9</b> Encouraging consistency with marker genes</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><i class="fa fa-check"></i><b>18</b> Data integration</a><ul>
<li class="chapter" data-level="18.1" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#abbreviations-5"><i class="fa fa-check"></i><b>18.1</b> Abbreviations</a></li>
<li class="chapter" data-level="18.2" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#motivation-4"><i class="fa fa-check"></i><b>18.2</b> Motivation</a></li>
<li class="chapter" data-level="18.3" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#load-data-6"><i class="fa fa-check"></i><b>18.3</b> Load data</a></li>
<li class="chapter" data-level="18.4" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#loading-the-data-4"><i class="fa fa-check"></i><b>18.4</b> Loading the data</a></li>
<li class="chapter" data-level="18.5" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#diagnosing-batch-effects-4"><i class="fa fa-check"></i><b>18.5</b> Diagnosing batch effects</a></li>
<li class="chapter" data-level="18.6" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#linear-regression-4"><i class="fa fa-check"></i><b>18.6</b> Linear regression</a></li>
<li class="chapter" data-level="18.7" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#performing-mnn-correction-4"><i class="fa fa-check"></i><b>18.7</b> Performing MNN correction</a><ul>
<li class="chapter" data-level="18.7.1" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#algorithm-overview-4"><i class="fa fa-check"></i><b>18.7.1</b> Algorithm overview</a></li>
<li class="chapter" data-level="18.7.2" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#application-to-the-data-4"><i class="fa fa-check"></i><b>18.7.2</b> Application to the data</a></li>
</ul></li>
<li class="chapter" data-level="18.8" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#correction-diagnostics-4"><i class="fa fa-check"></i><b>18.8</b> Correction diagnostics</a><ul>
<li class="chapter" data-level="18.8.1" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#mixing-between-batches-3"><i class="fa fa-check"></i><b>18.8.1</b> Mixing between batches</a></li>
<li class="chapter" data-level="18.8.2" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#preserving-biological-heterogeneity-4"><i class="fa fa-check"></i><b>18.8.2</b> Preserving biological heterogeneity</a><ul>
<li class="chapter" data-level="18.8.2.1" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#comparison-between-within-batch-clusters-and-across-batch-clusters-obtained-after-mnn-correction-3"><i class="fa fa-check"></i><b>18.8.2.1</b> Comparison between within-batch clusters and across-batch clusters obtained after MNN correction</a></li>
<li class="chapter" data-level="18.8.2.2" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#coassignment-probabilities-3"><i class="fa fa-check"></i><b>18.8.2.2</b> Coassignment probabilities</a></li>
<li class="chapter" data-level="18.8.2.3" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#rand-index-3"><i class="fa fa-check"></i><b>18.8.2.3</b> Rand index</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18.9" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#encouraging-consistency-with-marker-genes-4"><i class="fa fa-check"></i><b>18.9</b> Encouraging consistency with marker genes</a></li>
<li class="chapter" data-level="18.10" data-path="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html"><a href="dataSetIntegration-PBMMC-ETV6-RUNX1Top.html#identify-clusters-with-pbmmc-cells"><i class="fa fa-check"></i><b>18.10</b> Identify clusters with PBMMC cells</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="large-cluster-with-moderate-pbmmc-proportion.html"><a href="large-cluster-with-moderate-pbmmc-proportion.html"><i class="fa fa-check"></i><b>19</b> large cluster with moderate PBMMC proportion:</a></li>
<li class="chapter" data-level="20" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html"><i class="fa fa-check"></i><b>20</b> Cluster marker genes</a><ul>
<li class="chapter" data-level="20.1" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#learning-objectives"><i class="fa fa-check"></i><b>20.1</b> Learning objectives</a></li>
<li class="chapter" data-level="20.2" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#load-data-7"><i class="fa fa-check"></i><b>20.2</b> Load data</a></li>
<li class="chapter" data-level="20.3" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#detecting-genes-differentially-expressed-between-clusters"><i class="fa fa-check"></i><b>20.3</b> Detecting genes differentially expressed between clusters</a><ul>
<li class="chapter" data-level="20.3.1" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#differential-expression-analysis"><i class="fa fa-check"></i><b>20.3.1</b> Differential expression analysis</a></li>
<li class="chapter" data-level="20.3.2" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#heatmap"><i class="fa fa-check"></i><b>20.3.2</b> Heatmap</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#using-the-log-fold-change"><i class="fa fa-check"></i><b>20.4</b> Using the log-fold change</a></li>
<li class="chapter" data-level="20.5" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#finding-cluster-specific-markers"><i class="fa fa-check"></i><b>20.5</b> Finding cluster-specific markers</a></li>
<li class="chapter" data-level="20.6" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#using-the-wilcoxon-rank-sum-test"><i class="fa fa-check"></i><b>20.6</b> Using the Wilcoxon rank sum test</a></li>
<li class="chapter" data-level="20.7" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#using-a-binomial-test"><i class="fa fa-check"></i><b>20.7</b> Using a binomial test</a></li>
<li class="chapter" data-level="20.8" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#combining-multiple-marker-statistics"><i class="fa fa-check"></i><b>20.8</b> Combining multiple marker statistics</a></li>
<li class="chapter" data-level="20.9" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#invalidity-of-p-values"><i class="fa fa-check"></i><b>20.9</b> Invalidity of p-values</a><ul>
<li class="chapter" data-level="20.9.1" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#from-data-snooping"><i class="fa fa-check"></i><b>20.9.1</b> 11.5.1 From data snooping</a></li>
<li class="chapter" data-level="20.9.2" data-path="cluster-marker-genes.html"><a href="cluster-marker-genes.html#nature-of-replication"><i class="fa fa-check"></i><b>20.9.2</b> Nature of replication</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">CRUK Bioinformatics Summer School 2020 - single-cell RNA-seq analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="PreProcTop" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Quality Control</h1>
<div id="introduction-3" class="section level2">
<h2><span class="header-section-number">5.1</span> Introduction</h2>
<!--
OSCA chapter 6 Quality Control
-->
<p>We will use two sets of Bone Marrow Mononuclear Cells (BMMC):</p>
<ul>
<li>‘CaronBourque2020’: pediatric samples</li>
<li>‘Hca’: HCA Census of Immune Cells for adult BMMCs</li>
</ul>
<p>Fastq files were retrieved from publicly available archive (SRA and HCA).</p>
<p>Sequencing quality was assessed and visualised using fastQC and MultiQC.</p>
<p>Reads were aligned against GRCh38 and features counted using cellranger (v3.1.0).</p>
<p>We will now check the quality of the data further:</p>
<ul>
<li>mapping quality and amplification rate</li>
<li>cell counts</li>
<li>distribution of keys quality metrics</li>
</ul>
<p>We will then:</p>
<ul>
<li>filter genes with very low expression</li>
<li>identify low-quality cells</li>
<li>filter and/or mark low quality cells</li>
</ul>
<!-- TODO:
- add references and/or links
- add code used to fetch the data or point to script or have chapter for retrieval+QC and for cellranger
-->
</div>
<div id="load-packages-1" class="section level2">
<h2><span class="header-section-number">5.2</span> Load packages</h2>
<ul>
<li>SingleCellExperiment - to store the data</li>
<li>Matrix - to deal with sparse and/or large matrices</li>
<li>DropletUtils - utilities for the analysis of droplet-based, inc. cell counting</li>
<li>scater - QC</li>
<li>scran - normalisation</li>
<li>igraph - graphs</li>
<li>biomaRt - for gene annotation</li>
<li>ggplot2 - for plotting</li>
<li>irlba - for faster PCA</li>
</ul>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="PreProcTop.html#cb263-1"></a>projDir &lt;-<span class="st"> </span>params<span class="op">$</span>projDir</span>
<span id="cb263-2"><a href="PreProcTop.html#cb263-2"></a>wrkDir &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/CaronBourque2020/grch38300&quot;</span>, projDir) </span>
<span id="cb263-3"><a href="PreProcTop.html#cb263-3"></a>outDirBit &lt;-<span class="st"> </span>params<span class="op">$</span>outDirBit <span class="co"># &quot;AnaWiSeurat/Attempt1&quot;</span></span>
<span id="cb263-4"><a href="PreProcTop.html#cb263-4"></a>qcPlotDirBit &lt;-<span class="st"> &quot;Plots/Qc&quot;</span></span>
<span id="cb263-5"><a href="PreProcTop.html#cb263-5"></a>poolBool &lt;-<span class="st"> </span><span class="ot">TRUE</span> <span class="co"># FALSE # whether to read each sample in and pool them and write object to file, or just load that file.</span></span>
<span id="cb263-6"><a href="PreProcTop.html#cb263-6"></a>biomartBool &lt;-<span class="st"> </span><span class="ot">FALSE</span> <span class="co"># TRUE # biomaRt sometimes fails, do it once, write to file and use that copy. See geneAnnot.Rmd</span></span>
<span id="cb263-7"><a href="PreProcTop.html#cb263-7"></a>addQcBool &lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb263-8"><a href="PreProcTop.html#cb263-8"></a>runAll &lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb263-9"><a href="PreProcTop.html#cb263-9"></a>saveRds &lt;-<span class="st"> </span><span class="ot">TRUE</span> <span class="co"># overwrite existing Rds files</span></span>
<span id="cb263-10"><a href="PreProcTop.html#cb263-10"></a><span class="kw">dir.create</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s&quot;</span>, projDir, outDirBit, qcPlotDirBit),</span>
<span id="cb263-11"><a href="PreProcTop.html#cb263-11"></a>           <span class="dt">showWarnings =</span> <span class="ot">FALSE</span>,</span>
<span id="cb263-12"><a href="PreProcTop.html#cb263-12"></a>           <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="PreProcTop.html#cb264-1"></a><span class="kw">print</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s&quot;</span>, projDir, outDirBit, qcPlotDirBit))</span></code></pre></div>
<pre><code>## [1] &quot;/ssd/personal/baller01/20200511_FernandesM_ME_crukBiSs2020/AnaWiSce/Ana1/Plots/Qc&quot;</code></pre>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="PreProcTop.html#cb266-1"></a><span class="kw">dir.create</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects&quot;</span>, projDir, outDirBit),</span>
<span id="cb266-2"><a href="PreProcTop.html#cb266-2"></a>       <span class="dt">showWarnings =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
</div>
<div id="sample-sheet-2" class="section level2">
<h2><span class="header-section-number">5.3</span> Sample sheet</h2>
<p>We will load both the Caron and Hca data sets.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="PreProcTop.html#cb267-1"></a><span class="co"># CaronBourque2020</span></span>
<span id="cb267-2"><a href="PreProcTop.html#cb267-2"></a>cb_sampleSheetFn &lt;-<span class="st"> </span><span class="kw">file.path</span>(projDir, <span class="st">&quot;Data/CaronBourque2020/SraRunTable.txt&quot;</span>)</span>
<span id="cb267-3"><a href="PreProcTop.html#cb267-3"></a><span class="co"># Human Cell Atlas</span></span>
<span id="cb267-4"><a href="PreProcTop.html#cb267-4"></a>hca_sampleSheetFn &lt;-<span class="st"> </span><span class="kw">file.path</span>(projDir, <span class="st">&quot;Data/Hca/accList_Hca.txt&quot;</span>)</span>
<span id="cb267-5"><a href="PreProcTop.html#cb267-5"></a></span>
<span id="cb267-6"><a href="PreProcTop.html#cb267-6"></a><span class="co"># read sample sheet in:</span></span>
<span id="cb267-7"><a href="PreProcTop.html#cb267-7"></a>splShtColToKeep &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Run&quot;</span>, <span class="st">&quot;Sample.Name&quot;</span>, <span class="st">&quot;source_name&quot;</span>)</span>
<span id="cb267-8"><a href="PreProcTop.html#cb267-8"></a></span>
<span id="cb267-9"><a href="PreProcTop.html#cb267-9"></a>cb_sampleSheet &lt;-<span class="st"> </span><span class="kw">read.table</span>(cb_sampleSheetFn, <span class="dt">header=</span>T, <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>)</span>
<span id="cb267-10"><a href="PreProcTop.html#cb267-10"></a>hca_sampleSheet &lt;-<span class="st"> </span><span class="kw">read.table</span>(hca_sampleSheetFn, <span class="dt">header=</span>F, <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>)</span>
<span id="cb267-11"><a href="PreProcTop.html#cb267-11"></a><span class="kw">colnames</span>(hca_sampleSheet) &lt;-<span class="st"> &quot;Sample.Name&quot;</span></span>
<span id="cb267-12"><a href="PreProcTop.html#cb267-12"></a>hca_sampleSheet<span class="op">$</span>Run &lt;-<span class="st"> </span>hca_sampleSheet<span class="op">$</span>Sample.Name</span>
<span id="cb267-13"><a href="PreProcTop.html#cb267-13"></a>hca_sampleSheet<span class="op">$</span>source_name &lt;-<span class="st"> &quot;ABMMC&quot;</span> <span class="co"># adult BMMC</span></span>
<span id="cb267-14"><a href="PreProcTop.html#cb267-14"></a></span>
<span id="cb267-15"><a href="PreProcTop.html#cb267-15"></a>sampleSheet &lt;-<span class="st"> </span><span class="kw">rbind</span>(cb_sampleSheet[,splShtColToKeep], hca_sampleSheet[,splShtColToKeep])</span>
<span id="cb267-16"><a href="PreProcTop.html#cb267-16"></a></span>
<span id="cb267-17"><a href="PreProcTop.html#cb267-17"></a>sampleSheet <span class="op">%&gt;%</span></span>
<span id="cb267-18"><a href="PreProcTop.html#cb267-18"></a><span class="st">    </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb267-19"><a href="PreProcTop.html#cb267-19"></a><span class="st">    </span><span class="kw">datatable</span>(<span class="dt">rownames =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div id="htmlwidget-fec50fd5a6fe461ebfb9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-fec50fd5a6fe461ebfb9">{"x":{"filter":"none","data":[["SRR9264343","SRR9264344","SRR9264345","SRR9264346","SRR9264347","SRR9264348","SRR9264349","SRR9264350","SRR9264351","SRR9264352","SRR9264353","SRR9264354","MantonBM1","MantonBM2","MantonBM3","MantonBM4","MantonBM5","MantonBM6","MantonBM7","MantonBM8"],["GSM3872434","GSM3872435","GSM3872436","GSM3872437","GSM3872438","GSM3872439","GSM3872440","GSM3872441","GSM3872442","GSM3872442","GSM3872443","GSM3872444","MantonBM1","MantonBM2","MantonBM3","MantonBM4","MantonBM5","MantonBM6","MantonBM7","MantonBM8"],["ETV6-RUNX1","ETV6-RUNX1","ETV6-RUNX1","ETV6-RUNX1","HHD","HHD","PRE-T","PRE-T","PBMMC","PBMMC","PBMMC","PBMMC","ABMMC","ABMMC","ABMMC","ABMMC","ABMMC","ABMMC","ABMMC","ABMMC"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Run<\/th>\n      <th>Sample.Name<\/th>\n      <th>source_name<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="data-representation-1" class="section level2">
<h2><span class="header-section-number">5.4</span> Data representation</h2>
<p>We will use a <a href="https://bioconductor.org/packages/SingleCellExperiment/">SingleCellExperiment</a> object that is described <a href="https://www.nature.com/articles/s41592-019-0654-x">here</a> and stores various data types:</p>
<ul>
<li>the count matrix</li>
<li>feature (gene) annotation</li>
<li>droplet annotation</li>
<li>outcome of downstream analysis such as dimensionality reduction</li>
</ul>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="PreProcTop.html#cb268-1"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/Images/tenxLibStructureV3.png&quot;</span>, <span class="st">&quot;..&quot;</span>)</span>
<span id="cb268-2"><a href="PreProcTop.html#cb268-2"></a><span class="kw">print</span>(<span class="kw">getwd</span>())</span></code></pre></div>
<pre><code>## [1] &quot;/ssd/personal/baller01/20200511_FernandesM_ME_crukBiSs2020/AnaWiSce/Ana1/ScriptsMkWiC&quot;</code></pre>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="PreProcTop.html#cb270-1"></a><span class="kw">print</span>(tmpFn)</span></code></pre></div>
<pre><code>## [1] &quot;../Images/tenxLibStructureV3.png&quot;</code></pre>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="PreProcTop.html#cb272-1"></a><span class="kw">print</span>(<span class="kw">file.exists</span>(tmpFn))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="PreProcTop.html#cb274-1"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(tmpFn, <span class="dt">auto_pdf =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="../Images/tenxLibStructureV3.png" width="80%" /></p>
</div>
<div id="example-1" class="section level2">
<h2><span class="header-section-number">5.5</span> Example</h2>
<p>We will load the data for the first sample in the sample sheet: SRR9264343.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="PreProcTop.html#cb275-1"></a>i &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb275-2"><a href="PreProcTop.html#cb275-2"></a>sample.path &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s/outs/raw_feature_bc_matrix/&quot;</span>,</span>
<span id="cb275-3"><a href="PreProcTop.html#cb275-3"></a>                       wrkDir,</span>
<span id="cb275-4"><a href="PreProcTop.html#cb275-4"></a>                       sampleSheet[i,<span class="st">&quot;Run&quot;</span>],</span>
<span id="cb275-5"><a href="PreProcTop.html#cb275-5"></a>                       sampleSheet[i,<span class="st">&quot;Run&quot;</span>])</span>
<span id="cb275-6"><a href="PreProcTop.html#cb275-6"></a>sce.raw &lt;-<span class="st"> </span><span class="kw">read10xCounts</span>(sample.path, <span class="dt">col.names=</span><span class="ot">TRUE</span>)</span>
<span id="cb275-7"><a href="PreProcTop.html#cb275-7"></a>sce.raw</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 33538 737280 
## metadata(1): Samples
## assays(1): counts
## rownames(33538): ENSG00000243485 ENSG00000237613 ... ENSG00000277475
##   ENSG00000268674
## rowData names(3): ID Symbol Type
## colnames(737280): AAACCTGAGAAACCAT-1 AAACCTGAGAAACCGC-1 ...
##   TTTGTCATCTTTAGTC-1 TTTGTCATCTTTCCTC-1
## colData names(2): Sample Barcode
## reducedDimNames(0):
## altExpNames(0):</code></pre>
<p>We can access these different types of data with various functions.</p>
<p>Number of genes and droplets in the count matrix:</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="PreProcTop.html#cb277-1"></a><span class="kw">dim</span>(<span class="kw">counts</span>(sce.raw))</span></code></pre></div>
<pre><code>## [1]  33538 737280</code></pre>
<p>Features, with rowData():</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="PreProcTop.html#cb279-1"></a><span class="kw">head</span>(<span class="kw">rowData</span>(sce.raw))</span></code></pre></div>
<pre><code>## DataFrame with 6 rows and 3 columns
##                              ID      Symbol            Type
##                     &lt;character&gt; &lt;character&gt;     &lt;character&gt;
## ENSG00000243485 ENSG00000243485 MIR1302-2HG Gene Expression
## ENSG00000237613 ENSG00000237613     FAM138A Gene Expression
## ENSG00000186092 ENSG00000186092       OR4F5 Gene Expression
## ENSG00000238009 ENSG00000238009  AL627309.1 Gene Expression
## ENSG00000239945 ENSG00000239945  AL627309.3 Gene Expression
## ENSG00000239906 ENSG00000239906  AL627309.2 Gene Expression</code></pre>
<p>Samples, with colData():</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="PreProcTop.html#cb281-1"></a><span class="kw">head</span>(<span class="kw">colData</span>(sce.raw))</span></code></pre></div>
<pre><code>## DataFrame with 6 rows and 2 columns
##                                    Sample            Barcode
##                               &lt;character&gt;        &lt;character&gt;
## AAACCTGAGAAACCAT-1 /ssd/personal/baller.. AAACCTGAGAAACCAT-1
## AAACCTGAGAAACCGC-1 /ssd/personal/baller.. AAACCTGAGAAACCGC-1
## AAACCTGAGAAACCTA-1 /ssd/personal/baller.. AAACCTGAGAAACCTA-1
## AAACCTGAGAAACGAG-1 /ssd/personal/baller.. AAACCTGAGAAACGAG-1
## AAACCTGAGAAACGCC-1 /ssd/personal/baller.. AAACCTGAGAAACGCC-1
## AAACCTGAGAAAGTGG-1 /ssd/personal/baller.. AAACCTGAGAAAGTGG-1</code></pre>
<p>Single-cell RNA-seq data compared to bulk RNA-seq is sparse, especially with droplet-based methods such as 10X, mostly because:</p>
<ul>
<li>a given cell does not express each gene</li>
<li>the library preparation does not capture all transcript the cell does express</li>
<li>the sequencing depth per cell is far lower</li>
</ul>
<p>Counts, with counts(). Given the large number of droplets in a sample, count matrices can be large. They are however very sparse and can be stored in a ‘sparse matrix’ that only stores non-zero values, for example a ‘dgCMatrix’ object (‘DelayedArray’ class).</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="PreProcTop.html#cb283-1"></a><span class="kw">counts</span>(sce.raw) &lt;-<span class="st"> </span><span class="kw">as</span>(<span class="kw">counts</span>(sce.raw), <span class="st">&quot;dgCMatrix&quot;</span>)</span>
<span id="cb283-2"><a href="PreProcTop.html#cb283-2"></a><span class="kw">counts</span>(sce.raw)[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>## 10 x 10 sparse Matrix of class &quot;dgCMatrix&quot;
##                                    
## ENSG00000243485 . . . . . . . . . .
## ENSG00000237613 . . . . . . . . . .
## ENSG00000186092 . . . . . . . . . .
## ENSG00000238009 . . . . . . . . . .
## ENSG00000239945 . . . . . . . . . .
## ENSG00000239906 . . . . . . . . . .
## ENSG00000241599 . . . . . . . . . .
## ENSG00000236601 . . . . . . . . . .
## ENSG00000284733 . . . . . . . . . .
## ENSG00000235146 . . . . . . . . . .</code></pre>
</div>
<div id="mapping-qc-1" class="section level2">
<h2><span class="header-section-number">5.6</span> Mapping QC</h2>
<div id="gene-body-coverage-1" class="section level3">
<h3><span class="header-section-number">5.6.1</span> Gene body coverage</h3>
<p>The plot below show the average coverage (y-axis) along the body of genes (x-axis).</p>
<!-- In /ssd/personal/baller01/20200511_FernandesM_ME_crukBiSs2020/AnaWiSce/Ana1/ScriptsMkWiC: -->
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="PreProcTop.html#cb285-1"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/Images/1_AAACCTGAGACTTTCG-1.rseqcGeneBodyCovCheck.txt.geneBodyCoverage.curves.png&quot;</span>, <span class="st">&quot;..&quot;</span>)</span>
<span id="cb285-2"><a href="PreProcTop.html#cb285-2"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(tmpFn, <span class="dt">auto_pdf =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="../Images/1_AAACCTGAGACTTTCG-1.rseqcGeneBodyCovCheck.txt.geneBodyCoverage.curves.png" width="80%" /></p>
</div>
<div id="amplification-rate-1" class="section level3">
<h3><span class="header-section-number">5.6.2</span> Amplification rate</h3>
<p>We will use the information stored in the ‘molecule info’ file to count the number of UMI and reads for each gene in each cell.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="PreProcTop.html#cb286-1"></a><span class="co">##mol.info.file &lt;- sprintf(&quot;%s/%s/%s/outs/molecule_info.h5&quot;, wrkDir, sampleSheet[i,&quot;Run&quot;], sampleSheet[i,&quot;Run&quot;])</span></span>
<span id="cb286-2"><a href="PreProcTop.html#cb286-2"></a><span class="co">##mol.info &lt;- read10xMolInfo(mol.info.file)</span></span>
<span id="cb286-3"><a href="PreProcTop.html#cb286-3"></a><span class="co"># or mol.info object if issue with H5Fopen</span></span>
<span id="cb286-4"><a href="PreProcTop.html#cb286-4"></a>i &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb286-5"><a href="PreProcTop.html#cb286-5"></a>mol.info.file &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s/outs/molecule_info_h5.Rds&quot;</span>, wrkDir, sampleSheet[i,<span class="st">&quot;Run&quot;</span>], sampleSheet[i,<span class="st">&quot;Run&quot;</span>])</span>
<span id="cb286-6"><a href="PreProcTop.html#cb286-6"></a>mol.info &lt;-<span class="st"> </span><span class="kw">readRDS</span>(mol.info.file)</span></code></pre></div>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="PreProcTop.html#cb287-1"></a><span class="co"># slow</span></span>
<span id="cb287-2"><a href="PreProcTop.html#cb287-2"></a></span>
<span id="cb287-3"><a href="PreProcTop.html#cb287-3"></a><span class="co"># &#39;data&#39; slot:</span></span>
<span id="cb287-4"><a href="PreProcTop.html#cb287-4"></a>mol.info<span class="op">$</span>data</span></code></pre></div>
<pre><code>## DataFrame with 18544666 rows and 5 columns
##                      cell       umi gem_group      gene     reads
##               &lt;character&gt; &lt;integer&gt; &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;
## 1        AAACCTGAGAAACCTA    467082         1      3287         1
## 2        AAACCTGAGAAACCTA    205888         1      3446         1
## 3        AAACCTGAGAAACCTA    866252         1      3896         3
## 4        AAACCTGAGAAACCTA    796027         1      3969         1
## 5        AAACCTGAGAAACCTA    542561         1      5008         1
## ...                   ...       ...       ...       ...       ...
## 18544662 TTTGTCATCTTTAGTC    927060         1     23634         1
## 18544663 TTTGTCATCTTTAGTC    975865         1     27143         1
## 18544664 TTTGTCATCTTTAGTC    364964         1     27467         4
## 18544665 TTTGTCATCTTTAGTC    152570         1     30125         7
## 18544666 TTTGTCATCTTTAGTC    383230         1     30283         5</code></pre>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="PreProcTop.html#cb289-1"></a><span class="co"># &#39;genes&#39; slot</span></span>
<span id="cb289-2"><a href="PreProcTop.html#cb289-2"></a><span class="kw">head</span>(mol.info<span class="op">$</span>genes)</span></code></pre></div>
<pre><code>## [1] &quot;ENSG00000243485&quot; &quot;ENSG00000237613&quot; &quot;ENSG00000186092&quot; &quot;ENSG00000238009&quot;
## [5] &quot;ENSG00000239945&quot; &quot;ENSG00000239906&quot;</code></pre>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="PreProcTop.html#cb291-1"></a><span class="co"># for each cell and gene, count UMIs</span></span>
<span id="cb291-2"><a href="PreProcTop.html#cb291-2"></a><span class="co"># slow, but needs running, at least once</span></span>
<span id="cb291-3"><a href="PreProcTop.html#cb291-3"></a><span class="co"># so write it to file to load later if need be.</span></span>
<span id="cb291-4"><a href="PreProcTop.html#cb291-4"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/sce_preProc_ampDf1.Rds&quot;</span>, projDir, outDirBit)</span>
<span id="cb291-5"><a href="PreProcTop.html#cb291-5"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">file.exists</span>(tmpFn))</span>
<span id="cb291-6"><a href="PreProcTop.html#cb291-6"></a>{</span>
<span id="cb291-7"><a href="PreProcTop.html#cb291-7"></a>  ampDf &lt;-<span class="st"> </span>mol.info<span class="op">$</span>data <span class="op">%&gt;%</span></span>
<span id="cb291-8"><a href="PreProcTop.html#cb291-8"></a><span class="st">    </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb291-9"><a href="PreProcTop.html#cb291-9"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">umi =</span> <span class="kw">as.character</span>(umi)) <span class="op">%&gt;%</span></span>
<span id="cb291-10"><a href="PreProcTop.html#cb291-10"></a><span class="st">    </span><span class="kw">group_by</span>(cell, gene) <span class="op">%&gt;%</span></span>
<span id="cb291-11"><a href="PreProcTop.html#cb291-11"></a><span class="st">        </span><span class="kw">summarise</span>(<span class="dt">nUmis =</span> <span class="kw">n</span>(),</span>
<span id="cb291-12"><a href="PreProcTop.html#cb291-12"></a>                  <span class="dt">totReads=</span><span class="kw">sum</span>(reads)) <span class="op">%&gt;%</span></span>
<span id="cb291-13"><a href="PreProcTop.html#cb291-13"></a><span class="st">        </span><span class="kw">data.frame</span>()</span>
<span id="cb291-14"><a href="PreProcTop.html#cb291-14"></a></span>
<span id="cb291-15"><a href="PreProcTop.html#cb291-15"></a>    <span class="co"># Write object to file</span></span>
<span id="cb291-16"><a href="PreProcTop.html#cb291-16"></a>    <span class="kw">saveRDS</span>(ampDf, tmpFn)</span>
<span id="cb291-17"><a href="PreProcTop.html#cb291-17"></a>} <span class="cf">else</span> {</span>
<span id="cb291-18"><a href="PreProcTop.html#cb291-18"></a>    ampDf &lt;-<span class="st"> </span><span class="kw">readRDS</span>(tmpFn)</span>
<span id="cb291-19"><a href="PreProcTop.html#cb291-19"></a>}</span>
<span id="cb291-20"><a href="PreProcTop.html#cb291-20"></a><span class="kw">rm</span>(tmpFn)</span>
<span id="cb291-21"><a href="PreProcTop.html#cb291-21"></a></span>
<span id="cb291-22"><a href="PreProcTop.html#cb291-22"></a><span class="co"># distribution of totReads</span></span>
<span id="cb291-23"><a href="PreProcTop.html#cb291-23"></a><span class="kw">summary</span>(ampDf<span class="op">$</span>totReads)</span></code></pre></div>
<pre><code>##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
##     1.00     2.00     6.00    15.23    12.00 79275.00</code></pre>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="PreProcTop.html#cb293-1"></a><span class="co"># distribution of nUmis</span></span>
<span id="cb293-2"><a href="PreProcTop.html#cb293-2"></a><span class="kw">summary</span>(ampDf<span class="op">$</span>nUmis)</span></code></pre></div>
<pre><code>##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
##    1.000    1.000    1.000    2.377    1.000 7137.000</code></pre>
<p>We now plot the amplification rate.</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="PreProcTop.html#cb295-1"></a>sp2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ampDf, <span class="kw">aes</span>(<span class="dt">x=</span>nUmis, <span class="dt">y=</span>totReads)) <span class="op">+</span></span>
<span id="cb295-2"><a href="PreProcTop.html#cb295-2"></a><span class="st">  </span><span class="kw">geom_bin2d</span>(<span class="dt">bins =</span> <span class="dv">50</span>) <span class="op">+</span></span>
<span id="cb295-3"><a href="PreProcTop.html#cb295-3"></a><span class="st">  </span><span class="kw">scale_fill_continuous</span>(<span class="dt">type =</span> <span class="st">&quot;viridis&quot;</span>) <span class="op">+</span></span>
<span id="cb295-4"><a href="PreProcTop.html#cb295-4"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">trans=</span><span class="st">&#39;log10&#39;</span>) <span class="op">+</span></span>
<span id="cb295-5"><a href="PreProcTop.html#cb295-5"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">trans=</span><span class="st">&#39;log10&#39;</span>) <span class="op">+</span></span>
<span id="cb295-6"><a href="PreProcTop.html#cb295-6"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;totReads vs nUmis&quot;</span>) <span class="op">+</span></span>
<span id="cb295-7"><a href="PreProcTop.html#cb295-7"></a><span class="st">  </span><span class="kw">theme_bw</span>()</span>
<span id="cb295-8"><a href="PreProcTop.html#cb295-8"></a></span>
<span id="cb295-9"><a href="PreProcTop.html#cb295-9"></a>sp2</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/ampDf_bin2d-1.png" width="672" /></p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="PreProcTop.html#cb296-1"></a><span class="kw">gc</span>(<span class="dt">verbose=</span><span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>##              used    (Mb) gc trigger    (Mb)   max used    (Mb)
## Ncells    9288829   496.1   13541980   723.3   13541980   723.3
## Vcells 3021432558 23051.8 4895307436 37348.3 4074004374 31082.2</code></pre>
</div>
</div>
<div id="cell-calling-for-droplet-data-1" class="section level2">
<h2><span class="header-section-number">5.7</span> Cell calling for droplet data</h2>
<p>For a given sample, amongst the tens of thousands of droplets used in the assay, some will contain a cell while many others will not. The presence of RNA in a droplet will show with non-zero UMI count. This is however not sufficient to infer that the droplet does contain a cell. Indeed, after sample preparation, some cell debris including RNA will still float in the mix. This ambient RNA is unwillingly captured during library preparation and sequenced.</p>
<p>Cellranger generates a count matrix that includes all droplets analysed in the assay. We will now load this ‘raw matrix’ for one sample and draw the distribution of UMI counts.</p>
<p>Distribution of UMI counts:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="PreProcTop.html#cb298-1"></a>libSizeDf &lt;-<span class="st"> </span>mol.info<span class="op">$</span>data <span class="op">%&gt;%</span></span>
<span id="cb298-2"><a href="PreProcTop.html#cb298-2"></a><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb298-3"><a href="PreProcTop.html#cb298-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">umi =</span> <span class="kw">as.character</span>(umi)) <span class="op">%&gt;%</span></span>
<span id="cb298-4"><a href="PreProcTop.html#cb298-4"></a><span class="st">  </span><span class="kw">group_by</span>(cell) <span class="op">%&gt;%</span></span>
<span id="cb298-5"><a href="PreProcTop.html#cb298-5"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">nUmis =</span> <span class="kw">n</span>(), <span class="dt">totReads=</span><span class="kw">sum</span>(reads)) <span class="op">%&gt;%</span></span>
<span id="cb298-6"><a href="PreProcTop.html#cb298-6"></a><span class="st">    </span><span class="kw">data.frame</span>()</span>
<span id="cb298-7"><a href="PreProcTop.html#cb298-7"></a><span class="kw">rm</span>(mol.info)</span></code></pre></div>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="PreProcTop.html#cb299-1"></a><span class="kw">ggplot</span>(libSizeDf, <span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">log10</span>(nUmis))) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">50</span>)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/nUmis_hist-1.png" width="672" /></p>
<p>Library size varies widely, both amongst empty droplets and droplets carrying cells, mostly due to:</p>
<ul>
<li>variation in droplet size,</li>
<li>amplification efficiency,</li>
<li>sequencing</li>
</ul>
<p>Most cell counting methods try to identify the library size that best distinguishes empty from cell-carrying droplets.</p>
<div id="mixture-model-1" class="section level3">
<h3><span class="header-section-number">5.7.1</span> Mixture model</h3>
<p>This method by default fits a mixture of two normal distributions to the logged library sizes:</p>
<ul>
<li>one with a small mean for empty droplets</li>
<li>the other with a higher mean for cell-carrying droplets</li>
</ul>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="PreProcTop.html#cb300-1"></a><span class="kw">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb300-2"><a href="PreProcTop.html#cb300-2"></a><span class="co"># get package</span></span>
<span id="cb300-3"><a href="PreProcTop.html#cb300-3"></a><span class="kw">library</span>(<span class="st">&quot;mixtools&quot;</span>)</span>
<span id="cb300-4"><a href="PreProcTop.html#cb300-4"></a><span class="co"># have library sizes on a log10 scale</span></span>
<span id="cb300-5"><a href="PreProcTop.html#cb300-5"></a>log10_lib_size &lt;-<span class="st"> </span><span class="kw">log10</span>(libSizeDf<span class="op">$</span>nUmis)</span>
<span id="cb300-6"><a href="PreProcTop.html#cb300-6"></a><span class="co"># fit mixture</span></span>
<span id="cb300-7"><a href="PreProcTop.html#cb300-7"></a>mix &lt;-<span class="st"> </span><span class="kw">normalmixEM</span>(log10_lib_size,</span>
<span id="cb300-8"><a href="PreProcTop.html#cb300-8"></a>           <span class="dt">mu=</span><span class="kw">c</span>(<span class="kw">log10</span>(<span class="dv">100</span>), <span class="kw">log10</span>(<span class="dv">1000</span>)),</span>
<span id="cb300-9"><a href="PreProcTop.html#cb300-9"></a>           <span class="dt">maxrestarts=</span><span class="dv">50</span>,</span>
<span id="cb300-10"><a href="PreProcTop.html#cb300-10"></a>           <span class="dt">epsilon =</span> <span class="fl">1e-03</span>)</span></code></pre></div>
<pre><code>## number of iterations= 29</code></pre>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="PreProcTop.html#cb302-1"></a><span class="co"># plot</span></span>
<span id="cb302-2"><a href="PreProcTop.html#cb302-2"></a><span class="kw">plot</span>(mix, <span class="dt">which=</span><span class="dv">2</span>, <span class="dt">xlab2=</span><span class="st">&quot;log(mol per cell)&quot;</span>)</span>
<span id="cb302-3"><a href="PreProcTop.html#cb302-3"></a><span class="co"># get density for each distribution:</span></span>
<span id="cb302-4"><a href="PreProcTop.html#cb302-4"></a>p1 &lt;-<span class="st"> </span><span class="kw">dnorm</span>(log10_lib_size, <span class="dt">mean=</span>mix<span class="op">$</span>mu[<span class="dv">1</span>], <span class="dt">sd=</span>mix<span class="op">$</span>sigma[<span class="dv">1</span>])</span>
<span id="cb302-5"><a href="PreProcTop.html#cb302-5"></a>p2 &lt;-<span class="st"> </span><span class="kw">dnorm</span>(log10_lib_size, <span class="dt">mean=</span>mix<span class="op">$</span>mu[<span class="dv">2</span>], <span class="dt">sd=</span>mix<span class="op">$</span>sigma[<span class="dv">2</span>])</span>
<span id="cb302-6"><a href="PreProcTop.html#cb302-6"></a><span class="co"># find intersection:</span></span>
<span id="cb302-7"><a href="PreProcTop.html#cb302-7"></a><span class="cf">if</span> (mix<span class="op">$</span>mu[<span class="dv">1</span>] <span class="op">&lt;</span><span class="st"> </span>mix<span class="op">$</span>mu[<span class="dv">2</span>]) {</span>
<span id="cb302-8"><a href="PreProcTop.html#cb302-8"></a>    split &lt;-<span class="st"> </span><span class="kw">min</span>(log10_lib_size[p2 <span class="op">&gt;</span><span class="st"> </span>p1])</span>
<span id="cb302-9"><a href="PreProcTop.html#cb302-9"></a>} <span class="cf">else</span> {</span>
<span id="cb302-10"><a href="PreProcTop.html#cb302-10"></a>    split &lt;-<span class="st"> </span><span class="kw">min</span>(log10_lib_size[p1 <span class="op">&gt;</span><span class="st"> </span>p2])</span>
<span id="cb302-11"><a href="PreProcTop.html#cb302-11"></a>}</span>
<span id="cb302-12"><a href="PreProcTop.html#cb302-12"></a><span class="co"># show split on plot:</span></span>
<span id="cb302-13"><a href="PreProcTop.html#cb302-13"></a><span class="kw">abline</span>(<span class="dt">v=</span>split, <span class="dt">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/cellCall_mixtools-1.png" width="672" /></p>
</div>
<div id="barcode-rank-plot-1" class="section level3">
<h3><span class="header-section-number">5.7.2</span> Barcode rank plot</h3>
<p>The barcode rank plot shows the library sizes against their rank in decreasing order,
for the first 10000 droplets only.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="PreProcTop.html#cb303-1"></a>barcode_rank &lt;-<span class="st"> </span><span class="kw">rank</span>(<span class="op">-</span>libSizeDf<span class="op">$</span>nUmis)</span>
<span id="cb303-2"><a href="PreProcTop.html#cb303-2"></a><span class="kw">plot</span>(barcode_rank, libSizeDf<span class="op">$</span>nUmis, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">10000</span>), <span class="dt">ylab=</span><span class="st">&quot;library size&quot;</span>)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/cellCall_barcodeRankPlot_initScale-1.png" width="672" /></p>
<p>Given the exponential shape of the curve above, library sizes can be shown on the log10 scale:</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="PreProcTop.html#cb304-1"></a><span class="kw">plot</span>(barcode_rank, log10_lib_size, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">10000</span>))</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/cellCall_barcodeRankPlot_logScale-1.png" width="672" /></p>
<p>The plot above shows that the majority of droplets have fewer than 100 UMIs, e.g. droplets with rank greater than 4000. We will redraw the plot to focus on droplets with lower ranks, by using the log10 scale for the x-axis.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="PreProcTop.html#cb305-1"></a><span class="kw">plot</span>(<span class="kw">log10</span>(barcode_rank), log10_lib_size, <span class="dt">xlim=</span><span class="kw">log10</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">10000</span>)))</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/cellCall_barcodeRankPlot_logScale2-1.png" width="672" /></p>
<p>The point on the curve where it drops sharply may be used as the split point. Before that point library sizes are high, because droplets carry a cell. After that point, library sizes are far smaller because droplets do not carry a cell, only ambient RNA (… or do they?).</p>
<p>Here, we could ‘visually’ approximate the number of cells to 2500. There are however more robust and convenient methods.</p>
</div>
<div id="inflection-point-1" class="section level3">
<h3><span class="header-section-number">5.7.3</span> Inflection point</h3>
<p>We could also compute the inflection point of the curve.</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="PreProcTop.html#cb306-1"></a>o &lt;-<span class="st"> </span><span class="kw">order</span>(barcode_rank)</span>
<span id="cb306-2"><a href="PreProcTop.html#cb306-2"></a>log10_lib_size &lt;-<span class="st"> </span>log10_lib_size[o]</span>
<span id="cb306-3"><a href="PreProcTop.html#cb306-3"></a>barcode_rank &lt;-<span class="st"> </span>barcode_rank[o]</span>
<span id="cb306-4"><a href="PreProcTop.html#cb306-4"></a></span>
<span id="cb306-5"><a href="PreProcTop.html#cb306-5"></a>rawdiff &lt;-<span class="st"> </span><span class="kw">diff</span>(log10_lib_size)<span class="op">/</span><span class="kw">diff</span>(barcode_rank)</span>
<span id="cb306-6"><a href="PreProcTop.html#cb306-6"></a>inflection &lt;-<span class="st"> </span><span class="kw">which</span>(rawdiff <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(rawdiff[<span class="dv">100</span><span class="op">:</span><span class="kw">length</span>(rawdiff)], <span class="dt">na.rm=</span><span class="ot">TRUE</span>))</span>
<span id="cb306-7"><a href="PreProcTop.html#cb306-7"></a></span>
<span id="cb306-8"><a href="PreProcTop.html#cb306-8"></a><span class="kw">plot</span>(<span class="dt">x=</span><span class="kw">log10</span>(barcode_rank),</span>
<span id="cb306-9"><a href="PreProcTop.html#cb306-9"></a>     <span class="dt">y=</span>log10_lib_size,</span>
<span id="cb306-10"><a href="PreProcTop.html#cb306-10"></a>     <span class="dt">xlim=</span><span class="kw">log10</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">10000</span>)))</span>
<span id="cb306-11"><a href="PreProcTop.html#cb306-11"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="kw">log10</span>(inflection), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/cellCall_inflex-1.png" width="672" /></p>
<p>The inflection is at 3279 UMIs (3.5157414 on the log10 scale).
2306 droplets have at least these many UMIs and would thus contain one cell (or more).</p>
</div>
<div id="cellranger-v1-and-v2-1" class="section level3">
<h3><span class="header-section-number">5.7.4</span> Cellranger v1 and v2</h3>
<p>Given an expected number of cells, cellranger used to assume a ~10-fold range of library sizes for real cells and estimate this range (cellranger v1 and v2). The threshold was defined as the 99th quantile of the library size, divided by 10.</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="PreProcTop.html#cb307-1"></a><span class="co"># approximate number of cells expected:</span></span>
<span id="cb307-2"><a href="PreProcTop.html#cb307-2"></a>n_cells &lt;-<span class="st"> </span><span class="dv">2500</span></span>
<span id="cb307-3"><a href="PreProcTop.html#cb307-3"></a><span class="co"># CellRanger</span></span>
<span id="cb307-4"><a href="PreProcTop.html#cb307-4"></a>totals &lt;-<span class="st"> </span><span class="kw">sort</span>(libSizeDf<span class="op">$</span>nUmis, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)</span>
<span id="cb307-5"><a href="PreProcTop.html#cb307-5"></a><span class="co"># 99th percentile of top n_cells divided by 10</span></span>
<span id="cb307-6"><a href="PreProcTop.html#cb307-6"></a>thresh =<span class="st"> </span>totals[<span class="kw">round</span>(<span class="fl">0.01</span><span class="op">*</span>n_cells)]<span class="op">/</span><span class="dv">10</span></span>
<span id="cb307-7"><a href="PreProcTop.html#cb307-7"></a><span class="co">#plot(log10(totals), xlim=c(1,10000))</span></span>
<span id="cb307-8"><a href="PreProcTop.html#cb307-8"></a><span class="kw">plot</span>(<span class="dt">x=</span><span class="kw">log10</span>(<span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">10000</span>)),</span>
<span id="cb307-9"><a href="PreProcTop.html#cb307-9"></a>     <span class="dt">y=</span><span class="kw">log10</span>(totals)[<span class="dv">1</span><span class="op">:</span><span class="dv">10000</span>]</span>
<span id="cb307-10"><a href="PreProcTop.html#cb307-10"></a>     )</span>
<span id="cb307-11"><a href="PreProcTop.html#cb307-11"></a><span class="kw">abline</span>(<span class="dt">h=</span><span class="kw">log10</span>(thresh), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/cellCall_cellrangerV1n2-1.png" width="672" /></p>
<p>The threshold is at 1452 UMIs and 2773 cells are detected.</p>
</div>
<div id="dropletutils-and-emptydrops-1" class="section level3">
<h3><span class="header-section-number">5.7.5</span> DropletUtils and EmptyDrops</h3>
<p>The <code>DropletUtils</code> package offers utilities to analyse droplet-based data, including cell counting using the library size as seen above. These simple approaches may exclude droplets with small or quiet cells with low RNA content. The <code>emptyDrops</code> method calls cells by first computing the expression profile for droplets with RNA content so low they almost certainly do not contain any cell: the ‘background’ or ‘ambient’ profile. The method then tests each non-background droplet for significant difference in expression profile.</p>
<p>Let’s first check the knee and inflection methods.</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="PreProcTop.html#cb308-1"></a>br.out &lt;-<span class="st"> </span><span class="kw">barcodeRanks</span>(<span class="kw">counts</span>(sce.raw))</span>
<span id="cb308-2"><a href="PreProcTop.html#cb308-2"></a><span class="kw">plot</span>(br.out<span class="op">$</span>rank, br.out<span class="op">$</span>total, <span class="dt">log=</span><span class="st">&quot;xy&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Rank&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Total UMI count&quot;</span>)</span>
<span id="cb308-3"><a href="PreProcTop.html#cb308-3"></a>o &lt;-<span class="st"> </span><span class="kw">order</span>(br.out<span class="op">$</span>rank)</span>
<span id="cb308-4"><a href="PreProcTop.html#cb308-4"></a><span class="kw">lines</span>(br.out<span class="op">$</span>rank[o], br.out<span class="op">$</span>fitted[o], <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb308-5"><a href="PreProcTop.html#cb308-5"></a></span>
<span id="cb308-6"><a href="PreProcTop.html#cb308-6"></a><span class="kw">abline</span>(<span class="dt">h=</span><span class="kw">metadata</span>(br.out)<span class="op">$</span>knee, <span class="dt">col=</span><span class="st">&quot;dodgerblue&quot;</span>, <span class="dt">lty=</span><span class="dv">2</span>)</span>
<span id="cb308-7"><a href="PreProcTop.html#cb308-7"></a><span class="kw">abline</span>(<span class="dt">h=</span><span class="kw">metadata</span>(br.out)<span class="op">$</span>inflection, <span class="dt">col=</span><span class="st">&quot;forestgreen&quot;</span>, <span class="dt">lty=</span><span class="dv">2</span>)</span>
<span id="cb308-8"><a href="PreProcTop.html#cb308-8"></a><span class="kw">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;dodgerblue&quot;</span>, <span class="st">&quot;forestgreen&quot;</span>), </span>
<span id="cb308-9"><a href="PreProcTop.html#cb308-9"></a>    <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;knee&quot;</span>, <span class="st">&quot;inflection&quot;</span>))</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/cellCall_dropletUtils-1.png" width="672" /></p>
<p>Testing for empty droplets.</p>
<p>We will call cells with a false discovery rate (FDR) of 0.1% so that at most 1 in 1000 droplets called may be empty.</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="PreProcTop.html#cb309-1"></a><span class="co"># a bit slow</span></span>
<span id="cb309-2"><a href="PreProcTop.html#cb309-2"></a><span class="co"># significance is computed by simulation so we set a seed for reproducibility</span></span>
<span id="cb309-3"><a href="PreProcTop.html#cb309-3"></a><span class="kw">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb309-4"><a href="PreProcTop.html#cb309-4"></a><span class="co"># run analysis:</span></span>
<span id="cb309-5"><a href="PreProcTop.html#cb309-5"></a>e.out &lt;-<span class="st"> </span><span class="kw">emptyDrops</span>(<span class="kw">counts</span>(sce.raw))</span>
<span id="cb309-6"><a href="PreProcTop.html#cb309-6"></a>e.out</span></code></pre></div>
<pre><code>## DataFrame with 737280 rows and 5 columns
##                        Total   LogProb    PValue   Limited       FDR
##                    &lt;integer&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;logical&gt; &lt;numeric&gt;
## AAACCTGAGAAACCAT-1         0        NA        NA        NA        NA
## AAACCTGAGAAACCGC-1         0        NA        NA        NA        NA
## AAACCTGAGAAACCTA-1        31        NA        NA        NA        NA
## AAACCTGAGAAACGAG-1         0        NA        NA        NA        NA
## AAACCTGAGAAACGCC-1         0        NA        NA        NA        NA
## ...                      ...       ...       ...       ...       ...
## TTTGTCATCTTTACAC-1         0        NA        NA        NA        NA
## TTTGTCATCTTTACGT-1         1        NA        NA        NA        NA
## TTTGTCATCTTTAGGG-1         0        NA        NA        NA        NA
## TTTGTCATCTTTAGTC-1        26        NA        NA        NA        NA
## TTTGTCATCTTTCCTC-1         0        NA        NA        NA        NA</code></pre>
<p>NAs are assigned to droplets used to compute the ambient profile.</p>
<p>Get numbers of droplets in each class defined by FDR and the cut-off used:</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="PreProcTop.html#cb311-1"></a><span class="kw">summary</span>(e.out<span class="op">$</span>FDR <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.001</span>)</span></code></pre></div>
<pre><code>##    Mode   FALSE    TRUE    NA&#39;s 
## logical     487    3075  733718</code></pre>
<p>The test significance is computed by permutation. For each droplet tested, the number of permutations may limit the value of the p-value. This information is available in the ‘Limited’ column. If ‘Limited’ is ‘TRUE’ for any non-significant droplet, the number of permutations was too low, should be increased and the analysis re-run.</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="PreProcTop.html#cb313-1"></a><span class="kw">table</span>(<span class="dt">Sig=</span>e.out<span class="op">$</span>FDR <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.001</span>, <span class="dt">Limited=</span>e.out<span class="op">$</span>Limited)</span></code></pre></div>
<pre><code>##        Limited
## Sig     FALSE TRUE
##   FALSE   487    0
##   TRUE     76 2999</code></pre>
<p>Let’s check that the background comprises only empty droplets. If the droplets used to define the background profile are indeed empty, testing them should result in a flat distribution of p-values. Let’s test the ‘ambient’ droplets and draw the p-value distribution.</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="PreProcTop.html#cb315-1"></a><span class="kw">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb315-2"><a href="PreProcTop.html#cb315-2"></a>limit &lt;-<span class="st"> </span><span class="dv">100</span>   </span>
<span id="cb315-3"><a href="PreProcTop.html#cb315-3"></a>all.out &lt;-<span class="st"> </span><span class="kw">emptyDrops</span>(<span class="kw">counts</span>(sce.raw), <span class="dt">lower=</span>limit, <span class="dt">test.ambient=</span><span class="ot">TRUE</span>)</span>
<span id="cb315-4"><a href="PreProcTop.html#cb315-4"></a><span class="kw">hist</span>(all.out<span class="op">$</span>PValue[all.out<span class="op">$</span>Total <span class="op">&lt;=</span><span class="st"> </span>limit <span class="op">&amp;</span><span class="st"> </span>all.out<span class="op">$</span>Total <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>],</span>
<span id="cb315-5"><a href="PreProcTop.html#cb315-5"></a>    <span class="dt">xlab=</span><span class="st">&quot;P-value&quot;</span>, <span class="dt">main=</span><span class="st">&quot;&quot;</span>, <span class="dt">col=</span><span class="st">&quot;grey80&quot;</span>) </span></code></pre></div>
<p><img src="MkWiC_files/figure-html/cellCall_emptyDrops_sigEmpty-1.png" width="672" /></p>
<p>The distribution of p-values looks uniform with no large peak for small values: no cell in these droplets.</p>
<p>To evaluate the outcome of the analysis, we will plot the strength of the evidence against library size.</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="PreProcTop.html#cb316-1"></a>is.cell &lt;-<span class="st"> </span>e.out<span class="op">$</span>FDR <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.001</span></span></code></pre></div>
<p>Number of cells detected: 3075.</p>
<p>The plot plot shows the strength of the evidence against the library size.
Each point is a droplet coloured:</p>
<ul>
<li>in black if without cell,</li>
<li>in red if with a cell (or more)</li>
<li>in green if with a cell (or more) as defined with <code>emptyDrops</code> but not the inflection method.</li>
</ul>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="PreProcTop.html#cb317-1"></a><span class="co"># colour:</span></span>
<span id="cb317-2"><a href="PreProcTop.html#cb317-2"></a>cellColour &lt;-<span class="st"> </span><span class="kw">ifelse</span>(is.cell, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;black&quot;</span>) <span class="co"># rep(&quot;black&quot;, nrow((e.out)))</span></span>
<span id="cb317-3"><a href="PreProcTop.html#cb317-3"></a><span class="co"># boolean for presence of cells as defined by the inflection method</span></span>
<span id="cb317-4"><a href="PreProcTop.html#cb317-4"></a>tmpBoolInflex &lt;-<span class="st"> </span>e.out<span class="op">$</span>Total <span class="op">&gt;</span><span class="st"> </span><span class="kw">metadata</span>(br.out)<span class="op">$</span>inflection</span>
<span id="cb317-5"><a href="PreProcTop.html#cb317-5"></a><span class="co"># boolean for presence of cells as defined by the emptyDrops method</span></span>
<span id="cb317-6"><a href="PreProcTop.html#cb317-6"></a>tmpBoolSmall &lt;-<span class="st"> </span>e.out<span class="op">$</span>FDR <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.001</span></span>
<span id="cb317-7"><a href="PreProcTop.html#cb317-7"></a>tmpBoolRecov &lt;-<span class="st"> </span><span class="op">!</span>tmpBoolInflex <span class="op">&amp;</span><span class="st"> </span>tmpBoolSmall</span>
<span id="cb317-8"><a href="PreProcTop.html#cb317-8"></a>cellColour[tmpBoolRecov] &lt;-<span class="st"> &quot;green&quot;</span> <span class="co"># &#39;recovered&#39; cells</span></span>
<span id="cb317-9"><a href="PreProcTop.html#cb317-9"></a></span>
<span id="cb317-10"><a href="PreProcTop.html#cb317-10"></a><span class="co"># plot strength of significance vs library size</span></span>
<span id="cb317-11"><a href="PreProcTop.html#cb317-11"></a><span class="kw">plot</span>(<span class="kw">log10</span>(e.out<span class="op">$</span>Total),</span>
<span id="cb317-12"><a href="PreProcTop.html#cb317-12"></a>     <span class="op">-</span>e.out<span class="op">$</span>LogProb,</span>
<span id="cb317-13"><a href="PreProcTop.html#cb317-13"></a>     <span class="dt">col=</span>cellColour,</span>
<span id="cb317-14"><a href="PreProcTop.html#cb317-14"></a>     <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="kw">max</span>(<span class="kw">log10</span>(e.out<span class="op">$</span>Total))),</span>
<span id="cb317-15"><a href="PreProcTop.html#cb317-15"></a>     <span class="dt">xlab=</span><span class="st">&quot;Total UMI count&quot;</span>,</span>
<span id="cb317-16"><a href="PreProcTop.html#cb317-16"></a>     <span class="dt">ylab=</span><span class="st">&quot;-Log Probability&quot;</span>)</span>
<span id="cb317-17"><a href="PreProcTop.html#cb317-17"></a></span>
<span id="cb317-18"><a href="PreProcTop.html#cb317-18"></a><span class="co"># add point to show &#39;recovered&#39; cell on top</span></span>
<span id="cb317-19"><a href="PreProcTop.html#cb317-19"></a><span class="kw">points</span>(<span class="kw">log10</span>(e.out<span class="op">$</span>Total)[tmpBoolRecov],</span>
<span id="cb317-20"><a href="PreProcTop.html#cb317-20"></a>       <span class="op">-</span>e.out<span class="op">$</span>LogProb[tmpBoolRecov],</span>
<span id="cb317-21"><a href="PreProcTop.html#cb317-21"></a>       <span class="dt">pch=</span><span class="dv">16</span>,</span>
<span id="cb317-22"><a href="PreProcTop.html#cb317-22"></a>       <span class="dt">col=</span><span class="st">&quot;green&quot;</span>)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/cellCall_emptyDrops_diagPlot-1.png" width="672" /></p>
<p>Let’s filter out empty droplets.</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="PreProcTop.html#cb318-1"></a>sce.ed &lt;-<span class="st"> </span>sce.raw[,<span class="kw">which</span>(e.out<span class="op">$</span>FDR <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.001</span>)] <span class="co"># &#39;ed&#39; for empty droplet</span></span>
<span id="cb318-2"><a href="PreProcTop.html#cb318-2"></a><span class="kw">rm</span>(sce.raw);</span>
<span id="cb318-3"><a href="PreProcTop.html#cb318-3"></a><span class="kw">gc</span>();</span></code></pre></div>
<pre><code>##              used    (Mb) gc trigger    (Mb)   max used    (Mb)
## Ncells    9521622   508.6   16305648   870.9   16305648   870.9
## Vcells 1404540205 10715.8 2765812427 21101.5 2297115936 17525.7</code></pre>
<p>And check the new SCE object:</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="PreProcTop.html#cb320-1"></a>sce.ed</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 33538 3075 
## metadata(1): Samples
## assays(1): counts
## rownames(33538): ENSG00000243485 ENSG00000237613 ... ENSG00000277475
##   ENSG00000268674
## rowData names(3): ID Symbol Type
## colnames(3075): AAACCTGAGACTTTCG-1 AAACCTGGTCTTCAAG-1 ...
##   TTTGTCACAGGCTCAC-1 TTTGTCAGTTCGGCAC-1
## colData names(2): Sample Barcode
## reducedDimNames(0):
## altExpNames(0):</code></pre>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="PreProcTop.html#cb322-1"></a><span class="kw">rm</span>(sce.ed)</span></code></pre></div>
<p>Cell calling in cellranger v3 uses a method similar to emptyDrops() and a ‘filtered matrix’ is generated that only keeps droplets deemed to contain a cell (or more). We will load these filtered matrices now.</p>
</div>
</div>
<div id="load-filtered-matrices-1" class="section level2">
<h2><span class="header-section-number">5.8</span> Load filtered matrices</h2>
<p>Each sample was analysed with cellranger separately. We load filtered matrices one sample at a time, showing for each the name and number of features and cells.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="PreProcTop.html#cb323-1"></a><span class="co"># load data:</span></span>
<span id="cb323-2"><a href="PreProcTop.html#cb323-2"></a><span class="co"># a bit slow</span></span>
<span id="cb323-3"><a href="PreProcTop.html#cb323-3"></a><span class="co"># use &#39;cache.lazy = FALSE&#39; to avoid &#39;long vectors not supported yet&#39; when &#39;cache=TRUE&#39;</span></span>
<span id="cb323-4"><a href="PreProcTop.html#cb323-4"></a></span>
<span id="cb323-5"><a href="PreProcTop.html#cb323-5"></a>sce.list &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dt">length =</span> <span class="kw">nrow</span>(sampleSheet))</span>
<span id="cb323-6"><a href="PreProcTop.html#cb323-6"></a></span>
<span id="cb323-7"><a href="PreProcTop.html#cb323-7"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(sampleSheet))</span>
<span id="cb323-8"><a href="PreProcTop.html#cb323-8"></a>{</span>
<span id="cb323-9"><a href="PreProcTop.html#cb323-9"></a>    <span class="kw">print</span>(<span class="kw">sprintf</span>(<span class="st">&quot;&#39;Run&#39; %s, &#39;Sample.Name&#39; %s&quot;</span>, sampleSheet[i,<span class="st">&quot;Run&quot;</span>], sampleSheet[i,<span class="st">&quot;Sample.Name&quot;</span>]))</span>
<span id="cb323-10"><a href="PreProcTop.html#cb323-10"></a>    sample.path &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s/outs/filtered_feature_bc_matrix/&quot;</span>,</span>
<span id="cb323-11"><a href="PreProcTop.html#cb323-11"></a>                  <span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/grch38300&quot;</span>,</span>
<span id="cb323-12"><a href="PreProcTop.html#cb323-12"></a>                      projDir,</span>
<span id="cb323-13"><a href="PreProcTop.html#cb323-13"></a>                      <span class="kw">ifelse</span>(sampleSheet[i,<span class="st">&quot;source_name&quot;</span>] <span class="op">==</span><span class="st"> &quot;ABMMC&quot;</span>,</span>
<span id="cb323-14"><a href="PreProcTop.html#cb323-14"></a>                         <span class="st">&quot;Hca&quot;</span>,</span>
<span id="cb323-15"><a href="PreProcTop.html#cb323-15"></a>                         <span class="st">&quot;CaronBourque2020&quot;</span>)),</span>
<span id="cb323-16"><a href="PreProcTop.html#cb323-16"></a>                  sampleSheet[i,<span class="st">&quot;Run&quot;</span>],</span>
<span id="cb323-17"><a href="PreProcTop.html#cb323-17"></a>                  sampleSheet[i,<span class="st">&quot;Run&quot;</span>])</span>
<span id="cb323-18"><a href="PreProcTop.html#cb323-18"></a>    sce.list[[i]] &lt;-<span class="st"> </span><span class="kw">read10xCounts</span>(sample.path)</span>
<span id="cb323-19"><a href="PreProcTop.html#cb323-19"></a>    <span class="kw">print</span>(<span class="kw">dim</span>(sce.list[[i]]))</span>
<span id="cb323-20"><a href="PreProcTop.html#cb323-20"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;&#39;Run&#39; SRR9264343, &#39;Sample.Name&#39; GSM3872434&quot;
## [1] 33538  3088
## [1] &quot;&#39;Run&#39; SRR9264344, &#39;Sample.Name&#39; GSM3872435&quot;
## [1] 33538  6678
## [1] &quot;&#39;Run&#39; SRR9264345, &#39;Sample.Name&#39; GSM3872436&quot;
## [1] 33538  5054
## [1] &quot;&#39;Run&#39; SRR9264346, &#39;Sample.Name&#39; GSM3872437&quot;
## [1] 33538  6096
## [1] &quot;&#39;Run&#39; SRR9264347, &#39;Sample.Name&#39; GSM3872438&quot;
## [1] 33538  5442
## [1] &quot;&#39;Run&#39; SRR9264348, &#39;Sample.Name&#39; GSM3872439&quot;
## [1] 33538  5502
## [1] &quot;&#39;Run&#39; SRR9264349, &#39;Sample.Name&#39; GSM3872440&quot;
## [1] 33538  4126
## [1] &quot;&#39;Run&#39; SRR9264350, &#39;Sample.Name&#39; GSM3872441&quot;
## [1] 33538  3741
## [1] &quot;&#39;Run&#39; SRR9264351, &#39;Sample.Name&#39; GSM3872442&quot;
## [1] 33538   978
## [1] &quot;&#39;Run&#39; SRR9264352, &#39;Sample.Name&#39; GSM3872442&quot;
## [1] 33538  1150
## [1] &quot;&#39;Run&#39; SRR9264353, &#39;Sample.Name&#39; GSM3872443&quot;
## [1] 33538  4964
## [1] &quot;&#39;Run&#39; SRR9264354, &#39;Sample.Name&#39; GSM3872444&quot;
## [1] 33538  4255
## [1] &quot;&#39;Run&#39; MantonBM1, &#39;Sample.Name&#39; MantonBM1&quot;
## [1] 33538 23283
## [1] &quot;&#39;Run&#39; MantonBM2, &#39;Sample.Name&#39; MantonBM2&quot;
## [1] 33538 25055
## [1] &quot;&#39;Run&#39; MantonBM3, &#39;Sample.Name&#39; MantonBM3&quot;
## [1] 33538 24548
## [1] &quot;&#39;Run&#39; MantonBM4, &#39;Sample.Name&#39; MantonBM4&quot;
## [1] 33538 26478
## [1] &quot;&#39;Run&#39; MantonBM5, &#39;Sample.Name&#39; MantonBM5&quot;
## [1] 33538 26383
## [1] &quot;&#39;Run&#39; MantonBM6, &#39;Sample.Name&#39; MantonBM6&quot;
## [1] 33538 22801
## [1] &quot;&#39;Run&#39; MantonBM7, &#39;Sample.Name&#39; MantonBM7&quot;
## [1] 33538 24372
## [1] &quot;&#39;Run&#39; MantonBM8, &#39;Sample.Name&#39; MantonBM8&quot;
## [1] 33538 24860</code></pre>
<p>Let’s combine all 20 samples into a single object.</p>
<p>We first check the feature lists are identical.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="PreProcTop.html#cb325-1"></a><span class="co"># check row names are the same</span></span>
<span id="cb325-2"><a href="PreProcTop.html#cb325-2"></a><span class="co"># compare to that for the first sample</span></span>
<span id="cb325-3"><a href="PreProcTop.html#cb325-3"></a></span>
<span id="cb325-4"><a href="PreProcTop.html#cb325-4"></a>rowNames1 &lt;-<span class="st"> </span><span class="kw">rownames</span>(sce.list[[<span class="dv">1</span>]])</span>
<span id="cb325-5"><a href="PreProcTop.html#cb325-5"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw">nrow</span>(sampleSheet))</span>
<span id="cb325-6"><a href="PreProcTop.html#cb325-6"></a>{</span>
<span id="cb325-7"><a href="PreProcTop.html#cb325-7"></a>    <span class="kw">print</span>(<span class="kw">identical</span>(rowNames1, <span class="kw">rownames</span>(sce.list[[i]])))</span>
<span id="cb325-8"><a href="PreProcTop.html#cb325-8"></a>}</span></code></pre></div>
<pre><code>## [1] TRUE
## [1] TRUE
## [1] TRUE
## [1] TRUE
## [1] TRUE
## [1] TRUE
## [1] TRUE
## [1] TRUE
## [1] TRUE
## [1] TRUE
## [1] TRUE
## [1] TRUE
## [1] TRUE
## [1] TRUE
## [1] TRUE
## [1] TRUE
## [1] TRUE
## [1] TRUE
## [1] TRUE</code></pre>
<p>A cell barcode comprises the actual sequence and a ‘group ID’, e.g. AAACCTGAGAAACCAT-1. The latter helps distinguish cells with identical barcode sequence but come from different samples. As each sample was analysed separately, the group ID is set to 1 in all data sets. To pool these data sets we first need to change group IDs so cell barcodes are unique across all samples. We will use the position of the sample in the sample sheet.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="PreProcTop.html#cb327-1"></a><span class="co"># subset 2000 cells:</span></span>
<span id="cb327-2"><a href="PreProcTop.html#cb327-2"></a><span class="co"># mind that is not mentioned in Rds file names ...</span></span>
<span id="cb327-3"><a href="PreProcTop.html#cb327-3"></a><span class="cf">if</span>(<span class="kw">ncol</span>(sce.list[[<span class="dv">1</span>]]) <span class="op">&lt;</span><span class="st"> </span><span class="dv">2000</span>)</span>
<span id="cb327-4"><a href="PreProcTop.html#cb327-4"></a>{</span>
<span id="cb327-5"><a href="PreProcTop.html#cb327-5"></a>  sce &lt;-<span class="st"> </span>sce.list[[<span class="dv">1</span>]]</span>
<span id="cb327-6"><a href="PreProcTop.html#cb327-6"></a>} <span class="cf">else</span> {</span>
<span id="cb327-7"><a href="PreProcTop.html#cb327-7"></a>  sce &lt;-<span class="st"> </span>sce.list[[<span class="dv">1</span>]][, <span class="kw">sample</span>(<span class="kw">ncol</span>(sce.list[[<span class="dv">1</span>]]), <span class="dv">2000</span>)]</span>
<span id="cb327-8"><a href="PreProcTop.html#cb327-8"></a>}</span>
<span id="cb327-9"><a href="PreProcTop.html#cb327-9"></a></span>
<span id="cb327-10"><a href="PreProcTop.html#cb327-10"></a><span class="kw">colData</span>(sce)<span class="op">$</span>Barcode &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;([0-9])$&quot;</span>, <span class="dv">1</span>, <span class="kw">colData</span>(sce)<span class="op">$</span>Barcode)</span>
<span id="cb327-11"><a href="PreProcTop.html#cb327-11"></a><span class="kw">print</span>(<span class="kw">head</span>(<span class="kw">colData</span>(sce)<span class="op">$</span>Barcode))</span></code></pre></div>
<pre><code>## [1] &quot;GATGCTAGTATCAGTC-1&quot; &quot;GTCCTCAGTCCAAGTT-1&quot; &quot;CGCGTTTAGGCTAGCA-1&quot;
## [4] &quot;GGATTACGTGCGAAAC-1&quot; &quot;CGTTGGGCAGCCAATT-1&quot; &quot;GTGCGGTGTCATTAGC-1&quot;</code></pre>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="PreProcTop.html#cb329-1"></a><span class="kw">print</span>(<span class="kw">tail</span>(<span class="kw">colData</span>(sce)<span class="op">$</span>Barcode))</span></code></pre></div>
<pre><code>## [1] &quot;CGTCCATAGATTACCC-1&quot; &quot;CAGCCGACATCCCATC-1&quot; &quot;GCAGCCACACTTCTGC-1&quot;
## [4] &quot;CAAGATCGTCGGCACT-1&quot; &quot;GTAACGTTCCCATTAT-1&quot; &quot;TTCGGTCAGGGTTCCC-1&quot;</code></pre>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="PreProcTop.html#cb331-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw">nrow</span>(sampleSheet))</span>
<span id="cb331-2"><a href="PreProcTop.html#cb331-2"></a>{</span>
<span id="cb331-3"><a href="PreProcTop.html#cb331-3"></a>  <span class="cf">if</span>(<span class="kw">ncol</span>(sce.list[[i]]) <span class="op">&lt;</span><span class="st"> </span><span class="dv">2000</span>)</span>
<span id="cb331-4"><a href="PreProcTop.html#cb331-4"></a>  {</span>
<span id="cb331-5"><a href="PreProcTop.html#cb331-5"></a>      sce.tmp &lt;-<span class="st"> </span>sce.list[[i]]</span>
<span id="cb331-6"><a href="PreProcTop.html#cb331-6"></a>  } <span class="cf">else</span> {</span>
<span id="cb331-7"><a href="PreProcTop.html#cb331-7"></a>    sce.tmp &lt;-<span class="st"> </span>sce.list[[i]][, <span class="kw">sample</span>(<span class="kw">ncol</span>(sce.list[[i]]), <span class="dv">2000</span>)]</span>
<span id="cb331-8"><a href="PreProcTop.html#cb331-8"></a>  }</span>
<span id="cb331-9"><a href="PreProcTop.html#cb331-9"></a>    <span class="kw">colData</span>(sce.tmp)<span class="op">$</span>Barcode &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;([0-9])$&quot;</span>, i, <span class="kw">colData</span>(sce.tmp)<span class="op">$</span>Barcode)</span>
<span id="cb331-10"><a href="PreProcTop.html#cb331-10"></a>    sce &lt;-<span class="st"> </span><span class="kw">cbind</span>(sce, sce.tmp)</span>
<span id="cb331-11"><a href="PreProcTop.html#cb331-11"></a>    <span class="kw">print</span>(<span class="kw">tail</span>(<span class="kw">colData</span>(sce)<span class="op">$</span>Barcode, <span class="dv">2</span>))</span>
<span id="cb331-12"><a href="PreProcTop.html#cb331-12"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;AGAGTGGCACCAGTTA-2&quot; &quot;AACACGTGTACCTACA-2&quot;
## [1] &quot;CGGCTAGAGCTGAACG-3&quot; &quot;TAGCCGGAGTTAGCGG-3&quot;
## [1] &quot;ACACCAAGTCAGAAGC-4&quot; &quot;AAGGTTCAGGCCGAAT-4&quot;
## [1] &quot;AGGGTGAAGAGTCGGT-5&quot; &quot;CTGCGGAGTGAGTATA-5&quot;
## [1] &quot;GGCGACTGTGTTTGGT-6&quot; &quot;TTGGAACAGTGTACTC-6&quot;
## [1] &quot;TGTGGTACACTTACGA-7&quot; &quot;ACTGAGTTCTATCGCC-7&quot;
## [1] &quot;GTCACAACAATCGGTT-8&quot; &quot;CTACATTGTCTCTCGT-8&quot;
## [1] &quot;TTTGGTTGTGCATCTA-9&quot; &quot;TTTGTCACAGCTCGAC-9&quot;
## [1] &quot;TTTGTCAGTAAATGTG-10&quot; &quot;TTTGTCAGTACAAGTA-10&quot;
## [1] &quot;TGCGGGTAGCGTAGTG-11&quot; &quot;CTAGAGTCAAAGTGCG-11&quot;
## [1] &quot;GCAATCAAGGCTATCT-12&quot; &quot;GGGTCTGCATAAGACA-12&quot;
## [1] &quot;TATCTCAGTCATATCG-13&quot; &quot;TCGTACCTCTGGTATG-13&quot;
## [1] &quot;CGTTCTGCAGCTGTTA-14&quot; &quot;TCGCGAGTCATCTGCC-14&quot;
## [1] &quot;ACTTACTCAGGTTTCA-15&quot; &quot;ACTGCTCTCGGTTAAC-15&quot;
## [1] &quot;AGAGTGGCAAAGGCGT-16&quot; &quot;ACACCCTAGATCCCGC-16&quot;
## [1] &quot;GCTGGGTAGGCTCATT-17&quot; &quot;TGTTCCGCACAGACAG-17&quot;
## [1] &quot;CTACATTGTAGCGATG-18&quot; &quot;TGGGCGTCACACCGCA-18&quot;
## [1] &quot;TTCCCAGCAGGGTACA-19&quot; &quot;GTTCTCGGTCCTCCAT-19&quot;
## [1] &quot;GCTGGGTCATAACCTG-20&quot; &quot;TATGCCCCAGCGTCCA-20&quot;</code></pre>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="PreProcTop.html#cb333-1"></a><span class="kw">rm</span>(sce.list)</span></code></pre></div>
<p>We now add the sample sheet information to the object metadata.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="PreProcTop.html#cb334-1"></a>colDataOrig &lt;-<span class="st"> </span><span class="kw">colData</span>(sce)</span>
<span id="cb334-2"><a href="PreProcTop.html#cb334-2"></a></span>
<span id="cb334-3"><a href="PreProcTop.html#cb334-3"></a><span class="co"># split path:</span></span>
<span id="cb334-4"><a href="PreProcTop.html#cb334-4"></a>tmpList &lt;-<span class="st"> </span><span class="kw">strsplit</span>(colDataOrig<span class="op">$</span>Sample, <span class="dt">split=</span><span class="st">&quot;/&quot;</span>)</span>
<span id="cb334-5"><a href="PreProcTop.html#cb334-5"></a><span class="co"># get Run ID, to use to match sample in the meta data and sample sheet objects:</span></span>
<span id="cb334-6"><a href="PreProcTop.html#cb334-6"></a>tmpVec &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(tmpList, <span class="cf">function</span>(x){x[<span class="dv">9</span>]}))</span>
<span id="cb334-7"><a href="PreProcTop.html#cb334-7"></a><span class="kw">colData</span>(sce)<span class="op">$</span>Run &lt;-<span class="st"> </span>tmpVec</span>
<span id="cb334-8"><a href="PreProcTop.html#cb334-8"></a><span class="co"># remove path to filtered matrix files by sample name in &#39;Sample&#39;:</span></span>
<span id="cb334-9"><a href="PreProcTop.html#cb334-9"></a><span class="kw">colData</span>(sce)<span class="op">$</span>Sample &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb334-10"><a href="PreProcTop.html#cb334-10"></a><span class="co"># merge:</span></span>
<span id="cb334-11"><a href="PreProcTop.html#cb334-11"></a><span class="kw">colData</span>(sce) &lt;-<span class="st"> </span><span class="kw">colData</span>(sce) <span class="op">%&gt;%</span></span>
<span id="cb334-12"><a href="PreProcTop.html#cb334-12"></a><span class="st">  </span>data.frame <span class="op">%&gt;%</span></span>
<span id="cb334-13"><a href="PreProcTop.html#cb334-13"></a><span class="st">  </span><span class="kw">left_join</span>(sampleSheet[,splShtColToKeep], <span class="st">&quot;Run&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb334-14"><a href="PreProcTop.html#cb334-14"></a><span class="st">  </span><span class="kw">relocate</span>() <span class="op">%&gt;%</span></span>
<span id="cb334-15"><a href="PreProcTop.html#cb334-15"></a><span class="st">  </span>DataFrame</span></code></pre></div>
<p>Let’s save the object for future reference.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="PreProcTop.html#cb335-1"></a><span class="co"># Write object to file</span></span>
<span id="cb335-2"><a href="PreProcTop.html#cb335-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/sce_postPool.Rds&quot;</span>,</span>
<span id="cb335-3"><a href="PreProcTop.html#cb335-3"></a>         projDir, outDirBit)</span>
<span id="cb335-4"><a href="PreProcTop.html#cb335-4"></a><span class="kw">saveRDS</span>(sce, tmpFn)</span></code></pre></div>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="PreProcTop.html#cb336-1"></a><span class="co"># Read object in:</span></span>
<span id="cb336-2"><a href="PreProcTop.html#cb336-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/sce_postPool.Rds&quot;</span>,</span>
<span id="cb336-3"><a href="PreProcTop.html#cb336-3"></a>         projDir, outDirBit)</span>
<span id="cb336-4"><a href="PreProcTop.html#cb336-4"></a>sce &lt;-<span class="st"> </span><span class="kw">readRDS</span>(tmpFn)</span></code></pre></div>
</div>
<div id="properties-of-scrna-seq-data-1" class="section level2">
<h2><span class="header-section-number">5.9</span> Properties of scRNA-seq data</h2>
<p>The number and identity of genes detected in a cell vary across cells: the total number of genes detected across all cells is far larger than the number of genes detected in each cell.</p>
<p>Total number of genes detected across cells:</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="PreProcTop.html#cb337-1"></a><span class="co"># for each gene, compute total number of UMIs across all cells,</span></span>
<span id="cb337-2"><a href="PreProcTop.html#cb337-2"></a><span class="co"># then counts genes with at least one UMI:</span></span>
<span id="cb337-3"><a href="PreProcTop.html#cb337-3"></a><span class="kw">sum</span>(<span class="kw">rowSums</span>(<span class="kw">counts</span>(sce)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] 25116</code></pre>
<p>Summary of the distribution of the number of genes detected per cell:</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="PreProcTop.html#cb339-1"></a><span class="co"># for each cell count number of genes with at least 1 UMI</span></span>
<span id="cb339-2"><a href="PreProcTop.html#cb339-2"></a><span class="co"># then compute distribution moments:</span></span>
<span id="cb339-3"><a href="PreProcTop.html#cb339-3"></a><span class="kw">summary</span>(<span class="kw">colSums</span>(<span class="kw">counts</span>(sce) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>))</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##      26     717     940    1228    1521    6586</code></pre>
<p>Now let’s plot for each gene the total number of UMIs and the proportion of cells that express it. Lowly expressed genes tend to be detected in a large proportion of cells. The higher the overall expression the lower the proportion of cells.</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="PreProcTop.html#cb341-1"></a><span class="co"># randomly subset 1000 cells.</span></span>
<span id="cb341-2"><a href="PreProcTop.html#cb341-2"></a>tmpCounts &lt;-<span class="st"> </span><span class="kw">counts</span>(sce)[,<span class="kw">sample</span>(<span class="dv">1000</span>)]</span>
<span id="cb341-3"><a href="PreProcTop.html#cb341-3"></a></span>
<span id="cb341-4"><a href="PreProcTop.html#cb341-4"></a><span class="kw">plot</span>(<span class="kw">rowSums</span>(tmpCounts),</span>
<span id="cb341-5"><a href="PreProcTop.html#cb341-5"></a>     <span class="kw">rowMeans</span>(tmpCounts <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>),</span>
<span id="cb341-6"><a href="PreProcTop.html#cb341-6"></a>     <span class="dt">log =</span> <span class="st">&quot;x&quot;</span>,</span>
<span id="cb341-7"><a href="PreProcTop.html#cb341-7"></a>     <span class="dt">xlab=</span><span class="st">&quot;total number of UMIs&quot;</span>,</span>
<span id="cb341-8"><a href="PreProcTop.html#cb341-8"></a>     <span class="dt">ylab=</span><span class="st">&quot;proportion of cells expressing the gene&quot;</span></span>
<span id="cb341-9"><a href="PreProcTop.html#cb341-9"></a>)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Count genes that are not ‘expressed’ (detected):</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="PreProcTop.html#cb342-1"></a>not.expressed &lt;-<span class="st"> </span><span class="kw">rowSums</span>(<span class="kw">counts</span>(sce)) <span class="op">==</span><span class="st"> </span><span class="dv">0</span></span>
<span id="cb342-2"><a href="PreProcTop.html#cb342-2"></a><span class="kw">table</span>(not.expressed)</span></code></pre></div>
<pre><code>## not.expressed
## FALSE  TRUE 
## 25116  8422</code></pre>
<p>Plot the percentage of counts per gene and show genes with the highest UMI counts:</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="PreProcTop.html#cb344-1"></a><span class="co">#Compute the relative expression of each gene per cell</span></span>
<span id="cb344-2"><a href="PreProcTop.html#cb344-2"></a>rel_expression &lt;-<span class="st"> </span><span class="kw">t</span>( <span class="kw">t</span>(<span class="kw">counts</span>(sce)) <span class="op">/</span><span class="st"> </span>Matrix<span class="op">::</span><span class="kw">colSums</span>(<span class="kw">counts</span>(sce))) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></span>
<span id="cb344-3"><a href="PreProcTop.html#cb344-3"></a><span class="kw">rownames</span>(rel_expression) &lt;-<span class="st"> </span><span class="kw">rowData</span>(sce)<span class="op">$</span>Symbol</span>
<span id="cb344-4"><a href="PreProcTop.html#cb344-4"></a>most_expressed &lt;-<span class="st"> </span><span class="kw">sort</span>(Matrix<span class="op">::</span><span class="kw">rowSums</span>( rel_expression ),T)[<span class="dv">20</span><span class="op">:</span><span class="dv">1</span>] <span class="op">/</span><span class="st"> </span><span class="kw">ncol</span>(sce)</span>
<span id="cb344-5"><a href="PreProcTop.html#cb344-5"></a></span>
<span id="cb344-6"><a href="PreProcTop.html#cb344-6"></a><span class="kw">boxplot</span>( <span class="kw">as.matrix</span>(<span class="kw">t</span>(rel_expression[<span class="kw">names</span>(most_expressed),])),</span>
<span id="cb344-7"><a href="PreProcTop.html#cb344-7"></a>    <span class="dt">cex=</span>.<span class="dv">1</span>,</span>
<span id="cb344-8"><a href="PreProcTop.html#cb344-8"></a>    <span class="dt">las=</span><span class="dv">1</span>,</span>
<span id="cb344-9"><a href="PreProcTop.html#cb344-9"></a>    <span class="dt">xlab=</span><span class="st">&quot;% total count per cell&quot;</span>,</span>
<span id="cb344-10"><a href="PreProcTop.html#cb344-10"></a>    <span class="dt">col=</span>scales<span class="op">::</span><span class="kw">hue_pal</span>()(<span class="dv">20</span>)[<span class="dv">20</span><span class="op">:</span><span class="dv">1</span>],</span>
<span id="cb344-11"><a href="PreProcTop.html#cb344-11"></a>    <span class="dt">horizontal=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>Mind that we have combined two data sets here. It may be interesting to count non-expressed genes in each set separately.</p>
</div>
<div id="quality-control-1" class="section level2">
<h2><span class="header-section-number">5.10</span> Quality control</h2>
<!-- https://osca.bioconductor.org/quality-control.html -->
<p>Cell calling performed above does not inform on the quality of the library in each of the droplets kept. Poor-quality cells, or rather droplets, may be caused by cell damage during dissociation or failed library preparation. They usually have low UMI counts, few genes detected and/or high mitochondrial content. The presence may affect normalisation, assessment of cell population heterogeneity, clustering and trajectory:</p>
<ul>
<li>Normalisation: Contaminating genes, ‘the ambient RNA’, are detected at low levels in all libraires. In low quality libraries with low RNA content, scaling will increase counts for these genes more than for better-quality cells, resulting in their apparent upregulation in these cells and increased variance overall.</li>
<li>Cell population heterogeneity: variance estimation and dimensionality reduction with PCA where the first principal component will be correlated with library size, rather than biology.</li>
<li>Clustering and trajectory: higher mitochondrial and/or nuclear RNA content may cause low-quality cells to cluster separately or form states or trajectories between distinct cell types.</li>
</ul>
<p>We will now exclude lowly expressed features and identify low-quality cells using the following metrics mostly:</p>
<ul>
<li>library size, i.e. the total number of UMIs per cell</li>
<li>number of features detected per cell</li>
<li>mitochondrial content, i.e. the proportion of UMIs that map to mitochondrial genes, with higher values consistent with leakage from the cytoplasm of RNA, but not mitochondria</li>
</ul>
<p>We will first annotate genes, to know which ones are mitochondrial, then use <a href="https://bioconductor.org/packages/3.11/bioc/html/scater.html">scater</a>’s <code>addPerCellQC()</code> to compute various metrics.</p>
<p>Annotate genes with biomaRt.</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="PreProcTop.html#cb345-1"></a><span class="co"># retrieve the feature information</span></span>
<span id="cb345-2"><a href="PreProcTop.html#cb345-2"></a>gene.info &lt;-<span class="st"> </span><span class="kw">rowData</span>(sce)</span>
<span id="cb345-3"><a href="PreProcTop.html#cb345-3"></a></span>
<span id="cb345-4"><a href="PreProcTop.html#cb345-4"></a><span class="co"># setup the biomaRt connection to Ensembl using the correct species genome (hsapiens_gene_ensembl)</span></span>
<span id="cb345-5"><a href="PreProcTop.html#cb345-5"></a>ensembl &lt;-<span class="st"> </span><span class="kw">useEnsembl</span>(<span class="dt">biomart=</span><span class="st">&#39;ensembl&#39;</span>,</span>
<span id="cb345-6"><a href="PreProcTop.html#cb345-6"></a>                      <span class="dt">dataset=</span><span class="st">&#39;hsapiens_gene_ensembl&#39;</span>,</span>
<span id="cb345-7"><a href="PreProcTop.html#cb345-7"></a>                      <span class="dt">mirror =</span> <span class="st">&quot;www&quot;</span>)</span>
<span id="cb345-8"><a href="PreProcTop.html#cb345-8"></a></span>
<span id="cb345-9"><a href="PreProcTop.html#cb345-9"></a><span class="co">#ensembl = useMart(biomart=&quot;ensembl&quot;,</span></span>
<span id="cb345-10"><a href="PreProcTop.html#cb345-10"></a><span class="co">#         dataset=&#39;hsapiens_gene_ensembl&#39;,</span></span>
<span id="cb345-11"><a href="PreProcTop.html#cb345-11"></a><span class="co">#         host = &quot;www.ensembl.org&quot;) # ensemblRedirect = FALSE</span></span>
<span id="cb345-12"><a href="PreProcTop.html#cb345-12"></a></span>
<span id="cb345-13"><a href="PreProcTop.html#cb345-13"></a><span class="co"># retrieve the attributes of interest from biomaRt using the Ensembl gene ID as the key</span></span>
<span id="cb345-14"><a href="PreProcTop.html#cb345-14"></a><span class="co"># beware that this will only retrieve information for matching IDs</span></span>
<span id="cb345-15"><a href="PreProcTop.html#cb345-15"></a>gene_symbol &lt;-<span class="st"> </span><span class="kw">getBM</span>(<span class="dt">attributes=</span><span class="kw">c</span>(<span class="st">&#39;ensembl_gene_id&#39;</span>,</span>
<span id="cb345-16"><a href="PreProcTop.html#cb345-16"></a>                                  <span class="st">&#39;external_gene_name&#39;</span>,</span>
<span id="cb345-17"><a href="PreProcTop.html#cb345-17"></a>                                  <span class="st">&#39;chromosome_name&#39;</span>,</span>
<span id="cb345-18"><a href="PreProcTop.html#cb345-18"></a>                                  <span class="st">&#39;start_position&#39;</span>,</span>
<span id="cb345-19"><a href="PreProcTop.html#cb345-19"></a>                                  <span class="st">&#39;end_position&#39;</span>,</span>
<span id="cb345-20"><a href="PreProcTop.html#cb345-20"></a>                                  <span class="st">&#39;strand&#39;</span>),</span>
<span id="cb345-21"><a href="PreProcTop.html#cb345-21"></a>                     <span class="dt">filters=</span><span class="st">&#39;ensembl_gene_id&#39;</span>,</span>
<span id="cb345-22"><a href="PreProcTop.html#cb345-22"></a>                     <span class="dt">mart=</span>ensembl,</span>
<span id="cb345-23"><a href="PreProcTop.html#cb345-23"></a>                     <span class="dt">values=</span>gene.info[, <span class="dv">1</span>])</span>
<span id="cb345-24"><a href="PreProcTop.html#cb345-24"></a></span>
<span id="cb345-25"><a href="PreProcTop.html#cb345-25"></a><span class="co"># create a new data frame of the feature information</span></span>
<span id="cb345-26"><a href="PreProcTop.html#cb345-26"></a>gene.merge &lt;-<span class="st"> </span><span class="kw">merge</span>(gene_symbol, gene.info, <span class="dt">by.x=</span><span class="kw">c</span>(<span class="st">&#39;ensembl_gene_id&#39;</span>), <span class="dt">by.y=</span><span class="kw">c</span>(<span class="st">&#39;ID&#39;</span>), <span class="dt">all.y=</span><span class="ot">TRUE</span>)</span>
<span id="cb345-27"><a href="PreProcTop.html#cb345-27"></a><span class="kw">rownames</span>(gene.merge) &lt;-<span class="st"> </span>gene.merge<span class="op">$</span>ensembl_gene_id</span>
<span id="cb345-28"><a href="PreProcTop.html#cb345-28"></a></span>
<span id="cb345-29"><a href="PreProcTop.html#cb345-29"></a><span class="co"># set the order for the same as the original gene information</span></span>
<span id="cb345-30"><a href="PreProcTop.html#cb345-30"></a>gene.merge &lt;-<span class="st"> </span>gene.merge[gene.info[, <span class="dv">1</span>], ]</span>
<span id="cb345-31"><a href="PreProcTop.html#cb345-31"></a></span>
<span id="cb345-32"><a href="PreProcTop.html#cb345-32"></a><span class="co"># reset the rowdata on the SCE object to contain all of this information</span></span>
<span id="cb345-33"><a href="PreProcTop.html#cb345-33"></a><span class="kw">rowData</span>(sce) &lt;-<span class="st"> </span>gene.merge</span></code></pre></div>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="PreProcTop.html#cb346-1"></a><span class="co"># slow</span></span>
<span id="cb346-2"><a href="PreProcTop.html#cb346-2"></a><span class="co"># Write object to file</span></span>
<span id="cb346-3"><a href="PreProcTop.html#cb346-3"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/sce_postBiomart.Rds&quot;</span>,</span>
<span id="cb346-4"><a href="PreProcTop.html#cb346-4"></a>         projDir, outDirBit)</span>
<span id="cb346-5"><a href="PreProcTop.html#cb346-5"></a><span class="kw">saveRDS</span>(sce, tmpFn)</span></code></pre></div>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="PreProcTop.html#cb347-1"></a><span class="co"># Read object in:</span></span>
<span id="cb347-2"><a href="PreProcTop.html#cb347-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/sce_postBiomart.Rds&quot;</span>,</span>
<span id="cb347-3"><a href="PreProcTop.html#cb347-3"></a>         projDir, outDirBit)</span>
<span id="cb347-4"><a href="PreProcTop.html#cb347-4"></a>sce &lt;-<span class="st"> </span><span class="kw">readRDS</span>(tmpFn)</span></code></pre></div>
<p>Number of genes per chromosome, inc. 13 on the mitochondrial genome:</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="PreProcTop.html#cb348-1"></a><span class="co"># number of genes per chromosome</span></span>
<span id="cb348-2"><a href="PreProcTop.html#cb348-2"></a><span class="kw">table</span>(<span class="kw">rowData</span>(sce)<span class="op">$</span>chromosome_name) <span class="op">%&gt;%</span></span>
<span id="cb348-3"><a href="PreProcTop.html#cb348-3"></a><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb348-4"><a href="PreProcTop.html#cb348-4"></a>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">Chromosome=</span>Var1, <span class="dt">NbGenes=</span>Freq) <span class="op">%&gt;%</span></span>
<span id="cb348-5"><a href="PreProcTop.html#cb348-5"></a><span class="kw">datatable</span>(<span class="dt">rownames =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div id="htmlwidget-d1d54e0db7765b9794ce" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-d1d54e0db7765b9794ce">{"x":{"filter":"none","data":[["1","10","11","12","13","14","15","16","17","18","19","2","20","21","22","3","4","5","6","7","8","9","GL000009.2","GL000194.1","GL000195.1","GL000205.2","GL000213.1","GL000218.1","GL000219.1","KI270711.1","KI270713.1","KI270721.1","KI270726.1","KI270727.1","KI270728.1","KI270731.1","KI270734.1","MT","X","Y"],[3127,1221,1910,1748,662,1380,1121,1518,1880,654,1989,2263,889,499,831,1704,1345,1646,1616,1526,1303,1211,1,2,2,1,1,1,1,1,2,1,2,4,6,1,3,13,1067,97]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Chromosome<\/th>\n      <th>NbGenes<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="PreProcTop.html#cb349-1"></a><span class="co"># mitochondrial genes</span></span>
<span id="cb349-2"><a href="PreProcTop.html#cb349-2"></a>is.mito &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">rowData</span>(sce)<span class="op">$</span>chromosome_name<span class="op">==</span><span class="st">&quot;MT&quot;</span>)</span></code></pre></div>
<p>Calculate and store QC metrics for genes with addPerFeatureQC() and for cells with addPerCellQC().</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="PreProcTop.html#cb350-1"></a><span class="co"># long</span></span>
<span id="cb350-2"><a href="PreProcTop.html#cb350-2"></a><span class="co"># for genes</span></span>
<span id="cb350-3"><a href="PreProcTop.html#cb350-3"></a>sce &lt;-<span class="st"> </span><span class="kw">addPerFeatureQC</span>(sce)</span>
<span id="cb350-4"><a href="PreProcTop.html#cb350-4"></a><span class="kw">head</span>(<span class="kw">rowData</span>(sce)) <span class="op">%&gt;%</span></span>
<span id="cb350-5"><a href="PreProcTop.html#cb350-5"></a><span class="st">    </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb350-6"><a href="PreProcTop.html#cb350-6"></a><span class="st">    </span><span class="kw">datatable</span>(<span class="dt">rownames =</span> <span class="ot">FALSE</span>) <span class="co"># ENS ID</span></span></code></pre></div>
<div id="htmlwidget-b021b8afbeed2cb0938a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b021b8afbeed2cb0938a">{"x":{"filter":"none","data":[["ENSG00000243485","ENSG00000237613","ENSG00000186092","ENSG00000238009","ENSG00000239945","ENSG00000239906"],["MIR1302-2HG","FAM138A","OR4F5","AL627309.1","AL627309.3","AL627309.2"],["1","1","1","1","1","1"],[29554,34554,65419,89295,89551,139790],[31109,36081,71585,133723,91105,140339],[1,-1,1,-1,-1,-1],["MIR1302-2HG","FAM138A","OR4F5","AL627309.1","AL627309.3","AL627309.2"],["Gene Expression","Gene Expression","Gene Expression","Gene Expression","Gene Expression","Gene Expression"],[0,0,0,0.00086550566512799,5.24548887956358e-05,0],[0,0,0,0.086550566512799,0.00524548887956358,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>ensembl_gene_id<\/th>\n      <th>external_gene_name<\/th>\n      <th>chromosome_name<\/th>\n      <th>start_position<\/th>\n      <th>end_position<\/th>\n      <th>strand<\/th>\n      <th>Symbol<\/th>\n      <th>Type<\/th>\n      <th>mean<\/th>\n      <th>detected<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[3,4,5,8,9]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Three columns of interest for cells:</p>
<ul>
<li>‘sum’: total UMI count</li>
<li>‘detected’: number of features (genes) detected</li>
<li>‘subsets_Mito_percent’: percentage of reads mapped to mitochondrial transcripts</li>
</ul>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="PreProcTop.html#cb351-1"></a><span class="co"># for cells</span></span>
<span id="cb351-2"><a href="PreProcTop.html#cb351-2"></a>sce &lt;-<span class="st"> </span><span class="kw">addPerCellQC</span>(sce, <span class="dt">subsets=</span><span class="kw">list</span>(<span class="dt">Mito=</span>is.mito))</span>
<span id="cb351-3"><a href="PreProcTop.html#cb351-3"></a><span class="kw">head</span>(<span class="kw">colData</span>(sce)) <span class="op">%&gt;%</span></span>
<span id="cb351-4"><a href="PreProcTop.html#cb351-4"></a><span class="st">    </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb351-5"><a href="PreProcTop.html#cb351-5"></a><span class="st">    </span><span class="kw">datatable</span>(<span class="dt">rownames =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div id="htmlwidget-34f1d1e71fb370b98714" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-34f1d1e71fb370b98714">{"x":{"filter":"none","data":[["GATGCTAGTATCAGTC-1","GTCCTCAGTCCAAGTT-1","CGCGTTTAGGCTAGCA-1","GGATTACGTGCGAAAC-1","CGTTGGGCAGCCAATT-1","GTGCGGTGTCATTAGC-1"],["SRR9264343","SRR9264343","SRR9264343","SRR9264343","SRR9264343","SRR9264343"],["GSM3872434","GSM3872434","GSM3872434","GSM3872434","GSM3872434","GSM3872434"],["ETV6-RUNX1","ETV6-RUNX1","ETV6-RUNX1","ETV6-RUNX1","ETV6-RUNX1","ETV6-RUNX1"],[4301,573,4379,4989,3900,4108],[1550,331,1675,1867,1528,1579],[265,22,225,244,263,288],[11,7,12,11,12,12],[6.16135782376192,3.83944153577661,5.13815939712263,4.89075967127681,6.74358974358974,7.01071080817916],[4301,573,4379,4989,3900,4108]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Barcode<\/th>\n      <th>Run<\/th>\n      <th>Sample.Name<\/th>\n      <th>source_name<\/th>\n      <th>sum<\/th>\n      <th>detected<\/th>\n      <th>subsets_Mito_sum<\/th>\n      <th>subsets_Mito_detected<\/th>\n      <th>subsets_Mito_percent<\/th>\n      <th>total<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[4,5,6,7,8,9]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="PreProcTop.html#cb352-1"></a><span class="co"># Write object to file</span></span>
<span id="cb352-2"><a href="PreProcTop.html#cb352-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/sce_postAddQc.Rds&quot;</span>,</span>
<span id="cb352-3"><a href="PreProcTop.html#cb352-3"></a>         projDir, outDirBit)</span>
<span id="cb352-4"><a href="PreProcTop.html#cb352-4"></a><span class="kw">saveRDS</span>(sce, tmpFn)</span></code></pre></div>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="PreProcTop.html#cb353-1"></a><span class="co"># Read object in:</span></span>
<span id="cb353-2"><a href="PreProcTop.html#cb353-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/sce_postAddQc.Rds&quot;</span>,</span>
<span id="cb353-3"><a href="PreProcTop.html#cb353-3"></a>         projDir, outDirBit)</span>
<span id="cb353-4"><a href="PreProcTop.html#cb353-4"></a>sce &lt;-<span class="st"> </span><span class="kw">readRDS</span>(tmpFn)</span></code></pre></div>
<div id="qc-metric-distribution-1" class="section level3">
<h3><span class="header-section-number">5.10.1</span> QC metric distribution</h3>
<p>Overall:</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="PreProcTop.html#cb354-1"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb354-2"><a href="PreProcTop.html#cb354-2"></a><span class="kw">hist</span>(<span class="kw">log10</span>(sce<span class="op">$</span>sum), <span class="dt">breaks=</span><span class="dv">20</span>, <span class="dt">col=</span><span class="st">&quot;grey80&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Log-total UMI count&quot;</span>, <span class="dt">main=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb354-3"><a href="PreProcTop.html#cb354-3"></a><span class="kw">hist</span>(sce<span class="op">$</span>subsets_Mito_percent, <span class="dt">breaks=</span><span class="dv">20</span>, <span class="dt">col=</span><span class="st">&quot;grey80&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Proportion of reads in mitochondrial genes&quot;</span>, <span class="dt">main=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb354-4"><a href="PreProcTop.html#cb354-4"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">20</span>, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">&#39;purple&#39;</span>)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/qc_metricDistrib_twoHist-1.png" width="672" /></p>
<p>Per sample group:</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="PreProcTop.html#cb355-1"></a>sce<span class="op">$</span>source_name &lt;-<span class="st"> </span><span class="kw">factor</span>(sce<span class="op">$</span>source_name)</span>
<span id="cb355-2"><a href="PreProcTop.html#cb355-2"></a>sce<span class="op">$</span>block &lt;-<span class="st"> </span>sce<span class="op">$</span>source_name</span>
<span id="cb355-3"><a href="PreProcTop.html#cb355-3"></a>sce<span class="op">$</span>setName &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">&quot;ABMMC&quot;</span>, sce<span class="op">$</span>source_name), <span class="st">&quot;Hca&quot;</span>, <span class="st">&quot;Caron&quot;</span>)</span></code></pre></div>
<p>Library size (‘Total count’):</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="PreProcTop.html#cb356-1"></a>p &lt;-<span class="st"> </span><span class="kw">plotColData</span>(sce, <span class="dt">x=</span><span class="st">&quot;block&quot;</span>, <span class="dt">y=</span><span class="st">&quot;sum&quot;</span>,</span>
<span id="cb356-2"><a href="PreProcTop.html#cb356-2"></a>        <span class="dt">other_fields=</span><span class="st">&quot;setName&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co">#facet_wrap(~setName) + </span></span>
<span id="cb356-3"><a href="PreProcTop.html#cb356-3"></a><span class="st">        </span><span class="kw">scale_y_log10</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Total count&quot;</span>)</span>
<span id="cb356-4"><a href="PreProcTop.html#cb356-4"></a>p</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>Number of genes (‘detected’):</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="PreProcTop.html#cb357-1"></a>p &lt;-<span class="st"> </span><span class="kw">plotColData</span>(sce, <span class="dt">x=</span><span class="st">&quot;block&quot;</span>, <span class="dt">y=</span><span class="st">&quot;detected&quot;</span>, </span>
<span id="cb357-2"><a href="PreProcTop.html#cb357-2"></a>        <span class="dt">other_fields=</span><span class="st">&quot;setName&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co">#facet_wrap(~setName) + </span></span>
<span id="cb357-3"><a href="PreProcTop.html#cb357-3"></a><span class="st">        </span><span class="kw">scale_y_log10</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Detected features&quot;</span>)</span>
<span id="cb357-4"><a href="PreProcTop.html#cb357-4"></a>p</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>Mitochondrial content (‘subsets_Mito_percent’):</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="PreProcTop.html#cb358-1"></a>p &lt;-<span class="st"> </span><span class="kw">plotColData</span>(sce, <span class="dt">x=</span><span class="st">&quot;block&quot;</span>, <span class="dt">y=</span><span class="st">&quot;subsets_Mito_percent&quot;</span>, </span>
<span id="cb358-2"><a href="PreProcTop.html#cb358-2"></a>        <span class="dt">other_fields=</span><span class="st">&quot;setName&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># facet_wrap(~setName) +</span></span>
<span id="cb358-3"><a href="PreProcTop.html#cb358-3"></a><span class="st">        </span><span class="kw">ggtitle</span>(<span class="st">&quot;Mito percent&quot;</span>)</span>
<span id="cb358-4"><a href="PreProcTop.html#cb358-4"></a>p</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="PreProcTop.html#cb359-1"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s/qc_metricDistrib_plotColData2.png&quot;</span>, projDir, outDirBit, qcPlotDirBit)</span>
<span id="cb359-2"><a href="PreProcTop.html#cb359-2"></a><span class="kw">png</span>(tmpFn)</span>
<span id="cb359-3"><a href="PreProcTop.html#cb359-3"></a><span class="co"># violin plots</span></span>
<span id="cb359-4"><a href="PreProcTop.html#cb359-4"></a>gridExtra<span class="op">::</span><span class="kw">grid.arrange</span>(</span>
<span id="cb359-5"><a href="PreProcTop.html#cb359-5"></a>    <span class="kw">plotColData</span>(sce, <span class="dt">x=</span><span class="st">&quot;block&quot;</span>, <span class="dt">y=</span><span class="st">&quot;sum&quot;</span>,</span>
<span id="cb359-6"><a href="PreProcTop.html#cb359-6"></a>        <span class="dt">other_fields=</span><span class="st">&quot;setName&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co">#facet_wrap(~setName) + </span></span>
<span id="cb359-7"><a href="PreProcTop.html#cb359-7"></a><span class="st">        </span><span class="kw">scale_y_log10</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Total count&quot;</span>),</span>
<span id="cb359-8"><a href="PreProcTop.html#cb359-8"></a>    <span class="kw">plotColData</span>(sce, <span class="dt">x=</span><span class="st">&quot;block&quot;</span>, <span class="dt">y=</span><span class="st">&quot;detected&quot;</span>, </span>
<span id="cb359-9"><a href="PreProcTop.html#cb359-9"></a>        <span class="dt">other_fields=</span><span class="st">&quot;setName&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co">#facet_wrap(~setName) + </span></span>
<span id="cb359-10"><a href="PreProcTop.html#cb359-10"></a><span class="st">        </span><span class="kw">scale_y_log10</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Detected features&quot;</span>),</span>
<span id="cb359-11"><a href="PreProcTop.html#cb359-11"></a>    <span class="kw">plotColData</span>(sce, <span class="dt">x=</span><span class="st">&quot;block&quot;</span>, <span class="dt">y=</span><span class="st">&quot;subsets_Mito_percent&quot;</span>, </span>
<span id="cb359-12"><a href="PreProcTop.html#cb359-12"></a>        <span class="dt">other_fields=</span><span class="st">&quot;setName&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># facet_wrap(~setName) +</span></span>
<span id="cb359-13"><a href="PreProcTop.html#cb359-13"></a><span class="st">        </span><span class="kw">ggtitle</span>(<span class="st">&quot;Mito percent&quot;</span>),</span>
<span id="cb359-14"><a href="PreProcTop.html#cb359-14"></a>    <span class="dt">ncol=</span><span class="dv">1</span></span>
<span id="cb359-15"><a href="PreProcTop.html#cb359-15"></a>)</span>
<span id="cb359-16"><a href="PreProcTop.html#cb359-16"></a><span class="kw">dev.off</span>()</span></code></pre></div>
<pre><code>## png 
##   2</code></pre>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="PreProcTop.html#cb361-1"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;../%s/qc_metricDistrib_plotColData2.png&quot;</span>, qcPlotDirBit)</span>
<span id="cb361-2"><a href="PreProcTop.html#cb361-2"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(tmpFn, <span class="dt">auto_pdf =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="../Plots/Qc/qc_metricDistrib_plotColData2.png" width="80%" /></p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="PreProcTop.html#cb362-1"></a><span class="kw">rm</span>(tmpFn)</span></code></pre></div>
<p>Correlation between the number of genes detected and library size (‘detected’ against ‘sum’):</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="PreProcTop.html#cb363-1"></a>sp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">data.frame</span>(<span class="kw">colData</span>(sce)),</span>
<span id="cb363-2"><a href="PreProcTop.html#cb363-2"></a>             <span class="kw">aes</span>(<span class="dt">x=</span>sum,</span>
<span id="cb363-3"><a href="PreProcTop.html#cb363-3"></a>                 <span class="dt">y=</span>detected,</span>
<span id="cb363-4"><a href="PreProcTop.html#cb363-4"></a>                 <span class="dt">col=</span>subsets_Mito_percent)) <span class="op">+</span></span>
<span id="cb363-5"><a href="PreProcTop.html#cb363-5"></a><span class="st">  </span><span class="kw">geom_point</span>()</span>
<span id="cb363-6"><a href="PreProcTop.html#cb363-6"></a>sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>source_name)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
</div>
</div>
<div id="identification-of-low-quality-cells-with-adaptive-thresholds-1" class="section level2">
<h2><span class="header-section-number">5.11</span> Identification of low-quality cells with adaptive thresholds</h2>
<p>One can use hard threshold for the library size, number of genes detected and mitochondrial content. These will however vary across runs. It may therefore be preferable to rely on outlier detection to identify cells that markerdly differ from most cells.</p>
<p>We saw above that the distribution of the QC metrics is close to Normal. Hence, we can detect outlier using the median and the median absolute deviation (MAD) from the median (not the mean and the standard deviation that both are sensitive to outliers).</p>
<p>For a given metric, an outlier value is one that lies over some number of MADs away from the median. A cell will be excluded if it is an outlier in the part of the range to avoid, for example low gene counts, or high mitochondrial content. For a normal distribution, a threshold defined with a distance of 3 MADs from the median retains about 99% of values.</p>
<div id="library-size-1" class="section level3">
<h3><span class="header-section-number">5.11.1</span> Library size</h3>
<p>For the library size we use the log scale to avoid negative values for lower part of the distribution.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="PreProcTop.html#cb364-1"></a>qc.lib2 &lt;-<span class="st"> </span><span class="kw">isOutlier</span>(sce<span class="op">$</span>sum, <span class="dt">log=</span><span class="ot">TRUE</span>, <span class="dt">type=</span><span class="st">&quot;lower&quot;</span>)</span>
<span id="cb364-2"><a href="PreProcTop.html#cb364-2"></a><span class="kw">table</span>(qc.lib2)</span></code></pre></div>
<pre><code>## qc.lib2
## FALSE  TRUE 
## 37795   333</code></pre>
<p>Threshold values:</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="PreProcTop.html#cb366-1"></a><span class="kw">attr</span>(qc.lib2, <span class="st">&quot;thresholds&quot;</span>)</span></code></pre></div>
<pre><code>##    lower   higher 
## 576.4435      Inf</code></pre>
</div>
<div id="number-of-genes-1" class="section level3">
<h3><span class="header-section-number">5.11.2</span> Number of genes</h3>
<p>For the number of genes detected we also use the log scale to avoid negative values for lower part of the distribution.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="PreProcTop.html#cb368-1"></a>qc.nexprs2 &lt;-<span class="st"> </span><span class="kw">isOutlier</span>(sce<span class="op">$</span>detected, <span class="dt">log=</span><span class="ot">TRUE</span>, <span class="dt">type=</span><span class="st">&quot;lower&quot;</span>)</span>
<span id="cb368-2"><a href="PreProcTop.html#cb368-2"></a><span class="kw">table</span>(qc.nexprs2)</span></code></pre></div>
<pre><code>## qc.nexprs2
## FALSE  TRUE 
## 37723   405</code></pre>
<p>Threshold values:</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="PreProcTop.html#cb370-1"></a><span class="kw">attr</span>(qc.nexprs2, <span class="st">&quot;thresholds&quot;</span>)</span></code></pre></div>
<pre><code>##    lower   higher 
## 204.1804      Inf</code></pre>
</div>
<div id="mitochondrial-content-2" class="section level3">
<h3><span class="header-section-number">5.11.3</span> Mitochondrial content</h3>
<p>For the mitochondrial content the exclusion zone is in the higher part of the distribution.</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="PreProcTop.html#cb372-1"></a>qc.mito2 &lt;-<span class="st"> </span><span class="kw">isOutlier</span>(sce<span class="op">$</span>subsets_Mito_percent, <span class="dt">type=</span><span class="st">&quot;higher&quot;</span>)</span>
<span id="cb372-2"><a href="PreProcTop.html#cb372-2"></a><span class="kw">table</span>(qc.mito2)</span></code></pre></div>
<pre><code>## qc.mito2
## FALSE  TRUE 
## 35755  2373</code></pre>
<p>Threshold values:</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="PreProcTop.html#cb374-1"></a><span class="kw">attr</span>(qc.mito2, <span class="st">&quot;thresholds&quot;</span>)</span></code></pre></div>
<pre><code>##    lower   higher 
##     -Inf 8.715114</code></pre>
</div>
<div id="summary-1" class="section level3">
<h3><span class="header-section-number">5.11.4</span> Summary</h3>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="PreProcTop.html#cb376-1"></a>discard2 &lt;-<span class="st"> </span>qc.lib2 <span class="op">|</span><span class="st"> </span>qc.nexprs2 <span class="op">|</span><span class="st"> </span>qc.mito2</span>
<span id="cb376-2"><a href="PreProcTop.html#cb376-2"></a></span>
<span id="cb376-3"><a href="PreProcTop.html#cb376-3"></a><span class="co"># Summarize the number of cells removed for each reason.</span></span>
<span id="cb376-4"><a href="PreProcTop.html#cb376-4"></a><span class="kw">DataFrame</span>(<span class="dt">LibSize=</span><span class="kw">sum</span>(qc.lib2),</span>
<span id="cb376-5"><a href="PreProcTop.html#cb376-5"></a>      <span class="dt">NExprs=</span><span class="kw">sum</span>(qc.nexprs2),</span>
<span id="cb376-6"><a href="PreProcTop.html#cb376-6"></a>      <span class="dt">MitoProp=</span><span class="kw">sum</span>(qc.mito2),</span>
<span id="cb376-7"><a href="PreProcTop.html#cb376-7"></a>      <span class="dt">Total=</span><span class="kw">sum</span>(discard2))</span></code></pre></div>
<pre><code>## DataFrame with 1 row and 4 columns
##     LibSize    NExprs  MitoProp     Total
##   &lt;integer&gt; &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;
## 1       333       405      2373      2900</code></pre>
</div>
<div id="all-steps-at-once-1" class="section level3">
<h3><span class="header-section-number">5.11.5</span> All steps at once</h3>
<p>The steps above may be run at once with quickPerCellQC():</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="PreProcTop.html#cb378-1"></a>reasons &lt;-<span class="st"> </span><span class="kw">quickPerCellQC</span>(<span class="kw">colData</span>(sce),</span>
<span id="cb378-2"><a href="PreProcTop.html#cb378-2"></a>              <span class="dt">percent_subsets=</span><span class="kw">c</span>(<span class="st">&quot;subsets_Mito_percent&quot;</span>))</span>
<span id="cb378-3"><a href="PreProcTop.html#cb378-3"></a><span class="kw">colSums</span>(<span class="kw">as.matrix</span>(reasons)) <span class="op">%&gt;%</span></span>
<span id="cb378-4"><a href="PreProcTop.html#cb378-4"></a><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb378-5"><a href="PreProcTop.html#cb378-5"></a><span class="st">    </span><span class="kw">datatable</span>(<span class="dt">rownames =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div id="htmlwidget-394fd105106f0ceaabf0" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-394fd105106f0ceaabf0">{"x":{"filter":"none","data":[["low_lib_size","low_n_features","high_subsets_Mito_percent","discard"],[333,405,2373,2900]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>.<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="assumptions-1" class="section level3">
<h3><span class="header-section-number">5.11.6</span> Assumptions</h3>
<p>Data quality depends on the tissue analysed, some being difficult to dissociate, e.g. brain, so that one level of QC stringency will not fit all data sets.</p>
<p>Filtering based on QC metrics as done here assumes that these QC metrics are not correlated with biology. This may not necessarily be true in highly heterogenous data sets where some cell types represented by good-quality cells may have low RNA content or high mitochondrial content.</p>
</div>
</div>
<div id="experimental-factors-1" class="section level2">
<h2><span class="header-section-number">5.12</span> Experimental factors</h2>
<p>The two data sets analysed here may have been obtained in experiments with different settings, such as cell preparation or sequencing depth. Such differences between these two batches would affect the adaptive thesholds discussed above. We will now perform QC in each batch separately.</p>
<p>We will use the quickPerCellQC() ‘batch’ option.</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="PreProcTop.html#cb379-1"></a>batch.reasons &lt;-<span class="st"> </span><span class="kw">quickPerCellQC</span>(<span class="kw">colData</span>(sce),</span>
<span id="cb379-2"><a href="PreProcTop.html#cb379-2"></a>                                <span class="dt">percent_subsets=</span><span class="kw">c</span>(<span class="st">&quot;subsets_Mito_percent&quot;</span>),</span>
<span id="cb379-3"><a href="PreProcTop.html#cb379-3"></a>                <span class="dt">batch=</span>sce<span class="op">$</span>setName)</span>
<span id="cb379-4"><a href="PreProcTop.html#cb379-4"></a><span class="kw">colSums</span>(<span class="kw">as.matrix</span>(batch.reasons)) <span class="op">%&gt;%</span></span>
<span id="cb379-5"><a href="PreProcTop.html#cb379-5"></a><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb379-6"><a href="PreProcTop.html#cb379-6"></a><span class="st">    </span><span class="kw">datatable</span>(<span class="dt">rownames =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div id="htmlwidget-f528822e831cb0a8d967" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f528822e831cb0a8d967">{"x":{"filter":"none","data":[["low_lib_size","low_n_features","high_subsets_Mito_percent","discard"],[0,218,2249,2443]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>.<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="PreProcTop.html#cb380-1"></a>sce<span class="op">$</span>discard &lt;-<span class="st"> </span>batch.reasons<span class="op">$</span>discard</span></code></pre></div>
<p>Fewer cells are discarded, in particular because of small library size and low gene number.</p>
<p>But the differences are deeper as the two sets only partially overlap:</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="PreProcTop.html#cb381-1"></a><span class="kw">table</span>(reasons<span class="op">$</span>discard, batch.reasons<span class="op">$</span>discard)</span></code></pre></div>
<pre><code>##        
##         FALSE  TRUE
##   FALSE 34880   348
##   TRUE    805  2095</code></pre>
<p>Library size:</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="PreProcTop.html#cb383-1"></a><span class="kw">plotColData</span>(sce,</span>
<span id="cb383-2"><a href="PreProcTop.html#cb383-2"></a>        <span class="dt">x=</span><span class="st">&quot;block&quot;</span>, <span class="dt">y=</span><span class="st">&quot;sum&quot;</span>,</span>
<span id="cb383-3"><a href="PreProcTop.html#cb383-3"></a>        <span class="dt">colour_by=</span><span class="st">&quot;discard&quot;</span>,</span>
<span id="cb383-4"><a href="PreProcTop.html#cb383-4"></a>        <span class="dt">other_fields=</span><span class="st">&quot;setName&quot;</span>) <span class="op">+</span></span>
<span id="cb383-5"><a href="PreProcTop.html#cb383-5"></a><span class="st">        </span><span class="kw">scale_y_log10</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Total count&quot;</span>)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>Number of genes detected:</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="PreProcTop.html#cb384-1"></a><span class="kw">plotColData</span>(sce,</span>
<span id="cb384-2"><a href="PreProcTop.html#cb384-2"></a>            <span class="dt">x=</span><span class="st">&quot;block&quot;</span>, <span class="dt">y=</span><span class="st">&quot;detected&quot;</span>,</span>
<span id="cb384-3"><a href="PreProcTop.html#cb384-3"></a>            <span class="dt">colour_by=</span><span class="st">&quot;discard&quot;</span>, </span>
<span id="cb384-4"><a href="PreProcTop.html#cb384-4"></a>            <span class="dt">other_fields=</span><span class="st">&quot;setName&quot;</span>) <span class="op">+</span></span>
<span id="cb384-5"><a href="PreProcTop.html#cb384-5"></a><span class="st">  </span><span class="kw">scale_y_log10</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Detected features&quot;</span>)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="PreProcTop.html#cb385-1"></a><span class="kw">plotColData</span>(sce,</span>
<span id="cb385-2"><a href="PreProcTop.html#cb385-2"></a>            <span class="dt">x=</span><span class="st">&quot;block&quot;</span>, <span class="dt">y=</span><span class="st">&quot;detected&quot;</span>,</span>
<span id="cb385-3"><a href="PreProcTop.html#cb385-3"></a>            <span class="dt">colour_by=</span><span class="st">&quot;discard&quot;</span>,</span>
<span id="cb385-4"><a href="PreProcTop.html#cb385-4"></a>            <span class="dt">other_fields=</span><span class="st">&quot;setName&quot;</span>) <span class="op">+</span></span>
<span id="cb385-5"><a href="PreProcTop.html#cb385-5"></a><span class="st">          </span><span class="kw">facet_wrap</span>(<span class="op">~</span>colour_by) <span class="op">+</span><span class="st"> </span></span>
<span id="cb385-6"><a href="PreProcTop.html#cb385-6"></a><span class="st">        </span><span class="kw">scale_y_log10</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Detected features&quot;</span>)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<p>Mitochondrial content:</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="PreProcTop.html#cb386-1"></a><span class="kw">plotColData</span>(sce,</span>
<span id="cb386-2"><a href="PreProcTop.html#cb386-2"></a>            <span class="dt">x=</span><span class="st">&quot;block&quot;</span>, <span class="dt">y=</span><span class="st">&quot;subsets_Mito_percent&quot;</span>,</span>
<span id="cb386-3"><a href="PreProcTop.html#cb386-3"></a>            <span class="dt">colour_by=</span><span class="st">&quot;discard&quot;</span>,</span>
<span id="cb386-4"><a href="PreProcTop.html#cb386-4"></a>            <span class="dt">other_fields=</span><span class="st">&quot;setName&quot;</span>) <span class="op">+</span></span>
<span id="cb386-5"><a href="PreProcTop.html#cb386-5"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Mito percent&quot;</span>)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<div id="identify-poor-quality-batches-1" class="section level3">
<h3><span class="header-section-number">5.12.1</span> Identify poor-quality batches</h3>
<p>We will now consider the ‘sample’ batch to illustrate how to identify batches with overall low quality or different from other batches. Let’s compare thresholds across sample groups.</p>
<div id="number-of-genes-detected-1" class="section level4">
<h4><span class="header-section-number">5.12.1.1</span> Number of genes detected</h4>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="PreProcTop.html#cb387-1"></a><span class="co"># compute</span></span>
<span id="cb387-2"><a href="PreProcTop.html#cb387-2"></a>discard.nexprs &lt;-<span class="st"> </span><span class="kw">isOutlier</span>(sce<span class="op">$</span>detected, <span class="dt">log=</span><span class="ot">TRUE</span>, <span class="dt">type=</span><span class="st">&quot;lower&quot;</span>, <span class="dt">batch=</span>sce<span class="op">$</span>Sample.Name)</span>
<span id="cb387-3"><a href="PreProcTop.html#cb387-3"></a>nexprs.thresholds &lt;-<span class="st"> </span><span class="kw">attr</span>(discard.nexprs, <span class="st">&quot;thresholds&quot;</span>)[<span class="st">&quot;lower&quot;</span>,]</span>
<span id="cb387-4"><a href="PreProcTop.html#cb387-4"></a>nexprs.thresholds <span class="op">%&gt;%</span></span>
<span id="cb387-5"><a href="PreProcTop.html#cb387-5"></a><span class="st">  </span><span class="kw">round</span>(<span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb387-6"><a href="PreProcTop.html#cb387-6"></a><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb387-7"><a href="PreProcTop.html#cb387-7"></a><span class="st">    </span><span class="kw">datatable</span>(<span class="dt">rownames =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div id="htmlwidget-ffc66f23ba4d04d0cf9c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ffc66f23ba4d04d0cf9c">{"x":{"filter":"none","data":[["GSM3872434","GSM3872435","GSM3872436","GSM3872437","GSM3872438","GSM3872439","GSM3872440","GSM3872441","GSM3872442","GSM3872443","GSM3872444","MantonBM1","MantonBM2","MantonBM3","MantonBM4","MantonBM5","MantonBM6","MantonBM7","MantonBM8"],[603,334,326,127,174,571,191,275,71,132,238,430,402,399,315,244,464,372,357]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>.<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Without block:</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="PreProcTop.html#cb388-1"></a><span class="co"># plots - without blocking</span></span>
<span id="cb388-2"><a href="PreProcTop.html#cb388-2"></a>discard.nexprs.woBlock &lt;-<span class="st"> </span><span class="kw">isOutlier</span>(sce<span class="op">$</span>detected, <span class="dt">log=</span><span class="ot">TRUE</span>, <span class="dt">type=</span><span class="st">&quot;lower&quot;</span>)</span>
<span id="cb388-3"><a href="PreProcTop.html#cb388-3"></a>without.blocking &lt;-<span class="st"> </span><span class="kw">plotColData</span>(sce, <span class="dt">x=</span><span class="st">&quot;Sample.Name&quot;</span>, <span class="dt">y=</span><span class="st">&quot;detected&quot;</span>,</span>
<span id="cb388-4"><a href="PreProcTop.html#cb388-4"></a>    <span class="dt">colour_by=</span><span class="kw">I</span>(discard.nexprs.woBlock))</span>
<span id="cb388-5"><a href="PreProcTop.html#cb388-5"></a></span>
<span id="cb388-6"><a href="PreProcTop.html#cb388-6"></a>without.blocking <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>With block:</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="PreProcTop.html#cb389-1"></a><span class="co"># plots - with blocking</span></span>
<span id="cb389-2"><a href="PreProcTop.html#cb389-2"></a>with.blocking &lt;-<span class="st"> </span><span class="kw">plotColData</span>(sce, <span class="dt">x=</span><span class="st">&quot;Sample.Name&quot;</span>, <span class="dt">y=</span><span class="st">&quot;detected&quot;</span>,</span>
<span id="cb389-3"><a href="PreProcTop.html#cb389-3"></a>    <span class="dt">colour_by=</span><span class="kw">I</span>(discard.nexprs))</span>
<span id="cb389-4"><a href="PreProcTop.html#cb389-4"></a>with.blocking <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<div id="mitochondrial-content-3" class="section level5">
<h5><span class="header-section-number">5.12.1.1.1</span> Mitochondrial content</h5>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="PreProcTop.html#cb390-1"></a>discard.mito &lt;-<span class="st"> </span><span class="kw">isOutlier</span>(sce<span class="op">$</span>subsets_Mito_percent, <span class="dt">type=</span><span class="st">&quot;higher&quot;</span>, <span class="dt">batch=</span>sce<span class="op">$</span>Sample.Name)</span>
<span id="cb390-2"><a href="PreProcTop.html#cb390-2"></a>mito.thresholds &lt;-<span class="st"> </span><span class="kw">attr</span>(discard.mito, <span class="st">&quot;thresholds&quot;</span>)[<span class="st">&quot;higher&quot;</span>,]</span>
<span id="cb390-3"><a href="PreProcTop.html#cb390-3"></a>mito.thresholds <span class="op">%&gt;%</span></span>
<span id="cb390-4"><a href="PreProcTop.html#cb390-4"></a><span class="st">  </span><span class="kw">round</span>(<span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb390-5"><a href="PreProcTop.html#cb390-5"></a><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb390-6"><a href="PreProcTop.html#cb390-6"></a><span class="st">    </span><span class="kw">datatable</span>(<span class="dt">rownames =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div id="htmlwidget-0872b30780dc7358d077" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-0872b30780dc7358d077">{"x":{"filter":"none","data":[["GSM3872434","GSM3872435","GSM3872436","GSM3872437","GSM3872438","GSM3872439","GSM3872440","GSM3872441","GSM3872442","GSM3872443","GSM3872444","MantonBM1","MantonBM2","MantonBM3","MantonBM4","MantonBM5","MantonBM6","MantonBM7","MantonBM8"],[13,9,7,14,17,7,9,8,8,13,9,8,7,6,8,7,7,6,7]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>.<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Without block:</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="PreProcTop.html#cb391-1"></a><span class="co"># plots - without blocking</span></span>
<span id="cb391-2"><a href="PreProcTop.html#cb391-2"></a>discard.mito.woBlock &lt;-<span class="st"> </span><span class="kw">isOutlier</span>(sce<span class="op">$</span>subsets_Mito_percent, <span class="dt">type=</span><span class="st">&quot;higher&quot;</span>)</span>
<span id="cb391-3"><a href="PreProcTop.html#cb391-3"></a>without.blocking &lt;-<span class="st"> </span><span class="kw">plotColData</span>(sce, <span class="dt">x=</span><span class="st">&quot;Sample.Name&quot;</span>, <span class="dt">y=</span><span class="st">&quot;subsets_Mito_percent&quot;</span>,</span>
<span id="cb391-4"><a href="PreProcTop.html#cb391-4"></a>    <span class="dt">colour_by=</span><span class="kw">I</span>(discard.mito.woBlock))</span>
<span id="cb391-5"><a href="PreProcTop.html#cb391-5"></a>without.blocking <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<p>With block:</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="PreProcTop.html#cb392-1"></a><span class="co"># plots - with blocking</span></span>
<span id="cb392-2"><a href="PreProcTop.html#cb392-2"></a>with.blocking &lt;-<span class="st"> </span><span class="kw">plotColData</span>(sce, <span class="dt">x=</span><span class="st">&quot;Sample.Name&quot;</span>, <span class="dt">y=</span><span class="st">&quot;subsets_Mito_percent&quot;</span>,</span>
<span id="cb392-3"><a href="PreProcTop.html#cb392-3"></a>    <span class="dt">colour_by=</span><span class="kw">I</span>(discard.mito))</span>
<span id="cb392-4"><a href="PreProcTop.html#cb392-4"></a>with.blocking <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
</div>
</div>
<div id="samples-to-check-1" class="section level4">
<h4><span class="header-section-number">5.12.1.2</span> Samples to check</h4>
<p>Names of samples with a ‘low’ threshold for the number of genes detected:</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="PreProcTop.html#cb393-1"></a><span class="co"># names</span></span>
<span id="cb393-2"><a href="PreProcTop.html#cb393-2"></a><span class="kw">names</span>(nexprs.thresholds)[<span class="kw">isOutlier</span>(nexprs.thresholds, <span class="dt">type=</span><span class="st">&quot;lower&quot;</span>)]</span></code></pre></div>
<pre><code>## character(0)</code></pre>
<p>Names of samples with a ‘high’ threshold for mitocondrial content:</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="PreProcTop.html#cb395-1"></a><span class="co"># names</span></span>
<span id="cb395-2"><a href="PreProcTop.html#cb395-2"></a><span class="kw">names</span>(mito.thresholds)[<span class="kw">isOutlier</span>(mito.thresholds, <span class="dt">type=</span><span class="st">&quot;higher&quot;</span>)]</span></code></pre></div>
<pre><code>## [1] &quot;GSM3872434&quot; &quot;GSM3872437&quot; &quot;GSM3872438&quot; &quot;GSM3872443&quot;</code></pre>
</div>
</div>
<div id="qc-metrics-space-1" class="section level3">
<h3><span class="header-section-number">5.12.2</span> QC metrics space</h3>
<p>A similar approach exists to identify outliers using a set of metrics together. We will the same QC metrics as above.</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="PreProcTop.html#cb397-1"></a><span class="co"># slow</span></span>
<span id="cb397-2"><a href="PreProcTop.html#cb397-2"></a>stats &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">log10</span>(sce<span class="op">$</span>sum),</span>
<span id="cb397-3"><a href="PreProcTop.html#cb397-3"></a>           <span class="kw">log10</span>(sce<span class="op">$</span>detected),</span>
<span id="cb397-4"><a href="PreProcTop.html#cb397-4"></a>           sce<span class="op">$</span>subsets_Mito_percent)</span>
<span id="cb397-5"><a href="PreProcTop.html#cb397-5"></a></span>
<span id="cb397-6"><a href="PreProcTop.html#cb397-6"></a><span class="kw">library</span>(robustbase)</span>
<span id="cb397-7"><a href="PreProcTop.html#cb397-7"></a>outlying &lt;-<span class="st"> </span><span class="kw">adjOutlyingness</span>(stats, <span class="dt">only.outlyingness =</span> <span class="ot">TRUE</span>)</span>
<span id="cb397-8"><a href="PreProcTop.html#cb397-8"></a>multi.outlier &lt;-<span class="st"> </span><span class="kw">isOutlier</span>(outlying, <span class="dt">type =</span> <span class="st">&quot;higher&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="PreProcTop.html#cb398-1"></a><span class="kw">summary</span>(multi.outlier)</span></code></pre></div>
<pre><code>##    Mode   FALSE    TRUE 
## logical   34298    3830</code></pre>
<p>Compare with previous filtering:</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="PreProcTop.html#cb400-1"></a><span class="kw">table</span>(sce<span class="op">$</span>discard, multi.outlier)</span></code></pre></div>
<pre><code>##        multi.outlier
##         FALSE  TRUE
##   FALSE 33461  2224
##   TRUE    837  1606</code></pre>
</div>
<div id="qc-pca-1" class="section level3">
<h3><span class="header-section-number">5.12.3</span> QC PCA</h3>
<p>One can also perform a principal components analysis (PCA) on cells, based on the column metadata in a SingleCellExperiment object. Here we will only use the library size, the number of genes detected (which is correlated with library size) and the mitochondrial content.</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="PreProcTop.html#cb402-1"></a>sce &lt;-<span class="st"> </span><span class="kw">runColDataPCA</span>(sce, <span class="dt">variables=</span><span class="kw">list</span>(</span>
<span id="cb402-2"><a href="PreProcTop.html#cb402-2"></a>    <span class="st">&quot;sum&quot;</span>, <span class="st">&quot;detected&quot;</span>, <span class="st">&quot;subsets_Mito_percent&quot;</span>),</span>
<span id="cb402-3"><a href="PreProcTop.html#cb402-3"></a>    <span class="dt">outliers=</span><span class="ot">TRUE</span>)</span>
<span id="cb402-4"><a href="PreProcTop.html#cb402-4"></a></span>
<span id="cb402-5"><a href="PreProcTop.html#cb402-5"></a><span class="co">#reducedDimNames(sce)</span></span>
<span id="cb402-6"><a href="PreProcTop.html#cb402-6"></a><span class="co">#head(reducedDim(sce))</span></span>
<span id="cb402-7"><a href="PreProcTop.html#cb402-7"></a><span class="co">#head(colData(sce))</span></span>
<span id="cb402-8"><a href="PreProcTop.html#cb402-8"></a></span>
<span id="cb402-9"><a href="PreProcTop.html#cb402-9"></a><span class="co">#p &lt;- plotReducedDim(sce, dimred=&quot;PCA_coldata&quot;, colour_by = &quot;Sample.Name&quot;)</span></span>
<span id="cb402-10"><a href="PreProcTop.html#cb402-10"></a>p &lt;-<span class="st"> </span><span class="kw">plotReducedDim</span>(sce, <span class="dt">dimred=</span><span class="st">&quot;PCA_coldata&quot;</span>, <span class="dt">colour_by =</span> <span class="st">&quot;outlier&quot;</span>)</span>
<span id="cb402-11"><a href="PreProcTop.html#cb402-11"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>sce<span class="op">$</span>discard)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<p>Compare with previous filtering:</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="PreProcTop.html#cb403-1"></a><span class="kw">table</span>(sce<span class="op">$</span>discard, sce<span class="op">$</span>outlier)</span></code></pre></div>
<pre><code>##        
##         FALSE  TRUE
##   FALSE 35001   684
##   TRUE    769  1674</code></pre>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="PreProcTop.html#cb405-1"></a><span class="kw">table</span>(multi.outlier, sce<span class="op">$</span>outlier)</span></code></pre></div>
<pre><code>##              
## multi.outlier FALSE  TRUE
##         FALSE 33675   623
##         TRUE   2095  1735</code></pre>
</div>
<div id="other-diagnostic-plots-1" class="section level3">
<h3><span class="header-section-number">5.12.4</span> Other diagnostic plots</h3>
<p>Mitochondrial content against library size:</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="PreProcTop.html#cb407-1"></a><span class="kw">plotColData</span>(sce, <span class="dt">x=</span><span class="st">&quot;sum&quot;</span>, <span class="dt">y=</span><span class="st">&quot;subsets_Mito_percent&quot;</span>, <span class="dt">colour_by=</span><span class="st">&quot;discard&quot;</span>)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="PreProcTop.html#cb408-1"></a>sp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">data.frame</span>(<span class="kw">colData</span>(sce)),</span>
<span id="cb408-2"><a href="PreProcTop.html#cb408-2"></a>         <span class="kw">aes</span>(<span class="dt">x=</span>sum, <span class="dt">y=</span>subsets_Mito_percent, <span class="dt">col=</span>discard)) <span class="op">+</span></span>
<span id="cb408-3"><a href="PreProcTop.html#cb408-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.05</span>, <span class="dt">alpha =</span> <span class="fl">0.7</span>) <span class="op">+</span></span>
<span id="cb408-4"><a href="PreProcTop.html#cb408-4"></a><span class="st">  </span><span class="kw">geom_density_2d</span>(<span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb408-5"><a href="PreProcTop.html#cb408-5"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">colour =</span> <span class="kw">guide_legend</span>(<span class="dt">override.aes =</span> <span class="kw">list</span>(<span class="dt">size=</span><span class="dv">1</span>, <span class="dt">alpha=</span><span class="dv">1</span>))) <span class="op">+</span></span>
<span id="cb408-6"><a href="PreProcTop.html#cb408-6"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb408-7"><a href="PreProcTop.html#cb408-7"></a><span class="co">#sp</span></span>
<span id="cb408-8"><a href="PreProcTop.html#cb408-8"></a>ggExtra<span class="op">::</span><span class="kw">ggMarginal</span>(sp)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<p>Mind distributions:</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="PreProcTop.html#cb409-1"></a>sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>source_name)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
</div>
<div id="filter-low-quality-cells-out-1" class="section level3">
<h3><span class="header-section-number">5.12.5</span> Filter low-quality cells out</h3>
<p>We will now exclude poor-quality cells.</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="PreProcTop.html#cb410-1"></a>scePreQc &lt;-<span class="st"> </span>sce</span>
<span id="cb410-2"><a href="PreProcTop.html#cb410-2"></a>sce &lt;-<span class="st"> </span>scePreQc[,<span class="op">!</span>scePreQc<span class="op">$</span>discard]</span>
<span id="cb410-3"><a href="PreProcTop.html#cb410-3"></a>sce</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 33538 35685 
## metadata(20): Samples Samples ... Samples Samples
## assays(1): counts
## rownames(33538): ENSG00000243485 ENSG00000237613 ... ENSG00000277475
##   ENSG00000268674
## rowData names(10): ensembl_gene_id external_gene_name ... mean detected
## colnames: NULL
## colData names(14): Barcode Run ... discard outlier
## reducedDimNames(1): PCA_coldata
## altExpNames(0):</code></pre>
<p>We also write the R object to file to use later if need be.</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="PreProcTop.html#cb412-1"></a><span class="co"># Write object to file</span></span>
<span id="cb412-2"><a href="PreProcTop.html#cb412-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/sce_postQc.Rds&quot;</span>, projDir, outDirBit)</span>
<span id="cb412-3"><a href="PreProcTop.html#cb412-3"></a><span class="kw">saveRDS</span>(sce, tmpFn)</span></code></pre></div>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="PreProcTop.html#cb413-1"></a><span class="co"># Read object in:</span></span>
<span id="cb413-2"><a href="PreProcTop.html#cb413-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/sce_postQc.Rds&quot;</span>,</span>
<span id="cb413-3"><a href="PreProcTop.html#cb413-3"></a>         projDir, outDirBit)</span>
<span id="cb413-4"><a href="PreProcTop.html#cb413-4"></a>sce &lt;-<span class="st"> </span><span class="kw">readRDS</span>(tmpFn)</span></code></pre></div>
</div>
</div>
<div id="novelty-1" class="section level2">
<h2><span class="header-section-number">5.13</span> Novelty</h2>
<p>The number of genes per UMI for each cell informs on the level of sequencing saturation achieved ( <a href="https://hbctraining.github.io/In-depth-NGS-Data-Analysis-Course/sessionIV/lessons/SC_quality_control_analysis.html">hbctraining</a>). For a given cell, as sequencing depth increases each extra UMI is less likely to correspnf to a gene not already detected in that cell. Cells with small library size tend to have higher overall ‘novelty’ i.e. they have not reached saturation for any given gene. Outlier cell may have a library with low complexity. This may suggest the some cell types, e.g. red blood cells. The expected novelty is about 0.8.</p>
<p>Here we see that some PBMMCs have low novelty, ie overall fewer genes were detected for an equivalent number of UMIs in these cells than in others.</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="PreProcTop.html#cb414-1"></a>p &lt;-<span class="st"> </span><span class="kw">colData</span>(sce) <span class="op">%&gt;%</span></span>
<span id="cb414-2"><a href="PreProcTop.html#cb414-2"></a><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb414-3"><a href="PreProcTop.html#cb414-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>sum, <span class="dt">y=</span>detected, <span class="dt">color=</span>subsets_Mito_percent)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb414-4"><a href="PreProcTop.html#cb414-4"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb414-5"><a href="PreProcTop.html#cb414-5"></a><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method=</span>lm) <span class="op">+</span></span>
<span id="cb414-6"><a href="PreProcTop.html#cb414-6"></a><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb414-7"><a href="PreProcTop.html#cb414-7"></a><span class="st">  </span><span class="kw">scale_y_log10</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb414-8"><a href="PreProcTop.html#cb414-8"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">800</span>) <span class="op">+</span></span>
<span id="cb414-9"><a href="PreProcTop.html#cb414-9"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>source_name)</span>
<span id="cb414-10"><a href="PreProcTop.html#cb414-10"></a>p</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/novelty_scat-1.png" width="672" /></p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="PreProcTop.html#cb415-1"></a><span class="co"># write plot to file</span></span>
<span id="cb415-2"><a href="PreProcTop.html#cb415-2"></a></span>
<span id="cb415-3"><a href="PreProcTop.html#cb415-3"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s/novelty_scat.png&quot;</span>,</span>
<span id="cb415-4"><a href="PreProcTop.html#cb415-4"></a>         projDir, outDirBit, qcPlotDirBit)</span>
<span id="cb415-5"><a href="PreProcTop.html#cb415-5"></a><span class="kw">ggsave</span>(<span class="dt">plot=</span>p, <span class="dt">file=</span>tmpFn)</span>
<span id="cb415-6"><a href="PreProcTop.html#cb415-6"></a></span>
<span id="cb415-7"><a href="PreProcTop.html#cb415-7"></a><span class="co"># Novelty</span></span>
<span id="cb415-8"><a href="PreProcTop.html#cb415-8"></a><span class="co"># the number of genes per UMI for each cell,</span></span>
<span id="cb415-9"><a href="PreProcTop.html#cb415-9"></a><span class="co"># https://hbctraining.github.io/In-depth-NGS-Data-Analysis-Course/sessionIV/lessons/SC_quality_control_analysis.html</span></span>
<span id="cb415-10"><a href="PreProcTop.html#cb415-10"></a></span>
<span id="cb415-11"><a href="PreProcTop.html#cb415-11"></a><span class="co"># Add number of UMIs per gene for each cell to metadata</span></span>
<span id="cb415-12"><a href="PreProcTop.html#cb415-12"></a><span class="kw">colData</span>(sce)<span class="op">$</span>log10GenesPerUMI &lt;-<span class="st"> </span><span class="kw">log10</span>(<span class="kw">colData</span>(sce)<span class="op">$</span>detected) <span class="op">/</span><span class="st"> </span><span class="kw">log10</span>(<span class="kw">colData</span>(sce)<span class="op">$</span>sum)</span></code></pre></div>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="PreProcTop.html#cb416-1"></a><span class="co"># Visualize the overall novelty of the gene expression by visualizing the genes detected per UMI</span></span>
<span id="cb416-2"><a href="PreProcTop.html#cb416-2"></a>p &lt;-<span class="st"> </span><span class="kw">colData</span>(sce) <span class="op">%&gt;%</span></span>
<span id="cb416-3"><a href="PreProcTop.html#cb416-3"></a><span class="st">    </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb416-4"><a href="PreProcTop.html#cb416-4"></a><span class="st">        </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>log10GenesPerUMI, <span class="dt">color =</span> source_name, <span class="dt">fill =</span> source_name)) <span class="op">+</span></span>
<span id="cb416-5"><a href="PreProcTop.html#cb416-5"></a><span class="st">        </span><span class="kw">geom_density</span>()</span>
<span id="cb416-6"><a href="PreProcTop.html#cb416-6"></a>p</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/novelty_dens-1.png" width="672" /></p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="PreProcTop.html#cb417-1"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s/novelty_dens.png&quot;</span>,</span>
<span id="cb417-2"><a href="PreProcTop.html#cb417-2"></a>         projDir, outDirBit, qcPlotDirBit)</span>
<span id="cb417-3"><a href="PreProcTop.html#cb417-3"></a><span class="kw">ggsave</span>(<span class="dt">plot=</span>p, <span class="dt">file=</span>tmpFn)</span></code></pre></div>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="PreProcTop.html#cb418-1"></a><span class="kw">rm</span>(sce)</span></code></pre></div>
</div>
<div id="qc-based-on-sparsity-1" class="section level2">
<h2><span class="header-section-number">5.14</span> QC based on sparsity</h2>
<p>The approach above identified poor-quality using thresholds on the number of genes detected and mitochondrial content. We will here specifically look at the sparsity of the data, both at the gene and cell levels.</p>
<div id="remove-genes-that-are-not-expressed-at-all-1" class="section level3">
<h3><span class="header-section-number">5.14.1</span> Remove genes that are not expressed at all</h3>
<p>Genes that are not expressed at all are not informative, so we remove them:</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="PreProcTop.html#cb419-1"></a>not.expressed &lt;-<span class="st"> </span><span class="kw">rowSums</span>(<span class="kw">counts</span>(scePreQc)) <span class="op">==</span><span class="st"> </span><span class="dv">0</span></span>
<span id="cb419-2"><a href="PreProcTop.html#cb419-2"></a></span>
<span id="cb419-3"><a href="PreProcTop.html#cb419-3"></a><span class="co"># store the cell-wise information</span></span>
<span id="cb419-4"><a href="PreProcTop.html#cb419-4"></a>cols.meta &lt;-<span class="st"> </span><span class="kw">colData</span>(scePreQc)</span>
<span id="cb419-5"><a href="PreProcTop.html#cb419-5"></a>rows.meta &lt;-<span class="st"> </span><span class="kw">rowData</span>(scePreQc)</span>
<span id="cb419-6"><a href="PreProcTop.html#cb419-6"></a></span>
<span id="cb419-7"><a href="PreProcTop.html#cb419-7"></a>nz.counts &lt;-<span class="st"> </span><span class="kw">counts</span>(scePreQc)[<span class="op">!</span>not.expressed, ]</span>
<span id="cb419-8"><a href="PreProcTop.html#cb419-8"></a>sce.nz &lt;-<span class="st"> </span><span class="kw">SingleCellExperiment</span>(<span class="kw">list</span>(<span class="dt">counts=</span>nz.counts))</span>
<span id="cb419-9"><a href="PreProcTop.html#cb419-9"></a></span>
<span id="cb419-10"><a href="PreProcTop.html#cb419-10"></a><span class="co"># reset the column data on the new object</span></span>
<span id="cb419-11"><a href="PreProcTop.html#cb419-11"></a><span class="kw">colData</span>(sce.nz) &lt;-<span class="st"> </span>cols.meta</span>
<span id="cb419-12"><a href="PreProcTop.html#cb419-12"></a><span class="kw">rowData</span>(sce.nz) &lt;-<span class="st"> </span>rows.meta[<span class="op">!</span>not.expressed, ]</span>
<span id="cb419-13"><a href="PreProcTop.html#cb419-13"></a></span>
<span id="cb419-14"><a href="PreProcTop.html#cb419-14"></a>sce.nz</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 25116 38128 
## metadata(0):
## assays(1): counts
## rownames(25116): ENSG00000238009 ENSG00000239945 ... ENSG00000275063
##   ENSG00000271254
## rowData names(10): ensembl_gene_id external_gene_name ... mean detected
## colnames: NULL
## colData names(14): Barcode Run ... discard outlier
## reducedDimNames(0):
## altExpNames(0):</code></pre>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="PreProcTop.html#cb421-1"></a><span class="co"># Write object to file</span></span>
<span id="cb421-2"><a href="PreProcTop.html#cb421-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/sce_nz.Rds&quot;</span>,</span>
<span id="cb421-3"><a href="PreProcTop.html#cb421-3"></a>         projDir, outDirBit)</span>
<span id="cb421-4"><a href="PreProcTop.html#cb421-4"></a><span class="kw">saveRDS</span>(sce.nz, tmpFn)</span></code></pre></div>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="PreProcTop.html#cb422-1"></a><span class="co"># Write object to file</span></span>
<span id="cb422-2"><a href="PreProcTop.html#cb422-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/sce_nz.Rds&quot;</span>,</span>
<span id="cb422-3"><a href="PreProcTop.html#cb422-3"></a>         projDir, outDirBit)</span>
<span id="cb422-4"><a href="PreProcTop.html#cb422-4"></a>sce.nz &lt;-<span class="st"> </span><span class="kw">readRDS</span>(tmpFn)</span></code></pre></div>
</div>
<div id="sparsity-plots-1" class="section level3">
<h3><span class="header-section-number">5.14.2</span> Sparsity plots</h3>
<p>We will compute:</p>
<ul>
<li>the cell sparsity: for each cell, the proportion of genes that are not detected</li>
<li>the gene sparsity: for each gene, the proportion of cells in which it is not detected</li>
</ul>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="PreProcTop.html#cb423-1"></a><span class="co"># compute - SLOW</span></span>
<span id="cb423-2"><a href="PreProcTop.html#cb423-2"></a>cell_sparsity &lt;-<span class="st"> </span><span class="kw">apply</span>(<span class="kw">counts</span>(sce.nz) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">2</span>, sum)<span class="op">/</span><span class="kw">nrow</span>(<span class="kw">counts</span>(sce.nz))</span>
<span id="cb423-3"><a href="PreProcTop.html#cb423-3"></a>gene_sparsity &lt;-<span class="st"> </span><span class="kw">apply</span>(<span class="kw">counts</span>(sce.nz) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">1</span>, sum)<span class="op">/</span><span class="kw">ncol</span>(<span class="kw">counts</span>(sce.nz))</span>
<span id="cb423-4"><a href="PreProcTop.html#cb423-4"></a></span>
<span id="cb423-5"><a href="PreProcTop.html#cb423-5"></a><span class="kw">colData</span>(sce.nz)<span class="op">$</span>cell_sparsity &lt;-<span class="st"> </span>cell_sparsity</span>
<span id="cb423-6"><a href="PreProcTop.html#cb423-6"></a><span class="kw">rowData</span>(sce.nz)<span class="op">$</span>gene_sparsity &lt;-<span class="st"> </span>gene_sparsity</span>
<span id="cb423-7"><a href="PreProcTop.html#cb423-7"></a></span>
<span id="cb423-8"><a href="PreProcTop.html#cb423-8"></a><span class="co"># write outcome to file for later use</span></span>
<span id="cb423-9"><a href="PreProcTop.html#cb423-9"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/sce_nz_sparsityCellGene.Rds&quot;</span>,</span>
<span id="cb423-10"><a href="PreProcTop.html#cb423-10"></a>         projDir, outDirBit)</span>
<span id="cb423-11"><a href="PreProcTop.html#cb423-11"></a><span class="kw">saveRDS</span>(<span class="kw">list</span>(<span class="st">&quot;colData&quot;</span> =<span class="st"> </span><span class="kw">colData</span>(sce.nz),</span>
<span id="cb423-12"><a href="PreProcTop.html#cb423-12"></a>         <span class="st">&quot;rowData&quot;</span> =<span class="st"> </span><span class="kw">rowData</span>(sce.nz)),</span>
<span id="cb423-13"><a href="PreProcTop.html#cb423-13"></a>    tmpFn)</span></code></pre></div>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="PreProcTop.html#cb424-1"></a><span class="co"># Read object in:</span></span>
<span id="cb424-2"><a href="PreProcTop.html#cb424-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/sce_nz_sparsityCellGene.Rds&quot;</span>,</span>
<span id="cb424-3"><a href="PreProcTop.html#cb424-3"></a>         projDir, outDirBit)</span>
<span id="cb424-4"><a href="PreProcTop.html#cb424-4"></a>tmpList &lt;-<span class="st"> </span><span class="kw">readRDS</span>(tmpFn)</span>
<span id="cb424-5"><a href="PreProcTop.html#cb424-5"></a>cell_sparsity &lt;-<span class="st"> </span>tmpList<span class="op">$</span>colData<span class="op">$</span>cell_sparsity</span>
<span id="cb424-6"><a href="PreProcTop.html#cb424-6"></a>gene_sparsity &lt;-<span class="st"> </span>tmpList<span class="op">$</span>rowData<span class="op">$</span>gene_sparsity</span></code></pre></div>
<p>We now plot the distribution of these two metrics.</p>
<p>The cell sparsity plot shows that cells have between 85% and 99% 0’s, which is typical.</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="PreProcTop.html#cb425-1"></a><span class="kw">hist</span>(cell_sparsity, <span class="dt">breaks=</span><span class="dv">50</span>, <span class="dt">col=</span><span class="st">&quot;grey80&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Cell sparsity&quot;</span>, <span class="dt">main=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
<p>The gene sparsity plot shows that a large number of genes are almost never detected, which is also regularly observed.</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="PreProcTop.html#cb426-1"></a><span class="kw">hist</span>(gene_sparsity, <span class="dt">breaks=</span><span class="dv">50</span>, <span class="dt">col=</span><span class="st">&quot;grey80&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Gene sparsity&quot;</span>, <span class="dt">main=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="MkWiC_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
</div>
<div id="filters-1" class="section level3">
<h3><span class="header-section-number">5.14.3</span> Filters</h3>
<p>We also remove cells with sparsity higher than 0.99, and/or mitochondrial content higher than 20%.</p>
<p>Genes detected in a few cells only are unlikely to be informative and would hinder normalisation. We will remove genes that are expressed in fewer than 20 cells.</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="PreProcTop.html#cb427-1"></a><span class="co"># filter</span></span>
<span id="cb427-2"><a href="PreProcTop.html#cb427-2"></a>sparse.cells &lt;-<span class="st"> </span>cell_sparsity <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.99</span></span>
<span id="cb427-3"><a href="PreProcTop.html#cb427-3"></a>mito.cells &lt;-<span class="st"> </span>sce.nz<span class="op">$</span>subsets_Mito_percent <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span></span>
<span id="cb427-4"><a href="PreProcTop.html#cb427-4"></a></span>
<span id="cb427-5"><a href="PreProcTop.html#cb427-5"></a>min.cells &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="dv">20</span><span class="op">/</span><span class="kw">length</span>(cell_sparsity))</span>
<span id="cb427-6"><a href="PreProcTop.html#cb427-6"></a>sparse.genes &lt;-<span class="st"> </span>gene_sparsity <span class="op">&gt;</span><span class="st"> </span>min.cells</span></code></pre></div>
<p>Number of genes removed:</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="PreProcTop.html#cb428-1"></a><span class="kw">table</span>(sparse.genes)</span></code></pre></div>
<pre><code>## sparse.genes
## FALSE  TRUE 
## 17854  7262</code></pre>
<p>Number of cells removed:</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="PreProcTop.html#cb430-1"></a><span class="kw">table</span>(sparse.cells, mito.cells)</span></code></pre></div>
<pre><code>##             mito.cells
## sparse.cells FALSE  TRUE
##        FALSE 36871   671
##        TRUE    525    61</code></pre>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="PreProcTop.html#cb432-1"></a><span class="co"># remove cells from the SCE object that are poor quality</span></span>
<span id="cb432-2"><a href="PreProcTop.html#cb432-2"></a><span class="co"># remove the sparse genes, then re-set the counts and row data accordingly</span></span>
<span id="cb432-3"><a href="PreProcTop.html#cb432-3"></a>cols.meta &lt;-<span class="st"> </span><span class="kw">colData</span>(sce.nz)</span>
<span id="cb432-4"><a href="PreProcTop.html#cb432-4"></a>rows.meta &lt;-<span class="st"> </span><span class="kw">rowData</span>(sce.nz)</span>
<span id="cb432-5"><a href="PreProcTop.html#cb432-5"></a></span>
<span id="cb432-6"><a href="PreProcTop.html#cb432-6"></a>counts.nz &lt;-<span class="st"> </span><span class="kw">counts</span>(sce.nz)[<span class="op">!</span>sparse.genes, <span class="op">!</span>(sparse.cells <span class="op">|</span><span class="st"> </span>mito.cells)]</span>
<span id="cb432-7"><a href="PreProcTop.html#cb432-7"></a>sce.nz &lt;-<span class="st"> </span><span class="kw">SingleCellExperiment</span>(<span class="dt">assays=</span><span class="kw">list</span>(<span class="dt">counts=</span>counts.nz))</span>
<span id="cb432-8"><a href="PreProcTop.html#cb432-8"></a><span class="kw">colData</span>(sce.nz) &lt;-<span class="st"> </span>cols.meta[<span class="op">!</span>(sparse.cells <span class="op">|</span><span class="st"> </span>mito.cells),]</span>
<span id="cb432-9"><a href="PreProcTop.html#cb432-9"></a><span class="kw">rowData</span>(sce.nz) &lt;-<span class="st"> </span>rows.meta[<span class="op">!</span>sparse.genes, ]</span>
<span id="cb432-10"><a href="PreProcTop.html#cb432-10"></a>sce.nz</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 17854 36871 
## metadata(0):
## assays(1): counts
## rownames(17854): ENSG00000238009 ENSG00000237491 ... ENSG00000275063
##   ENSG00000271254
## rowData names(11): ensembl_gene_id external_gene_name ... detected
##   gene_sparsity
## colnames: NULL
## colData names(15): Barcode Run ... outlier cell_sparsity
## reducedDimNames(0):
## altExpNames(0):</code></pre>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="PreProcTop.html#cb434-1"></a><span class="co"># Write object to file</span></span>
<span id="cb434-2"><a href="PreProcTop.html#cb434-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/sce_nz_postQc.Rds&quot;</span>,</span>
<span id="cb434-3"><a href="PreProcTop.html#cb434-3"></a>         projDir, outDirBit)</span>
<span id="cb434-4"><a href="PreProcTop.html#cb434-4"></a><span class="kw">saveRDS</span>(sce.nz, tmpFn)</span></code></pre></div>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="PreProcTop.html#cb435-1"></a><span class="co"># Read object in:</span></span>
<span id="cb435-2"><a href="PreProcTop.html#cb435-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/sce_nz_postQc.Rds&quot;</span>,</span>
<span id="cb435-3"><a href="PreProcTop.html#cb435-3"></a>         projDir, outDirBit)</span>
<span id="cb435-4"><a href="PreProcTop.html#cb435-4"></a>sce.nz &lt;-<span class="st"> </span><span class="kw">readRDS</span>(tmpFn)</span></code></pre></div>
<p>Compare with filter above (mind that the comparison is not fair because we used a less stringent, hard filtering on mitochondrial content):</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="PreProcTop.html#cb436-1"></a><span class="kw">table</span>(scePreQc<span class="op">$</span>discard, (sparse.cells <span class="op">|</span><span class="st"> </span>mito.cells))</span></code></pre></div>
<pre><code>##        
##         FALSE  TRUE
##   FALSE 35351   334
##   TRUE   1520   923</code></pre>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="PreProcTop.html#cb438-1"></a><span class="kw">rm</span>(scePreQc)</span></code></pre></div>
</div>
<div id="separate-caron-and-hca-batches-1" class="section level3">
<h3><span class="header-section-number">5.14.4</span> Separate Caron and Hca batches</h3>
<p>We will now check sparsity for each batch separately.</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="PreProcTop.html#cb439-1"></a>sce.nz.caron &lt;-<span class="st"> </span>sce.nz[,sce.nz<span class="op">$</span>setName<span class="op">==</span><span class="st">&quot;Caron&quot;</span>]</span>
<span id="cb439-2"><a href="PreProcTop.html#cb439-2"></a>sce.nz.hca &lt;-<span class="st"> </span>sce.nz[,sce.nz<span class="op">$</span>setName<span class="op">==</span><span class="st">&quot;Hca&quot;</span>]</span></code></pre></div>
</div>
<div id="caron-only-1" class="section level3">
<h3><span class="header-section-number">5.14.5</span> Caron only</h3>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="PreProcTop.html#cb440-1"></a>setName &lt;-<span class="st"> &quot;caron&quot;</span></span>
<span id="cb440-2"><a href="PreProcTop.html#cb440-2"></a>sce.x &lt;-<span class="st"> </span>sce.nz.caron</span>
<span id="cb440-3"><a href="PreProcTop.html#cb440-3"></a><span class="kw">rm</span>(sce.nz.caron)</span></code></pre></div>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="PreProcTop.html#cb441-1"></a><span class="co"># compute - SLOW</span></span>
<span id="cb441-2"><a href="PreProcTop.html#cb441-2"></a>cell_sparsity &lt;-<span class="st"> </span><span class="kw">apply</span>(<span class="kw">counts</span>(sce.x) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">2</span>, sum)<span class="op">/</span><span class="kw">nrow</span>(<span class="kw">counts</span>(sce.x))</span>
<span id="cb441-3"><a href="PreProcTop.html#cb441-3"></a>gene_sparsity &lt;-<span class="st"> </span><span class="kw">apply</span>(<span class="kw">counts</span>(sce.x) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">1</span>, sum)<span class="op">/</span><span class="kw">ncol</span>(<span class="kw">counts</span>(sce.x))</span>
<span id="cb441-4"><a href="PreProcTop.html#cb441-4"></a></span>
<span id="cb441-5"><a href="PreProcTop.html#cb441-5"></a><span class="kw">colData</span>(sce.x)<span class="op">$</span>cell_sparsity &lt;-<span class="st"> </span>cell_sparsity</span>
<span id="cb441-6"><a href="PreProcTop.html#cb441-6"></a><span class="kw">rowData</span>(sce.x)<span class="op">$</span>gene_sparsity &lt;-<span class="st"> </span>gene_sparsity</span>
<span id="cb441-7"><a href="PreProcTop.html#cb441-7"></a></span>
<span id="cb441-8"><a href="PreProcTop.html#cb441-8"></a><span class="co"># write outcome to file for later use</span></span>
<span id="cb441-9"><a href="PreProcTop.html#cb441-9"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/%s_sce_nz_sparsityCellGene.Rds&quot;</span>,</span>
<span id="cb441-10"><a href="PreProcTop.html#cb441-10"></a>         projDir, outDirBit, setName)</span>
<span id="cb441-11"><a href="PreProcTop.html#cb441-11"></a><span class="kw">saveRDS</span>(<span class="kw">list</span>(<span class="st">&quot;colData&quot;</span> =<span class="st"> </span><span class="kw">colData</span>(sce.x),</span>
<span id="cb441-12"><a href="PreProcTop.html#cb441-12"></a>         <span class="st">&quot;rowData&quot;</span> =<span class="st"> </span><span class="kw">rowData</span>(sce.x)),</span>
<span id="cb441-13"><a href="PreProcTop.html#cb441-13"></a>    tmpFn)</span></code></pre></div>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="PreProcTop.html#cb442-1"></a><span class="co"># Read object in:</span></span>
<span id="cb442-2"><a href="PreProcTop.html#cb442-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/%s_sce_nz_sparsityCellGene.Rds&quot;</span>,</span>
<span id="cb442-3"><a href="PreProcTop.html#cb442-3"></a>         projDir, outDirBit, setName)</span>
<span id="cb442-4"><a href="PreProcTop.html#cb442-4"></a>tmpList &lt;-<span class="st"> </span><span class="kw">readRDS</span>(tmpFn)</span>
<span id="cb442-5"><a href="PreProcTop.html#cb442-5"></a>cell_sparsity &lt;-<span class="st"> </span>tmpList<span class="op">$</span>colData<span class="op">$</span>cell_sparsity</span>
<span id="cb442-6"><a href="PreProcTop.html#cb442-6"></a>gene_sparsity &lt;-<span class="st"> </span>tmpList<span class="op">$</span>rowData<span class="op">$</span>gene_sparsity</span></code></pre></div>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="PreProcTop.html#cb443-1"></a><span class="co"># plot</span></span>
<span id="cb443-2"><a href="PreProcTop.html#cb443-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s/%s_sparsity.png&quot;</span>,</span>
<span id="cb443-3"><a href="PreProcTop.html#cb443-3"></a>         projDir, outDirBit, qcPlotDirBit, setName)</span>
<span id="cb443-4"><a href="PreProcTop.html#cb443-4"></a><span class="kw">png</span>(tmpFn)</span>
<span id="cb443-5"><a href="PreProcTop.html#cb443-5"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb443-6"><a href="PreProcTop.html#cb443-6"></a><span class="kw">hist</span>(cell_sparsity, <span class="dt">breaks=</span><span class="dv">50</span>, <span class="dt">col=</span><span class="st">&quot;grey80&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Cell sparsity&quot;</span>, <span class="dt">main=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb443-7"><a href="PreProcTop.html#cb443-7"></a><span class="kw">hist</span>(gene_sparsity, <span class="dt">breaks=</span><span class="dv">50</span>, <span class="dt">col=</span><span class="st">&quot;grey80&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Gene sparsity&quot;</span>, <span class="dt">main=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb443-8"><a href="PreProcTop.html#cb443-8"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">40</span>, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">&#39;purple&#39;</span>)</span>
<span id="cb443-9"><a href="PreProcTop.html#cb443-9"></a><span class="kw">dev.off</span>()</span></code></pre></div>
<pre><code>## png 
##   2</code></pre>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="PreProcTop.html#cb445-1"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;../%s/%s_sparsity.png&quot;</span>,</span>
<span id="cb445-2"><a href="PreProcTop.html#cb445-2"></a>         qcPlotDirBit, setName)</span>
<span id="cb445-3"><a href="PreProcTop.html#cb445-3"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(tmpFn, <span class="dt">auto_pdf =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="../Plots/Qc/caron_sparsity.png" width="80%" /></p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="PreProcTop.html#cb446-1"></a><span class="kw">rm</span>(tmpFn)</span></code></pre></div>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="PreProcTop.html#cb447-1"></a><span class="co"># filter</span></span>
<span id="cb447-2"><a href="PreProcTop.html#cb447-2"></a>sparse.cells &lt;-<span class="st"> </span>cell_sparsity <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.99</span></span>
<span id="cb447-3"><a href="PreProcTop.html#cb447-3"></a>mito.cells &lt;-<span class="st"> </span>sce.x<span class="op">$</span>subsets_Mito_percent <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span></span>
<span id="cb447-4"><a href="PreProcTop.html#cb447-4"></a></span>
<span id="cb447-5"><a href="PreProcTop.html#cb447-5"></a>min.cells &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="dv">20</span><span class="op">/</span><span class="kw">length</span>(cell_sparsity))</span>
<span id="cb447-6"><a href="PreProcTop.html#cb447-6"></a>sparse.genes &lt;-<span class="st"> </span>gene_sparsity <span class="op">&gt;</span><span class="st"> </span>min.cells</span></code></pre></div>
<p>We write the R object to ‘caron_sce_nz_postQc.Rds’.</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="PreProcTop.html#cb448-1"></a><span class="co"># remove cells from the SCE object that are poor quality</span></span>
<span id="cb448-2"><a href="PreProcTop.html#cb448-2"></a><span class="co"># remove the sparse genes, then re-set the counts and row data accordingly</span></span>
<span id="cb448-3"><a href="PreProcTop.html#cb448-3"></a>cols.meta &lt;-<span class="st"> </span><span class="kw">colData</span>(sce.x)</span>
<span id="cb448-4"><a href="PreProcTop.html#cb448-4"></a>rows.meta &lt;-<span class="st"> </span><span class="kw">rowData</span>(sce.x)</span>
<span id="cb448-5"><a href="PreProcTop.html#cb448-5"></a></span>
<span id="cb448-6"><a href="PreProcTop.html#cb448-6"></a>counts.x &lt;-<span class="st"> </span><span class="kw">counts</span>(sce.x)[<span class="op">!</span>sparse.genes, <span class="op">!</span>(sparse.cells <span class="op">|</span><span class="st"> </span>mito.cells)]</span>
<span id="cb448-7"><a href="PreProcTop.html#cb448-7"></a>sce.x &lt;-<span class="st"> </span><span class="kw">SingleCellExperiment</span>(<span class="dt">assays=</span><span class="kw">list</span>(<span class="dt">counts=</span>counts.x))</span>
<span id="cb448-8"><a href="PreProcTop.html#cb448-8"></a><span class="kw">colData</span>(sce.x) &lt;-<span class="st"> </span>cols.meta[<span class="op">!</span>(sparse.cells <span class="op">|</span><span class="st"> </span>mito.cells),]</span>
<span id="cb448-9"><a href="PreProcTop.html#cb448-9"></a><span class="kw">rowData</span>(sce.x) &lt;-<span class="st"> </span>rows.meta[<span class="op">!</span>sparse.genes, ]</span>
<span id="cb448-10"><a href="PreProcTop.html#cb448-10"></a>sce.x</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 16629 20908 
## metadata(0):
## assays(1): counts
## rownames(16629): ENSG00000237491 ENSG00000225880 ... ENSG00000275063
##   ENSG00000271254
## rowData names(11): ensembl_gene_id external_gene_name ... detected
##   gene_sparsity
## colnames: NULL
## colData names(15): Barcode Run ... outlier cell_sparsity
## reducedDimNames(0):
## altExpNames(0):</code></pre>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="PreProcTop.html#cb450-1"></a><span class="co"># Write object to file</span></span>
<span id="cb450-2"><a href="PreProcTop.html#cb450-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/%s_sce_nz_postQc.Rds&quot;</span>, projDir, outDirBit, setName)</span>
<span id="cb450-3"><a href="PreProcTop.html#cb450-3"></a><span class="kw">saveRDS</span>(sce.x, tmpFn)</span>
<span id="cb450-4"><a href="PreProcTop.html#cb450-4"></a></span>
<span id="cb450-5"><a href="PreProcTop.html#cb450-5"></a><span class="co"># update sce.nz.caron</span></span>
<span id="cb450-6"><a href="PreProcTop.html#cb450-6"></a>sce.nz.caron &lt;-<span class="st"> </span>sce.x  <span class="co"># TODO not used</span></span>
<span id="cb450-7"><a href="PreProcTop.html#cb450-7"></a><span class="kw">rm</span>(sce.x)</span></code></pre></div>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="PreProcTop.html#cb451-1"></a><span class="co"># Read object in:</span></span>
<span id="cb451-2"><a href="PreProcTop.html#cb451-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/%s_sce_nz_postQc.Rds&quot;</span>,</span>
<span id="cb451-3"><a href="PreProcTop.html#cb451-3"></a>         dirRel, outDirBit, setName)</span>
<span id="cb451-4"><a href="PreProcTop.html#cb451-4"></a>sce.nz.caron &lt;-<span class="st"> </span><span class="kw">readRDS</span>(tmpFn)</span></code></pre></div>
</div>
<div id="hca-only-1" class="section level3">
<h3><span class="header-section-number">5.14.6</span> Hca only</h3>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="PreProcTop.html#cb452-1"></a>setName &lt;-<span class="st"> &quot;hca&quot;</span></span>
<span id="cb452-2"><a href="PreProcTop.html#cb452-2"></a>sce.x &lt;-<span class="st"> </span>sce.nz.hca</span>
<span id="cb452-3"><a href="PreProcTop.html#cb452-3"></a><span class="kw">rm</span>(sce.nz.hca)</span></code></pre></div>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="PreProcTop.html#cb453-1"></a><span class="co"># compute - SLOW</span></span>
<span id="cb453-2"><a href="PreProcTop.html#cb453-2"></a>cell_sparsity &lt;-<span class="st"> </span><span class="kw">apply</span>(<span class="kw">counts</span>(sce.x) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">2</span>, sum)<span class="op">/</span><span class="kw">nrow</span>(<span class="kw">counts</span>(sce.x))</span>
<span id="cb453-3"><a href="PreProcTop.html#cb453-3"></a>gene_sparsity &lt;-<span class="st"> </span><span class="kw">apply</span>(<span class="kw">counts</span>(sce.x) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">1</span>, sum)<span class="op">/</span><span class="kw">ncol</span>(<span class="kw">counts</span>(sce.x))</span>
<span id="cb453-4"><a href="PreProcTop.html#cb453-4"></a></span>
<span id="cb453-5"><a href="PreProcTop.html#cb453-5"></a><span class="kw">colData</span>(sce.x)<span class="op">$</span>cell_sparsity &lt;-<span class="st"> </span>cell_sparsity</span>
<span id="cb453-6"><a href="PreProcTop.html#cb453-6"></a><span class="kw">rowData</span>(sce.x)<span class="op">$</span>gene_sparsity &lt;-<span class="st"> </span>gene_sparsity</span>
<span id="cb453-7"><a href="PreProcTop.html#cb453-7"></a></span>
<span id="cb453-8"><a href="PreProcTop.html#cb453-8"></a><span class="co"># write outcome to file for later use</span></span>
<span id="cb453-9"><a href="PreProcTop.html#cb453-9"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/%s_sce_nz_sparsityCellGene.Rds&quot;</span>,</span>
<span id="cb453-10"><a href="PreProcTop.html#cb453-10"></a>         projDir, outDirBit, setName)</span>
<span id="cb453-11"><a href="PreProcTop.html#cb453-11"></a><span class="kw">saveRDS</span>(<span class="kw">list</span>(<span class="st">&quot;colData&quot;</span> =<span class="st"> </span><span class="kw">colData</span>(sce.x),</span>
<span id="cb453-12"><a href="PreProcTop.html#cb453-12"></a>         <span class="st">&quot;rowData&quot;</span> =<span class="st"> </span><span class="kw">rowData</span>(sce.x)),</span>
<span id="cb453-13"><a href="PreProcTop.html#cb453-13"></a>    tmpFn)</span></code></pre></div>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="PreProcTop.html#cb454-1"></a><span class="co"># Read object in:</span></span>
<span id="cb454-2"><a href="PreProcTop.html#cb454-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/%s_sce_nz_sparsityCellGene.Rds&quot;</span>,</span>
<span id="cb454-3"><a href="PreProcTop.html#cb454-3"></a>         projDir, outDirBit, setName)</span>
<span id="cb454-4"><a href="PreProcTop.html#cb454-4"></a>tmpList &lt;-<span class="st"> </span><span class="kw">readRDS</span>(tmpFn)</span>
<span id="cb454-5"><a href="PreProcTop.html#cb454-5"></a>cell_sparsity &lt;-<span class="st"> </span>tmpList<span class="op">$</span>colData<span class="op">$</span>cell_sparsity</span>
<span id="cb454-6"><a href="PreProcTop.html#cb454-6"></a>gene_sparsity &lt;-<span class="st"> </span>tmpList<span class="op">$</span>rowData<span class="op">$</span>gene_sparsity</span></code></pre></div>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="PreProcTop.html#cb455-1"></a><span class="co"># plot</span></span>
<span id="cb455-2"><a href="PreProcTop.html#cb455-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/%s/%s_sparsity.png&quot;</span>,</span>
<span id="cb455-3"><a href="PreProcTop.html#cb455-3"></a>         projDir, outDirBit, qcPlotDirBit, setName)</span>
<span id="cb455-4"><a href="PreProcTop.html#cb455-4"></a><span class="kw">png</span>(tmpFn)</span>
<span id="cb455-5"><a href="PreProcTop.html#cb455-5"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb455-6"><a href="PreProcTop.html#cb455-6"></a><span class="kw">hist</span>(cell_sparsity, <span class="dt">breaks=</span><span class="dv">50</span>, <span class="dt">col=</span><span class="st">&quot;grey80&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Cell sparsity&quot;</span>, <span class="dt">main=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb455-7"><a href="PreProcTop.html#cb455-7"></a><span class="kw">hist</span>(gene_sparsity, <span class="dt">breaks=</span><span class="dv">50</span>, <span class="dt">col=</span><span class="st">&quot;grey80&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Gene sparsity&quot;</span>, <span class="dt">main=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb455-8"><a href="PreProcTop.html#cb455-8"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">40</span>, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">&#39;purple&#39;</span>)</span>
<span id="cb455-9"><a href="PreProcTop.html#cb455-9"></a><span class="kw">dev.off</span>()</span></code></pre></div>
<pre><code>## png 
##   2</code></pre>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="PreProcTop.html#cb457-1"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;../%s/%s_sparsity.png&quot;</span>,</span>
<span id="cb457-2"><a href="PreProcTop.html#cb457-2"></a>         qcPlotDirBit, setName)</span>
<span id="cb457-3"><a href="PreProcTop.html#cb457-3"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>(tmpFn, <span class="dt">auto_pdf =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="../Plots/Qc/hca_sparsity.png" width="80%" /></p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="PreProcTop.html#cb458-1"></a><span class="kw">rm</span>(tmpFn)</span></code></pre></div>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="PreProcTop.html#cb459-1"></a><span class="co"># filter</span></span>
<span id="cb459-2"><a href="PreProcTop.html#cb459-2"></a>sparse.cells &lt;-<span class="st"> </span>cell_sparsity <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.99</span></span>
<span id="cb459-3"><a href="PreProcTop.html#cb459-3"></a>mito.cells &lt;-<span class="st"> </span>sce.x<span class="op">$</span>subsets_Mito_percent <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span></span>
<span id="cb459-4"><a href="PreProcTop.html#cb459-4"></a></span>
<span id="cb459-5"><a href="PreProcTop.html#cb459-5"></a>min.cells &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="dv">20</span><span class="op">/</span><span class="kw">length</span>(cell_sparsity))</span>
<span id="cb459-6"><a href="PreProcTop.html#cb459-6"></a>sparse.genes &lt;-<span class="st"> </span>gene_sparsity <span class="op">&gt;</span><span class="st"> </span>min.cells</span></code></pre></div>
<p>We write the R object to ‘hca_sce_nz_postQc.Rds’.</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="PreProcTop.html#cb460-1"></a><span class="co"># remove cells from the SCE object that are poor quality</span></span>
<span id="cb460-2"><a href="PreProcTop.html#cb460-2"></a><span class="co"># remove the sparse genes, then re-set the counts and row data accordingly</span></span>
<span id="cb460-3"><a href="PreProcTop.html#cb460-3"></a>cols.meta &lt;-<span class="st"> </span><span class="kw">colData</span>(sce.x)</span>
<span id="cb460-4"><a href="PreProcTop.html#cb460-4"></a>rows.meta &lt;-<span class="st"> </span><span class="kw">rowData</span>(sce.x)</span>
<span id="cb460-5"><a href="PreProcTop.html#cb460-5"></a></span>
<span id="cb460-6"><a href="PreProcTop.html#cb460-6"></a>counts.x &lt;-<span class="st"> </span><span class="kw">counts</span>(sce.x)[<span class="op">!</span>sparse.genes, <span class="op">!</span>(sparse.cells <span class="op">|</span><span class="st"> </span>mito.cells)]</span>
<span id="cb460-7"><a href="PreProcTop.html#cb460-7"></a>sce.x &lt;-<span class="st"> </span><span class="kw">SingleCellExperiment</span>(<span class="dt">assays=</span><span class="kw">list</span>(<span class="dt">counts=</span>counts.x))</span>
<span id="cb460-8"><a href="PreProcTop.html#cb460-8"></a><span class="kw">colData</span>(sce.x) &lt;-<span class="st"> </span>cols.meta[<span class="op">!</span>(sparse.cells <span class="op">|</span><span class="st"> </span>mito.cells),]</span>
<span id="cb460-9"><a href="PreProcTop.html#cb460-9"></a><span class="kw">rowData</span>(sce.x) &lt;-<span class="st"> </span>rows.meta[<span class="op">!</span>sparse.genes, ]</span>
<span id="cb460-10"><a href="PreProcTop.html#cb460-10"></a>sce.x</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 14994 15963 
## metadata(0):
## assays(1): counts
## rownames(14994): ENSG00000237491 ENSG00000225880 ... ENSG00000276345
##   ENSG00000271254
## rowData names(11): ensembl_gene_id external_gene_name ... detected
##   gene_sparsity
## colnames: NULL
## colData names(15): Barcode Run ... outlier cell_sparsity
## reducedDimNames(0):
## altExpNames(0):</code></pre>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="PreProcTop.html#cb462-1"></a><span class="co"># Write object to file</span></span>
<span id="cb462-2"><a href="PreProcTop.html#cb462-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/%s_sce_nz_postQc.Rds&quot;</span>,</span>
<span id="cb462-3"><a href="PreProcTop.html#cb462-3"></a>         projDir, outDirBit, setName)</span>
<span id="cb462-4"><a href="PreProcTop.html#cb462-4"></a><span class="kw">saveRDS</span>(sce.x, tmpFn)</span>
<span id="cb462-5"><a href="PreProcTop.html#cb462-5"></a></span>
<span id="cb462-6"><a href="PreProcTop.html#cb462-6"></a><span class="co"># update sce.nz.hca</span></span>
<span id="cb462-7"><a href="PreProcTop.html#cb462-7"></a>sce.nz.hca &lt;-<span class="st"> </span>sce.x  <span class="co"># TODO not used</span></span>
<span id="cb462-8"><a href="PreProcTop.html#cb462-8"></a><span class="kw">rm</span>(sce.x)</span></code></pre></div>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="PreProcTop.html#cb463-1"></a><span class="co"># Read object in:</span></span>
<span id="cb463-2"><a href="PreProcTop.html#cb463-2"></a>tmpFn &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/%s/Robjects/%s_sce_nz_postQc.Rds&quot;</span>,</span>
<span id="cb463-3"><a href="PreProcTop.html#cb463-3"></a>         projDir, outDirBit, setName)</span>
<span id="cb463-4"><a href="PreProcTop.html#cb463-4"></a>sce.nz.hca &lt;-<span class="st"> </span><span class="kw">readRDS</span>(tmpFn) <span class="co"># TODO not used</span></span></code></pre></div>
</div>
</div>
<div id="session-information-1" class="section level2">
<h2><span class="header-section-number">5.15</span> Session information</h2>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="PreProcTop.html#cb464-1"></a><span class="kw">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.0.3 (2020-10-10)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: CentOS Linux 8 (Core)
## 
## Matrix products: default
## BLAS:   /opt/R/R-4.0.3/lib64/R/lib/libRblas.so
## LAPACK: /opt/R/R-4.0.3/lib64/R/lib/libRlapack.so
## 
## locale:
##  [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8    
##  [5] LC_MONETARY=en_GB.UTF-8    LC_MESSAGES=en_GB.UTF-8   
##  [7] LC_PAPER=en_GB.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats4    parallel  stats     graphics  grDevices utils     datasets 
## [8] methods   base     
## 
## other attached packages:
##  [1] robustbase_0.93-7           mixtools_1.2.0             
##  [3] irlba_2.3.3                 biomaRt_2.46.3             
##  [5] Matrix_1.2-18               igraph_1.2.6               
##  [7] DropletUtils_1.10.3         scater_1.18.6              
##  [9] ggplot2_3.3.3               scran_1.18.7               
## [11] SingleCellExperiment_1.12.0 SummarizedExperiment_1.20.0
## [13] Biobase_2.50.0              GenomicRanges_1.42.0       
## [15] GenomeInfoDb_1.26.7         IRanges_2.24.1             
## [17] S4Vectors_0.28.1            BiocGenerics_0.36.1        
## [19] MatrixGenerics_1.2.1        matrixStats_0.58.0         
## [21] dplyr_1.0.5                 DT_0.18                    
## [23] knitr_1.32                 
## 
## loaded via a namespace (and not attached):
##   [1] BiocFileCache_1.14.0      splines_4.0.3            
##   [3] BiocParallel_1.24.1       crosstalk_1.1.1          
##   [5] digest_0.6.27             htmltools_0.5.1.1        
##   [7] viridis_0.5.1             fansi_0.4.2              
##   [9] magrittr_2.0.1            memoise_2.0.0            
##  [11] limma_3.46.0              readr_1.4.0              
##  [13] R.utils_2.10.1            askpass_1.1              
##  [15] prettyunits_1.1.1         colorspace_2.0-0         
##  [17] blob_1.2.1                rappdirs_0.3.1           
##  [19] xfun_0.22                 crayon_1.4.1             
##  [21] RCurl_1.98-1.3            jsonlite_1.7.2           
##  [23] survival_3.2-7            glue_1.4.2               
##  [25] gtable_0.3.0              zlibbioc_1.36.0          
##  [27] XVector_0.30.0            DelayedArray_0.16.3      
##  [29] BiocSingular_1.6.0        kernlab_0.9-29           
##  [31] Rhdf5lib_1.12.1           DEoptimR_1.0-8           
##  [33] HDF5Array_1.18.1          scales_1.1.1             
##  [35] DBI_1.1.1                 edgeR_3.32.1             
##  [37] miniUI_0.1.1.1            Rcpp_1.0.6               
##  [39] isoband_0.2.4             xtable_1.8-4             
##  [41] viridisLite_0.3.0         progress_1.2.2           
##  [43] dqrng_0.2.1               bit_4.0.4                
##  [45] rsvd_1.0.3                htmlwidgets_1.5.3        
##  [47] httr_1.4.2                ellipsis_0.3.1           
##  [49] pkgconfig_2.0.3           XML_3.99-0.5             
##  [51] R.methodsS3_1.8.1         farver_2.1.0             
##  [53] scuttle_1.0.4             sass_0.3.1               
##  [55] dbplyr_2.0.0              locfit_1.5-9.4           
##  [57] utf8_1.2.1                later_1.1.0.1            
##  [59] tidyselect_1.1.0          labeling_0.4.2           
##  [61] rlang_0.4.10              AnnotationDbi_1.52.0     
##  [63] munsell_0.5.0             tools_4.0.3              
##  [65] cachem_1.0.4              generics_0.1.0           
##  [67] RSQLite_2.2.6             evaluate_0.14            
##  [69] stringr_1.4.0             fastmap_1.1.0            
##  [71] yaml_2.2.1                bit64_4.0.5              
##  [73] purrr_0.3.4               nlme_3.1-149             
##  [75] sparseMatrixStats_1.2.1   mime_0.10                
##  [77] R.oo_1.24.0               ggExtra_0.9              
##  [79] xml2_1.3.2                compiler_4.0.3           
##  [81] rstudioapi_0.13           beeswarm_0.2.3           
##  [83] curl_4.3                  tibble_3.1.1             
##  [85] statmod_1.4.35            bslib_0.2.4              
##  [87] stringi_1.5.3             highr_0.8                
##  [89] lattice_0.20-41           bluster_1.0.0            
##  [91] vctrs_0.3.7               pillar_1.6.0             
##  [93] lifecycle_1.0.0           rhdf5filters_1.2.0       
##  [95] jquerylib_0.1.3           BiocNeighbors_1.8.2      
##  [97] cowplot_1.1.1             bitops_1.0-6             
##  [99] httpuv_1.5.5              R6_2.5.0                 
## [101] promises_1.1.1            bookdown_0.21            
## [103] gridExtra_2.3             vipor_0.4.5              
## [105] codetools_0.2-16          MASS_7.3-53              
## [107] assertthat_0.2.1          rhdf5_2.34.0             
## [109] openssl_1.4.3             withr_2.4.2              
## [111] GenomeInfoDbData_1.2.4    mgcv_1.8-33              
## [113] hms_1.0.0                 grid_4.0.3               
## [115] beachmat_2.6.4            rmarkdown_2.7            
## [117] DelayedMatrixStats_1.12.3 segmented_1.3-3          
## [119] shiny_1.5.0               ggbeeswarm_0.6.0</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="PreProcAllCellsTop.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="NormalisationAllCellsTop.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/preProc.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["MkWiC.pdf", "MkWiC.epub"],
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"code_folding": "hide"
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
